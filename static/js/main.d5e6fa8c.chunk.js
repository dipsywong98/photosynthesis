(this.webpackJsonpphotosynthesis=this.webpackJsonpphotosynthesis||[]).push([[0],{108:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=108},118:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),a=n(71),i=n.n(a),c=n(3),s=n(12),l=n(30),u=n(7),d=n(36),h=n(16),b=n(119),f=Object(h.o)(.6),v={blue:"#3976E9",red:"#E4456F",green:"#2AC87D",yellow:"#E99608",gray:"#9CC6E9"},p={blue:"#4168AE",red:"#925666",green:"#569276",yellow:"#D49E41",gray:"#8E959B"},g={blue:"#7ea6f1",red:"#ed86a1",green:"#74dbaa",yellow:"#f1bb5e",gray:"#bfdaf1"},O=Object(c.a)(Object(c.a)({},v),{},{vibrantHighlights:Object(b.a)(f,v),dark:["#282c30","#383e43","#484f56"],light:["#E0E3E5","#c0c2c4","#a0a1a3"],white:["#f9fbfc","#f0f2f3","#e8ebec"]}),m=Object(c.a)(Object(c.a)({},O),{},{primary:O.blue,accent:O.yellow,inputFocus:Object(h.o)(.2,O.blue)}),y=Object(c.a)(Object(c.a)({},m),{},{blue:[m.blue,p.blue],red:[m.red,p.red],green:[m.green,p.green],yellow:[m.yellow,p.yellow],fgHighlights:Object(b.a)(f,p),bgHighlights:Object(b.a)(f,g),gray:[m.gray,p.gray],text:m.dark[0],muted:f(m.dark[0]),background:m.white[0],bgs:m.white,fgs:m.dark,bgPales:m.light.map(f),fgPales:m.dark.map(f),border:Object(h.o)(.8,O.dark[0]),highlight:Object(h.o)(.9,O.dark[0]),sunTagShadow:"#9c4727",code:{color:"#0451a5",backgroundColor:"#ffffff",prolog:"#001080",comment:"#008000",keyword:"#0000FF",number:"#09885a",constant:"#0000ff",variable:"#001080",string:"#a31515",selector:"#800000",tag:"#800000",operator:"#000000",punctuation:"#000000",function:"#795e26",className:"#267f99",char:"#a31515"}}),j=Object(c.a)(Object(c.a)({},m),{},{blue:[m.blue,g.blue],red:[m.red,g.red],green:[m.green,g.green],yellow:[m.yellow,g.yellow],gray:[m.gray,g.gray],fgHighlights:Object(b.a)(f,g),bgHighlights:Object(b.a)(f,p),text:m.light[0],muted:f(m.light[0]),background:m.dark[0],bgs:m.dark,fgs:m.light,bgPales:m.dark.map(f),fgPales:m.light.map(f),border:Object(h.o)(.8,O.light[0]),highlight:Object(h.o)(.9,O.light[0]),code:{color:"#9CDCFE",backgroundColor:"#1E1E1E",prolog:"#9cdcfe",comment:"rgb(106, 153, 85)",keyword:"rgb(86, 156, 214)",number:"rgb(181, 206, 168)",constant:"rgb(100, 102, 149)",variable:"rgb(156, 220, 254)",string:"rgb(206, 145, 120)",selector:"rgb(215, 186, 125)",tag:"rgb(86, 156, 214)",operator:"#808080",punctuation:"rgb(212, 212, 212)",function:"rgb(220, 220, 170)",className:"rgb(78, 201, 176)",char:"rgb(209, 105, 105)"}}),w=.3,E=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ease";return{transition:t.map((function(t){return"".concat(e,"s ").concat(t," ").concat(n)})).join(",")}},x=function(e){return E(.1,e)},k={px:3,py:2},S=Object(c.a)(Object(c.a)({borderRadius:1,border:"1px solid",borderColor:"border"},x(["box-shadow"])),{},{boxShadow:"0 0 0 0 transparent",":focus, &.focus":{boxShadow:function(e){return"0 0 0 3px ".concat(e.colors.inputFocus)},borderColor:"unset"},lineHeight:"input",backgroundColor:"transparent",color:"text",fontFamily:"body",fontWeight:"body",fontSize:1}),C=Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)({},S),k),x(["background-color"])),{},{display:"inline-flex",alignItems:"center",textAlign:"unset",outline:"none","::-moz-focus-inner":{border:"none"},cursor:"pointer",":disabled":{cursor:"default"}}),R={borderRadius:4},T=Object(c.a)(Object(c.a)({},C),{px:1,py:1}),A=Object(c.a)(Object(c.a)({},C),{px:2,py:2}),P={"":C,"-sm":T,"-md":A,"-borderless":Object(c.a)(Object(c.a)({},C),{},{border:0}),"-borderless-sm":Object(c.a)(Object(c.a)({},T),{},{border:0}),"-borderless-md":Object(c.a)(Object(c.a)({},A),{},{border:0}),"-pill":Object(c.a)(Object(c.a)(Object(c.a)({},C),R),{},{px:5}),"-pill-sm":Object(c.a)(Object(c.a)(Object(c.a)({},T),R),{},{px:3}),"-pill-md":Object(c.a)(Object(c.a)(Object(c.a)({},A),R),{},{px:4})},M={normal:{fg:"text",bg:"background",hoverBg:"highlight"},primary:{fg:"white.0",bg:"blue.0",hoverBg:"blue.1"},success:{fg:"white.0",bg:"blue.0",hoverBg:"blue.1"},warning:{fg:"dark.0",bg:"yellow.0",hoverBg:"yellow.1"},danger:{fg:"white.0",bg:"red.0",hoverBg:"red.1"},red:{fg:"white.0",bg:"red.0",hoverBg:"red.1"},active:{fg:"white.0",bg:"blue.0"},transparent:{fg:"fgs.0",bg:"transparent",hoverBg:"highlight",border:0}},N={};for(var _ in P)for(var D in M)N[D+_]=Object(c.a)(Object(c.a)({},P[_]),{},{backgroundColor:M[D].bg,color:M[D].fg,"*":{fill:M[D].fg},":hover":{backgroundColor:M[D].hoverBg},"&:disabled":{backgroundColor:"light.0",color:"light.1"}});var H=N,I=Object(c.a)(Object(c.a)({},S),k),L=Object(c.a)({position:"absolute",top:"12px",pt:"1px",left:k.px,pointerEvents:"none",ml:-1,px:1,fontSize:1,borderRadius:1,color:"fgs.1"},x(["top","font-size","color","background-color"])),G={backgroundColor:"background",fontSize:0,top:"-10px"},W=Object(c.a)(Object(c.a)({},{"::placeholder":{color:"transparent"}}),{},{"+ *":Object(c.a)({},L),":not(:placeholder-shown) + *":Object(c.a)({},G),":focus + *":Object(c.a)(Object(c.a)({},G),{color:"blue"})}),z={normal:I,baseMagic:W,inputMagic:Object(c.a)(Object(c.a)({},I),W)},B=Object(c.a)(Object(c.a)({},k),{},{color:"text",display:"block",":hover":{backgroundColor:"highlight"}}),q=Object(c.a)(Object(c.a)({},S),{},{boxShadow:2,backgroundColor:"bgs.1",lineHeight:1.8,overflow:"hidden",zIndex:1}),U=[4,5,6],F=U.map((function(e){return function(t){return t.fontSizes[e]}})),Y={fontSize:1,success:{color:"green.1"},danger:{color:"red.1"},warning:{color:"yellow.1"},heading:{fontSize:[3,4],mb:3},subheading:{textTransform:"uppercase",letterSpacing:"2px",fontWeight:"bold",fontSize:2,color:"fgs.0",mb:3},pageHeading:{fontSize:U,mb:3,svg:{color:"#ff0000",width:F,height:F}},largeHeading:{fontSize:[5,null,7],mb:3},columnHeading:{fontSize:2,fontWeight:"bold"},columnCardHeading:{fontSize:2,fontWeight:"bold"},helperText:{fontSize:0,color:"muted"}},K={p:3,px:3,py:3,my:3,borderRadius:1,borderWidth:1,borderStyle:"solid",borderColor:"border"},V={normal:Object(c.a)({},K),dashed:Object(c.a)(Object(c.a)({},K),{},{borderStyle:"dashed"}),primary:Object(c.a)(Object(c.a)({},K),{},{borderColor:"blue.1"}),danger:Object(c.a)(Object(c.a)({},K),{},{borderColor:"red.1",backgroundColor:Object(h.o)(.7,m.red)}),warning:Object(c.a)(Object(c.a)({},K),{},{borderColor:"yellow.1"}),success:Object(c.a)(Object(c.a)({},K),{},{borderColor:"green.1",backgroundColor:Object(h.o)(.7,m.green)})},J={borderRadius:1},X=function(e,t){return Object(c.a)(Object(c.a)({},J),{},{borderColor:e,color:t,"*":{fill:t}})},Q={primary:X("blue.0","blue.1"),info:X("gray.0","gray.1"),danger:X("red.0","red.1"),warning:X("yellow.0","yellow.1"),success:X("green.0","green.1")},Z={useColorSchemeMediaQuery:!0,colors:Object(c.a)(Object(c.a)({},y),{},{modes:{dark:j}}),bg:{success:m.green[0],danger:m.red[0],warning:m.yellow[0]},text:Y,breakpoints:["40em","52em","64em","110em"],space:[0,4,8,16,32,64,128,256,512],fonts:{body:"Nunito",heading:"inherit",monospace:"Inconsolata, monospace"},fontSizes:[12,14,16,20,24,32,48,64,96],fontWeights:{body:400,heading:300,bold:700},lineHeights:{body:1.5,heading:1.3,input:1.7},radii:[0,4,8,16,32],shadows:["none","0 2px 4px rgba(0, 0, 0, 0.2)","0 4px 8px rgba(0, 0, 0, 0.3)"],layout:{container:{maxWidth:"100em",p:[3,null,4]},sidebar:{width:"250px"}},buttons:H,inputs:z,badges:{primary:{backgroundColor:"blue.0",color:"white.0","*":{fill:"white.0"}},success:{backgroundColor:"green.0",color:"white.0","*":{fill:"white.0"}},danger:{backgroundColor:"red.0",color:"white.0","*":{fill:"white.0"}},warning:{backgroundColor:"yellow.0",color:"dark.0","*":{fill:"dark.0"}}},messages:Q,code:{fontFamily:"monospace",fontSize:"inherit",color:"code.color",backgroundColor:"code.backgroundColor",borderRadius:1,borderWidth:"1px",borderStyle:"solid",borderColor:"border",p:3,tabSize:4,MozTabSize:"4",".token-line":{display:"flex"},".token":{display:"inline-block",lineHeight:1.5},".prolog":{color:"code.prolog"},".comment":{color:"code.comment"},".builtin,.changed,.keyword":{color:"code.keyword"},".number":{color:"code.number"},".constant":{color:"code.constant"},".attr-name,.variable":{color:"code.variable"},".string,.attr-value":{color:"code.string"},".selector":{color:"code.selector"},".tag":{color:"code.tag"},".punctuation,.operator":{color:"code.operator"},".punctuation, .plain":{color:"code.punctuation"},".function":{color:"code.function"},".class-name":{color:"code.className"},".char":{color:"code.char"},".inserted":{backgroundColor:"fgHighlights.green"},".deleted":{backgroundColor:"fgHighlights.red"},".special":{color:"red.0"},".tab":{position:"relative","::before":{position:"absolute",left:"1px",top:"calc(50% - 0.5px)",content:'""',width:"calc(100% - 3.5px)",borderTopWidth:"1px",borderTopStyle:"solid",borderTopColor:"red.0"},"::after":{position:"absolute",right:"1px",top:0,content:'">"',color:"red.0"}}},menuItem:B,links:{default:{color:"blue.1","*":{fill:"blue.1"},":hover":{color:"blue.0","*":{fill:"blue.0"}}},plain:{color:"gray.1","*":{fill:"gray.1"},":hover":{color:"gray.0","*":{fill:"gray.0"}}},active:{color:"yellow.1","*":{fill:"yellow.1"},":hover":{color:"yellow.0","*":{fill:"yellow.0"}}}},dropdown:q,wells:V,styles:{root:{fontFamily:"body",fontWeight:"body",lineHeight:"body"},"*":{boxSizing:"border-box"},body:{margin:0,overscrollBehaviorY:"contain"},h1:{color:"text",fontFamily:"heading",lineHeight:"heading",fontWeight:"heading",fontSize:5},h2:{color:"text",fontFamily:"heading",lineHeight:"heading",fontWeight:"heading",fontSize:4},h3:{color:"text",fontFamily:"heading",lineHeight:"heading",fontWeight:"heading",fontSize:3},h4:{color:"text",fontFamily:"heading",lineHeight:"heading",fontWeight:"heading",fontSize:2},h5:{color:"text",fontFamily:"heading",lineHeight:"heading",fontWeight:"heading",fontSize:1},h6:{color:"text",fontFamily:"heading",lineHeight:"heading",fontWeight:"heading",fontSize:0},p:{color:"text",fontFamily:"body",fontWeight:"body",lineHeight:"body"},a:{textDecoration:"none",outline:"none","::-moz-focus-inner":{border:"none"}},pre:{fontFamily:"monospace",overflowX:"auto",code:{color:"inherit"}},table:{width:"100%",borderCollapse:"separate",borderSpacing:0},th:{textAlign:"left",borderBottomStyle:"solid"},td:{textAlign:"left",borderBottomStyle:"solid"},img:{maxWidth:"100%"},hr:{borderTop:"1px solid",borderBottom:"none",borderColor:"border"}}},$=n(10),ee=n.n($),te=function(e){return void 0!==e&&null!==e},ne=n(0),re={block:ee.a.bool},oe=Object(r.forwardRef)((function(e,t){return Object(ne.b)(u.c,Object(c.a)({ref:t,variant:"normal",sx:{display:te(e.block)&&e.block?"flex":void 0,width:te(e.block)&&e.block?"100%":void 0,justifyContent:te(e.block)&&e.block?"center":void 0,position:"relative"}},e))}));oe.propTypes=re,oe.defaultProps={block:!1},oe.displayName="Button";var ae=oe,ie=n(81),ce=n.n(ie),se=function(e){var t=e.color,n=e.size,r=e.sx,o=Array.isArray(n)&&n.reduce((function(e,t){return e&&"number"===typeof t}),!0)||"number"===typeof n,a=Array.isArray(n)?n:"number"===typeof n?[n]:n,i=o?a.map((function(e){return function(t){return t.fontSizes[e]*t.lineHeights.body}})):a;return Object(ne.b)(ce.a,Object(c.a)(Object(c.a)({},Object(c.a)(Object(c.a)({},e),{},{color:null,size:null})),{},{sx:Object(c.a)({fill:t,height:i,width:i},r)}))};se.defaultProps={color:"text",size:1};var le=se,ue=(ee.a.func.isRequired,ee.a.number.isRequired,function(){var e,t=Object(d.b)(),n=Object(s.a)(t,2),r=n[0],o=n[1];return Object(ne.c)(u.e,{py:2,px:null===(e=Z.layout)||void 0===e?void 0:e.container.p,sx:{alignItems:"center",position:"fixed",width:"100%",zIndex:1},children:[Object(ne.b)(u.e,{mr:2,sx:{alignItems:"center",flex:1}}),Object(ne.b)(u.e,{ml:"auto",sx:{alignItems:"center"},children:Object(ne.b)(ae,{onClick:function(){return o("default"===r?"dark":"default")},mr:2,title:"Toggle Dark Mode",children:Object(ne.b)(le,{path:l.c})})})]})}),de=n(15),he=function(e){return Object(ne.b)(u.b,Object(c.a)({as:"input",__themeKey:"inputs",variant:"normal"},e))},be=function(e){return Object(ne.b)(ae,{variant:e.variant||"normal-sm",type:"button",sx:Object(c.a)(Object(c.a)({},e.sx),{},{visibility:void 0!==e.hidden&&null!==e.hidden&&e.hidden?"hidden":"unset",overflow:"hidden"}),onClick:e.onClick,children:Object(ne.b)(le,{path:e.path,sx:e.iconSx,color:e.color,size:e.size})})},fe=(ee.a.bool,ee.a.string.isRequired,ee.a.object,ee.a.string,ee.a.bool,ee.a.func,ee.a.func,ee.a.string,function(e){var t,n,r,o=e.onClearClick,a=Object(de.a)(e,["onClearClick"]);return Object(ne.c)(u.b,{mt:3,sx:Object(c.a)({width:null!==(t=a.fullwidth)&&void 0!==t&&t?"100%":void 0},a.sx),children:[Object(ne.c)(u.h,{sx:{position:"relative"},children:[Object(ne.b)(he,Object(c.a)(Object(c.a)({},a),{},{placeholder:a.label,variant:"inputMagic",sx:Object(c.a)({width:null!==(n=a.fullwidth)&&void 0!==n&&n?"100%":void 0},a.sx)})),Object(ne.b)(u.i,{children:a.label}),null!==(r=a.disabled)&&void 0!==r&&r||void 0===o?null:Object(ne.b)(u.b,{sx:{position:"absolute",right:1,top:"50%",transform:"translateY(-50%)"},children:Object(ne.b)(be,{variant:"transparent-borderless-sm",path:l.d,onClick:o})})]}),Object(ne.b)(u.i,{variant:"helperText",children:a.helperText})]})}),ve=Object(r.forwardRef)((function(e,t){return Object(ne.b)(u.b,Object(c.a)({ref:t,__themeKey:"wells",variant:"normal"},e))}));ve.displayName="Well";var pe=ve,ge=n(55),Oe=n(9),me=n(11),ye=n.n(me),je=n(14),we=n(4),Ee=n(8),xe=n(27),ke=n(5),Se=n(6),Ce=n(24),Re=n(18),Te=n(124),Ae=n(92),Pe=5e3;function Me(e){return"function"===typeof e}var Ne,_e,De=function(){function e(){Object(we.a)(this,e),this._onEventListeners={},this._onceEventListeners={}}return Object(Ee.a)(e,[{key:"on",value:function(e,t){var n=this._onEventListeners[e];void 0===n&&(n=this._onEventListeners[e]={});var r=Object(Te.a)();return n[r]=t,r}},{key:"onMatch",value:function(e,t,n){return this.on(e,(function(e){Me(n)?n(e)&&t(e):(Object(Ae.a)(n,e)||"object"===typeof n&&null!==n&&"_"in n&&Object.keys(n._).reduce((function(t,r){return t&&Object(Ae.a)(n._[r],e[r])}),!0))&&t(e)}))}},{key:"once",value:function(e,t){var n=this._onceEventListeners[e];void 0===n&&(n=this._onceEventListeners[e]={});var r=Object(Te.a)();return n[r]=t,r}},{key:"onceMatch",value:function(e,t,n){return this.once(e,(function(e,r){Me(n)?n(e)?t(e,r):null===r||void 0===r||r():Object(Ae.a)(n,e)||"object"===typeof n&&null!==n&&"_"in n&&Object.keys(n._).reduce((function(t,r){return t&&Object(Ae.a)(n._[r],e[r])}),!0)?t(e,r):null===r||void 0===r||r()}))}},{key:"until",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){var n,r=this,o=arguments;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:Pe,o.length>2?o[2]:void 0,e.next=4,new Promise((function(e,o){var a=window.setTimeout((function(){o(new Error(t.toString()+" timeout"))}),n);r.once(t,(function(t){window.clearTimeout(a),e(t)}))}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"untilMatch",value:function(){var e=Object(je.a)(ye.a.mark((function e(t,n){var r,o=this,a=arguments;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:Pe,a.length>3?a[3]:void 0,void 0!==n){e.next=4;break}throw new Error("expect undefined");case 4:return e.next=6,new Promise((function(e,a){var i=window.setTimeout((function(){a(new Error("".concat(t," ").concat(JSON.stringify(n)," timeout")))}),r);o.onceMatch(t,(function(t){window.clearTimeout(i),e(t)}),n)}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"off",value:function(e,t){var n,r,o,a;null===(n=this._onEventListeners)||void 0===n||(null===(r=n[e])||void 0===r||delete r[t]),null===(o=this._onceEventListeners)||void 0===o||(null===(a=o[e])||void 0===a||delete a[t])}},{key:"emit",value:function(e,t){var n,r,o,a,i,c,l=this;null===(n=Object.values(null!==(r=null===(o=this._onEventListeners)||void 0===o?void 0:o[e])&&void 0!==r?r:{}))||void 0===n||n.forEach((function(e){e(t)}));var u=[];null===(a=Object.entries(null!==(i=null===(c=this._onceEventListeners)||void 0===c?void 0:c[e])&&void 0!==i?i:{}))||void 0===a||a.forEach((function(e){var n=Object(s.a)(e,2),r=n[0],o=n[1],a=!1;o(t,(function(){a=!0})),a||u.push(r)})),u.forEach((function(t){l.off(e,t)}))}}]),e}();!function(e){e.ANY="*",e.PEER_OPEN="_open",e.PEER_CLOSE="_close",e.PEER_CONNECT="_connect",e.PEER_DISCONNECT="_disconnect",e.PEER_ERROR="_error",e.CONN_OPEN="open",e.CONN_CLOSE="close",e.CONN_DATA="data",e.CONN_ERROR="error",e.CONN_ACK="ack",e.CONN_PKG="pkg"}(Ne||(Ne={})),function(e){e.ALERT="alert",e.XD="xd",e[e.JOIN=0]="JOIN",e[e.MEMBER_CHANGE=1]="MEMBER_CHANGE",e[e.NEW_JOIN=2]="NEW_JOIN",e[e.ACK=3]="ACK",e[e.PLAYER_LEFT=4]="PLAYER_LEFT",e[e.CHANGE_HOST=5]="CHANGE_HOST",e[e.RENAME=6]="RENAME",e[e.START_GAME=7]="START_GAME",e[e.GAME_EVENT=8]="GAME_EVENT",e[e.UPDATE_GAME_STATE=9]="UPDATE_GAME_STATE",e[e.DISPATCH=10]="DISPATCH",e[e.SET_STATE=11]="SET_STATE",e[e.PROMOTE=12]="PROMOTE",e[e.CANCEL=13]="CANCEL"}(_e||(_e={}));var He=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(e,r){var o;return Object(we.a)(this,n),(o=t.call(this)).conn=void 0,o.manager=void 0,o.dataHandler=function(e){return function(t){var n=Object(s.a)(t,2),r=n[0],a=n[1];if(void 0!==a&&a._t!==_e.ACK){var i,c=function(e){i=e};o.emit(Ne.CONN_DATA,{conn:Object(xe.a)(o),data:a,ack:c}),"object"===typeof a&&void 0!==a._t&&o.emit(Ne.CONN_PKG,{conn:Object(xe.a)(o),data:a.data,type:a._t,ack:c}),void 0!==e?e.send([r,{_t:_e.ACK,data:i}]):void 0===i?o.dataHandler()([r,{_t:_e.ACK,data:void 0}]):o.dataHandler()([r,{_t:_e.ACK,data:i}])}else"object"===typeof a&&null!==a&&void 0!==a._t?o.emit(Ne.CONN_ACK,{conn:Object(xe.a)(o),data:a.data,type:a._t,pid:r}):o.emit(Ne.CONN_ACK,{conn:Object(xe.a)(o),data:a,pid:r})}},"self"!==e&&(o.conn=e,o.enrichConn(e)),o.manager=r,o}return Object(Ee.a)(n,[{key:"log",value:function(){var e;(e=this.manager).log.apply(e,arguments)}},{key:"id",get:function(){return void 0!==this.conn?this.conn.peer:this.manager.id}},{key:"send",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){var n,r,o=this;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(Te.a)().split("-")[0],r=this.manager.untilMatch(Ne.CONN_ACK,(function(e){return e.pid===n})),void 0!==this.conn?this.conn.open?this.conn.send([n,t]):this.conn.on("open",(function(){var e;null===(e=o.conn)||void 0===e||e.send([n,t])})):this.dataHandler()([n,t]),e.next=5,r;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendPkg",value:function(){var e=Object(je.a)(ye.a.mark((function e(t,n){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send({data:n,_t:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e;null===(e=this.conn)||void 0===e||e.close(),this.emit(Ne.CONN_CLOSE,{conn:this})}},{key:"enrichConn",value:function(e){var t=this;return e.on("open",(function(){t.emit(Ne.CONN_OPEN,{conn:t})})),e.on("data",this.dataHandler(e)),e.on("error",(function(e){t.emit(Ne.CONN_ERROR,{conn:t,error:e})})),e.on("close",(function(){t.emit(Ne.CONN_CLOSE,{conn:t})})),e}},{key:"emit",value:function(e,t){Object(Ce.a)(Object(Re.a)(n.prototype),"emit",this).call(this,e,t),this.manager.emit(e,t)}}]),n}(De),Ie=n(73),Le=n.n(Ie),Ge=function(){function e(){var t=this;Object(we.a)(this,e),this.bufferSize=void 0,this.dataChannel=void 0,this.label="my label",this.metadata=void 0,this.open=!1,this.peer="peer",this.peerConnection=void 0,this.reliable=!0,this.serialization="binary",this.type="data",this.otherEnd=void 0,this.hostPeer=void 0,this.callbacks={},this.sent=[],window.setTimeout((function(){t.open=!0,t.trigger("open")}),1)}return Object(Ee.a)(e,[{key:"parse",value:function(){throw new Error("not implemented")}},{key:"stringify",value:function(e){throw new Error("not implemented")}},{key:"close",value:function(){var e=this;if(this.open){var t,n;if(this.open=!1,void 0!==this.hostPeer)this.hostPeer.connections=null===(t=this.hostPeer)||void 0===t?void 0:t.connections.filter((function(t){return t!==e}));if(void 0!==this.otherEnd)if(this.otherEnd.open=!1,void 0!==this.otherEnd.hostPeer)this.otherEnd.hostPeer.connections=null===(n=this.otherEnd.hostPeer)||void 0===n?void 0:n.connections.filter((function(t){return t!==e.otherEnd}));window.setTimeout((function(){var t;null===(t=e.otherEnd)||void 0===t||t.trigger("close"),e.trigger("close")}),1)}}},{key:"off",value:function(e,t,n){throw new Error("not implemented")}},{key:"on",value:function(e,t){e in this.callbacks||(this.callbacks[e]=[]),this.callbacks[e].push(t)}},{key:"trigger",value:function(e,t){var n;null===(n=this.callbacks[e])||void 0===n||n.forEach((function(e){e(t)}))}},{key:"send",value:function(e){var t;if(!this.open)throw new Error("Send data before opening");this.sent.push(e),Promise.resolve(null===(t=this.otherEnd)||void 0===t?void 0:t.trigger("data",e))}}]),e}(),We=function(){function e(){Object(we.a)(this,e),this.bufferSize=void 0,this.dataChannel=void 0,this.label="my label",this.metadata=void 0,this.open=!0,this.peer="peer",this.peerConnection=void 0,this.reliable=!0,this.serialization="binary",this.type="data",this.callbacks={},this.sent=[]}return Object(Ee.a)(e,[{key:"parse",value:function(){throw new Error("not implemented")}},{key:"stringify",value:function(e){return""}},{key:"close",value:function(){this.open=!1}},{key:"off",value:function(e,t,n){this.callbacks[e]=this.callbacks[e].filter((function(e){return e!==t}))}},{key:"trigger",value:function(e,t){var n;null===(n=this.callbacks[e])||void 0===n||n.forEach((function(e){return e(t)}))}},{key:"send",value:function(e){this.sent.push(e)}},{key:"answer",value:function(e,t){throw new Error("not implemented")}},{key:"on",value:function(e,t){e in this.callbacks||(this.callbacks[e]=[]),this.callbacks[e].push(t)}}]),e}(),ze=function(){function e(t,n){var r=this;if(Object(we.a)(this,e),this.connections=[],this.destroyed=!1,this.disconnected=!1,this.id="some id",this.prototype=void 0,this.callbacks={},this.id=null!==t&&void 0!==t?t:Object(Te.a)(),this.id in e.allPeers)throw new Error("Peer '".concat(this.id,"' already exist"));e.allPeers[this.id]=this,window.setTimeout((function(){r.trigger("open",r.id)}),1)}return Object(Ee.a)(e,[{key:"call",value:function(e,t,n){return new We}},{key:"connect",value:function(t,n){if(void 0===e.allPeers[t])throw new Error;var r=e.allPeers[t],o=new Ge,a=new Ge;return this.connections.push(o),r.connections.push(a),o.peer=t,a.peer=this.id,o.otherEnd=a,a.otherEnd=o,o.hostPeer=this,a.hostPeer=r,r.trigger("connection",a),o}},{key:"destroy",value:function(){this.destroyed=!0,this.connections.forEach((function(e){e.close()}));var t=e.allPeers,n=this.id,r=(t[n],Object(de.a)(t,[n].map(ge.a)));e.allPeers=r}},{key:"disconnect",value:function(){this.disconnected=!0;var t=e.allPeers,n=this.id,r=(t[n],Object(de.a)(t,[n].map(ge.a)));e.allPeers=r}},{key:"getConnection",value:function(e,t){var n;return null!==(n=this.connections.find((function(t){return t.peer===e})))&&void 0!==n?n:null}},{key:"listAllPeers",value:function(e){throw new Error("not implemented")}},{key:"off",value:function(e,t,n){throw new Error("not implemented")}},{key:"on",value:function(e,t){e in this.callbacks||(this.callbacks[e]=[]),this.callbacks[e].push(t)}},{key:"trigger",value:function(e,t){var n;null===(n=this.callbacks[e])||void 0===n||n.forEach((function(e){e(t)}))}},{key:"reconnect",value:function(){throw new Error("not implemented")}}]),e}();ze.allPeers={};var Be,qe,Ue,Fe,Ye,Ke,Ve,Je,Xe,Qe={peers:[],useFake:!1,make:function(e){var t,n=Qe.peers.shift();return void 0!==n?n:Qe.useFake?new ze(e):new Le.a(e,{host:null!==(t="peer.dipsy.me")?t:"localhost",port:Number.parseInt(null!=="443"?"443":"9000"),path:null!=="/"?"/":"/peer",secure:!0,config:JSON.parse('{"iceTransportPolicy":"all","iceServers":[{"urls":"stun:api.dipsy.me:3478"},{"urls":"turn:api.dipsy.me:3478","username":"hello","credential":"world"}]}')})}},Ze=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(e){var r;return Object(we.a)(this,n),(r=t.call(this)).id=void 0,r.peer=void 0,r.connections=[],r.closed=!1,r.log=function(){},r.onPeerOpenHandler=function(e){return function(t){r.id=t,r.emit(Ne.PEER_OPEN,{}),e.on("connection",r.onPeerConnectionHandler)}},r.onPeerConnectionHandler=function(e){r.log("connect",e.peer);var t=r.enrichConn(new He(e,Object(xe.a)(r)));t.once(Ne.CONN_OPEN,(function(){r.emit(Ne.PEER_CONNECT,{conn:t})}))},r.peer=r.initPeer(e),r.id=r.peer.id,r.on(Ne.CONN_CLOSE,(function(e){var t=e.conn;void 0!==t&&(r.connections=r.connections.filter((function(e){return e.id!==t.id})))})),r}return Object(Ee.a)(n,[{key:"isClosed",value:function(){return this.closed||this.peer.disconnected}},{key:"connect",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){var n,r,o=this,a=arguments;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:5e3,void 0===(r=this.connections.find((function(e){return e.id===t})))){e.next=4;break}return e.abrupt("return",Promise.resolve(r));case 4:if(t!==this.id){e.next=6;break}return e.abrupt("return",this.enrichConn(new He("self",this)));case 6:return e.next=8,new Promise((function(e,r){var a=setTimeout((function(){}),n),i=o.once(Ne.PEER_ERROR,(function(e){var t=e.error;r(t)})),c=o.peer.connect(t),s=function(){var t=o.enrichConn(new He(c,o));o.off(Ne.CONN_ERROR,i),e(t),clearTimeout(a)};c.on("open",(function(){s()})),c.open&&s()}));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connectPrefix",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connect(n.prefixId(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"broadcast",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.connections.map(function(){var e=Object(je.a)(ye.a.mark((function e(n){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.send(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"broadcastPkg",value:function(){var e=Object(je.a)(ye.a.mark((function e(t,n){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.connections.map(function(){var e=Object(je.a)(ye.a.mark((function e(r){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.sendPkg(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"conn",value:function(e){var t=this.connections.find((function(t){return t.id===e}));if(void 0===t)throw new Error("connection lost with ".concat(e));return t}},{key:"send",value:function(){var e=Object(je.a)(ye.a.mark((function e(t,n){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.conn(t).send(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendPkg",value:function(){var e=Object(je.a)(ye.a.mark((function e(t,n,r){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.conn(t).sendPkg(n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"initPeer",value:function(e){var t=this,n=Qe.make(e);return n.on("open",this.onPeerOpenHandler(n)),n.on("error",(function(e){t.emit(Ne.PEER_ERROR,{error:e})})),n.on("close",(function(){t.emit(Ne.PEER_CLOSE,{})})),n.on("disconnected",(function(){t.emit(Ne.PEER_DISCONNECT,{})})),n}},{key:"onPkg",value:function(e,t){return Object(Ce.a)(Object(Re.a)(n.prototype),"onMatch",this).call(this,Ne.CONN_PKG,(function(n){var r=n.data,o=Object(de.a)(n,["data"]);t(Object(c.a)(Object(c.a)({},o),{},{data:r,type:e}))}),{_:{type:e}})}},{key:"oncePkg",value:function(e,t){return Object(Ce.a)(Object(Re.a)(n.prototype),"onceMatch",this).call(this,Ne.CONN_PKG,(function(n){var r=n.data,o=Object(de.a)(n,["data"]);t(Object(c.a)(Object(c.a)({},o),{},{data:r,type:e}))}),{_:{type:e}})}},{key:"untilPkg",value:function(){var e=Object(je.a)(ye.a.mark((function e(t,r){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}throw new Error("trying to subscribe undefined pkgType");case 2:return e.next=4,Object(Ce.a)(Object(Re.a)(n.prototype),"untilMatch",this).call(this,Ne.CONN_PKG,{_:{type:t}},r,t).then((function(e){var n=e.data,r=Object(de.a)(e,["data"]);return Object(c.a)(Object(c.a)({},r),{},{data:n,type:t})}));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){return Object(Ce.a)(Object(Re.a)(n.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return Object(Ce.a)(Object(Re.a)(n.prototype),"once",this).call(this,e,t)}},{key:"emit",value:function(e,t){var r=t.conn,o=Object(de.a)(t,["conn"]);this.log("emit",e,Object(c.a)(Object(c.a)({},o),void 0!==r?{conn:{id:null===r||void 0===r?void 0:r.id}}:{})),Object(Ce.a)(Object(Re.a)(n.prototype),"emit",this).call(this,e,t)}},{key:"enrichConn",value:function(e){return this.connections.push(e),e}},{key:"disconnect",value:function(e){var t;null===(t=this.connections.find((function(t){return t.id===e})))||void 0===t||t.close()}},{key:"disconnectAll",value:function(){this.connections.map((function(e){return e.close()}))}},{key:"destroy",value:function(){this.closed=!0,this.peer.destroy(),this.disconnectAll()}},{key:"close",value:function(){this.closed=!0,this.peer.destroy(),this.disconnectAll()}}],[{key:"prefixId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"creamy9tale000000"+e}},{key:"withPrefix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new n(n.prefixId(e))}},{key:"startPrefix",value:function(){var e=Object(je.a)(ye.a.mark((function e(){var t,r=arguments;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",e.next=3,n.startAs(n.prefixId(t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"startAs",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,r){var o=new n(t);o.once(Ne.PEER_OPEN,(function(){e(o)})),o.once(Ne.PEER_ERROR,(function(e){r(e.error)}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(De),$e=n(22),et=n(2),tt=n(13),nt=2*Math.PI,rt="/photosynthesis/images",ot={BLUE_TOP:"blueTop",ORANGE_TOP:"orangeTop",YELLOW_TOP:"yellowTop",GREEN_TOP:"greenTop",TRUNK:"trunk",SHADE:"shade",GROUND_SHADE:"groundShade",ACORN:"acorn",PINE_CONE:"pineCone",MAPLE_SEED:"mapleSeed",BASSWOOD_SEED:"basswoodSeed",RING:"ring",LANDSCAPE:"landscape"};!function(e){e[e.BLUE=0]="BLUE",e[e.ORANGE=1]="ORANGE",e[e.YELLOW=2]="YELLOW",e[e.GREEN=3]="GREEN"}(Je||(Je={})),function(e){e[e.SEED=0]="SEED",e[e.SHORT=1]="SHORT",e[e.MID=2]="MID",e[e.TALL=3]="TALL"}(Xe||(Xe={}));var at=(Be={},Object(Oe.a)(Be,Je.BLUE,ot.BLUE_TOP),Object(Oe.a)(Be,Je.ORANGE,ot.ORANGE_TOP),Object(Oe.a)(Be,Je.YELLOW,ot.YELLOW_TOP),Object(Oe.a)(Be,Je.GREEN,ot.GREEN_TOP),Be),it=(qe={},Object(Oe.a)(qe,Je.BLUE,ot.PINE_CONE),Object(Oe.a)(qe,Je.ORANGE,ot.BASSWOOD_SEED),Object(Oe.a)(qe,Je.YELLOW,ot.ACORN),Object(Oe.a)(qe,Je.GREEN,ot.MAPLE_SEED),qe),ct=(Ue={},Object(Oe.a)(Ue,Je.BLUE,1865705),Object(Oe.a)(Ue,Je.ORANGE,14233882),Object(Oe.a)(Ue,Je.YELLOW,15324444),Object(Oe.a)(Ue,Je.GREEN,5499164),Ue),st=[-18,-10.7,-5.63,0],lt=1.5*Math.PI,ut=(Fe={},Object(Oe.a)(Fe,Xe.SEED,{tree:{scale:new et.Ib(0,0,0)},seed:{scale:new et.Ib(1,1,1)}}),Object(Oe.a)(Fe,Xe.SHORT,{tree:{scale:new et.Ib(.333,.333,.333)},seed:{scale:new et.Ib(0,0,0)}}),Object(Oe.a)(Fe,Xe.MID,{tree:{scale:new et.Ib(.666,.666,.666)},seed:{scale:new et.Ib(0,0,0)}}),Object(Oe.a)(Fe,Xe.TALL,{tree:{scale:new et.Ib(1,1,1)},seed:{scale:new et.Ib(0,0,0)}}),Fe),dt=1.5,ht=(Ye={},Object(Oe.a)(Ye,Xe.SEED,1),Object(Oe.a)(Ye,Xe.SHORT,2),Object(Oe.a)(Ye,Xe.MID,3),Object(Oe.a)(Ye,Xe.TALL,4),Ye),bt=(Ke={},Object(Oe.a)(Ke,Xe.SEED,[1,1,2,2]),Object(Oe.a)(Ke,Xe.SHORT,[2,2,3,3]),Object(Oe.a)(Ke,Xe.MID,[3,3,4]),Object(Oe.a)(Ke,Xe.TALL,[4,5]),Ke),ft="".concat(50,"px"),vt=(Ve={},Object(Oe.a)(Ve,Xe.SEED,"seed"),Object(Oe.a)(Ve,Xe.SHORT,"short tree"),Object(Oe.a)(Ve,Xe.MID,"middle tree"),Object(Oe.a)(Ve,Xe.TALL,"tall tree"),Ve),pt=new et.Bb,gt=(new et.Q({color:13421772}),pt.load(rt+"/sun_segment.png",void 0,void 0,console.error)),Ot=new et.Q({transparent:!0,map:gt}),mt=new et.eb(56,56),yt=new et.P(mt,Ot);yt.rotation.x=-Math.PI/2,yt.renderOrder=1;var jt=[1,2,3,4].map((function(e){return"".concat(rt,"/leaf_").concat(e,".svg")})).map((function(e){return pt.load(e)})).map((function(e){return new et.Q({transparent:!0,map:e})})).map((function(e){var t=new et.j(5/3*2,12),n=new et.P(t,e);n.rotation.x=-Math.PI/2;var r=new et.ab;return r.name="cylinder",r.add(n),r})),wt=function(e){null===e||void 0===e||e.traverse((function(e){if(e instanceof et.P){var t=e.geometry,n=e.material;void 0!==t&&t.dispose();var r=function(e){Object.keys(e).forEach((function(t){var n=e[t];n instanceof et.Ab&&n.dispose()})),e.dispose()};void 0!==n&&(Array.isArray(n)?n.forEach(r):r(n))}}))},Et=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).color=void 0,e.growthStage=void 0,e.topObj=void 0,e.trunkObj=void 0,e.plant=void 0,e.seed=void 0,e.tree=void 0,e.shade=void 0,e.groundShade=void 0,e}return Object(Ee.a)(n,[{key:"reset",value:function(){this.plant=void 0,this.seed=void 0,this.tree=void 0,this.shade=void 0,wt(this.topObj),wt(this.trunkObj),this.topObj=void 0,this.trunkObj=void 0}}]),n}(tt.a);Et.schema={color:{type:tt.d.Number},growthStage:{type:tt.d.Number},tree:{type:tt.d.Ref,default:void 0},topObj:{type:tt.d.Ref,default:void 0},trunkObj:{type:tt.d.Ref,default:void 0},shade:{type:tt.d.Ref,default:void 0},seed:{type:tt.d.Ref,default:void 0}};var xt=n(17),kt=n(83),St={},Ct={},Rt=0,Tt=0,At=function(){var e=Object(je.a)(ye.a.mark((function e(t){var n,r,o;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=St[t])){e.next=13;break}if(Rt===Tt){e.next=10;break}return o=null!==(r=Ct[t])&&void 0!==r?r:[],void 0===Ct[t]&&(Ct[t]=o),e.next=7,new Promise((function(e,n){o.push({resolve:e,reject:n,modelName:t})}));case 7:return e.abrupt("return",e.sent);case 10:return e.abrupt("return",Promise.reject(new Error("Model not found: "+t)));case 11:e.next=14;break;case 13:return e.abrupt("return",Promise.resolve(n));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pt=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){return Object(we.a)(this,n),t.apply(this,arguments)}return n}(tt.c),Mt=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(e,r){var o;if(Object(we.a)(this,n),(o=t.call(this,e,r)).gameWorld=void 0,void 0===(null===r||void 0===r?void 0:r.gameWorld))throw new Error("Game world must be provided");return o.gameWorld=null===r||void 0===r?void 0:r.gameWorld,o}return n}($e.a),Nt=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).axial=void 0,e}return n}(tt.a);Nt.schema={axial:{type:tt.d.Ref}};var _t=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).material=void 0,e.treeEntity=void 0,e}return n}(tt.a);_t.schema={material:{type:tt.d.Ref,default:void 0},treeEntity:{type:tt.d.Ref,default:void 0}};var Dt=function(e){return function(t){return function(n,r,o){return e(n,r,t(o))}}},Ht=Dt((function(e,t,n){return t*n+e*(1-n)})),It=Dt((function(e,t,n){return t.clone().multiply(n).sub(e.clone().multiply(n.clone().subScalar(1)))})),Lt=(Dt((function(e,t,n){return t.clone().multiply(n).sub(e.clone().multiply(n.clone().subScalar(1)))})),n(122)),Gt=n(46),Wt=n.n(Gt),zt=Wt()(.2,1.61,.7,-.1),Bt=Wt()(.32,-.16,0,1.51),qt=Wt()(0,0,.58,1),Ut=Object(Lt.a)(zt,qt),Ft=Object(Lt.a)(Bt,qt),Yt=function(e){var t=Ut(e);return new et.Ib(t,Ft(e),t)},Kt=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).tweens=[],e}return Object(Ee.a)(n,[{key:"reset",value:function(){Object(Ce.a)(Object(Re.a)(n.prototype),"reset",this).call(this),this.tweens=[]}}],[{key:"queueTween",value:function(e,t){var r;null===(r=e.getMutableComponent(n))||void 0===r||r.tweens.push(t)}}]),n}(tt.a);Kt.schema={tweens:{type:tt.d.Array,default:[]}};var Vt=function(e){return(new et.Ib).addScalar(e)},Jt=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).refEntity=void 0,e}return n}(tt.a);Jt.schema={refEntity:{type:tt.d.Ref}};var Xt=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){return Object(we.a)(this,n),t.apply(this,arguments)}return Object(Ee.a)(n,[{key:"execute",value:function(e,t){var r,o,a=this;null===(r=this.queries.trees.changed)||void 0===r||r.forEach((function(e){n.updateGrowthStage(e),a.gameWorld.sceneHasUpdated=!0})),null===(o=this.queries.trees.added)||void 0===o||o.forEach((function(e){var t=e.getMutableComponent(Et),r=e.getComponent(Nt),o=e.getObject3D();if(void 0!==t&&void 0!==o&&void 0!==r){var i=a.gameWorld.tileEntities.get(r.axial.toString());if(void 0!==i){var c=i.getMutableComponent(_t);if(void 0!==c){c.treeEntity=e;var l=t.color;o.name="tree-"+e.id.toString()+"-"+Je[l],a.gameWorld.sceneHasUpdated=!0;var u=[At(at[l]),At(ot.TRUNK),At(it[l]),At(ot.SHADE),At(ot.GROUND_SHADE)];Promise.all(u).then((function(r){var o=r.map((function(e){return e.clone()})),c=Object(s.a)(o,5),l=c[0],u=c[1],d=c[2],h=c[3],b=c[4],f=new et.ab;f.name="shadeContainer",f.add(h),f.position.y=st[t.growthStage];var v=new et.ab;v.name="groundShadeContainer";var p=new et.ab;p.name="tree",l.position.y=10,t.topObj=l,t.trunkObj=u,p.scale.set(0,0,0),p.add(l,u),d.scale.set(0,0,0);var g=new et.ab;g.name="plantContainer",g.rotation.y=Math.random()*nt,g.add(p,d),t.plant=a.world.createEntity().addObject3DComponent(g,e).addComponent(Jt,{refEntity:i}),t.tree=a.world.createEntity().addObject3DComponent(p,t.plant).addComponent(Kt),t.seed=a.world.createEntity().addObject3DComponent(d,t.plant).addComponent(Kt),t.shade=a.world.createEntity().addObject3DComponent(f,e).addComponent(Pt).addComponent(Kt);var O=a.world.createEntity().addObject3DComponent(v,e).addComponent(Pt);t.groundShade=a.world.createEntity().addObject3DComponent(b,O).addComponent(Kt),b.rotation.x=-.8,f.position.y=st[Xe.SEED],p.scale.set(0,0,0),d.scale.set(0,0,0),n.updateGrowthStage(e)})).catch(console.error)}}}}))}}],[{key:"updateGrowthStage",value:function(e){var t=e.getComponent(Et);if(void 0!==t){var n,r=t.tree,o=t.seed,a=t.shade,i=t.groundShade,c=null===r||void 0===r?void 0:r.getObject3D(),s=null===o||void 0===o?void 0:o.getObject3D(),l=null===a||void 0===a?void 0:a.getObject3D(),u=null===i||void 0===i?void 0:i.getObject3D();void 0!==a&&void 0!==l&&Kt.queueTween(a,{duration:dt,loop:1,value:0,prop:"position",from:l.position,to:new et.Ib(0,st[t.growthStage],0),func:It(Yt)}),void 0!==i&&void 0!==u&&Kt.queueTween(i,{duration:1,loop:1,value:0,prop:"rotation",from:u.rotation,to:new et.q(t.growthStage===Xe.SEED?-.8:0,0,0),func:(n=It(Vt),function(e,t,r){return(new et.q).setFromVector3(n(e.toVector3(),t.toVector3(),r))})}),void 0!==r&&void 0!==c&&Kt.queueTween(r,{duration:dt,loop:1,value:0,prop:"scale",from:c.scale.clone(),to:ut[t.growthStage].tree.scale.clone(),func:It(Yt)}),void 0!==o&&void 0!==s&&Kt.queueTween(o,{duration:dt,loop:1,value:0,prop:"scale",from:s.scale.clone(),to:ut[t.growthStage].seed.scale.clone(),func:It(Yt)})}}}]),n}(Mt);Xt.queries={trees:{components:[Et,$e.c],listen:{added:!0,removed:!0,changed:[Et,Nt]}}};var Qt=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).ref=void 0,e}return n}(tt.a);Qt.schema={ref:{type:tt.d.Ref}};var Zt=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){return Object(we.a)(this,n),t.apply(this,arguments)}return Object(Ee.a)(n,[{key:"execute",value:function(e,t){var n=this;this.queries.object3DTweens.results.forEach((function(t){var r=null===t||void 0===t?void 0:t.getObject3D(),o=t.getMutableComponent(Kt);void 0!==r&&void 0!==o&&n.tweenTarget(r,o,e,(function(e,t,n){return t[n].fromArray(e.toArray())}))})),this.queries.referencedTweens.results.forEach((function(t){var r,o=null===t||void 0===t||null===(r=t.getComponent(Qt))||void 0===r?void 0:r.ref,a=t.getMutableComponent(Kt);void 0!==o&&void 0!==a&&n.tweenTarget(o,a,e,(function(e,t,n){t[n]=e}))}))}},{key:"tweenTarget",value:function(e,t,n,r){var o=this,a=[];t.tweens.forEach((function(t){if(void 0!==t){var i=t.duration,c=t.value,s=t.prop,l=t.from,u=t.to,d=t.func,h=Math.min(1,n/i+c);t.value=h;var b=d(l,u,h);r(b,e,s),o.gameWorld.sceneHasUpdated=!0,1===h&&(t.value=0,t.loop>0&&t.loop--,0===t.loop)||a.push(t)}})),t.tweens=a}}]),n}(Mt);Zt.queries={object3DTweens:{components:[Kt,$e.c]},referencedTweens:{components:[Kt,Qt]}};var $t=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){return Object(we.a)(this,n),t.apply(this,arguments)}return Object(Ee.a)(n,[{key:"execute",value:function(e,t){var n=this;this.queries.axialPositions.results.forEach((function(e){var t,r=null===(t=e.getComponent(Nt))||void 0===t?void 0:t.axial,o=e.getObject3D();if(void 0!==r&&void 0!==o){var a=o.userData.q,i=o.userData.r;if(a!==r.q&&i!==r.r){var c=r.toCartesian(5).toArray(),l=Object(s.a)(c,2),u=l[0],d=l[1];o.userData.q=r.q,o.userData.r=r.r,o.position.set(u,0,d),n.gameWorld.sceneHasUpdated=!0}}}))}}]),n}(Mt);$t.queries={axialPositions:{components:[Nt,$e.c]}};var en=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){return Object(we.a)(this,n),t.apply(this,arguments)}return Object(Ee.a)(n,[{key:"execute",value:function(e,t){var n=this;this.queries.tiles.results.forEach((function(e){var t=e.getComponent(_t);if(void 0!==t&&void 0!==t.material){var r;if(void 0!==t.treeEntity){var o=t.treeEntity.getComponent(Et);if(void 0===o)return;r=ct[o.color]}else r=3355443;r!==t.material.color.getHex()&&(t.material.color.setHex(r),n.gameWorld.sceneHasUpdated=!0)}}))}}]),n}(Mt);en.queries={tiles:{components:[_t]}};var tn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){return Object(we.a)(this,n),t.apply(this,arguments)}return Object(Ee.a)(n,[{key:"execute",value:function(e,t){var n=this;this.queries.sunFacingObjs.results.forEach((function(e){var t=e.getObject3D();void 0!==t&&(t.rotation.y=n.gameWorld.sunOrientationRad)}))}}]),n}(Mt);tn.queries={sunFacingObjs:{components:[Pt,$e.c]}};var nn=n(74),rn=n(39),on=function(){function e(t,n,r){Object(we.a)(this,e),this.x=void 0,this.y=void 0,this.z=void 0,this.x=t,this.y=n,this.z=r}return Object(Ee.a)(e,[{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"toString",value:function(){return this.toArray().join(",")}},{key:"toAxial",value:function(){return new cn(this.x,this.z)}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"tileDistance",value:function(e){return(Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z))/2}},{key:"range",value:function(t){for(var n=[],r=-t;r<=t;r++)for(var o=Math.max(-t,-r-t);o<=Math.min(t,-r+t);o++){var a=-r-o;n.push(new e(this.x+r,this.y+o,this.z+a))}return n}}],[{key:"fromArray",value:function(t){return Object(rn.a)(e,Object(xt.a)(t))}},{key:"fromString",value:function(t){var n=t.split(",").map((function(e){return parseInt(e,10)}));return e.fromArray([n[0],n[1],n[2]])}},{key:"origin",get:function(){return new e(0,0,0)}}]),e}();on.neighbors=[new on(1,-1,0),new on(1,0,-1),new on(0,1,-1),new on(-1,1,0),new on(-1,0,1),new on(0,-1,1)];var an=function(){function e(t,n){Object(we.a)(this,e),this.x=void 0,this.y=void 0,this.x=t,this.y=n}return Object(Ee.a)(e,[{key:"toArray",value:function(){return[this.x,this.y]}},{key:"toString",value:function(){return this.toArray().join(",")}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this}},{key:"euclideanDistance",value:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}},{key:"manhattanDistance",value:function(e){return this.x-e.x+(this.y-e.y)}},{key:"added",value:function(t){return new e(this.x,this.y).add(t)}},{key:"scaled",value:function(t){return new e(this.x,this.y).scale(t)}},{key:"norm",value:function(){return this.euclideanDistance(e.origin)}},{key:"normalize",value:function(){return this.scale(1/this.norm())}},{key:"normalized",value:function(){return new e(this.x,this.y).normalize()}},{key:"clone",value:function(){return new e(this.x,this.y)}}],[{key:"fromArray",value:function(t){return Object(rn.a)(e,Object(xt.a)(t))}},{key:"fromString",value:function(t){var n=t.split(",").map((function(e){return parseInt(e,10)}));return e.fromArray([n[0],n[1]])}},{key:"origin",get:function(){return new e(0,0)}}]),e}();an.neighbors=[new an(-1,-1),new an(0,-1),new an(1,-1),new an(-1,0),new an(1,0),new an(-1,1),new an(0,1),new an(1,1)];var cn=function(){function e(t,n){Object(we.a)(this,e),this.q=void 0,this.r=void 0,this.q=t,this.r=n}return Object(Ee.a)(e,[{key:"toArray",value:function(){return[this.q,this.r]}},{key:"toString",value:function(){return this.toArray().join(",")}},{key:"toHexCube",value:function(){return new on(this.q,-this.q-this.r,this.r)}},{key:"toCartesian",value:function(e){var t=e*(Math.sqrt(3)*this.q+Math.sqrt(3)/2*this.r),n=e*(1.5*this.r);return new an(t,n)}},{key:"add",value:function(e){return this.q+=e.q,this.r+=e.r,this}},{key:"scale",value:function(e){return this.q*=e,this.r*=e,this}},{key:"tileDistance",value:function(e){return(Math.abs(this.q-e.q)+Math.abs(this.q+this.r-e.q-e.r)+Math.abs(this.r-e.r))/2}},{key:"range",value:function(e){return this.toHexCube().range(e).map((function(e){return e.toAxial()}))}}],[{key:"fromArray",value:function(t){return Object(rn.a)(e,Object(xt.a)(t))}},{key:"fromString",value:function(t){var n=t.split(",").map((function(e){return parseInt(e,10)}));return e.fromArray([n[0],n[1]])}},{key:"origin",get:function(){return new e(0,0)}}]),e}();cn.neighbors=[new cn(1,0),new cn(1,-1),new cn(0,-1),new cn(-1,0),new cn(-1,1),new cn(0,1)];var sn=n(85),ln=n.n(sn),un=n(51),dn=n.n(un),hn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).hm=void 0,e.panDistances=[],e.setXY=function(t){var n=t.x,r=t.y;e.gameWorld.mouseScreenPosition.x=n/window.innerWidth*2-1,e.gameWorld.mouseScreenPosition.y=-r/window.innerHeight*2+1,e.gameWorld.hasMouseMoved=!0},e.onMouseMove=function(t){var n,r;t instanceof MouseEvent?(n=t.clientX,r=t.clientY):(n=t.changedTouches[0].pageX,r=t.changedTouches[0].pageY),e.setXY({x:n,y:r})},e}return Object(Ee.a)(n,[{key:"init",value:function(){var e=this,t=this.gameWorld.renderer.domElement;this.hm=new dn.a(t),this.hm.add(new dn.a.Pan({direction:dn.a.DIRECTION_ALL})),this.hm.on("pan",(function(t){var n=t.velocityX,r=t.velocityY;e.panDistances.push([n,r])})),this.hm.on("tap",(function(t){var n=t.center;e.setXY(n),e.gameWorld.willSelectObject=!0})),this.hm.on("pinch",(function(t){var n=t.scale;e.gameWorld.camera.position.z=Math.max(.999,Math.min(e.gameWorld.camera.position.z*n,4))})),t.addEventListener("touchmove",this.onMouseMove),t.addEventListener("mousemove",this.onMouseMove)}},{key:"dispose",value:function(){this.hm.destroy()}},{key:"execute",value:function(e,t){for(var n;void 0!==(n=this.panDistances.pop());){var r=n,o=Object(s.a)(r,2),a=o[0],i=o[1];this.gameWorld.cameraRotationObj.rotation.y-=.1*a;var c=this.gameWorld.cameraTiltObj.rotation.x-.05*i;this.gameWorld.cameraTiltObj.rotation.x=Math.max(-Math.PI/2,Math.min(-.1,c)),this.gameWorld.sceneHasUpdated=!0}}}]),n}(Mt),bn=n(93),fn=n(86),vn=n(87),pn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).composer=void 0,e.outlinePass=void 0,e.effectFXAA=void 0,e}return n}($e.d);pn.schema=void 0,pn.schema={composer:{type:tt.d.Ref},renderer:{type:tt.d.Ref},scene:{type:tt.d.Ref},camera:{type:tt.d.Ref},outlinePass:{type:tt.d.Ref},effectFXAA:{type:tt.d.Ref}};var gn=n(52),On=n(88),mn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).needsResize=!0,e.intersectionCounter=0,e}return Object(Ee.a)(n,[{key:"onResize",value:function(){this.needsResize=!0,this.gameWorld.sceneHasUpdated=!0}},{key:"init",value:function(){this.needsResize=!0,this.onResize=this.onResize.bind(this),window.addEventListener("resize",this.onResize.bind(this),!1)}},{key:"dispose",value:function(){window.removeEventListener("resize",this.onResize.bind(this))}},{key:"execute",value:function(e,t){var n=this;this.intersectionCounter+=e,this.gameWorld.sceneHasUpdated&&(this.gameWorld.sceneHasUpdated=!1,this.queries.renderers.results.forEach((function(e){var t=e.getComponent($e.d);if(void 0!==t){var n=t.camera.getObject3D(),r=t.scene.getObject3D(),o=t.renderer;if(void 0!==r&&void 0!==n){var a=o.domElement,i=a.clientWidth,c=a.clientHeight,s=new bn.a(o);s.renderTarget1.texture.encoding=et.Nb,s.renderTarget2.texture.encoding=et.Nb;var l=new fn.a(r,n);s.addPass(l);var u=new vn.a(new et.Hb(i,c),r,n);u.edgeStrength=10,u.edgeThickness=2,u.hiddenEdgeColor.set(16777215),s.addPass(u);var d=new gn.a(On.a);d.uniforms.resolution.value.set(1/i,1/c),s.addPass(d),e.addComponent(pn,{renderer:o,scene:t.scene,camera:t.camera,composer:s,outlinePass:u,effectFXAA:d}),e.removeComponent($e.d)}}})),this.queries.rendererComposers.results.forEach((function(e){var t=e.getComponent(pn);if(void 0!==t){var r=t.camera.getObject3D(),o=t.scene.getObject3D(),a=t.renderer,i=t.composer,c=t.effectFXAA,s=t.outlinePass;if(void 0!==o&&void 0!==r){if(n.needsResize){var l=a.domElement;a.getPixelRatio()!==window.devicePixelRatio&&(a.setPixelRatio(window.devicePixelRatio),i.setPixelRatio(window.devicePixelRatio));var u=l.clientWidth,d=l.clientHeight;r.aspect=u/d,r.updateProjectionMatrix(),a.setSize(u,d,!1),i.setSize(u,d),s.resolution.set(u,d),c.uniforms.resolution.value.set(1/u,1/d),n.needsResize=!1}var h=n.gameWorld.hoverObject,b=n.gameWorld.activeObject;s.selectedObjects=[h,b!==h?b:void 0].filter((function(e){return void 0!==e})),i.render()}}})))}}]),n}(Mt);mn.queries={renderers:{components:[$e.d],listen:{added:!0}},rendererComposers:{components:[pn]}};var yn=function(e){return"entity"in e},jn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).secondsElapsed=0,e.raycaster=new et.pb,e}return Object(Ee.a)(n,[{key:"execute",value:function(e,t){if(!this.gameWorld.willSelectObject){if(!this.gameWorld.hasMouseMoved)return;if(this.gameWorld.hasMouseMoved=!1,this.secondsElapsed+=e,!(this.secondsElapsed>=n.CHECK_PERIOD))return;this.secondsElapsed-=n.CHECK_PERIOD}var r=this.queries.selectables.results.map((function(e){return e.getObject3D()})).filter((function(e){return void 0!==e}));this.raycaster.setFromCamera(this.gameWorld.mouseScreenPosition,this.gameWorld.camera);var o=this.raycaster.intersectObjects(r,!0);if(o.length>0){var a=o[0].object,i=a,c=a,s=!0;do{var l,u;null!==(i=null!==(l=null===(u=c=i)||void 0===u?void 0:u.parent)&&void 0!==l?l:null)&&(yn(i)?s=void 0===i.entity.getComponent(Jt):c!==i&&(s=!0))}while(s);c===i?console.error("currentRef cannot be parent"):null===i?console.error("parent cannot be null"):yn(i)&&this.gameWorld.hoverObject!==i&&(this.gameWorld.hoverObject=i,this.gameWorld.sceneHasUpdated=!0)}else void 0!==this.gameWorld.hoverObject&&(this.gameWorld.hoverObject=void 0);this.gameWorld.willSelectObject&&(this.gameWorld.activeObject=this.gameWorld.hoverObject,this.gameWorld.willSelectObject=!1,this.gameWorld.activeObjectChangeHandlers.forEach((function(e){return e()}))),this.gameWorld.sceneHasUpdated=!0}}]),n}(Mt);jn.CHECK_PERIOD=.05,jn.queries={selectables:{components:[Jt,$e.c]}};var wn=function(e,t){var n=t.color,r=t.growthStage,o=t.axial,a=new et.ab;if(void 0!==e.tileEntities.get(o.toString()))return e.world.createEntity().addObject3DComponent(a,e.gameEntity).addComponent(Et,{color:n,growthStage:r}).addComponent(Nt,{axial:o}).addComponent(Kt);console.error("Tile not found: "+o.toString())},En=function(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2},xn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){var e;Object(we.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).actions=[],e}return Object(Ee.a)(n,null,[{key:"setTimeout",value:function(e,t,r){var o;null===(o=e.getComponent(n))||void 0===o||o.actions.push({handler:t,timeout:r})}}]),n}(tt.a);xn.schema={};var kn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(){return Object(we.a)(this,n),t.apply(this,arguments)}return Object(Ee.a)(n,[{key:"execute",value:function(e,t){var n=this;this.queries.delayedActions.results.forEach((function(t){var r=t.getMutableComponent(xn);if(void 0!==r){var o=[];r.actions.forEach((function(r){r.timeout=Math.max(0,r.timeout-e),0===r.timeout?(r.handler(t),n.gameWorld.sceneHasUpdated=!0):o.push(r)})),r.actions=o}}))}}]),n}(Mt);kn.queries={delayedActions:{components:[xn]}};var Sn,Cn=function(){function e(){var t=this;Object(we.a)(this,e),this.gui=void 0,this.stats=void 0,this.hasStarted=!1,this.messages={},this.world=void 0,this.renderer=void 0,this.camera=void 0,this.cameraTiltObj=void 0,this.cameraRotationObj=void 0,this.sunOrientationRad=lt,this.sceneEntity=void 0,this.gameEntity=void 0,this.tileEntities=new Map,this.sunManagerEntity=void 0,this.mouseScreenPosition=new et.Hb,this.hasMouseMoved=!1,this.willSelectObject=!1,this.activeObject=void 0,this.hoverObject=void 0,this.sceneHasUpdated=!1,this.activeObjectChangeHandlers=[],this.stats=new ln.a,this.gui=new nn.a.GUI,this.renderer=new et.Mb({antialias:!0}),this.world=new $e.b({entityPoolSize:1e3}),document.body.appendChild(this.stats.dom),window.addEventListener("load",(function(){t.init()}))}return Object(Ee.a)(e,[{key:"dispose",value:function(){var e;this.destroyGUI(),this.world.stop(),this.tileEntities.clear(),wt(null===(e=this.sceneEntity)||void 0===e?void 0:e.getObject3D()),this.sunOrientationRad=0,this.hasStarted=!1,this.activeObjectChangeHandlers.splice(0),console.log("end")}},{key:"init",value:function(){var e=this;if(!this.hasStarted){console.log("start"),this.hasStarted=!0,this.initGUI();var t=new et.l,n=Object($e.f)(this.world,{renderer:this.renderer,animationLoop:function(){e.stats.begin(),e.world.execute(t.getDelta(),t.elapsedTime),e.stats.end()}}),r=n.camera,o=n.sceneEntity;this.camera=r,this.sceneEntity=o,this.initRenderer(),this.initECS(),this.initScene(),this.sunManagerEntity=this.world.createEntity("sunManager").addComponent(Qt,{ref:this}).addComponent(Kt),Promise.all(Object.values(ot).map(At)).then((function(){e.sceneHasUpdated=!0})).catch(console.error),this.world.play()}}},{key:"destroyGUI",value:function(){this.gui.destroy(),this.gui=new nn.a.GUI}},{key:"initGUI",value:function(){}},{key:"initECS",value:function(){this.world.registerComponent(Et),this.world.registerComponent(Kt),this.world.registerComponent(Nt),this.world.registerComponent(_t),this.world.registerComponent(Pt),this.world.registerComponent(pn),this.world.registerComponent(Jt),this.world.registerComponent(Qt),this.world.registerComponent(xn),this.world.unregisterSystem($e.e),this.world.registerSystem(mn,{priority:999,gameWorld:this}),this.world.registerSystem(kn,{gameWorld:this}),this.world.registerSystem($t,{gameWorld:this}),this.world.registerSystem(en,{gameWorld:this}),this.world.registerSystem(Xt,{gameWorld:this}),this.world.registerSystem(Zt,{gameWorld:this}),this.world.registerSystem(tn,{gameWorld:this}),this.world.registerSystem(hn,{gameWorld:this}),this.world.registerSystem(jn,{gameWorld:this})}},{key:"initRenderer",value:function(){this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=et.Gb,this.renderer.setClearColor(13300220),this.renderer.outputEncoding=et.Nb}},{key:"initScene",value:function(){var e;this.camera.position.set(0,0,95),this.camera.fov=40,null===(e=this.sceneEntity.getObject3D())||void 0===e||e.remove(this.camera);var t=new et.ab;t.name="cameraTilt",t.rotation.x=-.4,t.add(this.camera),this.cameraTiltObj=t;var n=new et.ab;n.name="cameraRotation",n.add(t),this.cameraRotationObj=n;var r=this.gui.addFolder("Camera");r.add(this.camera.position,"z",20,300,1).name("zoom"),r.open(),this.world.createEntity().addObject3DComponent(n,this.sceneEntity);var o=new et.b(1646408,.5),a=new et.o(16318386,1.2);a.position.set(0,150*Math.sin(52.725),150),a.castShadow=!0,a.shadow.camera.visible=!0,a.shadow.bias=-.001,a.shadow.radius=2,a.shadow.camera.near=50,a.shadow.camera.far=300,a.shadow.camera.top=-100,a.shadow.camera.bottom=50,a.shadow.camera.left=-100,a.shadow.camera.right=100,a.shadow.mapSize.set(Math.pow(2,9),Math.pow(2,9));var i=new et.u;i.name="sun",i.add(a);var c=new et.o(16777215,.2);c.name="sky",c.position.y=100;var s=new et.u;s.name="commonLights",s.add(o,c);var l=new et.ab;At(ot.LANDSCAPE).then((function(e){return l.add(e.clone())})).catch(console.error),l.name="floor",this.world.createEntity().addObject3DComponent(l,this.sceneEntity),this.world.createEntity().addObject3DComponent(s,this.sceneEntity),this.world.createEntity().addObject3DComponent(i,this.sceneEntity).addComponent(Pt);var u=new et.u;u.name="Game",this.gameEntity=this.world.createEntity().addObject3DComponent(u,this.sceneEntity).addComponent(xn),this.generateGrid();var d=new et.ab;d.name="sunSegmentWrapper";var h=new et.ab;h.name="sugSegment",h.position.y=2.2,h.position.z=28,h.rotation.y=Math.PI,h.add(yt),d.add(h),this.world.createEntity("sunSegment").addObject3DComponent(d,this.gameEntity).addComponent(Pt)}},{key:"generateGrid",value:function(){var e=this,t=new et.ab;t.name="gameBoard";var n=this.world.createEntity().addObject3DComponent(t,this.gameEntity);cn.origin.range(3).forEach((function(t){var r=new et.u;r.name="tileContainer-"+t.toString();var o=e.world.createEntity().addObject3DComponent(r,n).addComponent(Nt,{axial:t}).addComponent(_t);o.addComponent(Jt,{refEntity:o}),e.tileEntities.set(t.toString(),o)})),At(ot.RING).then((function(t){e.tileEntities.forEach((function(n){var r=new et.ab;r.name="ringContainer";var o=t.clone(),a=o.children.find((function(e){return e instanceof et.P})),i=null===a||void 0===a?void 0:a.material,c=n.getComponent(Nt);if(void 0!==a&&i instanceof et.T&&void 0!==c){var s,l=i.clone();a.material=l;var u=c.axial;a.material.name="tileRing-"+u.toString();var d=n.getMutableComponent(_t);void 0!==d&&(d.material=l);var h=u.tileDistance(cn.origin),b=jt[3-h].clone();if(h>0){var f=u.toCartesian(5),v=Math.atan(f.x/f.y);b.rotation.y=f.y<0?v:v+Math.PI}r.add(o,b),null===(s=n.getObject3D())||void 0===s||s.add(r)}else console.error("Cannot find standard material inside ring object");e.sceneHasUpdated=!0}))})).catch(console.error)}},{key:"send",value:function(e,t){var n,r=null!==(n=this.messages[e])&&void 0!==n?n:[];void 0===this.messages[e]&&(this.messages[e]=r),r.push(t)}},{key:"setTile",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.color,a=r.growthStage,i=null===(t=this.tileEntities.get(e.toString()))||void 0===t||null===(n=t.getComponent(_t))||void 0===n?void 0:n.treeEntity,c=null===i||void 0===i?void 0:i.getMutableComponent(Et);void 0!==c?void 0!==a?c.growthStage=a:void 0!==i&&this.removeTree(e):void 0!==o&&void 0!==a&&wn(this,{color:o,growthStage:a,axial:e})}},{key:"setRayDirection",value:function(e){var t,n=this.sunOrientationRad%nt,r=Math.floor(n/nt)*nt+(lt+e*Math.PI/3)%nt,o=r>n?r-nt:r;console.log(n,o),null===(t=this.sunManagerEntity.getComponent(Kt))||void 0===t||t.tweens.push({duration:2,from:n,func:Ht(En),loop:1,prop:"sunOrientationRad",to:o,value:0})}},{key:"getActiveEntity",value:function(){var e,t,n;return null===(e=this.activeObject)||void 0===e||null===(t=e.entity)||void 0===t||null===(n=t.getComponent(Jt))||void 0===n?void 0:n.refEntity}},{key:"getActiveAxial",value:function(){var e,t;return null===(e=this.getActiveEntity())||void 0===e||null===(t=e.getComponent(Nt))||void 0===t?void 0:t.axial}},{key:"resetBoard",value:function(){var e=this;cn.origin.range(3).forEach((function(t){e.removeTree(t)})),this.setRayDirection(0)}},{key:"onActiveObjectChange",value:function(e){this.activeObjectChangeHandlers.push(e)}},{key:"removeTree",value:function(e){var t,n,r,o=null===(t=this.tileEntities.get(e.toString()))||void 0===t?void 0:t.getMutableComponent(_t),a=null===o||void 0===o?void 0:o.treeEntity;void 0!==a&&(null===(n=a.getComponent(Kt))||void 0===n||null===(r=n.tweens)||void 0===r||r.push({duration:dt,from:new et.Ib(1,1,1),func:It(Yt),loop:1,prop:"scale",to:new et.Ib(0,0,0),value:0}),xn.setTimeout(this.gameEntity,(function(){a.remove(),void 0!==o&&(o.treeEntity=void 0)}),dt))}}]),e}(),Rn=n(125),Tn=n(123),An=function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout((function(){e()}),t)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pn=n(94),Mn="NetworkStateBusyError";Error;!function(e){e[e.STATE_CHANGE=0]="STATE_CHANGE",e[e.MEMBERS_CHANGE=1]="MEMBERS_CHANGE",e[e.MEMBERS_JOIN=2]="MEMBERS_JOIN",e[e.MEMBERS_LEFT=3]="MEMBERS_LEFT",e[e.NETWORK_ERROR=4]="NETWORK_ERROR",e[e.HOST_CHANGE=5]="HOST_CHANGE"}(Sn||(Sn={}));var Nn,_n,Dn=function(e){if("object"===typeof e&&null!==e&&"members"in e&&"host"in e){var t=e;return Array.isArray(t.members)&&t.members.reduce((function(e,t){return e&&"string"===typeof t}),!0)}return!1},Hn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(e,r,o){var a;return Object(we.a)(this,n),(a=t.call(this)).hostConnectionManager=void 0,a.myConnectionManager=void 0,a.meToHostConnection=void 0,a.members=[],a.state=void 0,a.networkName=void 0,a.reducer=void 0,a.hostId=void 0,a.initialState=void 0,a.activeAction=void 0,a.requestQueue=[],a.stateStaging=void 0,a.stagingActionId=void 0,a.logs=[],a.networkErrorHandler=function(e){a.emit(Sn.NETWORK_ERROR,{error:e})},a.sendToHost=function(){var e=Object(je.a)(ye.a.mark((function e(t,n){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==a.meToHostConnection){e.next=2;break}throw new Error("not connected to host");case 2:return e.next=4,a.myConnectionManager.sendPkg(a.meToHostConnection.id,t,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.initMyConnectionManagerListeners=function(){a.myConnectionManager.onPkg(_e.MEMBER_CHANGE,(function(e){var t=e.data;a.handleMemberChange(t).catch(a.networkErrorHandler)})),a.myConnectionManager.onPkg(_e.SET_STATE,(function(e){var t=e.data;a.emit(Sn.STATE_CHANGE,{state:t}),a.state=t})),a.myConnectionManager.onPkg(_e.DISPATCH,a.dispatchHandler),a.myConnectionManager.onPkg(_e.CANCEL,(function(e){var t=e.data.id;a.log("cancel staging",t,a.stagingActionId),t===a.stagingActionId&&(a.stateStaging=void 0,a.stagingActionId=void 0)})),a.myConnectionManager.onPkg(_e.PROMOTE,(function(){if(void 0===a.stateStaging)throw new Error("promote before staging");a.setState(a.stateStaging),a.stateStaging=void 0}))},a.host=function(){var e=Object(je.a)(ye.a.mark((function e(t){var n,r,o;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.log("hosting network ".concat(t)),e.next=3,Ze.startPrefix(t);case 3:if(n=e.sent,a.log("created hostConnection"),r=a.hostId,a.hostId=a.id,a.hostConnectionManager=n,a.hostConnectionManager.on(Ne.CONN_OPEN,(function(e){var t,n,r=e.conn;void 0!==r&&(a.log("".concat(null!==(t=r.id)&&void 0!==t?t:"someone"," is joining the network, telling the rest about it and tell new joiner the member list")),null===(n=a.hostConnectionManager)||void 0===n||n.broadcastPkg(_e.MEMBER_CHANGE,{host:a.hostId,members:[].concat(Object(xt.a)(a.members),[r.id])}).catch(a.networkErrorHandler),r.sendPkg(_e.SET_STATE,Object(Rn.a)(a.state)).catch(a.networkErrorHandler))})),a.hostConnectionManager.on(Ne.CONN_CLOSE,(function(e){var t,n,r=e.conn;a.log("".concat(null!==(t=null===r||void 0===r?void 0:r.id)&&void 0!==t?t:"someone"," is leaving the network, telling the rest about it")),null===(n=a.hostConnectionManager)||void 0===n||n.broadcastPkg(_e.MEMBER_CHANGE,{host:a.id,members:a.members.filter((function(e){return e!==(null===r||void 0===r?void 0:r.id)}))}).catch(a.networkErrorHandler)})),!(a.members.length>0)){e.next=18;break}return a.log("hostConnection trying to connect to all members and tell them to update member list"),o=a.members.filter((function(e){return e!==r})),e.next=15,Promise.all(o.map(function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===n||void 0===n?void 0:n.connect(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).catch(console.log);case 15:return e.next=17,n.broadcastPkg(_e.MEMBER_CHANGE,{host:a.id,members:o});case 17:a.log("hostConnection connected to all members");case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.join=function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.log("joining network ",t),e.next=3,a.myConnectionManager.connectPrefix(t);case 3:a.meToHostConnection=e.sent,a.log("connected to network"),a.meToHostConnection.on(Ne.CONN_CLOSE,(function(e){var t,n=e.conn;a.log("lost connection with ".concat(null!==(t=null===n||void 0===n?void 0:n.id)&&void 0!==t?t:"some peer")),a.members.length>1&&(void 0===a.networkName||a.myConnectionManager.isClosed()||a.members.filter((function(e){return e!==a.hostId}))[0]!==a.id||(a.log("taking over the host role"),a.host(a.networkName).catch(a.networkErrorHandler)))})),a.log("waiting for member list");case 7:if(0!==a.members.length){e.next=12;break}return e.next=10,An(100);case 10:e.next=7;break;case 12:a.log("received member list, connecting to other members");case 13:if(a.members.reduce((function(e,t){return e&&void 0!==a.myConnectionManager.connections.find((function(e){return e.id===t}))}),!0)){e.next=18;break}return e.next=16,An(100);case 16:e.next=13;break;case 18:a.log("all members connected");case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleMemberChange=function(){var e=Object(je.a)(ye.a.mark((function e(t){var n,r,o,i;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Dn(t)){e.next=25;break}if(a.emit(Sn.HOST_CHANGE,{host:t.host}),t.members.length!==a.members.length||!a.members.reduce((function(e,n){return e&&t.members.includes(n)}),!0)){e.next=4;break}return e.abrupt("return");case 4:return a.hostId=t.host,n=Object(xt.a)(a.members),r=t.members,a.members=Object(xt.a)(r),o=r.filter((function(e){return!n.includes(e)})),i=n.filter((function(e){return!r.includes(e)})),e.prev=10,e.next=13,Promise.all(o.map(function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.myConnectionManager.connect(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:i.forEach((function(e){a.myConnectionManager.disconnect(e)})),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(10),a.emit(Sn.NETWORK_ERROR,e.t0),console.log(e.t0);case 20:(o.length>0||i.length>0)&&a.emit(Sn.MEMBERS_CHANGE,{members:a.members}),o.length>0&&a.emit(Sn.MEMBERS_JOIN,{members:o}),i.length>0&&a.emit(Sn.MEMBERS_LEFT,{members:i}),e.next=26;break;case 25:throw new Error("wrong member change payload");case 26:case"end":return e.stop()}}),e,null,[[10,16]])})));return function(t){return e.apply(this,arguments)}}(),a.setReducer=function(e){a.reducer=e},a.dispatch=function(){var e=Object(je.a)(ye.a.mark((function e(t){var n,r,o,i,s,l,u,d,h,b,f,v,p;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.log("dispatch",t),n=function(){var e=Object(je.a)(ye.a.mark((function e(){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){a.requestQueue.push({action:t,resolve:e,reject:n})}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),void 0===a.activeAction){e.next=6;break}return e.next=5,n();case 5:return e.abrupt("return",e.sent);case 6:return r=Object(Te.a)(),a.activeAction=t,e.next=10,Promise.all(a.members.map(function(){var e=Object(je.a)(ye.a.mark((function e(n){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.myConnectionManager.sendPkg(n,_e.DISPATCH,Object(c.a)(Object(c.a)({},t),{},{actionId:r}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:if(o=e.sent,i=!1,s=[],o.forEach((function(e){var t,n=e.data,r=e.conn;void 0!==n&&!0!==n&&("string"===typeof n&&(a.log("".concat(null!==(t=null===r||void 0===r?void 0:r.id)&&void 0!==t?t:"someone"," response error ").concat(n)),n===Mn?i=!0:s.push(n)))})),u=Promise.resolve(),!(s.length>0)){e.next=23;break}return a.activeAction=void 0,e.next=19,Promise.all(a.members.map(function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.myConnectionManager.sendPkg(t,_e.CANCEL,{id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 19:d=Object(Tn.a)(s),l=1===d.length?new Error(d[0]):new Error("Multiple Errors: ".concat(d.join(","))),e.next=33;break;case 23:if(!i){e.next=30;break}return a.activeAction=void 0,e.next=27,Promise.all(a.members.map(function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.myConnectionManager.sendPkg(t,_e.CANCEL,{id:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 27:u=An(500).then(Object(je.a)(ye.a.mark((function e(){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.dispatch(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))),e.next=33;break;case 30:return e.next=32,Promise.all(a.members.map(function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.myConnectionManager.sendPkg(t,_e.PROMOTE,{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 32:a.activeAction=void 0;case 33:if(b=null!==(h=a.requestQueue.shift())&&void 0!==h?h:{},f=b.action,v=b.resolve,p=b.reject,void 0!==f&&void 0!==v&&void 0!==p&&a.dispatch(f).then(v).catch(p),void 0===l){e.next=39;break}return e.next=38,Promise.reject(l);case 38:return e.abrupt("return",e.sent);case 39:return e.next=41,u;case 41:return e.abrupt("return",e.sent);case 42:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.dispatchLocal=function(){var e=Object(je.a)(ye.a.mark((function e(t){var n;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==a.reducer){e.next=3;break}throw a.emit(Sn.NETWORK_ERROR,{error:new Error("no reducer defined")}),new Error("no reducer defined");case 3:return n=a.reducer(a.state,t,a.id),a.setState(n),e.next=7,Promise.resolve();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.dispatchHandler=function(e){var t=e.conn,n=e.data,r=e.ack;if(void 0===a.reducer)a.emit(Sn.NETWORK_ERROR,{error:new Error("no reducer defined")}),null===r||void 0===r||r("no reducer defined");else if(void 0===t)a.emit(Sn.NETWORK_ERROR,{error:new Error("no conn")}),null===r||void 0===r||r("no conn");else if(void 0!==a.stateStaging)null===r||void 0===r||r(Mn);else try{var o=n;a.stateStaging=a.reducer(a.state,o,t.id),a.stagingActionId=o.actionId,null===r||void 0===r||r(!0)}catch(i){null===r||void 0===r||r(i.message)}},a.setState=function(e){a.state=e,a.emit(Sn.STATE_CHANGE,{state:e})},a.leave=function(){var e,t;a.networkName=void 0,null===(e=a.hostConnectionManager)||void 0===e||e.destroy(),null===(t=a.meToHostConnection)||void 0===t||t.close(),a.emit(Sn.MEMBERS_LEFT,{members:a.members}),a.emit(Sn.MEMBERS_CHANGE,{members:[]}),a.meToHostConnection=void 0,a.hostConnectionManager=void 0,a.state=Object(Rn.a)(a.initialState),a.members=[],a.hostId=void 0},a.reducer=o,a.initialState=Object(Rn.a)(r),a.myConnectionManager=e,a.initMyConnectionManagerListeners(),a.state=Object(Rn.a)(r),a}return Object(Ee.a)(n,[{key:"id",get:function(){return this.myConnectionManager.id}},{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,n),this.logs.push(n)}},{key:"isHost",value:function(){return void 0!==this.hostConnectionManager||void 0===this.meToHostConnection&&void 0}},{key:"myId",get:function(){return this.myConnectionManager.id}},{key:"joinOrHost",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.networkName=t,e.prev=1,this.log("check if network ".concat(t," exists, if not, create it")),e.next=5,this.host(t);case 5:return this.log("created network ".concat(t)),e.next=8,this.join(t);case 8:e.next=15;break;case 10:return e.prev=10,e.t0=e.catch(1),this.log("network ".concat(t," exists")),e.next=15,this.join(t);case 15:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(De),In=function(e){var t,n;return Object(Rn.a)({lightPoint:0,score:0,color:e,availableArea:(t={},Object(Oe.a)(t,Xe.SEED,2),Object(Oe.a)(t,Xe.SHORT,4),Object(Oe.a)(t,Xe.MID,1),Object(Oe.a)(t,Xe.TALL,0),t),playerBoard:(n={},Object(Oe.a)(n,Xe.SEED,[!0,!0,!0,!0]),Object(Oe.a)(n,Xe.SHORT,[!0,!0,!0,!0]),Object(Oe.a)(n,Xe.MID,[!0,!0,!0]),Object(Oe.a)(n,Xe.TALL,[!0,!0]),n)})},Ln=function(){var e={};return new on(0,0,0).range(3).forEach((function(t){var n=t.tileDistance(on.origin);e[t.toAxial().toString()]={leaves:4-n}})),e},Gn=function(e){return void 0!==e&&[Xe.SHORT,Xe.MID,Xe.TALL].includes(e)};!function(e){e[e.UPDATE_GAME_STATE=0]="UPDATE_GAME_STATE",e[e.GAME_OVER=1]="GAME_OVER",e[e.ACTIVE_OBJECT_CHANGED=2]="ACTIVE_OBJECT_CHANGED"}(Nn||(Nn={})),function(e){e[e.GROW_TREE=0]="GROW_TREE",e[e.END_TURN=1]="END_TURN",e[e.PLANT_SEED=2]="PLANT_SEED",e[e.PURCHASE=3]="PURCHASE"}(_n||(_n={}));var Wn,zn,Bn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(e){var r;return Object(we.a)(this,n),(r=t.call(this)).room=void 0,r.gameWorld=new Cn,r.dispatch=function(){var e=Object(je.a)(ye.a.mark((function e(t){var n;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.mi===(null===(n=r.state)||void 0===n?void 0:n.turn)){e.next=2;break}throw new Error("not your turn");case 2:return e.next=4,r.room.network.dispatch({action:Wn.GAME_EVENT,payload:t});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.errorHandler=function(e){console.log(e)},r.reducer=function(e,t,n){var o=t.action,a=t.payload,i=r.room.pi(n);if(e.turn!==i)throw new Error("not your turn");var c=Object(Rn.a)(e);switch(o){case _n.END_TURN:return r.endTurnHandler(c,i);case _n.GROW_TREE:if("string"!==typeof a)throw new Error("invalid payload");var s=cn.fromString(a);return r.growTreeHandler(c,i,s);case _n.PLANT_SEED:if(!Array.isArray(a)||2!==a.length||"string"!==typeof a[0]||"string"!==typeof a[1])throw new Error("invalid payload");var l=cn.fromString(a[0]),u=cn.fromString(a[1]);return r.plantSeedHandler(c,i,l,u);case _n.PURCHASE:if("number"!==typeof a)throw new Error("invalid payload");var d=a;return r.purchaseHandler(c,i,d)}return e},r.room=e,r.room.network.on(Sn.STATE_CHANGE,(function(e){var t=e.state;r.emit(Nn.UPDATE_GAME_STATE,{data:null===t||void 0===t?void 0:t.game})})),r.gameWorld.onActiveObjectChange((function(){r.emit(Nn.ACTIVE_OBJECT_CHANGED,{data:{activeAxial:r.gameWorld.getActiveAxial()}})})),r}return Object(Ee.a)(n,[{key:"started",get:function(){return this.room.started}},{key:"state",get:function(){return this.room.network.state.game}},{key:"me",get:function(){return this.room.p(this.room.myId)}},{key:"mi",get:function(){return Number.parseInt(this.me)}},{key:"nPlayers",get:function(){return this.room.playerIds.length}},{key:"start",value:function(e){this.gameWorld.resetBoard()}},{key:"rejoin",value:function(e){var t=this;Object.entries(e.board).forEach((function(n){var r=Object(s.a)(n,2),o=r[0],a=r[1];void 0!==a.color&&void 0!==a.growthStage&&t.setTile(e,cn.fromString(o),a)})),this.setRayDirection(e,e.rayDirection)}},{key:"stop",value:function(e){this.emit(Nn.GAME_OVER,{data:e})}},{key:"endTurn",value:function(){var e=Object(je.a)(ye.a.mark((function e(){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dispatch({action:_n.END_TURN,payload:[]});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"endTurnHandler",value:function(e,t){if(e.turn++,e.dirtyTiles=[],e.turn===this.nPlayers){if(e.preparingRound>0&&(e.preparingRound--,0===e.preparingRound&&(e.rayDirection=1,e.revolutionLeft++)),0===e.preparingRound&&(e.rayDirection=(e.rayDirection+5)%6,0===e.rayDirection&&(e.rayDirection=0,e.revolutionLeft--),e=this.setRayDirection(e,e.rayDirection)),e.turn=0,e.revolutionLeft<=0)return this.endGameCalculation(e);0===e.preparingRound&&(e=this.photosynthesis(e))}return e}},{key:"photosynthesis",value:function(e){var t={},n=e.rayDirection;return Object.entries(e.board).forEach((function(e){var r=Object(s.a)(e,2),o=r[0],a=r[1];if(Gn(a.growthStage))for(var i=cn.fromString(o),c=0;c<a.growthStage;c++){var l;i=i.add(cn.neighbors[n]),t[i.toString()]=Math.max(null!==(l=t[i.toString()])&&void 0!==l?l:0,a.growthStage)}})),Object.entries(e.board).forEach((function(n){var r,o=Object(s.a)(n,2),a=o[0],i=o[1];Gn(i.growthStage)&&(void 0!==i.color&&i.growthStage>(null!==(r=t[a])&&void 0!==r?r:0)&&(e.playerInfo[i.color].lightPoint+=i.growthStage,e.playerInfo[i.color].lightPoint=Math.min(e.playerInfo[i.color].lightPoint,20)))})),e}},{key:"endGameCalculation",value:function(e){var t=this,n=[],r=0;return e.playerInfo.forEach((function(e,t){e.score+=Math.floor(e.lightPoint/3),e.lightPoint=0,e.score>r?(r=e.score,n=[t.toString()]):e.score===r&&n.push(t.toString())})),e.gameOver="".concat(n.map((function(e){return t.room.whoami(e)})).join(", ")," ").concat(1===n.length?"wins":"win"),Object(c.a)({},e)}},{key:"growTree",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dispatch({action:_n.GROW_TREE,payload:t.toString()});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"growTreeHandler",value:function(e,t,n){if(!(n.toString()in e.board))throw new Error("".concat(n.toString()," is not in game board"));if(e.dirtyTiles.includes(n.toString()))throw new Error("Cannot act on same tile twice");if(e.preparingRound>0){if(void 0!==e.board[n.toString()].growthStage)throw new Error("Already occupied");if(1!==e.board[n.toString()].leaves)throw new Error("First round can only grow tree on tile with 1 leaf");--e.playerInfo[t].availableArea[Xe.SHORT],e=this.setTile(e,n,{color:t,growthStage:Xe.SHORT}),e=this.endTurnHandler(e,t)}else{if(e.board[n.toString()].color!==t)throw new Error("You can only grow trees that belong to you");var r=e.board[n.toString()].growthStage;if(void 0===r)throw new Error("Please use growSeed method to plant a seed");if(e.playerInfo[t].lightPoint<ht[r])throw new Error("Not enough light point, needed ".concat(ht[r],", but only have ").concat(e.playerInfo[t].lightPoint));if(r!==Xe.TALL&&e.playerInfo[t].availableArea[r+1]<=0)throw new Error("Not enough ".concat(Xe[r+1],", you need to buy it with light points before growing"));e.playerInfo[t].lightPoint-=ht[r],r===Xe.TALL?(e=this.resetTile(e,n),e=this.returnTree(e,t,Xe.TALL),e=this.obtainToken(e,t,n)):(e.playerInfo[t].availableArea[r+1]--,e=this.setTile(e,n,{color:t,growthStage:r+1}),e=this.returnTree(e,t,r)),e.dirtyTiles.push(n.toString())}return e}},{key:"plantSeed",value:function(){var e=Object(je.a)(ye.a.mark((function e(t,n){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dispatch({action:_n.PLANT_SEED,payload:[t.toString(),n.toString()]});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"plantSeedHandler",value:function(e,t,n,r){if(!(n.toString()in e.board))throw new Error("".concat(n.toString()," is not in game board"));if(!(r.toString()in e.board))throw new Error("".concat(r.toString()," is not in game board"));if(e.preparingRound>0)throw new Error("Cannot plant seed at preparing round");if(e.playerInfo[t].availableArea[Xe.SEED]<=0)throw new Error("Not enough available seed, you need to use light point to purchase more");if(e.dirtyTiles.includes(n.toString())||e.dirtyTiles.includes(r.toString()))throw new Error("Cannot act on same tile twice");var o=e.board[n.toString()];if(!Gn(o.growthStage))throw new Error("Source tile needed to be a tree");if(o.color!==t)throw new Error("Cannot use other's tree as source");if(n.tileDistance(r)>o.growthStage)throw new Error("Seed is too far from tree");if(e.playerInfo[t].lightPoint<1)throw new Error("Need ".concat(1," light points, but only got ").concat(e.playerInfo[t].lightPoint));return e.dirtyTiles.push(n.toString(),r.toString()),e.playerInfo[t].lightPoint-=1,e.playerInfo[t].availableArea[Xe.SEED]--,e=this.setTile(e,r,{color:t,growthStage:Xe.SEED})}},{key:"purchase",value:function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dispatch({action:_n.PURCHASE,payload:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"haveSlot",value:function(e,t,n){return e.playerInfo[t].playerBoard[n].reduce((function(e,t){return e||!t}),!1)}},{key:"purchaseHandler",value:function(e,t,r){if(e.preparingRound>0)throw new Error("Cannot purchase at preparing round");var o=n.nextPurchase(e,t,r),a=o.purchaseIndex,i=o.cost;if(e.playerInfo[t].lightPoint<i)throw new Error("Not enough light point to purchase ".concat(Xe[r],", ").concat(i.toString()," needed but only have ").concat(e.playerInfo[t].lightPoint));return e.playerInfo[t].lightPoint-=i,e.playerInfo[t].playerBoard[r][a]=!1,e.playerInfo[t].availableArea[r]++,e}},{key:"setTile",value:function(e,t,n){return e.board[t.toString()].growthStage=n.growthStage,e.board[t.toString()].color=n.color,this.gameWorld.setTile(t,n),e}},{key:"resetTile",value:function(e,t){return e.board[t.toString()].color=void 0,e.board[t.toString()].growthStage=void 0,this.gameWorld.setTile(t),e}},{key:"returnTree",value:function(e,t,n){for(var r=0;r<e.playerInfo[t].playerBoard[n].length;r++)if(!e.playerInfo[t].playerBoard[n][r]){e.playerInfo[t].playerBoard[n][r]=!0;break}return e}},{key:"nextToken",value:function(e,t){for(var n=e.board[t.toString()].leaves;n>=1;n--){var r=e.scoreTokens[n][0];if(void 0!==r)return{leaves:n,score:r}}return{leaves:0,score:0}}},{key:"obtainToken",value:function(e,t,n){var r=this.nextToken(e,n).leaves,o=e.scoreTokens[r].shift();return e.playerInfo[t].score+=null!==o&&void 0!==o?o:0,e}},{key:"setRayDirection",value:function(e,t){return e.rayDirection=t,this.gameWorld.setRayDirection(t),e}}],[{key:"initialState",value:function(e){return function(e){for(var t={preparingRound:2,dirtyTiles:[],turn:0,rayDirection:0,totalRevolutions:3,revolutionLeft:3,board:Ln(),scoreTokens:{1:[14,14,13,13,13,12,12,12,12],2:[17,16,16,14,14,13,13,13],3:[19,18,18,17,17],4:[22,21,20]},playerInfo:[],photosynthesisHints:[]},n=0;n<e;n++)t.playerInfo[n]=In(n);return 2===e&&(t.scoreTokens[4]=[]),t}(e)}},{key:"nextPurchase",value:function(e,t,n){var r;for(r=0;r<e.playerInfo[t].playerBoard[n].length&&!e.playerInfo[t].playerBoard[n][r];r++);return{purchaseIndex:r,cost:bt[n][r]}}}]),n}(De),qn="ABCDEFGHJKLMNOPQRSTUVWXYZ";!function(e){e[e.JOIN=0]="JOIN",e[e.LEAVE=1]="LEAVE",e[e.RENAME=2]="RENAME",e[e.START_GAME=3]="START_GAME",e[e.END_GAME=4]="END_GAME",e[e.GAME_EVENT=5]="GAME_EVENT"}(Wn||(Wn={})),function(e){e[e.SET_PLAYERS=0]="SET_PLAYERS",e[e.SET_HOST=1]="SET_HOST",e[e.START_GAME=2]="START_GAME",e[e.ERROR=3]="ERROR",e[e.END_GAME=4]="END_GAME",e[e.LEAVE_ROOM=5]="LEAVE_ROOM"}(zn||(zn={}));var Un=Object.freeze({maxPlayers:4,minPlayers:2,players:{}}),Fn=function(e){Object(ke.a)(n,e);var t=Object(Se.a)(n);function n(e){var r;return Object(we.a)(this,n),(r=t.call(this)).network=void 0,r.manager=void 0,r.game=void 0,r.create=function(){var e=Object(je.a)(ye.a.mark((function e(t,n){var o;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0===n||""===n?[0,0,0,0].map((function(){return qn[Math.floor(Math.random()*qn.length)]})).join(""):n,e.next=3,r.join(t,o);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.join=function(){var e=Object(je.a)(ye.a.mark((function e(t,n){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==n){e.next=2;break}throw new Error("Room name is required");case 2:return console.log("joining ".concat(n)),e.next=5,r.network.joinOrHost(n);case 5:return e.next=7,r.network.dispatch({action:Wn.JOIN,payload:t}).catch((function(e){throw r.leaveRoom(),e}));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.joinOrCreate=r.join,r.errorHandler=function(e){var t=e.error;console.log(t),r.emit(zn.ERROR,{data:t})},r.rename=function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.network.dispatch({action:Wn.RENAME,payload:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.leaveRoom=function(){r.network.leave(),r.emit(zn.SET_HOST,{data:void 0}),r.emit(zn.LEAVE_ROOM,{data:void 0})},r.startGame=Object(je.a)(ye.a.mark((function e(){var t,n;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},n={},Object.entries(r.players).forEach((function(e,r){var o=Object(s.a)(e,2),a=o[0],i=o[1];t[a]=r.toString(),t[r]=a,n[i]=r.toString()})),e.next=5,r.network.dispatch({action:Wn.START_GAME,payload:{idDict:t,nameDict:n}});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),r.endGame=function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.network.dispatch({action:Wn.END_GAME,payload:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.networkReducer=function(e,t,n){var o=t.action,a=t.payload,i=function(){if("string"!==typeof a)throw new Error("Invalid payload");if(r.started){var t;if(void 0===r.n(a))throw new Error("Room '".concat(null!==(t=r.roomCode)&&void 0!==t?t:"","' has started game"));if(void 0!==e.idDict&&void 0!==e.nameDict){var o=r.n(a);e.idDict[n]=o,e.idDict[o]=n,e.nameDict[a]=o}}if(Object.values(e.players).includes(a))throw new Error("Name '".concat(a,"' already taken"));e.players=Object(c.a)(Object(c.a)({},e.players),{},Object(Oe.a)({},n,a)),r.emit(zn.SET_PLAYERS,{data:Object(c.a)({},e.players)}),void 0!==e.game&&r.game.rejoin(e.game)};switch(o){case Wn.JOIN:var s;if(Object.keys(e.players).length+1>e.maxPlayers)throw new Error("Room '".concat(null!==(s=r.roomCode)&&void 0!==s?s:"","' is already full"));return i(),Object(c.a)({},e);case Wn.RENAME:return i(),Object(c.a)({},e);case Wn.LEAVE:var l=r.players,u=a,d=(l[u],Object(de.a)(l,[u].map(ge.a)));return e.players=d,r.emit(zn.SET_PLAYERS,{data:Object(c.a)({},e.players)}),Object(c.a)({},e);case Wn.START_GAME:var h;if(r.playerIds.length<r.state.minPlayers)throw new Error("Not enough players, required 2");var b=a;return e.game=Bn.initialState(r.playerIds.length),e.idDict=Object(Rn.a)(b.idDict),e.nameDict=Object(Rn.a)(b.nameDict),null===(h=r.game)||void 0===h||h.start(e.game),r.emit(zn.START_GAME,{data:r.game}),Object(c.a)({},e);case Wn.END_GAME:return e.idDict=void 0,e.nameDict=void 0,void 0!==e.game&&(e.game.gameOver=a),r.game.stop(a),r.emit(zn.END_GAME,{data:a}),Object(c.a)({},e);case Wn.GAME_EVENT:if(r.started&&void 0!==e.game){if(void 0!==e.game.gameOver)throw new Error("Game over");try{var f;e.game=null===(f=r.game)||void 0===f?void 0:f.reducer(e.game,a,n)}catch(v){throw console.trace(v),v}return Object(c.a)({},e)}throw new Error("Game not started")}return e},r.manager=null!==e&&void 0!==e?e:new Ze,r.network=new Hn(r.manager,Object(Rn.a)(Un),r.networkReducer),r.network.on(Sn.MEMBERS_LEFT,(function(e){var t=e.members;void 0!==t&&t.forEach((function(e){r.network.dispatchLocal({action:Wn.LEAVE,payload:e}).catch(r.errorHandler)}))})),r.network.on(Sn.HOST_CHANGE,(function(e){var t=e.host;void 0!==t&&r.emit(zn.SET_HOST,{data:t})})),r.game=new Bn(Object(xe.a)(r)),r}return Object(Ee.a)(n,[{key:"state",get:function(){return this.network.state}},{key:"hostPlayerId",get:function(){return this.network.hostId}},{key:"roomCode",get:function(){return this.network.networkName}},{key:"myId",get:function(){return this.network.id}},{key:"players",get:function(){return this.state.players}},{key:"playerIds",get:function(){return Object.keys(this.players)}},{key:"p",value:function(e){if(void 0===this.state.idDict)throw console.trace("Game not started yet"),new Error("Game not started yet");return this.state.idDict[e]}},{key:"pi",value:function(e){if(void 0===this.state.idDict)throw console.trace("Game not started yet"),new Error("Game not started yet");return Number.parseInt(this.state.idDict[e])}},{key:"n",value:function(e){if(void 0===this.state.nameDict)throw console.trace("Game not started yet"),new Error("Game not started yet");return this.state.nameDict[e]}},{key:"whoami",value:function(e){if(void 0===this.state.idDict)throw console.trace("Game not started yet"),new Error("Game not started yet");var t=this.state.idDict[e];if(void 0===t)throw new Error("Id ".concat(e," not in game"));return this.state.players[t]}},{key:"started",get:function(){return void 0!==this.state.game&&void 0===this.state.game.gameOver}}],[{key:"getName",value:function(e,t){return void 0!==e.idDict&&void 0!==e.players?e.players[e.idDict[t]]:""}}]),n}(De),Yn=new Fn,Kn=Object(r.createContext)(Yn),Vn=function(){return Object(r.useContext)(Kn)},Jn=(ee.a.object,function(e){return Object(ne.b)(u.b,Object(c.a)(Object(c.a)({},e),{},{sx:Object(c.a)({py:4,px:5,backgroundColor:"background",boxShadow:2,borderRadius:3},e.sx)}))}),Xn=(ee.a.func.isRequired,function(e){var t=e.setState,n=Vn(),o=Object(r.useState)(""),a=Object(s.a)(o,2),i=a[0],c=a[1],l=Object(r.useState)(window.location.hash.substring(2)),d=Object(s.a)(l,2),h=d[0],b=d[1],f=Object(r.useState)(""),v=Object(s.a)(f,2),p=v[0],g=v[1],O=Object(r.useState)(""),m=Object(s.a)(O,2),y=m[0],j=m[1],w=Object(r.useState)(!1),E=Object(s.a)(w,2),x=E[0],k=E[1],S=function(e){var t="Photosynthesis";void 0!==e&&(t="".concat(e," - Photosynthesis")),window.history.pushState({roomCode:e},t,"#/".concat(null!==e&&void 0!==e?e:"")),window.document.title=t};return Object(r.useEffect)((function(){var e=function(e){var n,r=e.state;b(null!==(n=null===r||void 0===r?void 0:r.roomCode)&&void 0!==n?n:""),null!==r&&""!==(null===r||void 0===r?void 0:r.roomCode)||t(po.HOME)};return window.addEventListener("popstate",e),window.history.replaceState({roomCode:window.location.hash.substring(2)},"Photosynthesis"),function(){window.removeEventListener("popstate",e)}}),[t]),Object(ne.b)(Jn,{children:Object(ne.c)(u.e,{sx:{flexDirection:"column"},children:[Object(ne.b)(u.g,{children:"Welcome to Photosynthesis"}),""!==p&&Object(ne.b)(pe,{variant:"danger",children:p}),Object(ne.b)(fe,{fullwidth:!0,disabled:x,label:"Name",onChange:function(e){var t=e.target;return null===c||void 0===c?void 0:c(t.value)},value:i}),Object(ne.b)(fe,{fullwidth:!0,disabled:x,label:"Room",onChange:function(e){var t=e.target;return null===b||void 0===b?void 0:b(t.value.toUpperCase())},value:h}),Object(ne.c)(u.e,{mt:3,children:[Object(ne.b)(ae,{sx:{flex:1},disabled:x||""===i,variant:"warning",onClick:function(){j("Creating Room..."),k(!0),n.create(i,h).then((function(){g(""),t(po.ROOM),S(n.roomCode)})).catch((function(e){"unavailable-id"===e.type?g("Room ".concat(h," already exists")):g("Error when creating room"),console.error(e)})).finally((function(){j(""),k(!1)}))},children:"New Room"}),Object(ne.b)(ae,{sx:{flex:1},disabled:x||""===i||""===h,ml:3,variant:"primary",onClick:function(){j("Joining Room..."),k(!0),n.join(i,h).then((function(){g(""),S(h),n.started?t(po.GAME):t(po.ROOM)})).catch((function(e){g(e.message),console.error(e)})).finally((function(){j(""),k(!1)}))},children:"Join Room"})]}),Object(ne.b)(u.i,{children:y})]})})}),Qn=(ee.a.string.isRequired,ee.a.node.isRequired,ee.a.oneOfType([ee.a.arrayOf(ee.a.oneOfType([ee.a.number,ee.a.string])),ee.a.number,ee.a.string]),ee.a.any,ee.a.bool,ee.a.oneOfType([ee.a.arrayOf(ee.a.oneOfType([ee.a.number,ee.a.string])),ee.a.number,ee.a.string]),function(e){var t=e.children,n=e.color,r=e.path,o=e.size,a=e.reverse,i=void 0!==a&&a,s=e.iconMargin,l=void 0===s?2:s,d=Object(de.a)(e,["children","color","path","size","reverse","iconMargin"]),h=null!==i&&void 0!==i&&i;return Object(ne.c)(u.e,Object(c.a)(Object(c.a)({sx:{alignItems:"center",flexDirection:h?"row-reverse":"row"}},d),{},{children:[Object(ne.b)(le,{size:o,path:r,color:n,sx:{fillOpacity:"transparent"===n?0:1,path:{fill:n}}})," ",Object(ne.b)(u.i,{sx:Object(Oe.a)({flex:1,color:n,fontSize:o},h?"mr":"ml",l),children:t})]}))});Qn.defaultProps={reverse:!1};var Zn=Qn,$n=n(26),er=n(89),tr=n.n(er),nr=function(e){var t=Object($n.d)().theme;return Object(ne.b)(tr.a,{ariaHideApp:!1,isOpen:e.isOpen,onRequestClose:function(){return!e.isStatic&&e.onClose()},contentLabel:e.contentLabel,style:{overlay:{backgroundColor:"fgPales.0",zIndex:200,display:"flex",justifyContent:"center",alignItems:"center",padding:t.space[2],overflowY:"auto"}},sx:Object(c.a)(Object(c.a)({minWidth:["100%","250px"],maxWidth:"number"===typeof e.size&&t.breakpoints[e.size],outline:"none",opacity:0,margin:"auto",fontFamily:"body",lineHeight:"body"},x(["opacity"])),{},{"&.ReactModal__Content--after-open":{opacity:1},"&.ReactModal__Content--before-close":{opacity:0}}),children:Object(ne.b)(u.b,Object(c.a)(Object(c.a)({},e),{},{sx:{backgroundColor:"bgs.1",boxShadow:2,borderRadius:1}}))})};nr.defaultProps={size:0};var rr=nr,or=n(120),ar=function(e){var t="function"===typeof e.onClose?e.onClose:Object(or.a)(void 0),n="function"===typeof e.onAction?e.onAction:Object(or.a)(void 0),r=function(e){return function(){t(),n(e)}};return Object(ne.c)(rr,{isStatic:!0,isOpen:e.isOpen,onClose:r(!1),contentLabel:e.contentLabel,setIsOpen:e.setIsOpen,size:e.size,children:[Object(ne.c)(u.b,{p:[4,3],pb:2,children:[Object(ne.b)(u.g,{variant:"subheading",children:e.title}),Object(ne.b)(u.i,{children:e.children})]}),Object(ne.c)(u.e,{p:[3,2],sx:{alignItems:"center",justifyContent:"flex-end"},children:[!e.hideNoChoice&&Object(ne.b)(ae,{onClick:r(!1),children:e.noText}),Object(ne.b)(ae,{variant:"primary",ml:2,onClick:r(!0),children:e.yesText})]})]})};ar.defaultProps={noText:"No",yesText:"Yes",title:"Confirm",hideNoChoice:!1};var ir=ar,cr=(ee.a.bool.isRequired,ee.a.func,ee.a.string,ee.a.func,ee.a.string,ee.a.node.isRequired,ee.a.string,ee.a.number,function(e){return Object(ne.b)(ir,Object(c.a)(Object(c.a)({},e),{},{hideNoChoice:!0,children:e.children}))});cr.defaultProps={title:"Alert",yesText:"OK"};var sr=cr,lr=function(){return Object(r.useContext)(ur)},ur=Object(r.createContext)(window.alert);ur.displayName="AlertContext";ee.a.func.isRequired;var dr=function(e){var t,n=e.setState,o=Vn(),a=Object(r.useState)({}),i=Object(s.a)(a,2),c=i[0],d=i[1],h=Object(r.useState)(""),b=Object(s.a)(h,2),f=b[0],v=b[1],p=lr(),g=null!==(t=c[o.myId])&&void 0!==t?t:"",O=o.rename;Object(r.useEffect)((function(){var e=o.on(zn.SET_PLAYERS,(function(e){var t=e.data;return d(t)})),t=o.on(zn.SET_HOST,(function(e){var t=e.data;return v(t)})),r=o.on(zn.START_GAME,(function(e){var t=e.data;n(po.GAME,t)})),a=o.on(zn.LEAVE_ROOM,(function(){n(po.HOME)}));return function(){o.off(zn.SET_PLAYERS,e),o.off(zn.SET_HOST,t),o.off(zn.START_GAME,r),o.off(zn.LEAVE_ROOM,a)}}),[o,n]);return Object(ne.b)(Jn,{children:Object(ne.c)(u.e,{sx:{flexDirection:"column"},children:[Object(ne.b)(u.g,{children:o.roomCode}),Object(ne.b)(fe,{label:"My Name",value:g,onChange:function(){var e=Object(je.a)(ye.a.mark((function e(t){var n,r,o;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.target,e.next=3,O(null!==(n=null===(r=o)||void 0===r?void 0:r.value)&&void 0!==n?n:"");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),Object(ne.b)(u.d,{my:3}),Object(ne.b)(u.e,{sx:{flexDirection:"column"},children:Object.entries(c).map((function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1];return n===f?Object(ne.c)(Zn,{path:l.e,children:[r,n===o.myId&&" (me)"]},n):Object(ne.c)(Zn,{path:l.a,children:[r,n===o.myId&&" (me)"]},n)}))}),Object(ne.b)(u.d,{my:3}),Object(ne.c)(u.e,{children:[Object(ne.b)(ae,{sx:{flex:1},variant:"warning",onClick:o.leaveRoom,children:"Back"}),Object(ne.b)(ae,{sx:{flex:1,visibility:f===o.myId?null:"hidden"},ml:3,variant:"primary",onClick:f===o.myId?function(){null===o||void 0===o||o.startGame().catch((function(e){console.log(e),p(e.message)}))}:void 0,children:"Start"})]})]})})},hr=Object(r.createContext)([Yn.game,void 0,void 0]),br=function(){return Object(r.useContext)(hr)},fr=function(e){var t=Vn().game,n=Object(r.useState)(void 0),o=Object(s.a)(n,2),a=o[0],i=o[1],l=Object(r.useState)(void 0),u=Object(s.a)(l,2),d=u[0],h=u[1];return Object(r.useEffect)((function(){i(void 0),t.on(Nn.UPDATE_GAME_STATE,(function(e){var t=e.data;h(null===t||void 0===t?void 0:t.gameOver),i(Object(c.a)({},t))})),t.on(Nn.GAME_OVER,(function(e){var t=e.data;return h(t)}))}),[t]),Object(ne.b)(hr.Provider,Object(c.a)({value:[t,a,d]},e))},vr=(ee.a.bool.isRequired,ee.a.node.isRequired,ee.a.bool,ee.a.bool,function(e){var t=e.isOpen,n=e.children,o=e.hideOnly,a=e.noInitialTransition,i=Object(de.a)(e,["isOpen","children","hideOnly","noInitialTransition"]),l=Object(r.useRef)(null),d=Object(r.useState)(0),h=Object(s.a)(d,2),b=h[0],f=h[1],v=Object(r.useState)(t),p=Object(s.a)(v,2),g=p[0],O=p[1],m=Object(r.useState)(t?1:0),y=Object(s.a)(m,2),j=y[0],x=y[1],k=Object(r.useState)(!1),S=Object(s.a)(k,2),C=S[0],R=S[1],T=Object(r.useState)(!(null!==a&&void 0!==a&&a)),A=Object(s.a)(T,2),P=A[0],M=A[1];Object(r.useEffect)((function(){setTimeout((function(){return M(!0)}),300)}),[]);Object(r.useEffect)((function(){t&&O(!0),x(t?5:4)}),[t]),Object(r.useEffect)((function(){C&&(null!==(null===l||void 0===l?void 0:l.current)&&f(l.current.scrollHeight),(4&j)>0?x(-5&j|2):(2&j)>0&&setTimeout((function(){C&&(2===j&&O(!1),x(-3&j))}),300))}),[C,j]),Object(r.useEffect)((function(){return R(!0),function(){R(!1)}}),[]);var N=3===j||4===j?b.toString()+"px":5===j||2===j?"0px":void 0;return Object(ne.b)(u.b,Object(c.a)(Object(c.a)({ref:l,sx:Object(c.a)({height:N,overflowY:(6&j)>0?"hidden":void 0},P?E(w,["height"]):{})},i),{},{children:null!==o&&void 0!==o&&o?Object(ne.b)(u.b,{sx:{display:g?"block":"none"},children:n}):g?n:null}))});vr.defaultProps={noInitialTransition:!1};var pr=vr,gr=(ee.a.bool,ee.a.node.isRequired,ee.a.node.isRequired,ee.a.func,ee.a.bool,ee.a.bool,ee.a.object,ee.a.bool,ee.a.func,ee.a.bool,ee.a.string,Object(r.forwardRef)((function(e,t){var n=e.defaultOpen,o=e.children,a=e.header,i=e.noPad,d=e.setController,h=e.hideOnly,b=e.reverseHeader,f=e.headerSx,v=e.onOpen,p=Object(de.a)(e,["defaultOpen","children","header","noPad","setController","hideOnly","reverseHeader","headerSx","onOpen"]),g=Object(r.useState)(null!==n&&void 0!==n&&n),O=Object(s.a)(g,2),m=O[0],y=O[1];return Object(r.useEffect)((function(){te(d)&&d({show:function(){return y(!0)},hide:function(){return y(!1)},toggle:function(){return y(!m)}})}),[m,d]),Object(r.useEffect)((function(){m&&(null===v||void 0===v||v())}),[m,v]),Object(ne.c)(pe,Object(c.a)(Object(c.a)({ref:t},p),{},{sx:Object(c.a)({p:[0,0,0,0]},p.sx),children:[Object(ne.c)(u.e,{onClick:function(){return y(!m)},sx:Object(c.a)({px:K.px,py:K.py,":hover":{backgroundColor:"highlight"},alignItems:"center",justifyContent:"space-between",flexDirection:null!==b&&void 0!==b&&b?"row-reverse":"row"},f),children:[a,Object(ne.b)(le,{path:l.b,sx:Object(c.a)(Object(c.a)({},E(.3,["transform"])),{},{transform:m?"rotate(180deg)":void 0})})]}),Object(ne.b)(pr,{isOpen:m,hideOnly:h,children:Object(ne.b)(u.b,{className:"collapsible-content",px:null!==i&&void 0!==i&&i?void 0:K.px,py:null!==i&&void 0!==i&&i?void 0:K.py,sx:{borderTopColor:"border",borderTopWidth:"1px",borderTopStyle:"solid"},children:o})})]}))})));gr.displayName="CollapsibleWell";var Or,mr,yr,jr,wr,Er=gr,xr=n.p+"static/media/token1.d3903231.png",kr=n.p+"static/media/token2.686baae1.png",Sr=n.p+"static/media/token3.9d69a577.png",Cr=n.p+"static/media/token4.791c829c.png",Rr=(ee.a.bool,ee.a.func,ee.a.string.isRequired,ee.a.node,ee.a.object,function(e){var t=e.disabled,n=e.onClick,r=e.path,o=e.children,a=e.sx;return Object(ne.b)(u.b,{onClick:function(){null===n||void 0===n||n()},sx:Object(c.a)({width:ft,height:ft,backgroundImage:"url(".concat(r,")"),backgroundSize:"auto 100%",textAlign:"center",lineHeight:ft,color:"white.0",boxShadow:1,borderRadius:"50%"},a),children:Object(ne.b)(u.b,{sx:{width:"100%",height:"100%",borderRadius:"50%",":hover":!0!==t?{backgroundColor:"highlight",cursor:void 0!==n?"pointer":void 0}:void 0,backgroundColor:!0===t?"muted":void 0},children:o})})}),Tr=n(90),Ar=(ee.a.number.isRequired,ee.a.object,function(e){var t=e.count,n=e.sx;return Object(ne.b)(u.a,{variant:t>0?"primary":"danger",sx:null!==n&&void 0!==n?n:void 0,children:t})}),Pr=(ee.a.arrayOf(ee.a.node).isRequired,ee.a.arrayOf(ee.a.bool.isRequired),ee.a.string.isRequired,ee.a.func,ee.a.number,function(e){var t=e.stack,n=e.imgPath,o=e.badge,a=e.enabled,i=e.onClick,l=Object(r.useState)(!1),d=Object(s.a)(l,2),h=d[0],b=d[1];return Object(r.useEffect)((function(){var e=function(){return b(!1)};return window.addEventListener("touchend",e),window.addEventListener("touchcancel",e),function(){window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e)}}),[b]),Object(ne.b)(Tr.a,{onTap:function(e){e.preventDefault(),b(!1)},onPress:function(e){e.preventDefault(),b(!0)},onPressUp:function(e){b(!1),e.preventDefault()},children:Object(ne.c)(u.b,{onMouseEnter:function(){return b(!0)},onMouseLeave:function(){return b(!1)},unselectable:"on",sx:{position:"relative",width:ft,height:ft},onContextMenu:function(e){b(!1),e.preventDefault()},m:1,children:[(t.length>0?t:["-"]).map((function(e,r){return Object(ne.b)(u.b,{sx:Object(c.a)({position:"absolute",bottom:h?"".concat(54*r,"px"):"0px",zIndex:t.length-r,pb:"4px"},E(w,["bottom"])),children:Object(ne.b)(Rr,{path:n,disabled:"-"===e||!1===(null===a||void 0===a?void 0:a[r]),onClick:0===r&&!1!==(null===a||void 0===a?void 0:a[r])?i:void 0,children:e})},r)})),void 0!==o&&null!==o&&Object(ne.b)(Ar,{count:o,sx:{position:"absolute",right:0,bottom:0,zIndex:t.length+1}})]})})}),Mr=["",xr,kr,Sr,Cr],Nr=(ee.a.arrayOf(ee.a.number).isRequired,ee.a.number.isRequired,function(e){return Mr[e]}),_r=function(e){var t=e.stack,n=e.leaves,r=Nr(n);return Object(ne.b)(Pr,{stack:t,imgPath:r,badge:t.length})},Dr=function(e){var t=e.children,n=Object(de.a)(e,["children"]),r=o.a.Children.toArray(t);return Object(ne.b)(u.e,Object(c.a)(Object(c.a)({sx:{alignItems:"flex-end"}},n),{},{children:r.map((function(e,t){var n=0===t?{}:{borderBottomLeftRadius:0,borderTopLeftRadius:0},a=t===r.length-1?{}:{borderBottomRightRadius:0,borderTopRightRadius:0};return o.a.cloneElement(e,{sx:Object(c.a)(Object(c.a)({},n),a)})}))}))},Hr=n.p+"static/media/sun.b0ca195e.svg",Ir=(ee.a.node,ee.a.object,function(e){var t=e.children,n=e.sx;return Object(ne.c)(u.e,{sx:null!==n&&void 0!==n?n:void 0,children:[Object(ne.b)(u.b,{children:Object(ne.b)("img",{alt:"sun icon",style:{maxHeight:"24px"},src:Hr})}),Object(ne.b)(u.b,{sx:{lineHeight:"24px"},children:t})]})}),Lr=function(e){var t=e.children,n=e.size,r=void 0===n?"24px":n,o=e.myPoints,a=e.className;return Object(ne.b)(u.b,{className:a,sx:{boxSizing:"content-box",backgroundImage:"url(".concat(Hr,")"),backgroundSize:"auto 100%",textAlign:"center",width:r,height:r,lineHeight:r,color:(null!==o&&void 0!==o?o:1/0)>=(null!==t&&void 0!==t?t:-1/0)?"white.0":"red.0",textShadow:function(e){var t,n,r,o;return"\n            -1px -1px 1px ".concat(null===(t=e.colors)||void 0===t?void 0:t.sunTagShadow,",\n            1px -1px 1px ").concat(null===(n=e.colors)||void 0===n?void 0:n.sunTagShadow,",\n            -1px 1px 1px ").concat(null===(r=e.colors)||void 0===r?void 0:r.sunTagShadow,",\n            1px 1px 1px ").concat(null===(o=e.colors)||void 0===o?void 0:o.sunTagShadow)},fontSize:1,fontWeight:"bolder"},children:t})},Gr=n.p+"static/media/seedBlue.a94e41ee.png",Wr=n.p+"static/media/shortBlue.73056e66.png",zr=n.p+"static/media/midBlue.77094c0e.png",Br=n.p+"static/media/tallBlue.c4de3db8.png",qr=n.p+"static/media/seedGreen.63212337.png",Ur=n.p+"static/media/shortGreen.de62bc33.png",Fr=n.p+"static/media/midGreen.64339637.png",Yr=n.p+"static/media/tallGreen.fe39512a.png",Kr=n.p+"static/media/seedOrange.cda5f0ce.png",Vr=n.p+"static/media/shortOrange.13be468c.png",Jr=n.p+"static/media/midOrange.e0443e61.png",Xr=n.p+"static/media/tallOrange.37dd8f99.png",Qr=n.p+"static/media/seedYellow.733a13b8.png",Zr=n.p+"static/media/shortYellow.a15af630.png",$r=n.p+"static/media/midYellow.1b6cf970.png",eo=n.p+"static/media/tallYellow.ed752832.png",to=(Or={},Object(Oe.a)(Or,Xe.SEED,Gr),Object(Oe.a)(Or,Xe.SHORT,Wr),Object(Oe.a)(Or,Xe.MID,zr),Object(Oe.a)(Or,Xe.TALL,Br),Or),no=(mr={},Object(Oe.a)(mr,Xe.SEED,qr),Object(Oe.a)(mr,Xe.SHORT,Ur),Object(Oe.a)(mr,Xe.MID,Fr),Object(Oe.a)(mr,Xe.TALL,Yr),mr),ro=(yr={},Object(Oe.a)(yr,Xe.SEED,Kr),Object(Oe.a)(yr,Xe.SHORT,Vr),Object(Oe.a)(yr,Xe.MID,Jr),Object(Oe.a)(yr,Xe.TALL,Xr),yr),oo=(jr={},Object(Oe.a)(jr,Xe.SEED,Qr),Object(Oe.a)(jr,Xe.SHORT,Zr),Object(Oe.a)(jr,Xe.MID,$r),Object(Oe.a)(jr,Xe.TALL,eo),jr),ao=(wr={},Object(Oe.a)(wr,Je.BLUE,to),Object(Oe.a)(wr,Je.GREEN,no),Object(Oe.a)(wr,Je.ORANGE,ro),Object(Oe.a)(wr,Je.YELLOW,oo),wr),io=(ee.a.arrayOf(ee.a.bool.isRequired).isRequired,ee.a.number.isRequired,ee.a.number.isRequired,ee.a.func,ee.a.number.isRequired,function(e,t){return ao[e][t]}),co=function(e){var t=e.canBuy,n=e.growthStage,o=e.color,a=e.onClick,i=e.myPoints,c=Object(r.useMemo)((function(){var e=t.map((function(e,t){return Object(ne.b)(Lr,{myPoints:i,sx:{top:0,right:"-4px",position:"absolute"},children:bt[n][t]},t)})),r=Object(xt.a)(t);if(!t[0]){var o=t.indexOf(!0);if(-1!==o){var a=e.splice(o,1);return r[0]=!0,r[o]=!1,[[a].concat(Object(xt.a)(e)),r]}}return[e,r]}),[t,n,i]),l=Object(s.a)(c,2),u=l[0],d=l[1];return Object(ne.b)(Pr,{stack:u,enabled:d,imgPath:io(o,n),onClick:a,badge:t.filter((function(e){return e})).length})},so=function(e){var t,n,o=e.mi,a=e.roomState,i=e.interactionStateReducer,c=a.game,l=Object(r.useState)(o),d=Object(s.a)(l,2),h=d[0],b=d[1];Object(r.useEffect)((function(){void 0!==o&&b(o)}),[o]);var f,v=null===c||void 0===c?void 0:c.playerInfo[null!==h&&void 0!==h?h:-1];return Object(ne.b)(Er,{header:void 0!==c?"Current turn: ".concat((f=c.turn,Fn.getName(a,f))):"Board",sx:{m:0,bg:"bgPales.0",maxHeight:"100vh"},defaultOpen:!0,children:void 0!==c&&Object(ne.c)(u.e,{sx:{flexWrap:"wrap",justifyContent:"space-around"},children:[Object(ne.c)(u.b,{children:[Object(ne.b)(u.b,{children:"Score Tokens"}),Object(ne.b)(u.e,{children:Object.entries(c.scoreTokens).map((function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(ne.b)(_r,{leaves:Number.parseInt(n),stack:r},n)}))})]}),Object(ne.c)(u.b,{children:[Object(ne.c)(u.e,{sx:{justifyContent:"space-between"},children:[Object(ne.c)(Dr,{children:[Object.entries(null!==(t=a.nameDict)&&void 0!==t?t:{}).map((function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(ne.b)(ae,{variant:r!==(null===h||void 0===h?void 0:h.toString())?"normal":"primary",onClick:function(){return b(Number.parseInt(r))},children:n},r)})),Object(ne.b)(ae,{onClick:function(){return console.log(a)},children:"O"})]}),c.turn===o&&Object(ne.b)(ae,{onClick:function(){i({action:_n.END_TURN})},disabled:c.preparingRound>0,children:"End Turn"})]}),void 0!==v&&Object(ne.c)(u.b,{children:[Object(ne.c)(u.f,{columns:2,children:[Object(ne.b)(Ir,{children:null!==(n=v.lightPoint)&&void 0!==n?n:""}),Object(ne.c)(u.b,{children:["Score: ",v.score]})]}),Object(ne.c)(u.f,{columns:[1,null,2],children:[Object(ne.c)(u.b,{children:[Object(ne.b)(u.b,{children:"Available:"}),Object(ne.b)(u.e,{children:Object.entries(v.availableArea).map((function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1],a=Number.parseInt(n)===Xe.SEED?1:ht[Number.parseInt(n)-1];return Object(ne.b)(u.b,{sx:{position:"relative"},children:Object(ne.b)(Pr,{onClick:h===o&&v.lightPoint>=a&&(c.preparingRound<=0||n===Xe.SHORT.toString())?function(){return function(e){e===Xe.SEED?i({action:_n.PLANT_SEED}):i({action:_n.GROW_TREE,growthStage:e-1})}(Number.parseInt(n))}:void 0,imgPath:io(v.color,Number.parseInt(n)),enabled:0===r?[!1]:void 0,stack:new Array(Math.max(1,r)).fill(Object(ne.b)(Lr,{myPoints:v.lightPoint,sx:{top:0,right:"-4px",position:"absolute"},children:a})),badge:r},n)},n)}))})]}),Object(ne.c)(u.b,{children:[Object(ne.b)(u.b,{children:"Purchase:"}),Object(ne.b)(u.e,{children:Object.entries(v.playerBoard).map((function(e){var t=Object(s.a)(e,2),n=t[0],r=t[1];return Object(ne.b)(co,{onClick:h===o&&void 0!==h&&v.lightPoint>=Bn.nextPurchase(c,h,Number.parseInt(n)).cost?function(){return e=Number.parseInt(n),void i({growthStage:e,action:_n.PURCHASE});var e}:void 0,growthStage:Number.parseInt(n),color:v.color,canBuy:r,myPoints:v.lightPoint},n)}))})]})]})]})]})]})})},lo=function(e){var t,n,o,a,i,c,s,l,d=e.interactionState,h=e.game,b=e.interactionStateReducer,f=function(e){var t;return h.started&&(null===(t=h.state)||void 0===t?void 0:t.board[e.toString()].color)===h.mi},v=h.started?null===(t=h.state)||void 0===t||null===(n=t.board[null!==(o=null===d||void 0===d||null===(a=d.axial)||void 0===a?void 0:a.toString())&&void 0!==o?o:""])||void 0===n?void 0:n.growthStage:void 0,p=h.gameWorld.renderer.domElement.parentElement,g=lr(),O=Object(r.useCallback)((function(e){var t=e.data.activeAxial;b(void 0===t?void 0:{axial:t})}),[b]);if(Object(r.useEffect)((function(){var e=h.on(Nn.ACTIVE_OBJECT_CHANGED,O);return function(){h.off(Nn.ACTIVE_OBJECT_CHANGED,e)}}),[O,h]),Object(r.useEffect)((function(){var e=function(e){var t=[0,0];e instanceof MouseEvent?(t[0]=e.clientX,t[1]=e.clientY):(t[0]=e.changedTouches[0].pageX,t[1]=e.changedTouches[0].pageY),b({popperCoord:t})};return null===p||void 0===p||p.addEventListener("click",e),function(){null===p||void 0===p||p.removeEventListener("click",e)}}),[p,h.gameWorld,b]),void 0===d.axial||void 0===h.state||void 0===d.popperCoord)return null;if(!h.started)return null;var m=h.state.playerInfo[h.mi],y=function(e){g(e.message)},j=function(e){h.purchase(e).catch(y)},w=Object(ne.c)(u.b,{children:[Object(ne.b)(u.b,{children:"Plant initial tree"}),Object(ne.b)(Rr,{path:io(h.mi,Xe.SHORT),onClick:function(){return b({action:_n.GROW_TREE})}})]}),E=m.availableArea[Xe.SEED]>=1,x=Bn.nextPurchase(h.state,h.mi,Xe.SEED).cost,k=Object(ne.c)(u.b,{m:1,children:[Object(ne.b)(u.b,{children:"Seed"}),Object(ne.b)(Pr,{imgPath:io(h.mi,Xe.SEED),stack:[Object(ne.b)(Lr,{myPoints:m.lightPoint,sx:{position:"absolute",top:0,right:"-4px"},children:1},1)],badge:m.availableArea[Xe.SEED],onClick:function(){return b({action:_n.PLANT_SEED})},enabled:[E&&m.lightPoint>=1]}),!E&&Object(ne.c)(u.b,{sx:{position:"relative"},children:[Object(ne.b)(ae,{variant:"normal-pill-sm",mt:2,onClick:function(){return j(Xe.SEED)},disabled:void 0===x||m.lightPoint<x,children:void 0===x?"N/A":"Buy"}),Object(ne.b)(Lr,{myPoints:m.lightPoint,sx:{position:"absolute",right:0,top:0},children:x})]})]}),S=void 0!==v&&m.availableArea[v+1]>0,C=void 0!==v&&v!==Xe.TALL?Bn.nextPurchase(h.state,h.mi,v+1).cost:1/0,R=void 0!==v&&v!==Xe.TALL&&Object(ne.c)(u.b,{m:1,children:[h.haveSlot(h.state,h.mi,v)?Object(ne.b)(u.b,{children:"Grow"}):Object(ne.b)(u.b,{title:"No empty slots on your purchase board. Proceed and you will say bye bye to your lovely ".concat(vt[v],". So think carefully."),sx:{color:"yellow.0"},children:"Grow"}),Object(ne.b)(Pr,{imgPath:io(h.mi,v+1),stack:[Object(ne.b)(Lr,{myPoints:m.lightPoint,sx:{position:"absolute",top:0,right:"-4px"},children:ht[v]},1)],badge:m.availableArea[v+1],onClick:function(){return b({action:_n.GROW_TREE})},enabled:[S&&m.lightPoint>=ht[v]]}),!S&&Object(ne.c)(u.b,{sx:{position:"relative"},children:[Object(ne.b)(ae,{variant:"normal-pill-sm",mt:2,onClick:function(){return j(v+1)},disabled:void 0===C||m.lightPoint<C,children:void 0===C?"N/A":"Buy"}),Object(ne.b)(Lr,{myPoints:m.lightPoint,sx:{position:"absolute",right:0,top:0},children:C})]})]}),T=h.nextToken(h.state,d.axial),A=void 0!==v&&v===Xe.TALL&&Object(ne.c)(u.b,{m:1,children:[Object(ne.b)(u.b,{children:"Harvest"}),Object(ne.b)(Pr,{stack:[Object(ne.c)(u.b,{sx:{position:"relative"},children:[Object(ne.b)(Lr,{myPoints:m.lightPoint,sx:{position:"absolute",right:"-4px"},children:ht[v]}),Object(ne.b)(u.b,{children:T.score})]},1)],imgPath:Nr(T.leaves),onClick:function(){return b({action:_n.GROW_TREE})},enabled:[m.lightPoint>=ht[Xe.TALL]]})]});return Object(ne.c)(Jn,{sx:{p:2,position:"fixed",left:"".concat(null!==(i=null===(c=d.popperCoord)||void 0===c?void 0:c[0].toString())&&void 0!==i?i:"0","px"),top:"".concat(null!==(s=null===(l=d.popperCoord)||void 0===l?void 0:l[1].toString())&&void 0!==s?s:"0","px"),backgroundColor:"bgPales.0",zIndex:1},children:[d.axial.toString(),h.state.preparingRound>0?void 0===v&&w:Object(ne.c)(u.e,{sx:{justifyItems:"space-around"},children:[(f(d.axial)||void 0===v)&&k,void 0!==v&&f(d.axial)&&(v===Xe.TALL?A:R)]})]})},uo=function(){var e=Object(je.a)(ye.a.mark((function e(t){return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return e(window.confirm(t))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ho=Object(r.createContext)(uo);ho.displayName="ConfirmContext";n(84),ee.a.number.isRequired,bo={},Object(Oe.a)(bo,Xe.SEED,"\u25ca"),Object(Oe.a)(bo,Xe.SHORT,"S"),Object(Oe.a)(bo,Xe.MID,"M"),Object(Oe.a)(bo,Xe.TALL,"L"),fo={},Object(Oe.a)(fo,Xe.SEED,[8,10]),Object(Oe.a)(fo,Xe.SHORT,[8,10]),Object(Oe.a)(fo,Xe.MID,[11,15]),Object(Oe.a)(fo,Xe.TALL,[17,25]),n(95),ee.a.string.isRequired,ee.a.bool,ee.a.number.isRequired,vo={},Object(Oe.a)(vo,Xe.SEED,[45,50]),Object(Oe.a)(vo,Xe.SHORT,[45,50]),Object(Oe.a)(vo,Xe.MID,[65,76]),Object(Oe.a)(vo,Xe.TALL,[98,115]),ee.a.number.isRequired,ee.a.func.isRequired,ee.a.func.isRequired;var bo,fo,vo,po,go=function(e){var t,n,o,a=e.setState,i=br(),l=Object(s.a)(i,1)[0],d=Vn(),h=Object(r.useContext)(ho),b=Object(r.useState)({}),f=Object(s.a)(b,2),v=f[0],p=f[1],g=function(e){var t,n,r,o,a=void 0===e?{}:Object(c.a)(Object(c.a)({},v),e);a.action===_n.PLANT_SEED&&void 0!==a.popperCoord&&(a=void 0===(null===(t=l.state)||void 0===t||null===(n=t.board[null!==(r=null===(o=a.axial)||void 0===o?void 0:o.toString())&&void 0!==r?r:""])||void 0===n?void 0:n.growthStage)?Object(c.a)(Object(c.a)({},a),{},{target:a.axial,popperCoord:void 0}):Object(c.a)(Object(c.a)({},a),{},{source:a.axial,popperCoord:void 0}));if(a.action===_n.PURCHASE&&void 0!==a.growthStage&&(console.log("purchase"),l.purchase(a.growthStage).catch(m),a={}),a.action===_n.END_TURN&&(console.log("end turn"),l.endTurn().catch(m),a={}),a.action===_n.PLANT_SEED&&void 0!==a.source&&void 0!==a.target&&(console.log("plant seed"),l.plantSeed(a.source,a.target).catch(m),a={}),a.action===_n.GROW_TREE&&void 0!==a.axial){var i,s;console.log("grow tree");var u=null===(i=l.state)||void 0===i||null===(s=i.board[a.axial.toString()])||void 0===s?void 0:s.growthStage;console.log("have slot",void 0!==u,void 0!==l.state,void 0!==u&&void 0!==l.state&&!l.haveSlot(l.state,l.mi,u)),void 0===u||void 0===l.state||l.haveSlot(l.state,l.mi,u)?(l.growTree(a.axial).catch(m),a={}):h("No empty slots on your purchase board. Proceed and lose your ".concat(vt[u])).then((function(e){e&&void 0!==a.axial&&l.growTree(a.axial).catch(m),p({})})).catch(m)}p(a)},O=lr(),m=Object(r.useCallback)((function(e){console.log(e),O(e.message)}),[O]),y=(null!==(t=null===(n=l.state)||void 0===n?void 0:n.preparingRound)&&void 0!==t?t:1)>0,j=Object(r.useMemo)((function(){if(void 0!==v.action)switch(v.action){case _n.GROW_TREE:return y||void 0!==v.axial?"":"Select a ".concat(void 0!==v.growthStage?vt[v.growthStage]:"tree"," to grow");case _n.PLANT_SEED:if(void 0===v.source)return"Select a tree as seed source tree";if(void 0===v.target)return"Select an empty tile to plant seed"}return""}),[y,v]),x=null===(o=l.state)||void 0===o?void 0:o.gameOver,k=void 0!==x;return Object(ne.c)(ne.a,{children:[Object(ne.c)(u.b,{children:[l.started&&Object(ne.b)(u.b,{sx:Object(c.a)({position:"fixed",top:0,right:0,left:0,bottom:0,pointerEvents:"none",boxShadow:""!==j?"inset 0 0 100px #".concat(ct[l.mi].toString(16)):void 0},E(w,["box-shadow"]))}),Object(ne.b)(u.g,{sx:{position:"fixed",top:0,width:"100%",textAlign:"center"},children:j}),Object(ne.b)(lo,{interactionState:v,interactionStateReducer:g,game:l}),Object(ne.c)(Jn,{sx:Object(c.a)({position:"fixed",top:k?"50%":"200%",left:"50%",transform:"translate(-50%, -50%)"},E(w,["top"])),children:[Object(ne.b)(u.g,{children:"Game Over"}),Object(ne.b)(u.i,{children:x}),Object(ne.b)(ae,{variant:"primary",mt:3,onClick:function(){l.gameWorld.resetBoard(),a(po.ROOM)},children:"Next Round"})]}),Object(ne.b)(u.e,{sx:{width:"100vw",flexDirection:"column",justifyContent:"space-between",justifyItems:"center",position:"absolute",left:0,bottom:0},children:Object(ne.b)(so,{mi:l.started?l.mi:void 0,roomState:d.state,interactionStateReducer:g})})]}),null]})},Oo=function(){var e=Object(r.useRef)(null),t=br(),n=Object(s.a)(t,1)[0].gameWorld;return Object(r.useEffect)((function(){var t,r=e.current;null!==r&&(r.childNodes.forEach((function(e){r.removeChild(e)})),r.appendChild(n.renderer.domElement),null===(t=n.world.getSystem($e.e))||void 0===t||t.onResize())}),[e,n.renderer.domElement,n.world]),Object(ne.b)(u.b,{ref:e,sx:{width:"100vw",height:"100vh",position:"absolute",left:0,top:0,right:0,bottom:0,canvas:{width:"100%",height:"100%"}}})},mo=n(75),yo=n(76),jo=function(e){return e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2},wo=function(e,t){return e/6<t?6:e/6>=t+1?0:6-e%6},Eo=function(e,t){return e/6>=t},xo=.08,ko=function(e){var t,n,o,a,i=Object.assign({},e),l=br(),d=Object(s.a)(l,1)[0].state,b=null!==(t=null===d||void 0===d?void 0:d.preparingRound)&&void 0!==t?t:0,f=b>0,v=f?6:6*(null!==(n=null===d||void 0===d?void 0:d.totalRevolutions)&&void 0!==n?n:0),p=f?6-b:v-6*(null!==(o=null===d||void 0===d?void 0:d.revolutionLeft)&&void 0!==o?o:0)+(6-(null!==(a=null===d||void 0===d?void 0:d.rayDirection)&&void 0!==a?a:0))%6,g=Object(r.useMemo)((function(){return Object(xt.a)(Array(Math.ceil(v/6)).keys())}),[p,v]),O=Object($n.d)().theme,m=Object(yo.a)(O,"bgs.2"),y=Object(yo.a)(O,f?"blue.0":"yellow.0"),j=Object(h.c)(.1,m),w=Object(h.f)(.1,m),E=i.sx,x=Object(de.a)(i,["sx"]),k=function(e,t){return[{remaining:[Math.min(.9999,wo(p,t)/6)],timing:{duration:2e3,ease:En}},{scale:[Eo(p,t)?1:.3],x:[Eo(p,t)?0:t-Math.floor(p/6)+.85],timing:{duration:2e3,ease:jo}}]};return Object(ne.b)(u.b,Object(c.a)(Object(c.a)({sx:Object(c.a)({text:{fill:"text"},userSelect:"none"},E)},x),{},{children:Object(ne.c)("svg",{width:250,height:80,viewBox:"0 0 6 2.2",shapeRendering:"crisp-edges",children:[Object(ne.b)("title",{children:"".concat(v-p).concat(f?" preparation":""," turns remaining")}),Object(ne.c)("defs",{children:[Object(ne.b)("filter",{id:"tintBlue",children:Object(ne.b)("feColorMatrix",{type:"matrix",values:"0 0 1 0.1 0 0 0.5 0.9 0.1 0 0 0 0.7 0.8 0 0 0 0 1 0"})}),Object(ne.b)("filter",{id:"shadow",children:Object(ne.b)("feDropShadow",{dx:0,dy:.035,stdDeviation:.05,floodOpacity:.25})}),Object(ne.b)("clipPath",{id:"frame",children:Object(ne.b)("circle",{cx:0,cy:0,r:1})}),Object(ne.c)("g",{id:"hexBorderBase",clipPath:"url(#frame)",children:[Object(ne.b)("circle",{cx:0,cy:0,r:1,stroke:"white",strokeWidth:.16,fill:"none"}),Object(ne.b)("circle",{cx:0,cy:0,r:.5,fill:"white"}),Object(ne.b)("g",{children:Object(ne.b)("rect",{transform:"translate(".concat(-.04," 0)"),y:-1,width:xo,height:2,fill:"white"})}),Object(ne.b)("g",{transform:"rotate(60)",children:Object(ne.b)("rect",{transform:"translate(".concat(-.04," 0)"),y:-1,width:xo,height:2,fill:"white"})}),Object(ne.b)("g",{transform:"rotate(120)",children:Object(ne.b)("rect",{transform:"translate(".concat(-.04," 0)"),y:-1,width:xo,height:2,fill:"white"})})]}),Object(ne.b)("mask",{id:"hexBorder",children:Object(ne.b)("use",{xlinkHref:"#hexBorderBase"})}),Object(ne.c)("radialGradient",{id:"containerFg",cx:.5,cy:0,r:.8,fx:.5,fy:.2,children:[Object(ne.b)("stop",{style:{stopColor:w,stopOpacity:1},offset:"0"}),Object(ne.b)("stop",{style:{stopColor:j,stopOpacity:1},offset:"1"})]}),Object(ne.c)("radialGradient",{id:"containerBg",cx:.5,cy:1,r:1,fx:.5,fy:.8,children:[Object(ne.b)("stop",{style:{stopColor:w,stopOpacity:1},offset:"0"}),Object(ne.b)("stop",{style:{stopColor:j,stopOpacity:1},offset:"1"})]}),Object(ne.c)("linearGradient",{id:"linearGradient2171",children:[Object(ne.b)("stop",{style:{stopColor:"#fff9a9",stopOpacity:.37254903},offset:"0",id:"stop2165"}),Object(ne.b)("stop",{style:{stopColor:"#ffef96",stopOpacity:.1021999},offset:"0.5",id:"stop2167"}),Object(ne.b)("stop",{style:{stopColor:"#ffec63",stopOpacity:.00264023},offset:"0.75",id:"stop2173"}),Object(ne.b)("stop",{style:{stopColor:"#ffea30",stopOpacity:0},offset:"1",id:"stop2169"})]}),Object(ne.c)("linearGradient",{id:"linearGradient2131",children:[Object(ne.b)("stop",{style:{stopColor:"#fffded",stopOpacity:.81651807},offset:"0",id:"stop2127"}),Object(ne.b)("stop",{style:{stopColor:"#fffcdf",stopOpacity:.53720075},offset:"0.5",id:"stop2137"}),Object(ne.b)("stop",{style:{stopColor:"#ffffff",stopOpacity:0},offset:"1",id:"stop2129"})]}),Object(ne.b)("radialGradient",{href:"#linearGradient1018",id:"radialGradient1020",cx:"77.560883",cy:"67.446457",fx:"77.560883",fy:"67.446457",r:"64.468956",gradientUnits:"userSpaceOnUse",gradientTransform:"matrix(0.73371669,1.2708346,-1.0409322,0.60099607,93.712059,-58.333995)"}),Object(ne.c)("linearGradient",{id:"linearGradient1018",children:[Object(ne.b)("stop",{style:{stopColor:"#fff82e",stopOpacity:1},offset:"0",id:"stop1014"}),Object(ne.b)("stop",{style:{stopColor:"#ff8600",stopOpacity:1},offset:"1",id:"stop1016"})]}),Object(ne.b)("radialGradient",{href:"#linearGradient1820",id:"radialGradient1020-8",cx:"88.773727",cy:"63.517612",fx:"88.773727",fy:"63.517612",r:"64.468956",gradientUnits:"userSpaceOnUse",gradientTransform:"matrix(0.44201773,0.75138827,-0.74632483,0.43904328,100.8945,-1.9339557)"}),Object(ne.c)("linearGradient",{id:"linearGradient1820",children:[Object(ne.b)("stop",{style:{stopColor:"#fff4b4",stopOpacity:0},offset:"0",id:"stop1816"}),Object(ne.b)("stop",{style:{stopColor:"#f0ba5a",stopOpacity:0},offset:"0.75",id:"stop1822"}),Object(ne.b)("stop",{style:{stopColor:"#fff274",stopOpacity:.84705889},offset:"1",id:"stop1818"})]}),Object(ne.b)("radialGradient",{href:"#linearGradient2131",id:"radialGradient2133",cx:"93.525307",cy:"68.181641",fx:"93.525307",fy:"68.181641",r:"44.625431",gradientTransform:"matrix(0.98276729,0.00528918,-0.00322951,0.60285783,2.0475808,25.053584)",gradientUnits:"userSpaceOnUse"}),Object(ne.b)("radialGradient",{href:"#linearGradient2171",id:"radialGradient2133-3",cx:"93.525307",cy:"68.181641",fx:"93.525307",fy:"68.181641",r:"44.625431",gradientTransform:"matrix(0.61266046,0.00270719,-0.00201328,0.30856342,-104.25485,155.02083)",gradientUnits:"userSpaceOnUse"}),Object(ne.c)("g",{id:"sun",transform:"scale(0.017896362) translate(-92.862984 -92.967812)",filter:f?"url(#tintBlue)":void 0,children:[Object(ne.b)("g",{id:"layer3",children:Object(ne.b)("circle",{fill:"url(#radialGradient1020)",fillOpacity:"1",id:"path1012",cx:"92.862984",cy:"92.967812",r:"55.877277"})}),Object(ne.b)("g",{id:"layer6",children:Object(ne.b)("circle",{fill:"url(#radialGradient1020-8)",fillOpacity:"1",id:"path1012-2",cx:"92.862984",cy:"92.967812",r:"55.877277"})}),Object(ne.c)("g",{id:"layer7",children:[Object(ne.b)("ellipse",{fill:"url(#radialGradient2133)",fillOpacity:"1",id:"path2125",cx:"93.247475",cy:"68.206581",rx:"44.625431",ry:"29.568932"}),Object(ne.b)("ellipse",{fill:"url(#radialGradient2133-3)",fillOpacity:"1",id:"path2125-9",cx:"-47.400539",cy:"177.10806",rx:"27.819649",ry:"15.134401",transform:"matrix(0.68938617,-0.72439403,0.85105199,0.52508144,0,0)"})]})]})]}),Object(ne.c)("g",{transform:"translate(1 1.05)",children:[Object(ne.b)("circle",{cx:0,cy:0,r:1,fill:"url(#containerBg)"}),Object(ne.b)(mo.b,{data:g,keyAccessor:function(e){return e.toString()},start:function(e,t){return{remaining:Math.min(.9999,wo(p,t)/6),scale:0,x:Eo(p,t)?0:t-Math.floor(p/6)+.85}},update:k,enter:k,leave:function(){return{scale:0,timing:{duration:2e3,ease:jo}}},children:function(e){return Object(ne.b)("g",{children:e.map((function(e){var t,n=e.key,r=e.state,o=r.remaining,a=r.scale,i=r.x,c=o>=.5?1:0,s=(t=o,{x:-Math.sin(nt*t),y:-Math.cos(nt*t)}),l=s.x,u=s.y,d="mask-".concat(n);return Object(ne.c)("g",{transform:"translate(".concat(i," 0) scale(").concat(a,")"),children:[Object(ne.b)("defs",{children:Object(ne.b)("clipPath",{id:d,children:Object(ne.b)("path",{d:"M 0 -1 A 1 1 0 ".concat(c," 0 ").concat(l.toString()," ").concat(u.toString()," L 0 0 Z")})})}),Object(ne.b)("g",{clipPath:"url(#".concat(d,")"),children:Object(ne.b)("use",{href:"#sun"})})]},n)}))})}}),Object(ne.b)(mo.a,{start:{rotation:60*p},update:{rotation:[60*p],timing:{duration:2e3,ease:En}},children:function(e){var t=e.rotation;return Object(ne.b)("path",{d:"M 0 -1 A 1 1 0 0 0 -0.8660254037844386 -0.5000000000000001 L 0 0 Z",fill:y,transform:"rotate(".concat(60+t,")")})}}),Object(ne.b)("use",{xlinkHref:"#hexBorderBase",filter:"url(#shadow)"}),Object(ne.b)("g",{mask:"url(#hexBorder)",children:Object(ne.b)("circle",{cx:0,cy:0,r:1,fill:"url(#containerFg)"})}),Object(ne.b)("text",{fontSize:.6,textAnchor:"middle",dy:.2,children:v-p})]})]})}))};!function(e){e[e.HOME=0]="HOME",e[e.ROOM=1]="ROOM",e[e.GAME=2]="GAME"}(po||(po={}));var So,Co=function(e){return function(t){var n=Object(r.useState)([]),o=Object(s.a)(n,2),a=o[0],i=o[1],l=function(){i(a.slice(1))},u=Object(r.useCallback)(function(){var e=Object(je.a)(ye.a.mark((function e(t){var n;return ye.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"===typeof t?{title:"Alert",message:t}:t,e.next=3,new Promise((function(e){i(a.concat([{message:n,resolve:e}]))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[a]),d=a.map((function(e,t){var n=e.message,r=e.resolve;return Object(ne.b)(ir,{isOpen:0===t,title:n.title,onAction:r,onClose:l,children:n.message},t)}));return Object(ne.c)(ho.Provider,{value:u,children:[Object(ne.b)(e,Object(c.a)({},t)),d]})}}((So=function(){var e=Object(r.useState)(po.HOME),t=Object(s.a)(e,2),n=t[0],o=t[1];return Object(ne.c)(u.b,{children:[Object(ne.b)(ue,{setState:o,state:n}),Object(ne.b)(u.b,{sx:{width:"100vw",height:"100vh",overflow:"hidden",position:"relative"},children:Object(ne.c)(fr,{children:[Object(ne.b)(Oo,{}),Object(ne.b)(u.e,{sx:Object(c.a)({width:"100vw",bottom:0,left:"".concat(100*-(n-2),"%"),position:"absolute"},E(.3,["left"],"linear")),children:Object(ne.b)(go,{setState:o})}),Object(ne.b)(u.e,{sx:Object(c.a)({width:"100vw",height:"100vh",left:"".concat(100*-(n-1),"%"),justifyContent:"center",alignItems:"center",position:"absolute"},E(.3,["left"],"linear")),children:Object(ne.b)(dr,{setState:o})}),Object(ne.b)(u.e,{sx:Object(c.a)({width:"100vw",height:"100vh",left:"".concat(100*-n,"%"),justifyContent:"center",alignItems:"center",position:"absolute"},E(.3,["left"],"linear")),children:Object(ne.b)(Xn,{setState:o})}),Object(ne.b)(u.b,{sx:{position:"fixed",top:"60px",left:"0"},children:Object(ne.b)(ko,{})})]})})]})},function(e){var t=Object(r.useState)([]),n=Object(s.a)(t,2),o=n[0],a=n[1],i=function(){a(o.slice(1))},l=o.map((function(e,t){return Object(ne.b)(sr,{isOpen:0===t,title:e.title,onClose:i,children:e.message},t)}));return Object(ne.c)(ur.Provider,{value:function(e){var t="string"===typeof e?{title:"Alert",message:e}:e;a(o.concat([t]))},children:[Object(ne.b)(So,Object(c.a)({},e)),l]})}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/.exec(window.location.hostname));var Ro=n(34),To=n(121),Ao=Object(To.a)(["theme"]);i.a.render(Object(ne.b)(o.a.StrictMode,{children:Object(ne.c)($n.a,{theme:Z,children:[Object(ne.b)((function(){return Object(ne.b)(Ro.a,{styles:function(e){var t,n,r;return{body:Ao(null===(t=e.styles)||void 0===t?void 0:t.body),"*":Ao(null===(n=e.styles)||void 0===n?void 0:n["*"]),a:Ao(null===(r=e.styles)||void 0===r?void 0:r.a)}}})}),{}),Object(ne.b)(d.a,{children:Object(ne.b)(Co,{})})]})}),document.getElementById("root")),function(){var e=new kt.a,t=Object.values(ot);Tt=t.length,t.forEach((function(t){e.load("/photosynthesis/models/"+t+".glb",(function(e){var n=new et.ab;n.name=t,n.add.apply(n,Object(xt.a)(e.scene.children)),n.traverse((function(e){e instanceof et.P&&(e.castShadow=!0,e.receiveShadow=!0)})),St[t]=n;var r=Ct[t];void 0!==r&&(r.forEach((function(e){e.resolve(n)})),Ct[t]=void 0),++Rt===Tt&&(Object.values(Ct).filter((function(e){return Array.isArray(e)})).forEach((function(e){return null===e||void 0===e?void 0:e.forEach((function(e){var t=e.reject,n=e.modelName;return t(new Error("Model not found: "+n))}))})),Object.keys(Ct).forEach((function(e){Ct[e]=void 0})))}),void 0,(function(e){return console.error(e)}))}))}(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister().catch(console.error)})).catch((function(e){console.error(e.message)}))},97:function(e,t,n){e.exports=n(118)}},[[97,1,2]]]);
//# sourceMappingURL=main.d5e6fa8c.chunk.js.map