{"version":3,"sources":["../node_modules/peerjs/dist sync","lib/Observable.ts","lib/ConnectionTypes.ts","lib/PkgType.ts","lib/Connection.ts","lib/errors/ConnectionTimeoutError.ts","lib/fake/FakeConn.ts","lib/fake/FakeMediaConnection.ts","lib/fake/FakePeer.ts","lib/PeerFactory.ts","lib/ConnectionManager.ts","3d/helpers.ts","Game/components/TreeComponent.ts","3d/constants.ts","3d/assets.ts","Game/components/SunOrientationComponent.ts","Game/systems/TreeSystem.ts","Game/components/TweenBaseComponent.ts","Game/components/TweenObject3DComponent.ts","Game/systems/TweenSystem.ts","Game/components/TweenMaterialComponent.ts","Game/components/AxialCoordsComponent.ts","3d/Coordinates/Cartesian2D.ts","3d/Coordinates/Axial.ts","3d/Coordinates/HexCube.ts","Game/components/TileComponent.ts","Game/systems/AxialCoordsSystem.ts","Game/systems/TileSystem.ts","Game/systems/SunOrientationSystem.ts","Game/entities/tree.ts","lib/StarMeshNetwork.ts","Game/GameWorld.ts","lib/pause.ts","Game/Game.ts","lib/Room.ts","lib/RoomContext.ts","theme/colors.js","theme/transitions.js","theme/inputs/inputPadding.js","theme/inputs/baseInput.js","theme/buttons.js","theme/inputs/normal.js","theme/inputs/baseMagic.js","theme/inputs/index.js","theme/inputs/inputMagic.js","theme/menuItem.js","theme/dropdown.js","theme/text.js","theme/wells.js","theme/messages.js","theme/index.js","theme/badges.js","theme/code.js","theme/links.js","theme/styles.js","utils/componentHelpers.ts","components/common/Button.tsx","components/common/Icon.jsx","components/NavBar.tsx","components/common/BasicInput.jsx","components/common/IconButton.jsx","components/common/Input.tsx","components/common/Well.tsx","components/common/Card.tsx","components/Home.tsx","components/common/IconText.tsx","components/common/Dialog.jsx","components/common/ConfirmDialog.jsx","components/common/AlertDialog.tsx","components/common/AlertContext.tsx","components/Room.tsx","components/App.tsx","Game/GameContext.tsx","components/GameRenderer.tsx","components/GamePlayer.tsx","serviceWorker.ts","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","isMatcher","match","ConnEvent","PkgType","Observable","_onEventListeners","_onceEventListeners","event","listener","events","this","undefined","uuid","uuidv4","on","value","equals","Object","_","reduce","flag","key","once","preventClear","timeout","Promise","reject","cb","window","setTimeout","toString","clearTimeout","JSON","stringify","onceMatch","values","forEach","clearUuid","entries","push","off","Connection","conn","connectionManager","manager","dataHandler","pid","data","_t","ACK","response","ack","v","emit","CONN_DATA","CONN_PKG","type","send","CONN_ACK","enrichConn","log","peer","v4","split","promise","untilMatch","open","close","CONN_CLOSE","CONN_OPEN","error","CONN_ERROR","payload","ConnectionTimeoutError","message","FakeConn","bufferSize","dataChannel","label","metadata","peerConnection","reliable","serialization","otherEnd","hostPeer","callbacks","sent","trigger","_data","connections","filter","fn","FakeMediaConnection","f","stream","options","FakePeer","destroyed","disconnected","prototype","allPeers","fakeConn","fakeConn2","ap","peerId","connectionId","find","callback","PeerFactory","peers","useFake","make","r","shift","process","REACT_APP_PEER_HOST","Peer","host","port","Number","parseInt","REACT_APP_PEER_PORT","path","REACT_APP_PEER_PATH","ConnectionManager","closed","onPeerOpenHandler","PEER_OPEN","onPeerConnectionHandler","connection","PEER_CONNECT","initPeer","prefixId","startAs","PEER_ERROR","existing","id1","id2","connect","openHandler","all","map","a","pkgType","sendPkg","c","PEER_CLOSE","PEER_DISCONNECT","rest","then","toLog","destroy","disconnectAll","disposeObj3D","obj3d","traverse","obj","Mesh","geometry","material","dispose","disposeMaterial","prop","Texture","Array","isArray","TreeComponent","color","growthStage","seedObj","treeObj","topObj","trunkObj","shadeObj","shadeEntity","Component","schema","Types","Ref","default","Color","GrowthStage","MODELS","BLUE_TOP","ORANGE_TOP","YELLOW_TOP","GREEN_TOP","TRUNK","SHADE","ACORN","PINE_CONE","MAPLE_SEED","BASSWOOD_SEED","RING","LANDSCAPE","TREE_MODELS","BLUE","ORANGE","YELLOW","GREEN","SEED_MODELS","SHADE_Y","TREE_GROWTH_PROPS","SEED","tree","scale","seed","SHORT","MID","TALL","objects","objectWaitOrders","loadedCount","totalCount","getObject","modelName","queue","modelNotFoundMessage","SunOrientationComponent","TreeSystem","delta","time","queries","trees","added","entity","treeComp","getMutableComponent","getObject3D","name","objectsToFetch","objs","o","clone","Object3D","add","position","y","world","createEntity","addComponent","Object3DComponent","plantContainerObj","rotation","Math","random","PI","updateGrowthStage","catch","console","changed","bind","results","getComponent","lengthSq","visible","removed","remove","set","ECSYThreeSystem","components","listen","TweenBaseComponent","loop","duration","TweenObject3DComponent","from","to","func","String","TweenSystem","object3DTweens","objComp","tweenComp","tweenObj3DComp","object3D","oldValue","min","result","fromArray","toArray","removeComponent","TweenMaterialComponent","AxialCoordsComponent","Cartesian2D","x","join","coords","n","t","sqrt","coord","euclideanDistance","origin","norm","normalize","s","i","neighbors","Axial","q","HexCube","size","axial","abs","toHexCube","range","toAxial","z","hexCube","max","TileComponent","AxialCoordsSystem","axialPositions","axialCoordsComp","obj3dComp","toCartesian","TileSystem","tiles","SunOrientationSystem","attributes","gameWorld","sunFacingObjs","sunOrientationRad","StarMeshNetworkEvents","GameWorld","gui","renderer","sceneEntity","camera","messages","started","dat","GUI","WebGLRenderer","ECSYThreeWorld","addEventListener","init","resetGUI","stop","initialize","initRenderer","initECS","initScene","play","sunControl","step","registerComponent","registerSystem","shadowMap","enabled","VSMShadowMap","setClearColor","outputEncoding","sRGBEncoding","fov","cameraTiltObj","cameraPivotObj","cameraFolder","addFolder","addObject3DComponent","ambientLight","AmbientLight","sun","DirectionalLight","sin","castShadow","shadow","bias","radius","near","far","top","bottom","left","right","mapSize","sunContainer","Group","sky","commonLights","floorObj","generateGrid","createTree","boardObj","boardEntity","ringObj","target","pause","GameEvent","GameActions","isMemberChangePayload","d","members","p","StarMeshNetwork","myConnectionManager","initialState","reducer","hostConnectionManager","meToHostConnection","state","networkName","hostId","networkErrorHandler","NETWORK_ERROR","sendToHost","initMyConnectionManagerListeners","onPkg","MEMBER_CHANGE","handleMemberChange","SET_STATE","STATE_CHANGE","DISPATCH","dispatchHandler","startPrefix","hostConnection","oldHost","broadcastPkg","cloneDeep","length","connectPrefix","isClosed","HOST_CHANGE","includes","oldList","newList","memberJoining","memberLeaving","disconnect","MEMBERS_CHANGE","MEMBERS_JOIN","MEMBERS_LEFT","setReducer","dispatch","action","dispatchLocal","newState","setState","stateStaging","leave","RoomActionTypes","RoomEvents","Game","room","network","GAME_EVENT","errorHandler","prevState","connId","pi","CLICK","board","turn","endGame","UPDATE_GAME_STATE","game","myId","me","GAME_OVER","CH","globalRoom","create","myName","roomCode","floor","joinOrHost","JOIN","leaveRoom","joinOrCreate","ERROR","rename","RENAME","SET_HOST","startGame","idDict","nameDict","players","k","START_GAME","END_GAME","networkReducer","setName","SET_PLAYERS","maxPlayers","LEAVE","playerIds","minPlayers","typed","start","gameOver","trace","RoomContext","createContext","useRoom","useContext","makeFade","transparentize","vibrantColors","blue","red","green","yellow","gray","dullColors","paleColors","baseColors","vibrantHighlights","mapObjIndexed","dark","light","white","colors","primary","accent","inputFocus","fgHighlights","bgHighlights","text","muted","background","bgs","fgs","fgPales","border","highlight","backgroundColor","prolog","comment","keyword","number","constant","variable","string","selector","tag","operator","punctuation","function","className","char","transition","props","ease","shortTransition","inputPadding","px","py","baseInput","borderRadius","borderColor","boxShadow","theme","lineHeight","fontFamily","fontWeight","fontSize","baseButton","display","alignItems","textAlign","outline","pillButton","smButton","mdButton","buttonStyles","buttonColors","normal","fg","bg","hoverBg","success","warning","danger","active","transparent","buttons","styleName","colorName","fill","fakePlaceholder","pt","pointerEvents","ml","fakePlaceholderPull","baseMagic","inputMagic","overflow","zIndex","pageHeadingSizes","pageHeadingIconSizes","fontSizes","heading","mb","subheading","textTransform","letterSpacing","pageHeading","svg","width","height","largeHeading","columnHeading","columnCardHeading","helperText","baseWell","my","borderWidth","borderStyle","dashed","baseMessage","messageStyle","fillColor","info","useColorSchemeMediaQuery","modes","breakpoints","space","fonts","body","monospace","fontWeights","bold","lineHeights","input","radii","shadows","layout","container","maxWidth","sidebar","inputs","badges","tabSize","MozTabSize","content","borderTopWidth","borderTopStyle","borderTopColor","menuItem","links","plain","dropdown","wells","styles","root","boxSizing","margin","h1","h2","h3","h4","h5","h6","textDecoration","pre","overflowX","table","borderCollapse","borderSpacing","th","borderBottomStyle","td","img","hr","borderTop","borderBottom","isDefined","buttonProps","block","PropTypes","bool","Button","forwardRef","ref","variant","sx","justifyContent","propTypes","defaultProps","displayName","Icon","sizes","NavBar","isRequired","useColorMode","colorMode","setColorMode","mr","flex","onClick","title","mdiCircleSlice4","BasicInput","as","__themeKey","IconButton","visibility","hidden","iconSx","Input","object","onClearClick","mt","fullwidth","placeholder","disabled","transform","mdiClose","Well","Card","Home","useState","exec","location","pathname","replace","setRoomCode","setError","setMessage","loading","setLoading","flexDirection","onChange","toUpperCase","AppState","ROOM","finally","GAME","IconText","node","any","children","reverse","otherProps","reverse_","fillOpacity","Dialog","useThemeUI","ariaHideApp","isOpen","onRequestClose","isStatic","onClose","contentLabel","style","overlay","padding","overflowY","minWidth","opacity","ConfirmDialog","onAction","run","setIsOpen","pb","hideNoChoice","noText","yesText","AlertDialog","AlertContext","alert","Room","setPlayers","setHost","useEffect","mdiCrown","mdiAccount","HOME","GameContext","GameContextProvider","gameState","setGameState","setGameOver","Provider","GameRenderer","instanceOf","useRef","divElem","current","childNodes","child","removeChild","appendChild","domElement","getSystem","WebGLRendererSystem","onResize","canvas","GamePlayer","b","click","WrappedComponent","withAlertQueue","_setState","history","pushState","pageTitle","setQueue","popAlert","slice","alertNodes","concat","Boolean","hostname","MyGlobal","ReactDOM","render","StrictMode","document","getElementById","loader","GLTFLoader","modelNames","load","MODELS_LOCATION","gltf","receiveShadow","scene","waitOrders","order","orders","startLoad","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.849c4458.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 74;","import { v4 as uuidv4 } from 'uuid'\nimport { equals } from 'ramda'\n\nconst TIMEOUT_DURATION = 5000\n\ninterface PayloadEssential {\n  toString: () => string\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\ntype Payload = Exclude<PayloadEssential, Function>\n\ntype Listener<P extends Payload> = (payload: P, preventClear?: () => void) => void\ntype Matcher<P extends Payload> = (payload: P) => boolean\n\nfunction isMatcher<P extends Payload> (match: P | Matcher<P> | { _: Partial<P> }): match is Matcher<P> {\n  return typeof match === 'function'\n}\n\n/**\n * @template E `typeof MyEnum` or a general `Record` with event names as keys paired with unique values\n * @template P type of payload\n */\nexport class Observable<E extends Record<string, string | number> = never, P extends Payload = never> {\n  private _onEventListeners: { [k in E[keyof E]]?: Record<string, Listener<P>> } = {}\n  private _onceEventListeners: { [k in E[keyof E]]?: Record<string, Listener<P>> } = {}\n\n  public on (event: E[keyof E], listener: Listener<P>): string {\n    let events = this._onEventListeners[event]\n    if (events === undefined) {\n      events = this._onEventListeners[event] = {}\n    }\n    const uuid = uuidv4()\n    events[uuid] = listener\n    return uuid\n  }\n\n  /**\n   * Given event, if the value going to feed to listener is equal to the params, call the listener\n   * @param event A value of E\n   * @param listener\n   * @param match\n   */\n  public onMatch (event: E[keyof E], listener: Listener<P>, match: P | Matcher<P> | { _: Partial<P> }): string {\n    return this.on(event, (value: P) => {\n      if (isMatcher(match)) {\n        if (match(value)) {\n          listener(value)\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      } else if (equals(match, value) as unknown as boolean) {\n        listener(value)\n      } else if (\n        typeof match === 'object' &&\n        match !== null &&\n        '_' in match &&\n        Object.keys(match._)\n          .reduce(\n            (flag: boolean, key) => (\n              flag && equals(\n                (match._ as Record<string, unknown>)[key],\n                (value as Record<string, unknown>)[key])\n            ),\n            true\n          )\n      ) {\n        listener(value)\n      }\n    })\n  }\n\n  public once (event: E[keyof E], listener: Listener<P>): string {\n    let events = this._onceEventListeners[event]\n    if (events === undefined) {\n      events = this._onceEventListeners[event] = {}\n    }\n    const uuid = uuidv4()\n    events[uuid] = listener\n    return uuid\n  }\n\n  /**\n   *\n   * @param event\n   * @param listener\n   * @param match\n   */\n  public onceMatch (event: E[keyof E], listener: Listener<P>, match: P | Matcher<P> | { _: Partial<P> }): string {\n    return this.once(event, (value: P, preventClear?: () => void) => {\n      if (isMatcher(match)) {\n        if (match(value)) {\n          listener(value, preventClear)\n        } else {\n          preventClear?.()\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      } else if (equals(match, value) as unknown as boolean) {\n        listener(value, preventClear)\n      } else if (\n        typeof match === 'object' &&\n        match !== null &&\n        '_' in match &&\n        Object.keys(match._)\n          .reduce(\n            (flag: boolean, key) => (\n              flag && equals(\n                (match._ as Record<string, unknown>)[key],\n                (value as Record<string, unknown>)[key])\n            ),\n            true\n          )\n      ) {\n        listener(value, preventClear)\n      } else {\n        preventClear?.()\n      }\n    })\n  }\n\n  public async until (event: E[keyof E], timeout = TIMEOUT_DURATION, _message?: unknown): Promise<P> {\n    return await new Promise((resolve, reject) => {\n      const cb = window.setTimeout(() => {\n        reject(new Error(event.toString() + ' timeout'))\n      }, timeout)\n      this.once(event, (value) => {\n        window.clearTimeout(cb)\n        resolve(value)\n      })\n    })\n  }\n\n  public async untilMatch (event: E[keyof E], value: P | Matcher<P> | { _: Partial<P> }, timeout = TIMEOUT_DURATION, _message?: unknown): Promise<P> {\n    if (value === undefined) throw new Error('expect undefined')\n    return await new Promise((resolve, reject) => {\n      const cb = window.setTimeout(() => {\n        reject(new Error(`${event} ${JSON.stringify(value)} timeout`))\n      }, timeout)\n      this.onceMatch(event, (value) => {\n        window.clearTimeout(cb)\n        resolve(value)\n      }, value)\n    })\n  }\n\n  public off (event: E[keyof E], uuid: string): void {\n    delete this._onEventListeners?.[event]?.[uuid]\n    delete this._onceEventListeners?.[event]?.[uuid]\n  }\n\n  public emit (event: E[keyof E], value: P): void {\n    Object.values(this._onEventListeners?.[event] ?? {})?.forEach((listener) => {\n      listener(value)\n    })\n    const clearUuid: string[] = []\n    Object.entries(this._onceEventListeners?.[event] ?? {})?.forEach(([uuid, listener]) => {\n      let preventClear = false\n      listener(value, () => {\n        preventClear = true\n      })\n      if (!preventClear) {\n        clearUuid.push(uuid)\n      }\n    })\n    clearUuid.forEach((uuid) => {\n      this.off(event, uuid)\n    })\n    // if (event !== '*') {\n    //   this.emit('*', event, ...params)\n    // }\n  }\n}\n","import { Connection } from './Connection'\nimport { PkgType } from './PkgType'\n\nexport enum ConnEvent {\n  ANY = '*',\n  PEER_OPEN = '_open',\n  PEER_CLOSE = '_close',\n  PEER_CONNECT = '_connect',\n  PEER_DISCONNECT = '_disconnect',\n  PEER_ERROR = '_error',\n  CONN_OPEN = 'open',\n  CONN_CLOSE = 'close',\n  CONN_DATA = 'data',\n  CONN_ERROR = 'error',\n  CONN_ACK = 'ack',\n  CONN_PKG = 'pkg'\n}\n\nexport interface ConnectionError {\n  name: string\n  message: string\n  stack?: string\n  type?: string\n}\n\nexport interface Package { _t: PkgType, data: unknown }\nexport type PayloadData = [string, Package]\n\nexport interface ConnectionListenerPayload {\n  conn?: Connection\n  data?: unknown\n  error?: ConnectionError\n  pid?: string\n  type?: PkgType\n  ack?: (ackVal: unknown) => void\n}\nexport type ConnectionListener = (payload: ConnectionListenerPayload) => void\n","export enum PkgType {\n  ALERT = 'alert',\n  XD = 'xd',\n  JOIN = 0,\n  MEMBER_CHANGE,\n  NEW_JOIN,\n  ACK,\n  PLAYER_LEFT,\n  CHANGE_HOST,\n  RENAME,\n  START_GAME,\n  GAME_EVENT,\n  UPDATE_GAME_STATE,\n  DISPATCH,\n  SET_STATE,\n}\n","import { DataConnection } from 'peerjs'\nimport { v4 } from 'uuid'\nimport { ConnectionListenerPayload, ConnEvent, Package, PayloadData } from './ConnectionTypes'\nimport { ConnectionManager } from './ConnectionManager'\nimport { Observable } from './Observable'\nimport { PkgType } from './PkgType'\n\nexport class Connection extends Observable<typeof ConnEvent, ConnectionListenerPayload> {\n  protected conn?: DataConnection // undefined if it is connecting to itself\n  protected manager: ConnectionManager\n\n  protected log (...params: unknown[]): void {\n    this.manager.log(...params)\n  }\n\n  public get id (): string {\n    if (this.conn !== undefined) {\n      return this.conn.peer\n    } else {\n      return this.manager.id\n    }\n  }\n\n  constructor (conn: DataConnection | 'self', connectionManager: ConnectionManager) {\n    super()\n    if (conn !== 'self') {\n      this.conn = conn\n      this.enrichConn(conn)\n    }\n    this.manager = connectionManager\n  }\n\n  public async send (data: Package): Promise<ConnectionListenerPayload> {\n    const pid = v4().split('-')[0]\n    const promise = this.manager.untilMatch(\n      ConnEvent.CONN_ACK,\n      ({ pid: p }: ConnectionListenerPayload) => p === pid)\n    if (this.conn !== undefined) {\n      if (this.conn.open) {\n        this.conn.send([pid, data])\n      } else {\n        this.conn.on('open', () => {\n          this.conn?.send([pid, data])\n        })\n      }\n    } else {\n      this.dataHandler()([pid, data])\n    }\n    return await promise\n  }\n\n  public async sendPkg (type: PkgType, data: unknown): Promise<ConnectionListenerPayload> {\n    return await this.send({\n      data,\n      _t: type\n    })\n  }\n\n  public close (): void {\n    this.conn?.close()\n    this.emit(ConnEvent.CONN_CLOSE, { conn: this })\n  }\n\n  private readonly dataHandler = (conn?: DataConnection) => ([pid, data]: PayloadData) => {\n    if (data !== undefined && data._t !== PkgType.ACK) {\n      let response: unknown\n      const ack = (v: unknown): void => {\n        response = v\n      }\n      this.emit(ConnEvent.CONN_DATA, { conn: this, data, ack })\n      if (typeof data === 'object' && data._t !== undefined) {\n        this.emit(ConnEvent.CONN_PKG, { conn: this, data: data.data, type: data._t, ack })\n      }\n      if (conn !== undefined) {\n        if (response === undefined) {\n          conn.send([pid, { _t: PkgType.ACK, data: response }])\n        } else {\n          conn.send([pid, { _t: PkgType.ACK, data: response }])\n        }\n      } else {\n        if (response === undefined) {\n          this.dataHandler()([pid, { _t: PkgType.ACK, data: undefined }])\n        } else {\n          this.dataHandler()([pid, { _t: PkgType.ACK, data: response }])\n        }\n      }\n    } else {\n      if (typeof data === 'object' && data !== null && data._t !== undefined) {\n        this.emit(ConnEvent.CONN_ACK, { conn: this, data: data.data, type: data._t, pid })\n      } else {\n        this.emit(ConnEvent.CONN_ACK, { conn: this, data, pid })\n      }\n    }\n  }\n\n  private enrichConn (conn: DataConnection): DataConnection {\n    conn.on('open', () => {\n      this.emit(ConnEvent.CONN_OPEN, { conn: this })\n    })\n    conn.on('data', this.dataHandler(conn))\n    conn.on('error', (error: Error) => {\n      this.emit(ConnEvent.CONN_ERROR, { conn: this, error })\n    })\n    conn.on('close', () => {\n      this.emit(ConnEvent.CONN_CLOSE, { conn: this })\n    })\n    return conn\n  }\n\n  public emit (event: ConnEvent, payload: ConnectionListenerPayload): void {\n    super.emit(event, payload)\n    this.manager.emit(event, payload)\n  }\n}\n","export class ConnectionTimeoutError extends Error {\n  type = 'connection timeout'\n\n  constructor (id: string) {\n    super()\n    this.message = 'connection timeout to peer ' + id\n  }\n}\n","import { DataConnection } from 'peerjs'\nimport { FakePeer } from './FakePeer'\n\nexport class FakeConn implements DataConnection {\n  bufferSize!: number\n  dataChannel!: RTCDataChannel\n  label = 'my label'\n  metadata: unknown\n  open = false\n  peer = 'peer'\n  peerConnection!: RTCPeerConnection\n  reliable = true\n  serialization = 'binary'\n  type = 'data'\n  otherEnd?: FakeConn\n  hostPeer?: FakePeer\n\n  constructor () {\n    window.setTimeout(() => {\n      this.open = true\n      this.trigger('open')\n    }, 1)\n  }\n\n  parse (): void {\n    throw new Error('not implemented')\n  }\n\n  stringify (_data: Record<string, unknown> | number | string | unknown[]): string {\n    throw new Error('not implemented')\n  }\n\n  close (): void {\n    if (this.open) {\n      this.open = false\n      if (this.hostPeer !== undefined) {\n        this.hostPeer.connections = this.hostPeer?.connections.filter(conn => conn !== this)\n      }\n      if (this.otherEnd !== undefined) {\n        this.otherEnd.open = false\n        if (this.otherEnd.hostPeer !== undefined) {\n          this.otherEnd.hostPeer.connections = this.otherEnd.hostPeer?.connections.filter(conn => conn !== this.otherEnd)\n        }\n      }\n      window.setTimeout(() => {\n        this.otherEnd?.trigger('close')\n        this.trigger('close')\n      }, 1)\n    }\n  }\n\n  off (event: string, fn: () => void, once?: boolean): void {\n    throw new Error('not implemented')\n  }\n\n  public callbacks: Record<string | 'data' | 'open' | 'close' | 'error', Array<(d?: unknown) => void>> = {}\n\n  public on (event: string, cb: () => void): void\n  public on (event: 'data', cb: (data: unknown) => void): void\n  public on (event: 'open', cb: () => void): void\n  public on (event: 'close', cb: () => void): void\n  public on (event: 'error', cb: (err: unknown) => void): void\n  public on (event: string | 'data' | 'open' | 'close' | 'error', cb: (() => void) | ((data: unknown) => void)): void {\n    if (!(event in this.callbacks)) {\n      this.callbacks[event] = []\n    }\n    this.callbacks[event].push(cb)\n  }\n\n  public trigger (event: string | 'data' | 'open' | 'close' | 'error', data?: unknown): void {\n    this.callbacks[event]?.forEach(cb => {\n      cb(data)\n    })\n  }\n\n  public sent: unknown[] = []\n\n  send (data: unknown): void {\n    if (!this.open) {\n      throw new Error('Send data before opening')\n    }\n    this.sent.push(data)\n    // eslint-disable-next-line no-void\n    void Promise.resolve(\n      this.otherEnd?.trigger('data', data)\n    )\n  }\n}\n","import Peer, { MediaConnection } from 'peerjs'\n\nexport class FakeMediaConnection implements MediaConnection {\n  bufferSize: unknown\n  dataChannel: unknown\n  label = 'my label'\n  metadata: unknown\n  open = true\n  peer = 'peer'\n  peerConnection!: RTCPeerConnection\n  reliable = true\n  serialization = 'binary'\n  type = 'data'\n\n  parse (): void {\n    throw new Error('not implemented')\n  }\n\n  stringify (data: Record<string, unknown> | string | number | unknown[]): string {\n    return ''\n  }\n\n  close (): void {\n    this.open = false\n  }\n\n  off (event: string, fn: () => void, once?: boolean): void {\n    this.callbacks[event] = this.callbacks[event].filter(f => f !== fn)\n  }\n\n  public callbacks: Record<string | 'data' | 'open' | 'close' | 'error', Array<(d?: unknown) => void>> = {}\n\n  // on (event: string, cb: () => void): void\n  // on (event: 'data', cb: (data: any) => void): void\n  // on (event: 'open', cb: () => void): void\n  // on (event: 'close', cb: () => void): void\n  // on (event: 'error', cb: (err: any) => void): void\n  // on (event: string | 'data' | 'open' | 'close' | 'error', cb: (() => void) | ((data: any) => void)): void {\n  //   if (!(event in this.callbacks)) {\n  //     this.callbacks[event] = []\n  //   }\n  //   this.callbacks[event].push(cb)\n  // }\n\n  public trigger (event: string | 'data' | 'open' | 'close' | 'error', data: unknown | undefined): void {\n    this.callbacks[event]?.forEach(cb => cb(data))\n  }\n\n  public sent: unknown[] = []\n\n  send (data: unknown): void {\n    this.sent.push(data)\n  }\n\n  answer (stream?: MediaStream, options?: Peer.AnswerOption): void {\n    throw new Error('not implemented')\n  }\n\n  on (event: string, cb: () => void): void\n  on (event: 'stream', cb: (stream: MediaStream) => void): void\n  on (event: 'close', cb: () => void): void\n  on (event: 'error', cb: (err: unknown) => void): void\n  on (event: string | 'stream' | 'close' | 'error', cb: (() => void) | ((stream: MediaStream) => void) | ((err: unknown) => void)): void {\n    if (!(event in this.callbacks)) {\n      this.callbacks[event] = []\n    }\n    this.callbacks[event].push(cb as (d: unknown) => void)\n  }\n}\n","import Peer from 'peerjs'\nimport { FakeConn } from './FakeConn'\nimport { FakeMediaConnection } from './FakeMediaConnection'\nimport { v4 as uuidv4 } from 'uuid'\n\nexport class FakePeer implements Peer {\n  static allPeers: Record<string, FakePeer> = {}\n  connections: FakeConn[] = []\n  destroyed = false\n  disconnected = false\n  id = 'some id'\n  prototype!: RTCIceServer\n\n  constructor (id?: string, options?: unknown) {\n    this.id = id ?? uuidv4()\n    if (this.id in FakePeer.allPeers) {\n      throw new Error(`Peer '${this.id}' already exist`)\n    }\n    FakePeer.allPeers[this.id] = this\n    window.setTimeout(() => {\n      this.trigger('open', this.id)\n    }, 1)\n  }\n\n  call (id: string, stream: MediaStream, options?: Peer.CallOption): Peer.MediaConnection {\n    return new FakeMediaConnection()\n  }\n\n  connect (id: string, options?: Peer.PeerConnectOption): Peer.DataConnection {\n    if (FakePeer.allPeers[id] === undefined) {\n      throw new Error()\n    }\n    const peer: FakePeer = FakePeer.allPeers[id]\n    const fakeConn = new FakeConn()\n    const fakeConn2 = new FakeConn()\n    this.connections.push(fakeConn)\n    peer.connections.push(fakeConn2)\n    fakeConn.peer = id\n    fakeConn2.peer = this.id\n    fakeConn.otherEnd = fakeConn2\n    fakeConn2.otherEnd = fakeConn\n    fakeConn.hostPeer = this\n    fakeConn2.hostPeer = peer\n    peer.trigger('connection', fakeConn2)\n    return fakeConn\n  }\n\n  destroy (): void {\n    this.destroyed = true\n    this.connections.forEach(conn => {\n      conn.close()\n    })\n    const { [this.id]: t, ...ap } = FakePeer.allPeers\n    FakePeer.allPeers = ap\n  }\n\n  disconnect (): void {\n    this.disconnected = true\n    const { [this.id]: t, ...ap } = FakePeer.allPeers\n    FakePeer.allPeers = ap\n  }\n\n  getConnection (peerId: string, connectionId: string): Peer.MediaConnection | Peer.DataConnection | null {\n    return this.connections.find(({ peer }) => peer === peerId) ?? null\n  }\n\n  listAllPeers (callback: (peerIds: string[]) => void): void {\n    throw new Error('not implemented')\n  }\n\n  off (event: string, fn: () => void, once?: boolean): void {\n    throw new Error('not implemented')\n  }\n\n  public callbacks: Record<string | 'data' | 'open' | 'close' | 'error', Array<(d?: unknown) => void>> = {}\n\n  on (event: string, cb: () => void): void\n  on (event: 'open', cb: (id: string) => void): void\n  on (event: 'connection', cb: (dataConnection: Peer.DataConnection) => void): void\n  on (event: 'call', cb: (mediaConnection: Peer.MediaConnection) => void): void\n  on (event: 'close', cb: () => void): void\n  on (event: 'disconnected', cb: () => void): void\n  on (event: 'error', cb: (err: unknown) => void): void\n  on (event: string | 'open' | 'connection' | 'call' | 'close' | 'disconnected' | 'error', cb: (() => void) | ((id: string) => void) | ((dataConnection: Peer.DataConnection) => void) | ((mediaConnection: Peer.MediaConnection) => void) | ((err: unknown) => void)): void {\n    if (!(event in this.callbacks)) {\n      this.callbacks[event] = []\n    }\n    this.callbacks[event].push(cb as (d?: unknown) => void)\n  }\n\n  public trigger (event: string | 'data' | 'open' | 'close' | 'error', data: unknown): void {\n    this.callbacks[event]?.forEach(cb => {\n      cb(data)\n    })\n  }\n\n  reconnect (): void {\n    throw new Error('not implemented')\n  }\n}\n","import Peer from 'peerjs'\nimport { FakePeer } from './fake/FakePeer'\n\nexport const PeerFactory: { peers: Peer[], useFake: boolean, make: (id?: string) => Peer | FakePeer } = {\n  peers: [],\n  useFake: false,\n  make (id?: string): Peer {\n    const r = PeerFactory.peers.shift()\n    if (r !== undefined) {\n      return r\n    } else if (!PeerFactory.useFake) {\n      if (process.env.REACT_APP_PEER_HOST === undefined) {\n        return new Peer(id)\n      } else {\n        return new Peer(id, {\n          host: process.env.REACT_APP_PEER_HOST ?? 'localhost',\n          port: Number.parseInt(process.env.REACT_APP_PEER_PORT ?? '9000'),\n          path: process.env.REACT_APP_PEER_PATH ?? '/peer'\n        })\n      }\n    } else {\n      return new FakePeer(id)\n    }\n  }\n}\n","import Peer, { DataConnection } from 'peerjs'\nimport { Observable } from './Observable'\nimport { ConnectionListener, ConnectionListenerPayload, ConnEvent, Package } from './ConnectionTypes'\nimport { Connection } from './Connection'\nimport { PkgType } from './PkgType'\nimport { ConnectionTimeoutError } from './errors/ConnectionTimeoutError'\nimport { PeerFactory } from './PeerFactory'\n\nexport class ConnectionManager extends Observable<typeof ConnEvent, ConnectionListenerPayload> {\n  public id: string\n  protected peer: Peer\n  public connections: Connection[] = []\n  protected closed = false\n\n  public isClosed (): boolean {\n    return this.closed || this.peer.disconnected\n  }\n\n  public log = (..._params: unknown[]): void => {\n    // console.log(this.id, ..._params)\n  }\n\n  public static prefixId (id = ''): string {\n    return 'creamy9tale000000' + id\n  }\n\n  public static withPrefix (id = ''): ConnectionManager {\n    return new ConnectionManager(ConnectionManager.prefixId(id))\n  }\n\n  public static async startPrefix (id = ''): Promise<ConnectionManager> {\n    return await ConnectionManager.startAs(ConnectionManager.prefixId(id))\n  }\n\n  public static async startAs (id?: string): Promise<ConnectionManager> {\n    return await new Promise<ConnectionManager>((resolve, reject) => {\n      const manager = new ConnectionManager(id)\n      manager.once(ConnEvent.PEER_OPEN, () => {\n        resolve(manager)\n      })\n      manager.once(ConnEvent.PEER_ERROR, (payload) => {\n        reject(payload.error)\n      })\n    })\n  }\n\n  constructor (id?: string) {\n    super()\n    this.peer = this.initPeer(id)\n    this.id = this.peer.id\n    this.on(ConnEvent.CONN_CLOSE, ({ conn }) => {\n      if (conn !== undefined) {\n        this.connections = this.connections.filter(({ id }) => id !== conn.id)\n      }\n    })\n  }\n\n  public async connect (id: string, timeout = 5000): Promise<Connection> {\n    const existing = this.connections.find(({ id: _id }) => _id === id)\n    if (existing !== undefined) return Promise.resolve(existing)\n    if (id === this.id) {\n      return this.enrichConn(new Connection('self', this))\n    }\n    return await new Promise((resolve, reject) => {\n      const id1 = setTimeout(() => {\n        reject(new ConnectionTimeoutError(id))\n      }, timeout)\n      const id2 = this.once(ConnEvent.PEER_ERROR, ({ error }: ConnectionListenerPayload) => {\n        reject(error)\n      })\n      const conn = this.peer.connect(id)\n      const openHandler = (): void => {\n        const connection: Connection = this.enrichConn(new Connection(conn, this))\n        this.off(ConnEvent.CONN_ERROR, id2)\n        resolve(connection)\n        clearTimeout(id1)\n      }\n      conn.on('open', () => {\n        openHandler()\n      })\n      if (conn.open) {\n        openHandler()\n      }\n    })\n  }\n\n  public async connectPrefix (id: string): Promise<Connection> {\n    return await this.connect(ConnectionManager.prefixId(id))\n  }\n\n  public async broadcast (data: Package): Promise<unknown> {\n    return await Promise.all(this.connections.map(async conn => {\n      return await conn.send(data)\n    }))\n  }\n\n  public async broadcastPkg (pkgType: PkgType, data: unknown): Promise<ConnectionListenerPayload[]> {\n    return await Promise.all(this.connections.map(async conn => {\n      return await conn.sendPkg(pkgType, data)\n    }))\n  }\n\n  public conn (id: string): Connection {\n    const find = this.connections.find(c => c.id === id)\n    if (find === undefined) {\n      throw new Error(`connection lost with ${id}`)\n    }\n    return find\n  }\n\n  public async send (id: string, data: Package): Promise<ConnectionListenerPayload> {\n    return await this.conn(id).send(data)\n  }\n\n  public async sendPkg (id: string, pkgType: PkgType, data: unknown): Promise<ConnectionListenerPayload> {\n    return await this.conn(id).sendPkg(pkgType, data)\n  }\n\n  private initPeer (id?: string): Peer {\n    const peer = PeerFactory.make(id)\n    peer.on('open', this.onPeerOpenHandler(peer))\n    peer.on('error', (error: Error) => {\n      this.emit(ConnEvent.PEER_ERROR, { error })\n    })\n    peer.on('close', () => {\n      this.emit(ConnEvent.PEER_CLOSE, {})\n    })\n    peer.on('disconnected', () => {\n      this.emit(ConnEvent.PEER_DISCONNECT, {})\n    })\n\n    return peer\n  }\n\n  private readonly onPeerOpenHandler = (peer: Peer) => (id: string): void => {\n    this.id = id\n    this.emit(ConnEvent.PEER_OPEN, {})\n    peer.on('connection', this.onPeerConnectionHandler)\n  }\n\n  private readonly onPeerConnectionHandler = (conn: DataConnection): void => {\n    this.log('connect', conn.peer)\n    const connection = this.enrichConn(new Connection(conn, this))\n    connection.once(ConnEvent.CONN_OPEN, () => {\n      this.emit(ConnEvent.PEER_CONNECT, { conn: connection })\n    })\n  }\n\n  public onPkg (pkgType: PkgType, listener: ConnectionListener): string {\n    return super.onMatch(ConnEvent.CONN_PKG, ({ data, ...rest }: ConnectionListenerPayload) => {\n      listener({ ...rest, data: data, type: pkgType })\n    }, { _: { type: pkgType } })\n  }\n\n  public oncePkg (pkgType: PkgType, listener: ConnectionListener): string {\n    return super.onceMatch(ConnEvent.CONN_PKG, ({ data, ...rest }: ConnectionListenerPayload) => {\n      listener({ ...rest, data: data, type: pkgType })\n    }, { _: { type: pkgType } })\n  }\n\n  public async untilPkg (pkgType: PkgType, timeout?: number): Promise<ConnectionListenerPayload> {\n    if (pkgType === undefined) throw new Error('trying to subscribe undefined pkgType')\n    return await super.untilMatch(ConnEvent.CONN_PKG, { _: { type: pkgType } }, timeout, pkgType)\n      .then(({ data, ...rest }: ConnectionListenerPayload) => {\n        return { ...rest, data: data, type: pkgType }\n      })\n  }\n\n  public on (event: ConnEvent, listener: ConnectionListener): string {\n    return super.on(event, listener)\n  }\n\n  public once (event: ConnEvent, listener: ConnectionListener): string {\n    return super.once(event, listener)\n  }\n\n  public emit (event: ConnEvent, payload: ConnectionListenerPayload): void {\n    const { conn, ...toLog } = payload\n    this.log('emit', event, { ...toLog, ...(conn !== undefined ? { conn: { id: conn?.id } } : {}) })\n    super.emit(event, payload)\n  }\n\n  private enrichConn (connection: Connection): Connection {\n    this.connections.push(connection)\n    return connection\n  }\n\n  public disconnect (id: string): void {\n    this.connections.find(c => c.id === id)?.close()\n  }\n\n  public disconnectAll (): void {\n    this.connections.map(conn => conn.close())\n  }\n\n  public destroy (): void {\n    this.closed = true\n    this.peer.destroy()\n    this.disconnectAll()\n  }\n\n  public close (): void {\n    this.closed = true\n    this.peer.destroy()\n    this.disconnectAll()\n  }\n}\n","import { Geometry, Material, Mesh, Object3D, Texture } from 'three'\nimport { BufferGeometry } from 'three/src/core/BufferGeometry'\n\nexport const disposeObj3D = (obj3d?: Object3D | null): void => {\n  obj3d?.traverse((obj) => {\n    if (obj instanceof Mesh) {\n      const geometry = obj.geometry as Geometry | BufferGeometry | undefined\n      const material = obj.material as Material | Material[] | undefined\n\n      if (geometry !== undefined) {\n        geometry.dispose()\n      }\n\n      const disposeMaterial = (material: Material): void => {\n        Object.keys(material).forEach((key) => {\n          const prop = material[key as keyof Material] as unknown\n          if (prop instanceof Texture) {\n            prop.dispose()\n          }\n        })\n        material.dispose()\n      }\n\n      if (material !== undefined) {\n        // Assuming no texture is used\n        if (Array.isArray(material)) {\n          material.forEach(disposeMaterial)\n        } else {\n          disposeMaterial(material)\n        }\n      }\n    }\n  })\n}\n","import { Component, Entity, Types } from 'ecsy'\nimport { Color, GrowthStage } from '../../3d/constants'\nimport { Object3D } from 'three'\nimport { disposeObj3D } from '../../3d/helpers'\n\nexport default class TreeComponent extends Component<TreeComponent> {\n  readonly color!: Color\n  growthStage!: GrowthStage\n  seedObj?: Object3D\n  treeObj?: Object3D\n  topObj?: Object3D\n  trunkObj?: Object3D\n  shadeObj?: Object3D\n  shadeEntity?: Entity\n\n  reset (): void {\n    disposeObj3D(this.topObj)\n    disposeObj3D(this.trunkObj)\n    disposeObj3D(this.treeObj)\n    disposeObj3D(this.seedObj)\n    this.seedObj = undefined\n    this.treeObj = undefined\n    this.topObj = undefined\n    this.trunkObj = undefined\n  }\n}\n\nTreeComponent.schema = {\n  color: { type: Types.Number },\n  growthStage: { type: Types.Number },\n  treeObj: { type: Types.Ref, default: undefined },\n  topObj: { type: Types.Ref, default: undefined },\n  trunkObj: { type: Types.Ref, default: undefined },\n  shadeObj: { type: Types.Ref, default: undefined },\n  shadeEntity: { type: Types.Ref, default: undefined },\n  seedObj: { type: Types.Ref, default: undefined }\n}\n","export const MODELS_LOCATION = process.env.PUBLIC_URL + '/models'\n\nexport const MODELS = {\n  BLUE_TOP: 'blueTop',\n  ORANGE_TOP: 'orangeTop',\n  YELLOW_TOP: 'yellowTop',\n  GREEN_TOP: 'greenTop',\n  TRUNK: 'trunk',\n  SHADE: 'shade',\n  ACORN: 'acorn',\n  PINE_CONE: 'pineCone',\n  MAPLE_SEED: 'mapleSeed',\n  BASSWOOD_SEED: 'basswoodSeed',\n  RING: 'ring',\n  LANDSCAPE: 'landscape'\n} as const\n\nexport enum Color {\n  BLUE,\n  ORANGE,\n  YELLOW,\n  GREEN\n}\n\nexport enum GrowthStage {\n  SEED,\n  SHORT,\n  MID,\n  TALL\n}\n\nexport type ModelName = typeof MODELS[keyof typeof MODELS]\n\nexport const TREE_MODELS: Record<Color, ModelName> = {\n  [Color.BLUE]: MODELS.BLUE_TOP,\n  [Color.ORANGE]: MODELS.ORANGE_TOP,\n  [Color.YELLOW]: MODELS.YELLOW_TOP,\n  [Color.GREEN]: MODELS.GREEN_TOP\n} as const\n\nexport const SEED_MODELS: Record<Color, ModelName> = {\n  [Color.BLUE]: MODELS.PINE_CONE,\n  [Color.ORANGE]: MODELS.BASSWOOD_SEED,\n  [Color.YELLOW]: MODELS.ACORN,\n  [Color.GREEN]: MODELS.MAPLE_SEED\n} as const\n\n// Rendering specifics\nexport const AMBIENT_COLOR = 0x191F48\nexport const SUN_COLOR = 0xF8FFB2\nexport const SKY_COLOR = 0xcaf1fc\n\nexport const SHADE_Y: { [k in GrowthStage]: number } = [-18, -10.7, -5.63, 0]\n\nexport const SUN_ANGLE = 52.725\n\nexport const TREE_TOP_Y = 10\n\nexport const TILE_SIZE = 5\n\nexport interface TreeGrowthProp {\n  tree: {\n    scale: [number, number, number]\n  }\n  seed: {\n    scale: [number, number, number]\n  }\n}\n\nexport const TREE_GROWTH_PROPS: { [k in GrowthStage]: TreeGrowthProp } = {\n  [GrowthStage.SEED]: {\n    tree: {\n      scale: [0, 0, 0]\n    },\n    seed: {\n      scale: [1, 1, 1]\n    }\n  },\n  [GrowthStage.SHORT]: {\n    tree: {\n      scale: [0.333, 0.333, 0.333]\n    },\n    seed: {\n      scale: [0, 0, 0]\n    }\n  },\n  [GrowthStage.MID]: {\n    tree: {\n      scale: [0.666, 0.666, 0.666]\n    },\n    seed: {\n      scale: [0, 0, 0]\n    }\n  },\n  [GrowthStage.TALL]: {\n    tree: {\n      scale: [1, 1, 1]\n    },\n    seed: {\n      scale: [0, 0, 0]\n    }\n  }\n}\n","import { Object3D } from 'three'\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { MODELS, MODELS_LOCATION } from './constants'\n\nexport const objects: Record<string, Object3D | undefined> = {}\n\nconst objectWaitOrders: Record<string, Array<{\n  resolve: (value?: Object3D | PromiseLike<Object3D>) => void\n  reject: (reason?: unknown) => void\n  modelName: string\n}> | undefined> = {}\n\nlet loadedCount = 0\nlet totalCount = 0\n\nexport const resetAssets = (): void => {\n  Object.keys(objects).forEach(key => {\n    objects[key] = undefined\n  })\n  loadedCount = 0\n  totalCount = 0\n}\n\nconst modelNotFoundMessage = 'Model not found'\n\nconst doneLoading = (): void => {\n  // Clean up unhandled promises\n  Object.values(objectWaitOrders)\n    .filter(orders => Array.isArray(orders))\n    .forEach(orders => orders?.forEach(({ reject, modelName }) => reject(new Error(modelNotFoundMessage + ': ' + modelName))))\n  Object.keys(objectWaitOrders).forEach(key => {\n    objectWaitOrders[key] = undefined\n  })\n}\n\nexport const startLoad = (): void => {\n  const loader = new GLTFLoader()\n  const modelNames = Object.values(MODELS)\n  totalCount = modelNames.length\n  modelNames.forEach(name => {\n    loader.load(\n      MODELS_LOCATION + '/' + name + '.glb',\n      (gltf) => {\n        // Process objects\n        const object = new Object3D()\n        object.castShadow = true\n        object.receiveShadow = true\n        object.name = name\n        object.add(...gltf.scene.children)\n        object.traverse(child => {\n          child.castShadow = true\n          child.receiveShadow = true\n        })\n        objects[name] = object\n\n        // Resolve promises\n        const waitOrders = objectWaitOrders[name]\n        if (waitOrders !== undefined) {\n          waitOrders.forEach(order => {\n            order.resolve(object)\n          })\n          objectWaitOrders[name] = undefined\n        }\n\n        // Loaded\n        loadedCount++\n        if (loadedCount === totalCount) {\n          doneLoading()\n        }\n      },\n      undefined,\n      (e) => console.error(e)\n    )\n  })\n}\n\nexport const getObject = async (modelName: string): Promise<Object3D> => {\n  const obj3d = objects[modelName]\n  if (obj3d === undefined) {\n    if (loadedCount !== totalCount) {\n      // Not all models are loaded, this model may be loading\n      const queue = objectWaitOrders[modelName] ?? []\n      if (objectWaitOrders[modelName] === undefined) {\n        objectWaitOrders[modelName] = queue\n      }\n      return await new Promise<Object3D>((resolve, reject) => {\n        queue.push({ resolve, reject, modelName })\n      })\n    } else {\n      // Model name is definitely not loaded\n      return Promise.reject(new Error(modelNotFoundMessage + ': ' + modelName))\n    }\n  } else {\n    return Promise.resolve(obj3d)\n  }\n}\n","import { Component } from 'ecsy'\n\nexport default class SunOrientationComponent extends Component<SunOrientationComponent> {}\n","import TreeComponent from '../components/TreeComponent'\nimport { getObject } from '../../3d/assets'\nimport { Color, MODELS, SEED_MODELS, SHADE_Y, TREE_GROWTH_PROPS, TREE_MODELS, TREE_TOP_Y } from '../../3d/constants'\nimport { ECSYThreeEntity, ECSYThreeSystem, Object3DComponent } from 'ecsy-three'\nimport { Object3D } from 'three'\nimport SunOrientationComponent from '../components/SunOrientationComponent'\n\nexport default class TreeSystem extends ECSYThreeSystem {\n  execute (delta: number, time: number): void {\n    this.queries.trees.added?.forEach((entity) => {\n      // Added\n      const treeComp = entity.getMutableComponent(TreeComponent)\n      const obj3d = entity.getObject3D()\n      if (treeComp === undefined || obj3d === undefined) {\n        return\n      }\n      const { color } = treeComp\n      obj3d.name = 'tree-' + entity.id.toString() + '-' + Color[color]\n\n      // setup components\n      const objectsToFetch = [\n        getObject(TREE_MODELS[color]),\n        getObject(MODELS.TRUNK),\n        getObject(SEED_MODELS[color]),\n        getObject(MODELS.SHADE)\n      ]\n\n      Promise.all(objectsToFetch).then((objs) => {\n        const [\n          topObj,\n          trunkObj,\n          seedObj\n        ] = objs.map(o => o.clone())\n\n        const shadeObj = new Object3D()\n        shadeObj.name = 'shadeContainer'\n        shadeObj.add(objs[3])\n        shadeObj.position.y = SHADE_Y[treeComp.growthStage]\n        const shadeEntity = this.world\n          .createEntity()\n          .addComponent(Object3DComponent, { value: shadeObj })\n          .addComponent(SunOrientationComponent)\n        treeComp.shadeObj = shadeObj\n        treeComp.shadeEntity = shadeEntity\n\n        const treeObj = new Object3D()\n        treeComp.treeObj = treeObj\n        treeObj.name = 'tree'\n        topObj.position.y = TREE_TOP_Y\n        treeComp.topObj = topObj\n        treeComp.trunkObj = trunkObj\n        treeObj.add(topObj, trunkObj)\n\n        treeComp.seedObj = seedObj\n\n        const plantContainerObj = new Object3D()\n        plantContainerObj.name = 'plantContainer'\n        plantContainerObj.rotation.y = Math.random() * Math.PI * 2\n        plantContainerObj.add(treeObj, seedObj)\n\n        obj3d.add(plantContainerObj, shadeObj)\n\n        TreeSystem.updateGrowthStage(entity)\n      }).catch(console.error)\n    })\n\n    this.queries.trees.changed?.forEach(TreeSystem.updateGrowthStage.bind(this))\n\n    this.queries.trees.results.forEach((entity) => {\n      // Always\n      const treeComp = entity.getComponent(TreeComponent)\n      if (treeComp === undefined) {\n        return\n      }\n      // Set visibility\n      const {\n        treeObj,\n        seedObj\n      } = treeComp\n\n      if (treeObj?.scale.lengthSq() === 0) {\n        treeObj.visible = false\n      }\n\n      if (seedObj?.scale.lengthSq() === 0) {\n        seedObj.visible = false\n      }\n    })\n\n    this.queries.trees.removed?.forEach((entity) => {\n      // Removed\n      const treeComp = entity.getComponent(TreeComponent)\n      if (treeComp === undefined) {\n        return\n      }\n      treeComp.shadeEntity?.remove()\n    })\n  }\n\n  private static updateGrowthStage (entity: ECSYThreeEntity): void {\n    // Changed\n    const treeComp = entity.getMutableComponent(TreeComponent)\n    if (treeComp === undefined) {\n      return\n    }\n\n    const {\n      treeObj,\n      seedObj,\n      shadeObj\n    } = treeComp\n\n    // Flexibility for animations\n    if (shadeObj !== undefined) {\n      shadeObj.position.y = SHADE_Y[treeComp.growthStage]\n    }\n    if (treeObj !== undefined) {\n      treeObj.scale.set(...TREE_GROWTH_PROPS[treeComp.growthStage].tree.scale)\n    }\n    if (seedObj !== undefined) {\n      seedObj.scale.set(...TREE_GROWTH_PROPS[treeComp.growthStage].seed.scale)\n    }\n  }\n}\n\n/*\nGrowth stages:\n0: seed model, scale = 1 easeInOutBack => tree model scale 0 grow out, seed shrink\n1: tree model, scale = 0.33 easeInOutBack\n2: tree model, scale = 0.66 easeInOutBack\n3: tree model, scale = 1 easeInOutBack\n */\n\nTreeSystem.queries = {\n  trees: {\n    components: [\n      TreeComponent, Object3DComponent\n    ],\n    listen: {\n      added: true,\n      removed: true,\n      changed: [TreeComponent]\n    }\n  }\n}\n","import { Component, Types } from 'ecsy'\n\nexport type TweenFunction<T> = (from: T, to: T, value: number) => T\n\nexport interface TweenProperties<T> {\n  from: T\n  to: T\n  func: TweenFunction<T>\n}\n\n// TODO deep clone when getObject\n// TODO tween material\nexport default class TweenBaseComponent<T> extends Component<TweenBaseComponent<T>> {\n  loop!: number\n  duration!: number\n  value!: number\n}\n\nTweenBaseComponent.schema = {\n  loop: { type: Types.Number, default: 1 },\n  duration: { type: Types.Number },\n  value: { type: Types.Number, default: 0 }\n}\n","import { Component, Types } from 'ecsy'\nimport { Object3D } from 'three'\nimport { TweenProperties } from './TweenBaseComponent'\n\nexport type TweenFunction<T> = (from: T, to: T, value: number) => T\n\ntype TweenableKeys = 'position' | 'rotation' | 'scale' | 'quaternion'\n\n// TODO tween material\nexport default class TweenObject3DComponent<T extends TweenableKeys>\n  extends Component<TweenObject3DComponent<T>>\n  implements TweenProperties<Object3D[T]> {\n  prop!: T\n  from!: Object3D[T]\n  to!: Object3D[T]\n  func!: TweenFunction<Object3D[T]>\n}\n\nTweenObject3DComponent.schema = {\n  prop: { type: Types.String },\n  from: { type: Types.Ref },\n  to: { type: Types.Ref },\n  func: { type: Types.Ref }\n}\n","import TweenBaseComponent from '../components/TweenBaseComponent'\nimport { ECSYThreeSystem, Object3DComponent } from 'ecsy-three'\nimport TweenObject3DComponent from '../components/TweenObject3DComponent'\n\nexport default class TweenSystem extends ECSYThreeSystem {\n  execute (delta: number, time: number): void {\n    (this.queries.object3DTweens?.results ?? []).forEach(entity => {\n      const objComp = entity.getComponent(Object3DComponent)\n      const tweenComp = entity.getMutableComponent(TweenBaseComponent)\n      const tweenObj3DComp = entity.getMutableComponent(TweenObject3DComponent)\n\n      if (objComp === undefined || objComp.value === undefined || tweenComp === undefined || tweenObj3DComp === undefined) {\n        return\n      }\n\n      const object3D = objComp.value\n\n      const {\n        loop,\n        duration,\n        value: oldValue\n      } = tweenComp\n\n      const {\n        prop,\n        from,\n        to,\n        func\n      } = tweenObj3DComp\n\n      const value = Math.min(1, delta / duration + oldValue)\n      tweenComp.value = value\n\n      const result = func(from, to, value)\n\n      object3D[prop].fromArray(result.toArray())\n\n      if (value === 1) {\n        // Tweening is complete\n        if (loop > 0) {\n          // Next loop\n          tweenComp.loop--\n          tweenComp.value = 0\n        }\n        if (loop === 0) {\n          // Remove component\n          entity.removeComponent(TweenBaseComponent)\n        }\n      }\n    })\n  }\n}\n\nTweenSystem.queries = {\n  object3DTweens: {\n    components: [TweenBaseComponent, TweenObject3DComponent, Object3DComponent]\n  }\n}\n","import { Component, Types } from 'ecsy'\nimport { Material } from 'three'\nimport { TweenProperties } from './TweenBaseComponent'\n\nexport type TweenFunction<T> = (from: T, to: T, value: number) => T\n\n// TODO tween material\nexport default class TweenMaterialComponent<T extends Material>\n  extends Component<TweenMaterialComponent<T>>\n  implements TweenProperties<number> {\n  from!: number\n  to!: number\n  func!: TweenFunction<number>\n}\n\nTweenMaterialComponent.schema = {\n  from: { type: Types.Ref },\n  to: { type: Types.Ref },\n  func: { type: Types.Ref }\n}\n","import { Component, Types } from 'ecsy'\nimport Axial from '../../3d/Coordinates/Axial'\n\nexport default class AxialCoordsComponent extends Component<AxialCoordsComponent> {\n  position!: Axial\n}\n\nAxialCoordsComponent.schema = {\n  position: { type: Types.Ref }\n}\n","import Coordinates from './Coordinates'\n\nexport default class Cartesian2D implements Coordinates<Cartesian2D> {\n  public x: number\n  public y: number\n\n  constructor (x: number, y: number) {\n    this.x = x\n    this.y = y\n  }\n\n  public static fromArray (a: [number, number]): Cartesian2D {\n    return new Cartesian2D(...a)\n  }\n\n  public static fromString (s: string): Cartesian2D {\n    const a = s.split(',').map((i: string) => parseInt(i, 10))\n    return Cartesian2D.fromArray([a[0], a[1]])\n  }\n\n  public static neighbors: Cartesian2D[] = [\n    new Cartesian2D(-1, -1),\n    new Cartesian2D(0, -1),\n    new Cartesian2D(1, -1),\n    new Cartesian2D(-1, 0),\n    new Cartesian2D(1, 0),\n    new Cartesian2D(-1, 1),\n    new Cartesian2D(0, 1),\n    new Cartesian2D(1, 1)\n  ]\n\n  public static get origin (): Cartesian2D {\n    return new Cartesian2D(0, 0)\n  }\n\n  public toArray (): [number, number] {\n    return [this.x, this.y]\n  }\n\n  public toString (): string {\n    return this.toArray().join(',')\n  }\n\n  public add (coords: Cartesian2D): Cartesian2D {\n    this.x += coords.x\n    this.y += coords.y\n    return this\n  }\n\n  public scale (n: number): Cartesian2D {\n    this.x *= n\n    this.y *= n\n    return this\n  }\n\n  public euclideanDistance (t: Cartesian2D): number {\n    return Math.sqrt((this.x - t.x) ** 2 + (this.y - t.y) ** 2)\n  }\n\n  public manhattanDistance (t: Cartesian2D): number {\n    return this.x - t.x + (this.y - t.y)\n  }\n\n  public added (coord: Cartesian2D): Cartesian2D {\n    const ret = new Cartesian2D(this.x, this.y)\n    return ret.add(coord)\n  }\n\n  public scaled (n: number): Cartesian2D {\n    const ret = new Cartesian2D(this.x, this.y)\n    return ret.scale(n)\n  }\n\n  public norm (): number {\n    return this.euclideanDistance(Cartesian2D.origin)\n  }\n\n  public normalize (): Cartesian2D {\n    return this.scale(1 / this.norm())\n  }\n\n  public normalized (): Cartesian2D {\n    const ret = new Cartesian2D(this.x, this.y)\n    return ret.normalize()\n  }\n\n  public clone (): Cartesian2D {\n    return new Cartesian2D(this.x, this.y)\n  }\n}\n","import HexCube from './HexCube'\nimport Coordinates from './Coordinates'\nimport Cartesian2D from './Cartesian2D'\n\nexport default class Axial implements Coordinates<Axial> {\n  public q: number\n  public r: number\n\n  constructor (q: number, r: number) {\n    this.q = q\n    this.r = r\n  }\n\n  public static neighbors = [\n    new Axial(+1, 0),\n    new Axial(+1, -1),\n    new Axial(0, -1),\n    new Axial(-1, 0),\n    new Axial(-1, +1),\n    new Axial(0, +1)\n  ]\n\n  public static fromArray (a: [number, number]): Axial {\n    return new Axial(...a)\n  }\n\n  public static fromString (s: string): Axial {\n    const a = s.split(',').map((i: string) => parseInt(i, 10))\n    return Axial.fromArray([a[0], a[1]])\n  }\n\n  static get origin (): Axial {\n    return new Axial(0, 0)\n  }\n\n  public toArray (): [number, number] {\n    return [this.q, this.r]\n  }\n\n  public toString (): string {\n    return this.toArray().join(',')\n  }\n\n  public toHexCube (): HexCube {\n    return new HexCube(this.q, -this.q - this.r, this.r)\n  }\n\n  public toCartesian (size: number): Cartesian2D {\n    const x = size * (Math.sqrt(3) * this.q + (Math.sqrt(3) / 2) * this.r)\n    const y = size * ((3 / 2) * this.r)\n    return new Cartesian2D(x, y)\n  }\n\n  public add (axial: Axial): Axial {\n    this.q += axial.q\n    this.r += axial.r\n    return this\n  }\n\n  public scale (n: number): Axial {\n    this.q *= n\n    this.r *= n\n    return this\n  }\n\n  public tileDistance (t: Axial): number {\n    return (\n      (Math.abs(this.q - t.q) +\n        Math.abs(this.q + this.r - t.q - t.r) +\n        Math.abs(this.r - t.r)) /\n      2\n    )\n  }\n\n  public range (r: number): Axial[] {\n    return this.toHexCube().range(r).map((c) => c.toAxial())\n  }\n}\n\nexport { Axial }\n","import Axial from './Axial'\nimport Coordinates from './Coordinates'\n\nexport default class HexCube implements Coordinates<HexCube> {\n  public x: number\n  public y: number\n  public z: number\n\n  constructor (x: number, y: number, z: number) {\n    this.x = x\n    this.y = y\n    this.z = z\n  }\n\n  public static neighbors: HexCube[] = [\n    new HexCube(+1, -1, 0), new HexCube(+1, 0, -1), new HexCube(0, +1, -1),\n    new HexCube(-1, +1, 0), new HexCube(-1, 0, +1), new HexCube(0, -1, +1)\n  ]\n\n  public static fromArray (a: [number, number, number]): HexCube {\n    return new HexCube(...a)\n  }\n\n  public static fromString (s: string): HexCube {\n    const a = s.split(',').map((i: string) => parseInt(i, 10))\n    return HexCube.fromArray([a[0], a[1], a[2]])\n  }\n\n  public static get origin (): HexCube {\n    return new HexCube(0, 0, 0)\n  }\n\n  public toArray (): [number, number, number] {\n    return [this.x, this.y, this.z]\n  }\n\n  public toString (): string {\n    return this.toArray().join(',')\n  }\n\n  public toAxial (): Axial {\n    return new Axial(this.x, this.z)\n  }\n\n  public add (hexCube: HexCube): HexCube {\n    this.x += hexCube.x\n    this.y += hexCube.y\n    this.z += hexCube.z\n    return this\n  }\n\n  public scale (n: number): HexCube {\n    this.x *= n\n    this.y *= n\n    this.z *= n\n    return this\n  }\n\n  public tileDistance (t: HexCube): number {\n    return (Math.abs(this.x - t.x) + Math.abs(this.y - t.y) + Math.abs(this.z - t.z)) / 2\n  }\n\n  public range (r: number): HexCube[] {\n    const results: HexCube[] = []\n    for (let x = -r; x <= r; x++) {\n      for (let y = Math.max(-r, -x - r); y <= Math.min(r, -x + r); y++) {\n        const z = -x - y\n        results.push(\n          new HexCube(this.x + x, this.y + y, this.z + z)\n        )\n      }\n    }\n    return results\n  }\n}\n","import { Component } from 'ecsy'\n\nexport default class TileComponent extends Component<TileComponent> {\n}\n","import AxialCoordsComponent from '../components/AxialCoordsComponent'\nimport { ECSYThreeSystem, Object3DComponent } from 'ecsy-three'\nimport { TILE_SIZE } from '../../3d/constants'\n\nexport default class AxialCoordsSystem extends ECSYThreeSystem {\n  execute (delta: number, time: number): void {\n    this.queries.axialPositions.results.forEach(entity => {\n      const axialCoordsComp = entity.getComponent(AxialCoordsComponent)\n      const obj3dComp = entity.getComponent(Object3DComponent)\n      const obj3d = obj3dComp?.value\n\n      if (axialCoordsComp === undefined || obj3d === undefined) {\n        return\n      }\n\n      const [x, z] = axialCoordsComp.position.toCartesian(TILE_SIZE).toArray()\n\n      obj3d.position.set(x, 0, z)\n    })\n  }\n}\n\nAxialCoordsSystem.queries = {\n  axialPositions: {\n    components: [AxialCoordsComponent, Object3DComponent]\n  }\n}\n","import TileComponent from '../components/TileComponent'\nimport TreeComponent from '../components/TreeComponent'\nimport AxialCoordsComponent from '../components/AxialCoordsComponent'\nimport { ECSYThreeSystem } from 'ecsy-three'\n\nexport default class TileSystem extends ECSYThreeSystem {\n  execute (delta: number, time: number): void {\n    //\n  }\n}\n\nTileSystem.queries = {\n  tiles: {\n    components: [TileComponent]\n  },\n  trees: {\n    components: [TreeComponent, AxialCoordsComponent]\n  }\n}\n","import { ECSYThreeSystem, ECSYThreeWorld, Object3DComponent } from 'ecsy-three'\nimport SunOrientationComponent from '../components/SunOrientationComponent'\nimport { GameWorldAttributes } from '../types/GameWorldAttributes'\nimport GameWorld from '../GameWorld'\n\nexport default class SunOrientationSystem extends ECSYThreeSystem {\n  private readonly gameWorld: GameWorld\n\n  constructor (world: ECSYThreeWorld, attributes?: GameWorldAttributes) {\n    super(world, attributes)\n    if (attributes?.gameWorld === undefined) {\n      throw new Error('Game world must be provided')\n    }\n    this.gameWorld = attributes?.gameWorld\n  }\n\n  execute (delta: number, time: number): void {\n    this.queries.sunFacingObjs.results.forEach(entity => {\n      const obj3d = entity.getObject3D()\n      if (obj3d === undefined) {\n        return\n      }\n      obj3d.rotation.y = this.gameWorld.sunOrientationRad\n    })\n  }\n}\n\nSunOrientationSystem.queries = {\n  sunFacingObjs: {\n    components: [SunOrientationComponent, Object3DComponent]\n  }\n}\n","import GameWorld from '../GameWorld'\nimport { Object3D } from 'three'\nimport TreeComponent from '../components/TreeComponent'\nimport { Color, GrowthStage } from '../../3d/constants'\n\nexport interface TreeOptions {\n  color: Color\n  growthStage: GrowthStage\n}\n\nexport const createTree = (gameWorld: GameWorld, { color, growthStage = 0 }: TreeOptions): void => {\n  const tree = new Object3D()\n\n  gameWorld.world\n    .createEntity()\n    .addObject3DComponent(tree, gameWorld.sceneEntity)\n    .addComponent(TreeComponent, {\n      color,\n      growthStage\n    })\n}\n","import { ConnectionManager } from './ConnectionManager'\nimport { ConnectionListenerPayload, ConnEvent } from './ConnectionTypes'\nimport { PkgType } from './PkgType'\nimport { Connection } from './Connection'\nimport { Observable } from './Observable'\nimport cloneDeep from 'lodash.clonedeep'\nimport { pause } from './pause'\n\nexport enum StarMeshNetworkEvents {\n  STATE_CHANGE,\n  MEMBERS_CHANGE,\n  MEMBERS_JOIN,\n  MEMBERS_LEFT,\n  NETWORK_ERROR,\n  HOST_CHANGE\n}\n\nexport interface StarMeshEventPayload<T> {\n  state?: T\n  members?: string[]\n  error?: Error\n  host?: string\n}\n\nexport type StarMeshAction = Record<string, unknown>\n\nexport type StarMeshReducer<T, U = never> = (prevState: T, action: U | StarMeshAction, connId: string) => T\n\ninterface MemberChangePayload {\n  members: string[]\n  host?: string\n}\n\nconst isMemberChangePayload = (data: unknown): data is MemberChangePayload => {\n  if (typeof data === 'object' && data !== null) {\n    if ('members' in data && 'host' in data) {\n      const d = data as { members: unknown, host: unknown }\n      return Array.isArray(d.members) && d.members.reduce((p: boolean, c) => p && typeof c === 'string', true)\n    }\n  }\n  return false\n}\n\nexport class StarMeshNetwork<T = Record<string, unknown>> extends Observable<typeof StarMeshNetworkEvents, StarMeshEventPayload<T>> {\n  hostConnectionManager?: ConnectionManager\n  myConnectionManager: ConnectionManager\n  meToHostConnection?: Connection\n  members: string[] = []\n\n  state: T\n  networkName?: string\n\n  reducer?: StarMeshReducer<T>\n  hostId?: string\n  initialState: T\n\n  public get id (): string {\n    return this.myConnectionManager.id\n  }\n\n  constructor (myConnectionManager: ConnectionManager, initialState: T, reducer?: StarMeshReducer<T>) {\n    super()\n    this.reducer = reducer\n    this.initialState = cloneDeep(initialState)\n    this.myConnectionManager = myConnectionManager\n    this.initMyConnectionManagerListeners()\n    this.state = cloneDeep(initialState)\n  }\n\n  private readonly networkErrorHandler = (error: Error): void => {\n    // console.log(this.id, error)\n    this.emit(StarMeshNetworkEvents.NETWORK_ERROR, { error })\n  }\n\n  public isHost (): boolean | undefined {\n    if (this.hostConnectionManager !== undefined) {\n      return true\n    } else if (this.meToHostConnection !== undefined) {\n      return false\n    } else {\n      return undefined\n    }\n  }\n\n  public sendToHost = async (pkgType: PkgType, data: unknown): Promise<ConnectionListenerPayload> => {\n    if (this.meToHostConnection === undefined) {\n      throw new Error('not connected to host')\n    }\n    return await this.myConnectionManager.sendPkg(this.meToHostConnection.id, pkgType, data)\n  }\n\n  public get myId (): string {\n    return this.myConnectionManager.id\n  }\n\n  private readonly initMyConnectionManagerListeners = (): void => {\n    this.myConnectionManager.onPkg(PkgType.MEMBER_CHANGE, ({ data }) => {\n      this.handleMemberChange(data).catch(this.networkErrorHandler)\n    })\n    this.myConnectionManager.onPkg(PkgType.SET_STATE, ({ data }) => {\n      this.emit(StarMeshNetworkEvents.STATE_CHANGE, { state: data as T })\n      this.state = data as T\n    })\n    this.myConnectionManager.onPkg(PkgType.DISPATCH, this.dispatchHandler)\n  }\n\n  public async joinOrHost (networkName: string): Promise<void> {\n    this.networkName = networkName\n    try {\n      await this.host(networkName)\n      await this.join(networkName)\n    } catch (e) {\n      await this.join(networkName)\n    }\n  }\n\n  private readonly host = async (networkName: string): Promise<void> => {\n    const hostConnection = await ConnectionManager.startPrefix(networkName)\n    const oldHost = this.hostId\n    this.hostId = this.id\n    this.hostConnectionManager = hostConnection\n    this.hostConnectionManager.on(ConnEvent.CONN_OPEN, ({ conn }) => {\n      if (conn !== undefined) {\n        this.hostConnectionManager?.broadcastPkg(PkgType.MEMBER_CHANGE, {\n          host: this.hostId,\n          members: [...this.members, conn.id]\n        })\n          .catch(this.networkErrorHandler)\n        conn.sendPkg(PkgType.SET_STATE, cloneDeep(this.state)).catch(this.networkErrorHandler)\n      }\n    })\n    this.hostConnectionManager.on(ConnEvent.CONN_CLOSE, ({ conn }) => {\n      this.hostConnectionManager?.broadcastPkg(PkgType.MEMBER_CHANGE, {\n        host: this.id,\n        members: this.members.filter(id => id !== conn?.id)\n      })\n        .catch(this.networkErrorHandler)\n    })\n    // if there are existing members, probably the members were connected to a disconnected host\n    // so update them to use the new host\n    if (this.members.length > 0) {\n      const members = this.members.filter(n => n !== oldHost)\n      await Promise.all(members.map(async (id: string): Promise<Connection> => await hostConnection?.connect(id))).catch(console.log)\n      await hostConnection.broadcastPkg(PkgType.MEMBER_CHANGE, {\n        host: this.id,\n        members\n      })\n    }\n  }\n\n  private readonly join = async (networkName: string): Promise<void> => {\n    this.meToHostConnection = await this.myConnectionManager.connectPrefix(networkName)\n    this.meToHostConnection.on(ConnEvent.CONN_CLOSE, () => {\n      if (this.members.length > 1) {\n        if (this.networkName !== undefined && !this.myConnectionManager.isClosed() && this.members.filter(n => n !== this.hostId)[0] === this.id) {\n          this.host(this.networkName).catch(this.networkErrorHandler)\n        }\n      }\n    })\n    while (this.members.length === 0) {\n      await pause(100)\n    }\n  }\n\n  private readonly handleMemberChange = async (data: unknown): Promise<void> => {\n    if (isMemberChangePayload(data)) {\n      this.emit(StarMeshNetworkEvents.HOST_CHANGE, { host: data.host })\n      if (data.members.length === this.members.length && this.members.reduce((f: boolean, c) => f && data.members.includes(c), true)) {\n        return\n      }\n      this.hostId = data.host\n      const oldList = [...this.members]\n      const newList = data.members\n      this.members = [...newList]\n      // connect to new member\n      const memberJoining = newList.filter(n => !oldList.includes(n))\n      const memberLeaving = oldList.filter(n => !newList.includes(n))\n      try {\n        await Promise.all(memberJoining.map(async n => {\n          return await this.myConnectionManager.connect(n)\n        }))\n        // disconnect leave member\n        memberLeaving.forEach(n => {\n          this.myConnectionManager.disconnect(n)\n        })\n      } catch (e) {\n        this.emit(StarMeshNetworkEvents.NETWORK_ERROR, e)\n        console.log(e)\n      }\n      if (memberJoining.length > 0 || memberLeaving.length > 0) {\n        this.emit(StarMeshNetworkEvents.MEMBERS_CHANGE, { members: this.members })\n      }\n      if (memberJoining.length > 0) {\n        this.emit(StarMeshNetworkEvents.MEMBERS_JOIN, { members: memberJoining })\n      }\n      if (memberLeaving.length > 0) {\n        this.emit(StarMeshNetworkEvents.MEMBERS_LEFT, { members: memberLeaving })\n      }\n    } else {\n      throw new Error('wrong member change payload')\n    }\n  }\n\n  public setReducer = (reducer: StarMeshReducer<T>): void => {\n    this.reducer = reducer\n  }\n\n  public dispatch = async (action: StarMeshAction): Promise<void> => {\n    const responses = await Promise.all(this.members.map(async (id) => await this.myConnectionManager.conn(id).sendPkg(PkgType.DISPATCH, action)))\n    responses.forEach(({ data }) => {\n      if (data !== undefined && data !== true) {\n        if (typeof data === 'string') {\n          throw new Error(data)\n        }\n      }\n    })\n  }\n\n  public dispatchLocal = async (action: StarMeshAction): Promise<void> => {\n    if (this.reducer === undefined) {\n      this.emit(StarMeshNetworkEvents.NETWORK_ERROR, { error: new Error('no reducer defined') })\n      throw new Error('no reducer defined')\n    }\n    const newState = this.reducer(this.state, action, this.id)\n    this.setState(newState)\n    return await Promise.resolve()\n  }\n\n  private readonly dispatchHandler = ({ conn, data, ack }: ConnectionListenerPayload): void => {\n    if (this.reducer === undefined) {\n      this.emit(StarMeshNetworkEvents.NETWORK_ERROR, { error: new Error('no reducer defined') })\n      ack?.('no reducer defined')\n    } else if (conn === undefined) {\n      this.emit(StarMeshNetworkEvents.NETWORK_ERROR, { error: new Error('no conn') })\n      ack?.('no conn')\n    } else {\n      try {\n        const stateStaging = this.reducer(this.state, data as StarMeshAction, conn.id)\n        this.setState(stateStaging)\n        ack?.(true)\n      } catch (e: unknown) {\n        ack?.((e as Error).message)\n      }\n    }\n  }\n\n  private readonly setState = (newState: T): void => {\n    this.state = newState\n    this.emit(StarMeshNetworkEvents.STATE_CHANGE, { state: newState })\n  }\n\n  public leave = (): void => {\n    this.networkName = undefined\n    this.hostConnectionManager?.destroy()\n    this.meToHostConnection?.close()\n    this.emit(StarMeshNetworkEvents.MEMBERS_LEFT, { members: this.members })\n    this.emit(StarMeshNetworkEvents.MEMBERS_CHANGE, { members: [] })\n    this.meToHostConnection = undefined\n    this.hostConnectionManager = undefined\n    this.state = cloneDeep(this.initialState)\n    this.members = []\n    this.hostId = undefined\n  }\n}\n","import { ECSYThreeEntity, ECSYThreeWorld, initialize, Object3DComponent } from 'ecsy-three'\nimport {\n  AmbientLight,\n  DirectionalLight,\n  Group,\n  Object3D,\n  PerspectiveCamera,\n  sRGBEncoding,\n  VSMShadowMap,\n  WebGLRenderer\n} from 'three'\nimport TreeSystem from './systems/TreeSystem'\nimport TweenSystem from './systems/TweenSystem'\nimport { disposeObj3D } from '../3d/helpers'\nimport TreeComponent from './components/TreeComponent'\nimport TweenBaseComponent from './components/TweenBaseComponent'\nimport TweenObject3DComponent from './components/TweenObject3DComponent'\nimport TweenMaterialComponent from './components/TweenMaterialComponent'\nimport AxialCoordsComponent from './components/AxialCoordsComponent'\nimport { AMBIENT_COLOR, Color, GrowthStage, MODELS, SKY_COLOR, SUN_ANGLE, SUN_COLOR } from '../3d/constants'\nimport { getObject } from '../3d/assets'\nimport HexCube from '../3d/Coordinates/HexCube'\nimport TileComponent from './components/TileComponent'\nimport AxialCoordsSystem from './systems/AxialCoordsSystem'\nimport TileSystem from './systems/TileSystem'\nimport SunOrientationComponent from './components/SunOrientationComponent'\nimport SunOrientationSystem from './systems/SunOrientationSystem'\nimport { createTree } from './entities/tree'\nimport dat from 'dat.gui'\n\nexport default class GameWorld {\n  gui: dat.GUI\n\n  renderer: WebGLRenderer\n  world: ECSYThreeWorld\n  sceneEntity?: ECSYThreeEntity\n  camera?: PerspectiveCamera\n  messages: Record<string, unknown[]> = {}\n\n  sunOrientationRad = 0\n  started = false\n\n  constructor () {\n    this.gui = new dat.GUI()\n    this.renderer = new WebGLRenderer()\n    this.world = new ECSYThreeWorld()\n    window.addEventListener('load', () => {\n      this.init()\n    })\n  }\n\n  public dispose (): void {\n    this.resetGUI()\n    this.world.stop()\n    disposeObj3D(this.sceneEntity?.getComponent(Object3DComponent)?.value)\n    this.sunOrientationRad = 0\n    this.started = false\n    console.log('end')\n  }\n\n  public init (): void {\n    if (this.started) return\n    console.log('start')\n    this.started = true\n    const {\n      camera,\n      sceneEntity\n    } = initialize(this.world, {\n      renderer: this.renderer\n    })\n    this.camera = camera\n    this.sceneEntity = sceneEntity\n    this.initRenderer()\n    this.initECS()\n    this.initScene()\n    this.world.play()\n  }\n\n  public resetWorld (): void {\n    this.dispose()\n    this.init()\n  }\n\n  private resetGUI (): void {\n    this.gui.destroy()\n    this.gui = new dat.GUI()\n\n    const sunControl = this.gui.add(this, 'sunOrientationRad', 0, 2 * Math.PI)\n    sunControl.name('Sun orientation')\n    sunControl.step(0.01)\n  }\n\n  private initECS (): void {\n    this.world.registerComponent(TreeComponent)\n    this.world.registerComponent(TweenBaseComponent)\n    this.world.registerComponent(TweenObject3DComponent)\n    this.world.registerComponent(TweenMaterialComponent)\n    this.world.registerComponent(AxialCoordsComponent)\n    this.world.registerComponent(TileComponent)\n    this.world.registerComponent(SunOrientationComponent)\n\n    this.world.registerSystem(AxialCoordsSystem)\n    this.world.registerSystem(TileSystem)\n    this.world.registerSystem(TreeSystem)\n    this.world.registerSystem(TweenSystem)\n    this.world.registerSystem(SunOrientationSystem, { gameWorld: this })\n  }\n\n  private initRenderer (): void {\n    this.renderer.shadowMap.enabled = true\n    this.renderer.shadowMap.type = VSMShadowMap\n    this.renderer.setClearColor(SKY_COLOR)\n    this.renderer.outputEncoding = sRGBEncoding\n  }\n\n  private initScene (): void {\n    if (this.camera !== undefined && this.sceneEntity !== undefined) {\n      this.camera.position.set(0, 0, 150)\n      this.camera.fov = 40\n\n      this.sceneEntity.getObject3D()?.remove(this.camera)\n\n      const cameraTiltObj = new Object3D()\n      cameraTiltObj.name = 'cameraTilt'\n      cameraTiltObj.rotation.x = -0.4\n      cameraTiltObj.add(this.camera)\n\n      const cameraPivotObj = new Object3D()\n      cameraPivotObj.name = 'cameraPivot'\n      cameraPivotObj.add(cameraTiltObj)\n\n      const cameraFolder = this.gui.addFolder('Camera')\n\n      cameraFolder.add(this.camera.position, 'z', 20, 300, 1).name('zoom')\n      cameraFolder.add(cameraTiltObj.rotation, 'x', -Math.PI / 2, 0, 0.01).name('tilt')\n      cameraFolder.add(cameraPivotObj.rotation, 'y', 0, Math.PI * 2, 0.01).name('rotation')\n      cameraFolder.open()\n\n      this.world.createEntity()\n        .addObject3DComponent(cameraPivotObj, this.sceneEntity)\n    }\n\n    const ambientLight = new AmbientLight(AMBIENT_COLOR, 0.5)\n    const sun = new DirectionalLight(SUN_COLOR, 1.2)\n    sun.position.set(0, Math.sin(SUN_ANGLE) * 150, 150)\n    sun.castShadow = true\n    sun.shadow.camera.visible = true\n    sun.shadow.bias = -0.001\n    sun.shadow.radius = 32\n    sun.shadow.camera.near = 50\n    sun.shadow.camera.far = 300\n    sun.shadow.camera.top = -100\n    sun.shadow.camera.bottom = 50\n    sun.shadow.camera.left = -100\n    sun.shadow.camera.right = 100\n    sun.shadow.mapSize.set(2 ** 13, 2 ** 13)\n    const sunContainer = new Group()\n    sunContainer.name = 'sun'\n    sunContainer.add(sun)\n\n    const sky = new DirectionalLight(0xFFFFFF, 0.2)\n    sky.name = 'sky'\n    sky.position.y = 100\n    sky.castShadow = true\n    sky.shadow.bias = -0.001\n    sky.shadow.radius = 128\n    sky.shadow.camera.near = 10\n    sky.shadow.camera.far = 150\n    sky.shadow.camera.top = -30\n    sky.shadow.camera.bottom = 30\n    sky.shadow.camera.left = -30\n    sky.shadow.camera.right = 30\n    sky.shadow.mapSize.set(2 ** 13, 2 ** 13)\n\n    const commonLights = new Group()\n    commonLights.name = 'commonLights'\n    commonLights.add(ambientLight, sky)\n\n    const floorObj = new Object3D()\n    getObject(MODELS.LANDSCAPE).then(obj => floorObj.add(obj.clone())).catch(console.error)\n    floorObj.name = 'floor'\n\n    this.world\n      .createEntity()\n      .addObject3DComponent(floorObj, this.sceneEntity)\n\n    this.world\n      .createEntity()\n      .addObject3DComponent(commonLights, this.sceneEntity)\n\n    this.world\n      .createEntity()\n      .addObject3DComponent(sunContainer, this.sceneEntity)\n      .addComponent(SunOrientationComponent)\n\n    this.generateGrid().catch(console.error)\n\n    createTree(this, { color: Color.YELLOW, growthStage: GrowthStage.SEED })\n  }\n\n  private async generateGrid (): Promise<void> {\n    const boardObj = new Object3D()\n    boardObj.name = 'gameBoard'\n\n    const boardEntity = this.world\n      .createEntity()\n      .addObject3DComponent(boardObj, this.sceneEntity)\n\n    const ringObj = await getObject(MODELS.RING)\n\n    for (let i = 0; i < 4; i++) {\n      new HexCube(0, 0, 0).range(i).forEach(hexCube => {\n        console.log(hexCube)\n        this.world\n          .createEntity()\n          .addObject3DComponent(ringObj.clone(), boardEntity)\n          .addComponent(TileComponent)\n          .addComponent(AxialCoordsComponent, { position: hexCube.toAxial() })\n      })\n    }\n  }\n\n  /**\n   * Send and receive messages between main game logic and ECS\n   * @param target Recipient\n   * @param message Message to recipient\n   */\n  public send (target: string, message: unknown): void {\n    const queue = this.messages[target] ?? []\n\n    if (this.messages[target] === undefined) {\n      this.messages[target] = queue\n    }\n\n    queue.push(message)\n  }\n}\n","export const pause = async (timeout: number): Promise<void> => await new Promise(resolve => {\n  setTimeout(() => {\n    resolve()\n  }, timeout)\n})\n","import { Room, RoomActionTypes } from '../lib/Room'\nimport { Observable } from '../lib/Observable'\nimport GameWorld from './GameWorld'\nimport { StarMeshAction, StarMeshNetworkEvents, StarMeshReducer } from '../lib/StarMeshNetwork'\n\nexport enum GameEvent {\n  UPDATE_GAME_STATE,\n  REQUEST_GAME_STATE,\n  GAME_OVER,\n  CLICK,\n  GAME_INIT\n}\n\nexport enum GameActions {\n  CLICK\n}\n\nexport type Coords = [number, number]\n\nexport interface GameState {\n  turn: number\n  board: Array<Array<string | null>>\n  gameOver?: string\n}\n\nexport interface GameEventPayload {\n  data: unknown\n}\n\nexport class Game extends Observable<typeof GameEvent, GameEventPayload> {\n  room: Room\n  gameWorld = new GameWorld()\n\n  public get started (): boolean {\n    return this.room.started\n  }\n\n  public get state (): GameState | undefined {\n    return this.room.network.state.game\n  }\n\n  public static get initialState (): GameState {\n    return {\n      turn: 0,\n      board:\n        [\n          [null, null, null],\n          [null, null, null],\n          [null, null, null]\n        ]\n    }\n  }\n\n  public get me (): string {\n    return this.room.p(this.room.myId)\n  }\n\n  public get mi (): number {\n    return Number.parseInt(this.me)\n  }\n\n  constructor (room: Room) {\n    super()\n    this.room = room\n    this.room.network.on(StarMeshNetworkEvents.STATE_CHANGE, ({ state }) => {\n      this.emit(GameEvent.UPDATE_GAME_STATE, { data: state?.game })\n    })\n  }\n\n  public start (): void {\n    // this.gameWorld.resetWorld()\n  }\n\n  public stop (payload: unknown): void {\n    this.emit(GameEvent.GAME_OVER, { data: payload })\n    // this.gameWorld.dispose()\n  }\n\n  public async click (x: number, y: number): Promise<void> {\n    return await this.dispatch({\n      action: GameActions.CLICK,\n      payload: [x, y]\n    }).catch(this.errorHandler)\n  }\n\n  public dispatch = async (action: StarMeshAction): Promise<void> => {\n    await this.room.network.dispatch({\n      action: RoomActionTypes.GAME_EVENT,\n      payload: action\n    })\n  }\n\n  public errorHandler = (e: Error): void => {\n    console.log(e)\n  }\n\n  public reducer: StarMeshReducer<GameState> = (prevState, { action, payload }, connId) => {\n    const pid = this.room.pi(connId)\n    switch (action) {\n      case GameActions.CLICK: {\n        const [x, y] = payload as Coords\n        if (prevState.board[x][y] === null && prevState.turn === pid) {\n          prevState.board[x][y] = pid === 0 ? 'O' : 'X'\n          prevState.turn = 1 - prevState.turn\n          if (x === 0 && y === 0) {\n            this.room.endGame(connId).catch(this.errorHandler)\n            // this.emit(GameEvent.GAME_OVER, { data: connId })\n          }\n          return { ...prevState }\n        } else {\n          throw new Error('invalid move')\n        }\n      }\n    }\n    return prevState\n  }\n}\n","import { ConnectionManager } from './ConnectionManager'\nimport { Observable } from './Observable'\nimport { Game, GameState } from '../Game/Game'\nimport { StarMeshEventPayload, StarMeshNetwork, StarMeshNetworkEvents, StarMeshReducer } from './StarMeshNetwork'\nimport cloneDeep from 'lodash.clonedeep'\nimport { pause } from './pause'\n\nconst CH = 'ABCDEFGHJKLMNOPQRSTUVWXYZ'\n\nconst generateRoomCode = (): string => {\n  return [0, 0, 0, 0].map(() => CH[Math.floor(Math.random() * CH.length)]).join('')\n}\n\nexport enum RoomActionTypes {\n  JOIN,\n  LEAVE,\n  RENAME,\n  START_GAME,\n  END_GAME,\n  GAME_EVENT,\n}\n\nexport enum RoomEvents {\n  SET_PLAYERS,\n  SET_HOST,\n  START_GAME,\n  ERROR,\n  END_GAME,\n}\n\nexport interface RoomEventPayload {\n  data: unknown\n}\n\nexport interface PlayersDict {\n  [id: string]: string\n}\n\ninterface RoomState {\n  players: PlayersDict\n  minPlayers: number\n  maxPlayers: number\n  game?: GameState\n  idDict?: PlayersDict\n  nameDict?: PlayersDict\n}\n\nexport class Room extends Observable<typeof RoomEvents, RoomEventPayload> {\n  network: StarMeshNetwork<RoomState>\n  manager: ConnectionManager\n  game: Game\n\n  public get hostPlayerId (): string | undefined {\n    return this.network.hostId\n  }\n\n  public get roomCode (): string | undefined {\n    return this.network.networkName\n  }\n\n  public get myId (): string {\n    return this.network.id\n  }\n\n  public get players (): PlayersDict {\n    return this.network.state.players\n  }\n\n  public get playerIds (): string[] {\n    return Object.keys(this.players)\n  }\n\n  /**\n   * given peerjs id return in game player id or\n   * given in game player id return peerjs id\n   * @param id\n   */\n  public p (id: string | number): string {\n    if (this.network.state.idDict === undefined) {\n      console.trace('Game not started yet')\n      throw new Error('Game not started yet')\n    }\n    return this.network.state.idDict[id]\n  }\n\n  /**\n   * given conn id return in game player id in integer\n   * @param id\n   */\n  public pi (id: string): number {\n    if (this.network.state.idDict === undefined) {\n      console.trace('Game not started yet')\n      throw new Error('Game not started yet')\n    }\n    return Number.parseInt(this.network.state.idDict[id])\n  }\n\n  /**\n   *  given name, return in game player id\n   * @param name\n   */\n  public n (name: string): string {\n    if (this.network.state.nameDict === undefined) {\n      console.trace('Game not started yet')\n      throw new Error('Game not started yet')\n    }\n    return this.network.state.nameDict[name]\n  }\n\n  public get started (): boolean {\n    return this.network.state.game !== undefined && this.network.state.game.gameOver === undefined\n  }\n\n  constructor (manager?: ConnectionManager) {\n    super()\n    this.manager = manager ?? new ConnectionManager()\n    this.network = new StarMeshNetwork<RoomState>(this.manager, {\n      maxPlayers: 4,\n      minPlayers: 2,\n      players: {}\n    }, this.networkReducer)\n    this.network.on(StarMeshNetworkEvents.MEMBERS_LEFT, ({ members }) => {\n      if (members !== undefined) {\n        members.forEach(id => {\n          this.network.dispatchLocal({\n            action: RoomActionTypes.LEAVE,\n            payload: id\n          }).catch(this.errorHandler)\n        })\n      }\n    })\n    this.network.on(StarMeshNetworkEvents.HOST_CHANGE, ({ host }) => {\n      if (host !== undefined) {\n        this.emit(RoomEvents.SET_HOST, { data: host })\n      }\n    })\n    this.game = new Game(this)\n  }\n\n  public create = async (myName: string, roomCode?: string): Promise<string> => {\n    const code = roomCode === undefined || roomCode === '' ? generateRoomCode() : roomCode\n    await this.join(myName, code)\n    return code\n  }\n\n  public join = async (myName: string, roomCode: string): Promise<void> => {\n    await this.network.joinOrHost(roomCode)\n    while (true) {\n      try {\n        this.manager.conn(ConnectionManager.prefixId(roomCode))\n        break\n      } catch (e) {\n        await pause(100)\n      }\n    }\n    await this.network.dispatch({\n      action: RoomActionTypes.JOIN,\n      payload: myName\n    }).catch(e => {\n      this.leaveRoom()\n      throw e\n    })\n  }\n\n  public joinOrCreate = this.join\n\n  private readonly errorHandler = ({ error }: StarMeshEventPayload<RoomState>): void => {\n    console.log(error)\n    this.emit(RoomEvents.ERROR, { data: error })\n  }\n\n  public rename = async (name: string): Promise<void> => {\n    return await this.network.dispatch({\n      action: RoomActionTypes.RENAME,\n      payload: name\n    })\n  }\n\n  public leaveRoom = (): void => {\n    this.network.leave()\n    this.emit(RoomEvents.SET_HOST, { data: undefined })\n  }\n\n  public startGame = async (): Promise<void> => {\n    const idDict: PlayersDict = {}\n    const nameDict: PlayersDict = {}\n    Object.entries(this.players).forEach(([id, name], k) => {\n      idDict[id] = k.toString()\n      idDict[k] = id\n      nameDict[name] = k.toString()\n    })\n    return await this.network.dispatch({\n      action: RoomActionTypes.START_GAME,\n      payload: {\n        idDict,\n        nameDict\n      }\n    })\n  }\n\n  public endGame = async (message: string): Promise<void> => {\n    return await this.network.dispatch({\n      action: RoomActionTypes.END_GAME,\n      payload: message\n    })\n  }\n\n  private readonly networkReducer: StarMeshReducer<RoomState> = (prevState, { action, payload }, connId) => {\n    const setName = (): void => {\n      if (typeof payload !== 'string') throw new Error('Invalid payload')\n      if (this.started) {\n        if (this.n(payload) === undefined) {\n          throw new Error(`Room '${this.roomCode ?? ''}' has started game`)\n        } else if (prevState.idDict !== undefined && prevState.nameDict !== undefined) {\n          const pid = this.n(payload)\n          prevState.idDict[connId] = pid\n          prevState.idDict[pid] = connId\n          prevState.nameDict[payload] = pid\n        }\n      }\n      if (Object.values(prevState.players).includes(payload)) {\n        throw new Error(`Name '${payload}' already taken`)\n      }\n      prevState.players = { ...prevState.players, [connId]: payload }\n      this.emit(RoomEvents.SET_PLAYERS, {\n        data: {\n          ...prevState.players\n        }\n      })\n    }\n    switch (action) {\n      case RoomActionTypes.JOIN:\n        if (Object.keys(prevState.players).length + 1 > prevState.maxPlayers) {\n          throw new Error(`Room '${this.roomCode ?? ''}' is already full`)\n        }\n        setName()\n        return { ...prevState }\n      case RoomActionTypes.RENAME:\n        setName()\n        return { ...prevState }\n      case RoomActionTypes.LEAVE: {\n        const { [payload as string]: u, ...players } = this.players\n        prevState.players = players\n        this.emit(RoomEvents.SET_PLAYERS, {\n          data: {\n            ...prevState.players\n          }\n        })\n        return { ...prevState }\n      }\n      case RoomActionTypes.START_GAME: {\n        if (this.playerIds.length < this.network.state.minPlayers) {\n          throw new Error('Not enough players, required 2')\n        }\n        const typed = payload as { idDict: PlayersDict, nameDict: PlayersDict }\n        prevState.idDict = cloneDeep(typed.idDict)\n        prevState.nameDict = cloneDeep(typed.nameDict)\n        prevState.game = Game.initialState\n        this.game?.start()\n        this.emit(RoomEvents.START_GAME, { data: this.game })\n        return { ...prevState }\n      }\n      case RoomActionTypes.END_GAME: {\n        prevState.idDict = undefined\n        prevState.nameDict = undefined\n        if (prevState.game !== undefined) {\n          prevState.game.gameOver = payload as string\n        }\n        this.game.stop(payload)\n        this.emit(RoomEvents.END_GAME, { data: payload })\n        return { ...prevState }\n      }\n      case RoomActionTypes.GAME_EVENT: {\n        if (this.started && prevState.game !== undefined) {\n          if (prevState.game.gameOver !== undefined) {\n            throw new Error('Game over')\n          }\n          prevState.game = this.game?.reducer(prevState.game, payload as Record<string, unknown>, connId)\n          return { ...prevState }\n        } else {\n          throw new Error('Game not started')\n        }\n      }\n    }\n    return prevState\n  }\n}\n","import { createContext, useContext } from 'react'\nimport { Room } from './Room'\n\nexport const globalRoom = new Room()\nexport const RoomContext = createContext(globalRoom)\nexport const useRoom = (): Room => useContext(RoomContext)\n","import { transparentize } from 'polished'\nimport { mapObjIndexed } from 'ramda'\n\nexport const makeFade = transparentize(0.6)\n\nexport const vibrantColors = {\n  blue: '#3976E9',\n  red: '#E4456F',\n  green: '#2AC87D',\n  yellow: '#E99608',\n  gray: '#9CC6E9'\n}\n\nexport const dullColors = {\n  blue: '#4168AE',\n  red: '#925666',\n  green: '#569276',\n  yellow: '#D49E41',\n  gray: '#8E959B'\n}\n\nexport const paleColors = {\n  blue: '#7ea6f1',\n  red: '#ed86a1',\n  green: '#74dbaa',\n  yellow: '#f1bb5e',\n  gray: '#bfdaf1'\n}\n\nexport const baseColors = {\n  ...vibrantColors,\n  vibrantHighlights: mapObjIndexed(makeFade, vibrantColors),\n  dark: ['#282c30', '#383e43', '#484f56'],\n  light: ['#E0E3E5', '#c0c2c4', '#a0a1a3'],\n  white: ['#f9fbfc', '#f0f2f3', '#e8ebec']\n}\n\nexport const colors = {\n  ...baseColors,\n  primary: baseColors.blue,\n  accent: baseColors.yellow,\n  inputFocus: transparentize(0.2, baseColors.blue)\n}\n\nexport const light = {\n  ...colors,\n  blue: [colors.blue, dullColors.blue],\n  red: [colors.red, dullColors.red],\n  green: [colors.green, dullColors.green],\n  yellow: [colors.yellow, dullColors.yellow],\n  fgHighlights: mapObjIndexed(makeFade, dullColors),\n  bgHighlights: mapObjIndexed(makeFade, paleColors),\n  gray: [colors.gray, dullColors.gray],\n  text: colors.dark[0],\n  muted: makeFade(colors.dark[0]),\n  background: colors.white[0],\n  bgs: colors.white,\n  fgs: colors.dark,\n  fgPales: colors.dark.map(makeFade),\n  border: transparentize(0.8, baseColors.dark[0]),\n  highlight: transparentize(0.9, baseColors.dark[0]),\n  code: {\n    color: '#0451a5',\n    backgroundColor: '#ffffff',\n    prolog: '#001080',\n    comment: '#008000',\n    keyword: '#0000FF',\n    number: '#09885a',\n    constant: '#0000ff',\n    variable: '#001080',\n    string: '#a31515',\n    selector: '#800000',\n    tag: '#800000',\n    operator: '#000000',\n    punctuation: '#000000',\n    function: '#795e26',\n    className: '#267f99',\n    char: '#a31515'\n  }\n}\n\nexport const dark = {\n  ...colors,\n  blue: [colors.blue, paleColors.blue],\n  red: [colors.red, paleColors.red],\n  green: [colors.green, paleColors.green],\n  yellow: [colors.yellow, paleColors.yellow],\n  gray: [colors.gray, paleColors.gray],\n  fgHighlights: mapObjIndexed(makeFade, paleColors),\n  bgHighlights: mapObjIndexed(makeFade, dullColors),\n  text: colors.light[0],\n  muted: makeFade(colors.light[0]),\n  background: colors.dark[0],\n  bgs: colors.dark,\n  fgs: colors.light,\n  fgPales: colors.light.map(makeFade),\n  border: transparentize(0.8, baseColors.light[0]),\n  highlight: transparentize(0.9, baseColors.light[0]),\n  code: {\n    color: '#9CDCFE',\n    backgroundColor: '#1E1E1E',\n    prolog: '#9cdcfe',\n    comment: 'rgb(106, 153, 85)',\n    keyword: 'rgb(86, 156, 214)',\n    number: 'rgb(181, 206, 168)',\n    constant: 'rgb(100, 102, 149)',\n    variable: 'rgb(156, 220, 254)',\n    string: 'rgb(206, 145, 120)',\n    selector: 'rgb(215, 186, 125)',\n    tag: 'rgb(86, 156, 214)',\n    operator: '#808080',\n    punctuation: 'rgb(212, 212, 212)',\n    function: 'rgb(220, 220, 170)',\n    className: 'rgb(78, 201, 176)',\n    char: 'rgb(209, 105, 105)'\n  }\n}\n","export const SLOW = 0.3\nexport const FAST = 0.1\n\nexport const transition = (time, props, ease = 'ease') => ({\n  transition: props.map(p => `${time}s ${p} ${ease}`).join(',')\n})\n\nexport const shortTransition = (props) => transition(FAST, props)\n","export const inputPadding = {\n  px: 3,\n  py: 2\n}\n\nexport const mdInputPadding = {\n  px: 2,\n  py: 2\n}\n\nexport const smInputPadding = {\n  px: 1,\n  py: 1\n}\n","import { shortTransition } from '../transitions'\n\nexport const baseInput = {\n  borderRadius: 1,\n  border: '1px solid',\n  borderColor: 'border',\n  ...shortTransition(['box-shadow']),\n  boxShadow: '0 0 0 0 transparent',\n  ':focus, &.focus': {\n    boxShadow: theme => `0 0 0 3px ${theme.colors.inputFocus}`,\n    borderColor: 'unset'\n  },\n  lineHeight: 'input',\n  backgroundColor: 'transparent',\n  color: 'text',\n  fontFamily: 'body',\n  fontWeight: 'body',\n  fontSize: 1\n}\n","import { shortTransition } from './transitions'\nimport { inputPadding, mdInputPadding, smInputPadding } from './inputs/inputPadding'\nimport { baseInput } from './inputs/baseInput'\n\nexport const baseButton = {\n  ...baseInput,\n  ...inputPadding,\n  ...shortTransition(['background-color']),\n  display: 'inline-flex',\n  alignItems: 'center',\n  textAlign: 'unset',\n  outline: 'none',\n  '::-moz-focus-inner': {\n    border: 'none'\n  }\n}\n\nexport const pillButton = {\n  borderRadius: 4\n}\n\nexport const smButton = {\n  ...baseButton,\n  ...smInputPadding\n}\n\nexport const mdButton = {\n  ...baseButton,\n  ...mdInputPadding\n}\n\nexport const borderlessButton = {\n  ...baseButton,\n  border: 0\n}\n\nexport const borderlessSmButton = {\n  ...smButton,\n  border: 0\n}\n\nexport const borderlessMdButton = {\n  ...mdButton,\n  border: 0\n}\n\nconst buttonStyles = {\n  '': baseButton,\n  '-sm': smButton,\n  '-md': mdButton,\n  '-borderless': borderlessButton,\n  '-borderless-sm': borderlessSmButton,\n  '-borderless-md': borderlessMdButton,\n  '-pill': { ...baseButton, ...pillButton, px: 5 },\n  '-pill-sm': { ...smButton, ...pillButton, px: 3 },\n  '-pill-md': { ...mdButton, ...pillButton, px: 4 }\n}\n\nconst buttonColors = {\n  normal: {\n    fg: 'text',\n    bg: 'background',\n    hoverBg: 'highlight'\n  },\n  primary: {\n    fg: 'white.0',\n    bg: 'blue.0',\n    hoverBg: 'blue.1'\n  },\n  success: {\n    fg: 'white.0',\n    bg: 'blue.0',\n    hoverBg: 'blue.1'\n  },\n  warning: {\n    fg: 'dark.0',\n    bg: 'yellow.0',\n    hoverBg: 'yellow.1'\n  },\n  danger: {\n    fg: 'white.0',\n    bg: 'red.0',\n    hoverBg: 'red.1'\n  },\n  red: {\n    fg: 'white.0',\n    bg: 'red.0',\n    hoverBg: 'red.1'\n  },\n  active: {\n    fg: 'white.0',\n    bg: 'blue.0'\n  },\n  transparent: {\n    fg: 'fgs.0',\n    bg: 'transparent',\n    hoverBg: 'highlight',\n    border: 0\n  }\n}\n\nconst buttons = {}\n\nfor (const styleName in buttonStyles) {\n  for (const colorName in buttonColors) {\n    buttons[colorName + styleName] = {\n      ...buttonStyles[styleName],\n      backgroundColor: buttonColors[colorName].bg,\n      color: buttonColors[colorName].fg,\n      '*': {\n        fill: buttonColors[colorName].fg\n      },\n      ':hover': {\n        backgroundColor: buttonColors[colorName].hoverBg\n      },\n      '&:disabled': {\n        backgroundColor: 'light.0',\n        color: 'light.1'\n      }\n    }\n  }\n}\n\nexport default buttons\n","import { inputPadding } from './inputPadding'\nimport { baseInput } from './baseInput'\n\nexport default {\n  ...baseInput,\n  ...inputPadding\n}\n","import { shortTransition } from '../transitions'\nimport { inputPadding } from './inputPadding'\n\nexport const placeholder = {\n  '::placeholder': {\n    color: 'transparent'\n  }\n}\n\nexport const fakePlaceholder = {\n  position: 'absolute',\n  top: '12px',\n  pt: '1px',\n  left: inputPadding.px,\n  pointerEvents: 'none',\n  ml: -1,\n  px: 1,\n  fontSize: 1,\n  borderRadius: 1,\n  color: 'fgs.1',\n  ...shortTransition(['top', 'font-size', 'color', 'background-color'])\n}\n\nexport const fakePlaceholderPull = {\n  backgroundColor: 'background',\n  fontSize: 0,\n  top: '-10px'\n}\n\nexport const fakePlaceholderFocus = {\n  color: 'blue'\n}\n\nexport default {\n  ...placeholder,\n  '+ *': {\n    ...fakePlaceholder\n  },\n  ':not(:placeholder-shown) + *': {\n    ...fakePlaceholderPull\n  },\n  ':focus + *': {\n    ...fakePlaceholderPull,\n    ...fakePlaceholderFocus\n  }\n}\n","import inputMagic from './inputMagic'\nimport normal from './normal'\nimport baseMagic from './baseMagic'\n\nexport default {\n  normal,\n  baseMagic,\n  inputMagic\n}\n","import normal from './normal'\nimport baseMagic from './baseMagic'\n\nexport default {\n  ...normal,\n  ...baseMagic\n}\n","import { inputPadding } from './inputs/inputPadding'\n\nexport default {\n  ...inputPadding,\n  color: 'text',\n  display: 'block',\n  ':hover': {\n    backgroundColor: 'highlight'\n  }\n}\n","import { baseInput } from './inputs/baseInput'\n\nexport default {\n  ...baseInput,\n  boxShadow: 2,\n  backgroundColor: 'bgs.1',\n  lineHeight: 1.8,\n  overflow: 'hidden',\n  zIndex: 1\n}\n","const pageHeadingSizes = [4, 5, 6]\nconst pageHeadingIconSizes = pageHeadingSizes.map(x => theme => theme.fontSizes[x])\n\nexport default {\n  fontSize: 1,\n  success: {\n    color: 'green.1'\n  },\n  danger: {\n    color: 'red.1'\n  },\n  warning: {\n    color: 'yellow.1'\n  },\n  heading: {\n    fontSize: [3, 4],\n    mb: 3\n  },\n  subheading: {\n    textTransform: 'uppercase',\n    letterSpacing: '2px',\n    fontWeight: 'bold',\n    fontSize: 2,\n    color: 'fgPales.0',\n    mb: 3\n  },\n  pageHeading: {\n    fontSize: pageHeadingSizes,\n    mb: 3,\n    svg: {\n      color: '#ff0000',\n      width: pageHeadingIconSizes,\n      height: pageHeadingIconSizes\n    }\n  },\n  largeHeading: {\n    fontSize: [5, null, 7],\n    mb: 3\n  },\n  columnHeading: {\n    fontSize: 2,\n    fontWeight: 'bold'\n  },\n  columnCardHeading: {\n    fontSize: 2,\n    fontWeight: 'bold'\n  },\n  helperText: {\n    fontSize: 0,\n    color: 'muted'\n  }\n}\n","import { colors } from './colors'\nimport { transparentize } from 'polished'\n\nexport const baseWell = {\n  p: 3,\n  px: 3,\n  py: 3,\n  my: 3,\n  borderRadius: 1,\n  borderWidth: 1,\n  borderStyle: 'solid',\n  borderColor: 'border'\n}\n\nexport default {\n  normal: {\n    ...baseWell\n  },\n  dashed: {\n    ...baseWell,\n    borderStyle: 'dashed'\n  },\n  primary: {\n    ...baseWell,\n    borderColor: 'blue.1'\n  },\n  danger: {\n    ...baseWell,\n    borderColor: 'red.1',\n    backgroundColor: transparentize(0.7, colors.red)\n  },\n  warning: {\n    ...baseWell,\n    borderColor: 'yellow.1'\n  },\n  success: {\n    ...baseWell,\n    borderColor: 'green.1',\n    backgroundColor: transparentize(0.7, colors.green)\n  }\n}\n","const baseMessage = {\n  borderRadius: 1\n}\n\nconst messageStyle = (borderColor, fillColor) => ({\n  ...baseMessage,\n  borderColor: borderColor,\n  color: fillColor,\n  '*': {\n    fill: fillColor\n  }\n})\n\nexport default {\n  primary: messageStyle('blue.0', 'blue.1'),\n  info: messageStyle('gray.0', 'gray.1'),\n  danger: messageStyle('red.0', 'red.1'),\n  warning: messageStyle('yellow.0', 'yellow.1'),\n  success: messageStyle('green.0', 'green.1')\n}\n","import { colors, dark, light } from './colors'\nimport code from './code'\nimport buttons from './buttons'\nimport inputs from './inputs'\nimport menuItem from './menuItem'\nimport links from './links'\nimport dropdown from './dropdown'\nimport styles from './styles'\nimport text from './text'\nimport wells from './wells'\nimport messages from './messages'\nimport badges from './badges'\n\nexport default {\n  useColorSchemeMediaQuery: true,\n  colors: {\n    ...light,\n    modes: {\n      dark\n    }\n  },\n  bg: {\n    success: colors.green[0],\n    danger: colors.red[0],\n    warning: colors.yellow[0]\n  },\n  text,\n  breakpoints: ['40em', '52em', '64em', '110em'],\n  space: [\n    0,\n    4,\n    8,\n    16,\n    32,\n    64,\n    128,\n    256,\n    512\n  ],\n  fonts: {\n    body: 'Arial',\n    heading: 'inherit',\n    monospace: 'Inconsolata, monospace'\n  },\n  fontSizes: [\n    12,\n    14,\n    16,\n    20,\n    24,\n    32,\n    48,\n    64,\n    96\n  ],\n  fontWeights: {\n    body: 400,\n    heading: 300,\n    bold: 700\n  },\n  lineHeights: {\n    body: 1.5,\n    heading: 1.3,\n    input: 1.7\n  },\n  radii: [0, 4, 8, 16, 32],\n  shadows: [\n    null,\n    '0 2px 4px rgba(0, 0, 0, 0.2)',\n    '0 4px 8px rgba(0, 0, 0, 0.3)'\n  ],\n  layout: {\n    container: {\n      maxWidth: '100em',\n      p: [3, null, 4]\n    },\n    sidebar: {\n      width: '250px'\n    }\n  },\n  buttons,\n  inputs,\n  badges,\n  messages,\n  code,\n  menuItem,\n  links,\n  dropdown,\n  wells,\n  styles\n}\n","export default {\n  primary: {\n    backgroundColor: 'blue.0',\n    color: 'white.0',\n    '*': {\n      fill: 'white.0'\n    }\n  },\n  success: {\n    backgroundColor: 'green.0',\n    color: 'white.0',\n    '*': {\n      fill: 'white.0'\n    }\n  },\n  danger: {\n    backgroundColor: 'red.0',\n    color: 'white.0',\n    '*': {\n      fill: 'white.0'\n    }\n  },\n  warning: {\n    backgroundColor: 'yellow.0',\n    color: 'dark.0',\n    '*': {\n      fill: 'dark.0'\n    }\n  }\n}\n","export default {\n  fontFamily: 'monospace',\n  fontSize: 'inherit',\n  color: 'code.color',\n  backgroundColor: 'code.backgroundColor',\n  borderRadius: 1,\n  borderWidth: '1px',\n  borderStyle: 'solid',\n  borderColor: 'border',\n  p: 3,\n  tabSize: 4,\n  MozTabSize: '4',\n  '.token-line': {\n    display: 'flex'\n  },\n  '.token': {\n    display: 'inline-block',\n    lineHeight: 1.5\n  },\n  '.prolog': {\n    color: 'code.prolog'\n  },\n  '.comment': {\n    color: 'code.comment'\n  },\n  '.builtin,.changed,.keyword': {\n    color: 'code.keyword'\n  },\n  '.number': {\n    color: 'code.number'\n  },\n  '.constant': {\n    color: 'code.constant'\n  },\n  '.attr-name,.variable': {\n    color: 'code.variable'\n  },\n  '.string,.attr-value': {\n    color: 'code.string'\n  },\n  '.selector': {\n    color: 'code.selector'\n  },\n  '.tag': {\n    color: 'code.tag'\n  },\n  '.punctuation,.operator': {\n    color: 'code.operator'\n  },\n  '.punctuation, .plain': {\n    color: 'code.punctuation'\n  },\n  '.function': {\n    color: 'code.function'\n  },\n  '.class-name': {\n    color: 'code.className'\n  },\n  '.char': {\n    color: 'code.char'\n  },\n  '.inserted': {\n    backgroundColor: 'fgHighlights.green'\n  },\n  '.deleted': {\n    backgroundColor: 'fgHighlights.red'\n  },\n  '.special': {\n    color: 'red.0'\n  },\n  '.tab': {\n    position: 'relative',\n    '::before': {\n      position: 'absolute',\n      left: '1px',\n      top: 'calc(50% - 0.5px)',\n      content: '\"\"',\n      width: 'calc(100% - 3.5px)',\n      borderTopWidth: '1px',\n      borderTopStyle: 'solid',\n      borderTopColor: 'red.0'\n    },\n    '::after': {\n      position: 'absolute',\n      right: '1px',\n      top: 0,\n      content: '\">\"',\n      color: 'red.0'\n    }\n  }\n}\n","export default {\n  default: {\n    color: 'blue.1',\n    '*': {\n      fill: 'blue.1'\n    },\n    ':hover': {\n      color: 'blue.0',\n      '*': {\n        fill: 'blue.0'\n      }\n    }\n  },\n  plain: {\n    color: 'gray.1',\n    '*': {\n      fill: 'gray.1'\n    },\n    ':hover': {\n      color: 'gray.0',\n      '*': {\n        fill: 'gray.0'\n      }\n    }\n  },\n  active: {\n    color: 'yellow.1',\n    '*': {\n      fill: 'yellow.1'\n    },\n    ':hover': {\n      color: 'yellow.0',\n      '*': {\n        fill: 'yellow.0'\n      }\n    }\n  }\n}\n","export default {\n  root: {\n    fontFamily: 'body',\n    fontWeight: 'body',\n    lineHeight: 'body'\n  },\n  '*': {\n    boxSizing: 'border-box'\n  },\n  body: {\n    margin: 0\n  },\n  h1: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 5\n  },\n  h2: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 4\n  },\n  h3: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 3\n  },\n  h4: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 2\n  },\n  h5: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 1\n  },\n  h6: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 0\n  },\n  p: {\n    color: 'text',\n    fontFamily: 'body',\n    fontWeight: 'body',\n    lineHeight: 'body'\n  },\n  a: {\n    textDecoration: 'none',\n    outline: 'none',\n    '::-moz-focus-inner': {\n      border: 'none'\n    }\n  },\n  pre: {\n    fontFamily: 'monospace',\n    overflowX: 'auto',\n    code: {\n      color: 'inherit'\n    }\n  },\n  table: {\n    width: '100%',\n    borderCollapse: 'separate',\n    borderSpacing: 0\n  },\n  th: {\n    textAlign: 'left',\n    borderBottomStyle: 'solid'\n  },\n  td: {\n    textAlign: 'left',\n    borderBottomStyle: 'solid'\n  },\n  img: {\n    maxWidth: '100%'\n  },\n  hr: {\n    borderTop: '1px solid',\n    borderBottom: 'none',\n    borderColor: 'border'\n  }\n}\n","/**\n * Guard against null and undefined\n * @param x\n */\nexport const isDefined = <T> (x: T | null | undefined): x is T => x !== undefined && x !== null\n\n/**\n * Use default value if null or undefined\n * @param x\n * @param defaultValue\n */\nexport const defaultValue = <T> (x: T | null | undefined, defaultValue: T): T => isDefined(x) ? x : defaultValue\n\nexport const useOrFallback = <T, U> (x: T | null | undefined, dependent: (x: T) => U, defaultValue: U): U =>\n  isDefined(x) ? dependent(x) : defaultValue\n\nexport const show = <T, U> (x: T | null | undefined, content: (x: T) => U): U | null => isDefined(x) ? content(x) : null\n","/** @jsx jsx */\nimport { ButtonProps, jsx } from 'theme-ui'\nimport { Button as ThemeUIButton } from '@theme-ui/components'\nimport PropTypes from 'prop-types'\nimport { forwardRef, FunctionComponent } from 'react'\nimport { isDefined } from '../../utils/componentHelpers'\n\nconst buttonProps = {\n  block: PropTypes.bool\n}\n\ntype MyButtonProps = PropTypes.InferProps<typeof buttonProps>\n\nconst Button: FunctionComponent<MyButtonProps & ButtonProps> = forwardRef<HTMLButtonElement, MyButtonProps & ButtonProps>((props, ref) => (\n  <ThemeUIButton\n    ref={ref}\n    variant='normal'\n    sx={{\n      display: isDefined(props.block) && props.block ? 'flex' : undefined,\n      width: isDefined(props.block) && props.block ? '100%' : undefined,\n      justifyContent: isDefined(props.block) && props.block ? 'center' : undefined,\n      position: 'relative'\n    }}\n    {...props}\n  />\n))\n\nButton.propTypes = buttonProps\n\nButton.defaultProps = {\n  block: false\n}\n\nButton.displayName = 'Button'\n\nexport default Button\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport MdiIcon from '@mdi/react'\nimport PropTypes from 'prop-types'\n\nconst Icon = (props) => {\n  const fontSizes = Array.isArray(props.size) ? props.size : [props.size]\n  const sizes = fontSizes.map(x => theme => theme.fontSizes[x] * theme.lineHeights.body)\n\n  return (\n    <MdiIcon\n      {...{ ...props, color: null, size: null }}\n      sx={{\n        fill: props.color,\n        height: sizes,\n        width: sizes,\n        ...props?.sx\n      }}\n    />\n  )\n}\n\nIcon.propTypes = {\n  path: PropTypes.string.isRequired,\n  color: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.func\n  ]),\n  size: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.arrayOf(PropTypes.number)\n  ]),\n  sx: PropTypes.object\n}\n\nIcon.defaultProps = {\n  color: 'text',\n  size: 1\n}\n\nexport default Icon\n","/** @jsx jsx */\nimport { mdiCircleSlice4 } from '@mdi/js'\nimport { Flex } from '@theme-ui/components'\nimport { jsx, useColorMode } from 'theme-ui'\nimport theme from '../theme'\nimport Button from './common/Button'\nimport Icon from './common/Icon'\nimport { FunctionComponent } from 'react'\nimport PropTypes from 'prop-types'\n\nconst propTypes = {\n  setState: PropTypes.func.isRequired,\n  state: PropTypes.number.isRequired\n}\n\nconst NavBar: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ state, setState }) => {\n  const [colorMode, setColorMode] = useColorMode()\n  const toggleDarkMode = (): void => setColorMode(colorMode === 'default' ? 'dark' : 'default')\n\n  return (\n    <Flex py={2} px={theme.layout.container.p} sx={{ alignItems: 'center', position: 'fixed', width: '100%' }}>\n      <Flex mr={2} sx={{ alignItems: 'center', flex: 1 }}>\n        {/* {state > 0 && <Button onClick={() => setState(state - 1)}><Icon path={mdiArrowLeft}/></Button>} */}\n      </Flex>\n      <Flex ml='auto' sx={{ alignItems: 'center' }}>\n        <Button onClick={toggleDarkMode} mr={2} title='Toggle Dark Mode'><Icon path={mdiCircleSlice4}/></Button>\n      </Flex>\n    </Flex>\n  )\n}\nexport default NavBar\n\nNavBar.propTypes = propTypes\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport { Box } from '@theme-ui/components'\n\nconst BasicInput = props => <Box as='input' __themeKey='inputs' variant='normal' {...props}/>\n\nexport default BasicInput\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Button from './Button'\nimport Icon from './Icon'\n\nconst IconButton = (props) => {\n  return <Button\n    variant={props.variant || 'normal-sm'}\n    type='button'\n    sx={{\n      ...props.sx,\n      visibility: props.hidden === undefined || props.hidden === null || !props.hidden ? 'unset' : 'hidden',\n      overflow: 'hidden'\n    }}\n    onClick={props.onClick}>\n    <Icon path={props.path} sx={props.iconSx} color={props.color} size={props.size}/>\n  </Button>\n}\n\nIconButton.propTypes = {\n  variant: PropTypes.string,\n  sx: PropTypes.object,\n  iconSx: PropTypes.object,\n  path: PropTypes.node,\n  onClick: PropTypes.func,\n  hidden: PropTypes.bool,\n  color: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.func\n  ]),\n  size: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.arrayOf(PropTypes.number)\n  ])\n}\n\nexport default IconButton\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport { Box, Label, Text } from '@theme-ui/components'\nimport PropTypes from 'prop-types'\nimport BasicInput from './BasicInput'\nimport { FunctionComponent } from 'react'\nimport IconButton from './IconButton'\nimport { mdiClose } from '@mdi/js'\n\nconst propTypes = {\n  fullwidth: PropTypes.bool,\n  label: PropTypes.string.isRequired,\n  sx: PropTypes.object,\n  helperText: PropTypes.string,\n  disabled: PropTypes.bool,\n  onClearClick: PropTypes.func,\n  onChange: PropTypes.func,\n  value: PropTypes.string\n}\n\nconst Input: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ onClearClick, ...props }) => (\n  <Box mt={3} sx={{ width: props.fullwidth ?? false ? '100%' : undefined, ...props.sx }}>\n    <Label\n      sx={{\n        position: 'relative'\n      }}>\n      <BasicInput\n        {...props}\n        placeholder={props.label}\n        variant='inputMagic'\n        sx={{ width: props.fullwidth ?? false ? '100%' : undefined, ...props.sx }}\n      />\n      <Text>{props.label}</Text>\n      {!(props.disabled ?? false) && onClearClick !== undefined\n        ? <Box sx={{ position: 'absolute', right: 1, top: '50%', transform: 'translateY(-50%)' }}>\n          <IconButton variant='transparent-borderless-sm' path={mdiClose} onClick={onClearClick}/>\n        </Box> : null}\n    </Label>\n    <Text variant='helperText'>\n      {props.helperText}\n    </Text>\n  </Box>\n)\n\nInput.propTypes = propTypes\n\nexport default Input\n","import React, { forwardRef, FunctionComponent } from 'react'\nimport { Box, BoxOwnProps } from '@theme-ui/components'\n\nconst Well: FunctionComponent<BoxOwnProps> = forwardRef<HTMLDivElement, BoxOwnProps>((props, ref) => (\n  <Box\n    ref={ref}\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    __themeKey='wells'\n    variant='normal'\n    {...props}\n  />\n))\n\nWell.displayName = 'Well'\n\nexport default Well\n","import React, { FunctionComponent } from 'react'\nimport { Box } from '@theme-ui/components'\n\nexport const Card: FunctionComponent = (props) => (\n  <Box\n    sx={{\n      py: 4, px: 5, backgroundColor: 'background', boxShadow: 2, borderRadius: 3\n    }}\n    {...props}\n  />\n)\n","import React, { FunctionComponent, useState } from 'react'\nimport { Flex, Heading, Text } from '@theme-ui/components'\nimport Input from './common/Input'\nimport PropTypes from 'prop-types'\nimport Button from './common/Button'\nimport Well from './common/Well'\nimport { useRoom } from '../lib/RoomContext'\nimport { AppState } from './App'\nimport { Card } from './common/Card'\n\nconst propTypes = {\n  setState: PropTypes.func.isRequired\n}\n\nexport const Home: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ setState }) => {\n  const room = useRoom()\n  const [name, setName] = useState('')\n  const [roomCode, setRoomCode] = useState(/^\\/(.*)$/.exec(window.location.pathname.replace(process.env.PUBLIC_URL, ''))?.[1] ?? '')\n  const [error, setError] = useState('')\n  const [message, setMessage] = useState('')\n  const [loading, setLoading] = useState(false)\n  const createRoom = (): void => {\n    setMessage('Creating Room...')\n    setLoading(true)\n    room.create(name, roomCode)\n      .then(() => {\n        setError('')\n        setState(AppState.ROOM)\n      })\n      .catch((e: { type: string }) => {\n        if (e.type === 'unavailable-id') {\n          setError(`Room ${roomCode} already exists`)\n        } else {\n          setError('Error when creating room')\n        }\n        console.error(e)\n      })\n      .finally(() => {\n        setMessage('')\n        setLoading(false)\n      })\n  }\n  const joinRoom = (): void => {\n    setMessage('Joining Room...')\n    setLoading(true)\n    room.join(name, roomCode)\n      .then(() => {\n        setError('')\n        if (room.started) {\n          setState(AppState.GAME)\n          // room.game.gameWorld.init()\n        } else {\n          setState(AppState.ROOM)\n        }\n      })\n      .catch((e: Error) => {\n        setError(e.message)\n        console.error(e)\n      })\n      .finally(() => {\n        setMessage('')\n        setLoading(false)\n      })\n  }\n  return (\n    <Card>\n      <Flex sx={{ flexDirection: 'column' }}>\n        <Heading>Welcome to Photosynthesis</Heading>\n        {\n          error !== '' && (\n            <Well variant='danger'>{error}</Well>\n          )\n        }\n        <Input\n          fullwidth={true}\n          disabled={loading}\n          label='Name'\n          onChange={({ target }) => setName?.((target as HTMLInputElement).value)}\n          value={name}\n        />\n        <Input\n          fullwidth={true}\n          disabled={loading}\n          label='Room'\n          onChange={({ target }) => setRoomCode?.((target as HTMLInputElement).value.toUpperCase())}\n          value={roomCode}\n        />\n        <Flex mt={3}>\n          <Button sx={{ flex: 1 }} disabled={loading || name === ''} variant='warning' onClick={createRoom}>New\n            Room</Button>\n          <Button sx={{ flex: 1 }} disabled={loading || name === ''} ml={3} variant='primary' onClick={joinRoom}>Join\n            Room</Button>\n        </Flex>\n        <Text>{message}</Text>\n      </Flex>\n    </Card>\n  )\n}\n\nHome.propTypes = propTypes\n","import React, { FunctionComponent } from 'react'\nimport { FlexProps } from 'theme-ui'\nimport { Flex, Text } from '@theme-ui/components'\nimport PropTypes, { InferProps } from 'prop-types'\nimport Icon from './Icon'\n\nconst iconTextProps = {\n  path: PropTypes.string.isRequired,\n  children: PropTypes.node.isRequired,\n  size: PropTypes.number,\n  color: PropTypes.any,\n  reverse: PropTypes.bool\n}\n\nexport interface IconTextProps extends InferProps<typeof iconTextProps> {\n  color?: string | ((x: unknown) => string) | null\n}\n\nconst IconText: FunctionComponent<IconTextProps & FlexProps> = ({ children, color, path, size, reverse = false, ...otherProps }) => {\n  const reverse_ = reverse ?? false\n  return (\n    <Flex sx={{ alignItems: 'center', flexDirection: reverse_ ? 'row-reverse' : 'row' }} {...otherProps}>\n      <Icon\n        size={size}\n        path={path}\n        color={color}\n        sx={{\n          fillOpacity: color === 'transparent' ? 0 : 1,\n          path: {\n            fill: color\n          }\n        }}\n      />\n      {' '}\n      <Text ml={!reverse_ ? 2 : 0} mr={reverse_ ? 2 : 0} sx={{ flex: 1, color }}>{children}</Text>\n    </Flex>\n  )\n}\n\nIconText.propTypes = iconTextProps\n\nIconText.defaultProps = {\n  reverse: false\n}\n\nexport default IconText\n","/** @jsx jsx */\nimport { jsx, useThemeUI } from 'theme-ui'\nimport Modal from 'react-modal'\nimport PropTypes from 'prop-types'\nimport { Box } from '@theme-ui/components'\nimport { shortTransition } from '../../theme/transitions'\n\nconst Dialog = props => {\n  const { theme } = useThemeUI()\n\n  return (\n    <Modal\n      ariaHideApp={false}\n      isOpen={props.isOpen}\n      onRequestClose={() => !props.isStatic && props.onClose()}\n      contentLabel={props.contentLabel}\n      style={{\n        overlay: {\n          backgroundColor: theme.colors.fgPales[0],\n          zIndex: 200,\n          display: 'flex',\n          justifyContent: 'center',\n          alignItems: 'center',\n          padding: theme.space[2],\n          overflowY: 'auto'\n        }\n      }}\n      sx={{\n        minWidth: ['100%', '250px'],\n        maxWidth: typeof props.size === 'number' && theme.breakpoints[props.size],\n        outline: 'none',\n        opacity: 0,\n        margin: 'auto',\n        fontFamily: 'body',\n        lineHeight: 'body',\n        ...shortTransition(['opacity']),\n        '&.ReactModal__Content--after-open': {\n          opacity: 1\n        },\n        '&.ReactModal__Content--before-close': {\n          opacity: 0\n        }\n      }}>\n      <Box\n        {...props}\n        sx={{\n          backgroundColor: 'bgs.1',\n          boxShadow: 2,\n          borderRadius: 1\n        }}\n      />\n    </Modal>\n  )\n}\n\nDialog.propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  onClose: PropTypes.func,\n  contentLabel: PropTypes.string,\n  setIsOpen: PropTypes.func,\n  isStatic: PropTypes.bool,\n  size: PropTypes.number\n}\n\nDialog.defaultProps = {\n  size: 0\n}\n\nexport default Dialog\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport Dialog from './Dialog'\nimport { Box, Flex, Heading, Text } from '@theme-ui/components'\nimport Button from './Button'\nimport PropTypes from 'prop-types'\n\nconst ConfirmDialog = props => {\n  const close = typeof props.onClose === 'function' ? props.onClose : () => {\n  }\n  const action = typeof props.onAction === 'function' ? props.onAction : () => {\n  }\n  const run = x => () => {\n    close()\n    action(x)\n  }\n  return (\n    <Dialog\n      isStatic\n      {...{\n        isOpen: props.isOpen,\n        onClose: props.onClose,\n        contentLabel: props.contentLabel,\n        setIsOpen: props.setIsOpen,\n        size: props.size\n      }}>\n      <Box p={[4, 3]} pb={2}>\n        <Heading variant='subheading'>{props.title}</Heading>\n        <Text>{props.children}</Text>\n      </Box>\n      <Flex\n        p={[3, 2]}\n        sx={{\n          alignItems: 'center',\n          justifyContent: 'flex-end'\n        }}>\n        {!props.hideNoChoice && <Button onClick={run(false)}>{props.noText}</Button>}\n        <Button ml={2} onClick={run(true)}>{props.yesText}</Button>\n      </Flex>\n    </Dialog>\n  )\n}\n\nConfirmDialog.propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  onClose: PropTypes.func,\n  onAction: PropTypes.func,\n  contentLabel: PropTypes.string,\n  setIsOpen: PropTypes.func,\n  noText: PropTypes.string,\n  yesText: PropTypes.string,\n  children: PropTypes.node.isRequired,\n  title: PropTypes.string,\n  hideNoChoice: PropTypes.bool,\n  size: PropTypes.number\n}\n\nConfirmDialog.defaultProps = {\n  noText: 'No',\n  yesText: 'Yes',\n  title: 'Confirm',\n  hideNoChoice: false\n}\n\nexport default ConfirmDialog\n","import React, { FunctionComponent } from 'react'\nimport ConfirmDialog from './ConfirmDialog'\nimport PropTypes from 'prop-types'\n\nconst propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  onClose: PropTypes.func,\n  contentLabel: PropTypes.string,\n  setIsOpen: PropTypes.func,\n  yesText: PropTypes.string,\n  children: PropTypes.node.isRequired,\n  title: PropTypes.string,\n  size: PropTypes.number\n}\n\nconst AlertDialog: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = props => (\n  <ConfirmDialog {...props} hideNoChoice>{props.children}</ConfirmDialog>\n)\nAlertDialog.propTypes = propTypes\n\nAlertDialog.defaultProps = {\n  title: 'Alert',\n  yesText: 'OK'\n}\n\nexport default AlertDialog\n","import React, { Context, createContext, FunctionComponent, useContext, useState } from 'react'\nimport AlertDialog from './AlertDialog'\n\nexport interface AlertMessage {\n  title: string\n  message: string | Element\n}\n\nexport type AlertFunction = (s: string | AlertMessage) => void\n\nexport const withAlertQueue = (WrappedComponent: FunctionComponent): FunctionComponent => {\n  const AlertWrapper: FunctionComponent = props => {\n    const [queue, setQueue] = useState<AlertMessage[]>([])\n\n    const popAlert = (): void => {\n      setQueue(queue.slice(1))\n    }\n\n    const queueAlert: AlertFunction = (s: string | AlertMessage): void => {\n      const message: AlertMessage = typeof s === 'string' ? { title: 'Alert', message: s } : s\n      setQueue(queue.concat([message]))\n    }\n\n    const alertNodes = queue.map((message, i) => (\n      <AlertDialog key={i} isOpen={i === 0} title={message.title} onClose={popAlert}>\n        {message.message}\n      </AlertDialog>\n    ))\n\n    return (\n      <AlertContext.Provider value={queueAlert}>\n        <WrappedComponent {...props}/>\n        {alertNodes}\n      </AlertContext.Provider>\n    )\n  }\n\n  return AlertWrapper\n}\n\nexport const useAlert = (): AlertFunction => useContext(AlertContext)\nexport const AlertContext: Context<AlertFunction> = createContext<AlertFunction>(window.alert)\nAlertContext.displayName = 'AlertContext'\n","import React, { FunctionComponent, useEffect, useState } from 'react'\nimport { Divider, Flex, Heading } from '@theme-ui/components'\nimport Input from './common/Input'\nimport PropTypes from 'prop-types'\nimport Button from './common/Button'\nimport { useRoom } from '../lib/RoomContext'\nimport { PlayersDict, RoomEvents } from '../lib/Room'\nimport IconText from './common/IconText'\nimport { mdiAccount, mdiCrown } from '@mdi/js'\nimport { AppState } from './App'\nimport { Game } from '../Game/Game'\nimport { useAlert } from './common/AlertContext'\nimport { Card } from './common/Card'\n\nconst propTypes = {\n  setState: PropTypes.func.isRequired\n}\n\nexport const Room: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ setState }) => {\n  const room = useRoom()\n  const [players, setPlayers] = useState<PlayersDict>({})\n  const [host, setHost] = useState('')\n  const alert = useAlert()\n  const name = players[room.myId] ?? ''\n  const rename = room.rename\n  useEffect(() => {\n    room.on(RoomEvents.SET_PLAYERS, ({ data }) => setPlayers(data as PlayersDict))\n    room.on(RoomEvents.SET_HOST, ({ data }) => setHost(data as string))\n    room.on(RoomEvents.START_GAME, ({ data: game }) => {\n      setState(AppState.GAME, game as Game)\n    })\n  }, [room, setState])\n  const startGame = (): void => {\n    room?.startGame().catch((e: Error) => {\n      console.log(e)\n      alert(e.message)\n    })\n  }\n  return (\n    <Card>\n      <Flex sx={{ flexDirection: 'column' }}>\n        <Heading>{room.roomCode}</Heading>\n        <Input\n          label='My Name'\n          value={name}\n          onChange={async ({ target }: InputEvent) => {\n            await rename((target as HTMLInputElement)?.value ?? '')\n          }}\n        />\n        <Divider my={3}/>\n        <Flex sx={{ flexDirection: 'column' }}>\n          {\n            Object.entries(players).map(([id, name]) => (\n              id === host\n                ? <IconText key={id} path={mdiCrown}>{name}{id === room.myId && ' (me)'}</IconText>\n                : <IconText key={id} path={mdiAccount}>{name}{id === room.myId && ' (me)'}</IconText>\n            ))\n          }\n        </Flex>\n        <Divider my={3}/>\n        <Flex>\n          <Button\n            sx={{ flex: 1 }}\n            variant='warning'\n            onClick={(): void => {\n              setState(AppState.HOME)\n            }}>\n            Back\n          </Button>\n          <Button\n            sx={{ flex: 1, visibility: (host === room.myId ? null : 'hidden') }}\n            ml={3}\n            variant='primary'\n            onClick={host === room.myId ? startGame : undefined}>\n            Start\n          </Button>\n        </Flex>\n      </Flex>\n    </Card>\n  )\n}\n\nRoom.propTypes = propTypes\n","import React, { FunctionComponent, useState } from 'react'\nimport { useRoom } from '../lib/RoomContext'\nimport { Flex } from 'theme-ui'\nimport NavBar from './NavBar'\nimport { transition } from '../theme/transitions'\nimport { Home } from './Home'\nimport { Room } from './Room'\nimport { GameContextProvider } from '../Game/GameContext'\nimport { GamePlayer } from './GamePlayer'\nimport { withAlertQueue } from './common/AlertContext'\n\nexport enum AppState {\n  HOME,\n  ROOM,\n  GAME\n}\n\nconst App: FunctionComponent = () => {\n  const [state, _setState] = useState(AppState.HOME)\n  const room = useRoom()\n  const setState = (newState: AppState): void => {\n    if (newState !== state) {\n      if (newState === AppState.HOME) {\n        room.leaveRoom()\n        window.history.pushState({\n          pageTitle: 'Whatever Game'\n        }, '', process.env.PUBLIC_URL)\n      } else if (newState === AppState.ROOM) {\n        window.history.pushState({\n          pageTitle: (room.roomCode ?? '') + ' - Whatever Game'\n        }, '', `${process.env.PUBLIC_URL}/${room.roomCode ?? ''}`)\n      }\n      _setState(newState)\n    }\n  }\n  return (\n    <Flex\n      sx={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        flexDirection: 'column'\n      }}>\n      <NavBar setState={setState} state={state}/>\n      <Flex sx={{ flex: 1, ml: `-${state * 100}%`, ...transition(0.3, ['margin-left'], 'linear') }}>\n        <Flex sx={{ minWidth: '100vw', justifyContent: 'center', alignItems: 'center' }}>\n          <Home setState={setState}/>\n        </Flex>\n        <Flex sx={{ minWidth: '100vw', justifyContent: 'center', alignItems: 'center' }}>\n          <Room setState={setState}/>\n        </Flex>\n        <Flex sx={{ minWidth: '100vw', justifyContent: 'center', alignItems: 'center' }}>\n          <GameContextProvider>\n            <GamePlayer setState={setState}/>\n          </GameContextProvider>\n        </Flex>\n      </Flex>\n    </Flex>\n  )\n}\n\nexport default withAlertQueue(App)\n","import React, { createContext, FunctionComponent, useContext, useEffect, useState } from 'react'\nimport { Game, GameEvent, GameState } from './Game'\nimport PropTypes from 'prop-types'\nimport { globalRoom, useRoom } from '../lib/RoomContext'\n\nexport const GameContext = createContext<[Game, GameState | undefined, string|undefined]>([globalRoom.game, undefined, undefined])\nexport const useGame = (): [Game, GameState | undefined, string|undefined] => useContext(GameContext)\n\nexport const GameContextProvider: FunctionComponent = (props) => {\n  const game = useRoom().game\n  const [gameState, setGameState] = useState<GameState|undefined>(undefined)\n  const [gameOver, setGameOver] = useState<string|undefined>(undefined)\n  useEffect(() => {\n    setGameState(undefined)\n    game.on(GameEvent.UPDATE_GAME_STATE, ({ data }) => {\n      const state = data as GameState\n      setGameOver(state?.gameOver)\n      setGameState({ ...state })\n    })\n    game.on(GameEvent.GAME_OVER, ({ data }) => setGameOver(data as string))\n  }, [game])\n  return <GameContext.Provider value={[game, gameState, gameOver]} {...props} />\n}\n\nGameContextProvider.propTypes = {\n  value: PropTypes.any\n}\n","import React, { FunctionComponent, useEffect, useRef } from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport { Box } from '@theme-ui/components'\nimport GameWorld from '../Game/GameWorld'\nimport { WebGLRendererSystem } from 'ecsy-three'\n\nconst gameRendererProps = {\n  gameWorld: PropTypes.instanceOf(GameWorld).isRequired\n}\n\nconst GameRenderer: FunctionComponent<InferProps<typeof gameRendererProps>> = ({ gameWorld }) => {\n  const ref = useRef<HTMLDivElement | null>(null)\n\n  useEffect(() => {\n    const divElem = ref.current\n    if (divElem !== null) {\n      divElem.childNodes.forEach(child => {\n        divElem.removeChild(child)\n      })\n      divElem.appendChild(gameWorld.renderer.domElement)\n      gameWorld.world.getSystem(WebGLRendererSystem)?.onResize()\n    }\n  }, [ref, gameWorld.renderer.domElement, gameWorld.world])\n\n  return (\n    <Box\n      ref={ref}\n      sx={{\n        width: '100vw',\n        height: '100vh',\n        position: 'fixed',\n        left: 0,\n        top: 0,\n        right: 0,\n        bottom: 0,\n        zIndex: -1,\n        canvas: {\n          width: '100%',\n          height: '100%'\n        }\n      }}\n    />\n  )\n}\n\nGameRenderer.propTypes = gameRendererProps\n\nexport default GameRenderer\n","import React, { FunctionComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport { useGame } from '../Game/GameContext'\nimport { Box, Divider, Flex } from '@theme-ui/components'\nimport Button from './common/Button'\nimport { AppState } from './App'\nimport GameRenderer from './GameRenderer'\nimport { Card } from './common/Card'\n\nconst propTypes = {\n  setState: PropTypes.func.isRequired\n}\n\nexport const GamePlayer: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ setState }) => {\n  const [game, gameState, gameOver] = useGame()\n  const click = (x: number, y: number): void => {\n    game?.click(x, y).catch(console.log)\n  }\n  return (\n    <Box>\n      <GameRenderer gameWorld={game.gameWorld}/>\n      <Box\n        sx={{\n          position: 'relative',\n          zIndex: 1\n        }}>\n        <Card>\n          {gameState?.board?.map((a: Array<string | null>, x: number) => (\n            <Flex key={x}>\n              {\n                a.map((b: (string | null), y) => (\n                  <Box\n                    key={y}\n                    sx={{ width: '40px', height: '40px', border: '1px solid black' }}\n                    onClick={() => click(x, y)}>\n                    {b}\n                  </Box>\n                ))\n              }\n            </Flex>\n          ))}\n          {\n            gameOver !== undefined && (\n              <Box>\n                <Divider/>\n                <Button variant='primary' onClick={() => { setState(AppState.ROOM) }}>Next Round</Button>\n              </Box>\n            )\n          }\n        </Card>\n      </Box>\n    </Box>\n  )\n}\n\nGamePlayer.propTypes = propTypes\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/.exec(window.location.hostname)\n)\n\ninterface Config {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\n}\n\nexport function register (config?: Config): void {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    )\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          )\n        }).catch(console.error)\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW (swUrl: string, config?: Config): void {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller !== null) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config?.onUpdate !== undefined) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              config?.onSuccess?.(registration)\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker (swUrl: string, config?: Config): void {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && !contentType.includes('javascript'))\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          }).catch(console.error)\n        }).catch(console.error)\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister (): void {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister().catch(console.error)\n      })\n      .catch((error: Error) => {\n        console.error(error.message)\n      })\n  }\n}\n","import React, { FunctionComponent } from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './components/App'\nimport * as serviceWorker from './serviceWorker'\nimport { Global } from '@emotion/core'\nimport theme from './theme'\nimport { ThemeProvider } from 'theme-ui'\nimport { startLoad } from './3d/assets'\n\nconst MyGlobal: FunctionComponent = () => (\n  <Global\n    styles={(theme) => ({\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment\n      body: theme.styles.body,\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment\n      '*': theme.styles['*'],\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment\n      a: theme.styles.a\n    })}\n  />\n)\n\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <MyGlobal/>\n      <App/>\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\nstartLoad()\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}