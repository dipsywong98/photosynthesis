{"version":3,"sources":["../node_modules/peerjs/dist sync","lib/Observable.ts","lib/ConnectionTypes.ts","lib/PkgType.ts","lib/Connection.ts","lib/fake/FakeConn.ts","lib/fake/FakeMediaConnection.ts","lib/fake/FakePeer.ts","lib/PeerFactory.ts","lib/ConnectionManager.ts","3d/extraObjects.ts","3d/helpers.ts","Game/components/TreeComponent.ts","3d/constants.ts","3d/assets.ts","Game/components/SunOrientationTagComponent.ts","Game/systems/GameWorldSystem.ts","Game/components/AxialCoordsComponent.ts","Game/components/TileComponent.ts","Game/easing/applyEasing.ts","Game/easing/1d/inverseElastic.ts","Game/easing/1d/elastic.ts","Game/easing/1d/easeOut.ts","Game/easing/3d/jelly.ts","Game/components/TweenComponent.ts","Game/easing/3d/linear.ts","Game/components/SelectableTagComponent.ts","Game/systems/TreeSystem.ts","Game/systems/TweenSystem.ts","Game/systems/AxialCoordsSystem.ts","Game/systems/TileSystem.ts","Game/systems/SunOrientationSystem.ts","Game/entities/tree.ts","3d/Coordinates/HexCube.ts","3d/Coordinates/Cartesian2D.ts","3d/Coordinates/Axial.ts","Game/systems/TouchSystem.ts","Game/components/RendererComposerComponent.ts","Game/systems/RendererComposerSystem.ts","Game/systems/SelectionSystem.ts","lib/StarMeshNetwork.ts","Game/GameWorld.ts","lib/pause.ts","Game/Game.ts","Game/getInitialState.ts","Game/isTreeGrowthStage.ts","lib/Room.ts","lib/RoomContext.ts","theme/colors.js","theme/transitions.js","theme/inputs/inputPadding.js","theme/inputs/baseInput.js","theme/buttons.js","theme/inputs/normal.js","theme/inputs/baseMagic.js","theme/inputs/index.js","theme/inputs/inputMagic.js","theme/menuItem.js","theme/dropdown.js","theme/text.js","theme/wells.js","theme/messages.js","theme/index.js","theme/badges.js","theme/code.js","theme/links.js","theme/styles.js","utils/componentHelpers.ts","components/common/Button.tsx","components/common/Icon.jsx","components/NavBar.tsx","components/common/BasicInput.jsx","components/common/IconButton.jsx","components/common/Input.tsx","components/common/Well.tsx","components/common/Card.tsx","components/Home.tsx","components/common/IconText.tsx","components/common/Dialog.jsx","components/common/ConfirmDialog.jsx","components/common/AlertDialog.tsx","components/common/AlertContext.tsx","components/Room.tsx","Game/GameContext.tsx","components/common/Dropdown.jsx","components/common/MenuItem.jsx","components/common/BasicSelect.jsx","components/common/Select.jsx","components/common/Collapsible.tsx","components/common/CollapsibleWell.tsx","components/App.tsx","components/Panel.tsx","components/GamePlayer.tsx","components/GameRenderer.tsx","serviceWorker.ts","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","isMatcher","match","ConnEvent","PkgType","Observable","_onEventListeners","_onceEventListeners","event","listener","events","this","undefined","uuid","uuidv4","on","value","equals","Object","_","reduce","flag","key","once","preventClear","timeout","Promise","reject","cb","window","setTimeout","toString","clearTimeout","JSON","stringify","onceMatch","values","forEach","clearUuid","entries","push","off","Connection","conn","connectionManager","manager","dataHandler","pid","data","_t","ACK","response","ack","v","emit","CONN_DATA","CONN_PKG","type","send","CONN_ACK","enrichConn","log","peer","v4","split","promise","untilMatch","open","close","CONN_CLOSE","CONN_OPEN","error","CONN_ERROR","payload","FakeConn","bufferSize","dataChannel","label","metadata","peerConnection","reliable","serialization","otherEnd","hostPeer","callbacks","sent","trigger","_data","connections","filter","fn","FakeMediaConnection","f","stream","options","FakePeer","destroyed","disconnected","prototype","allPeers","fakeConn","fakeConn2","ap","peerId","connectionId","find","callback","PeerFactory","peers","useFake","make","r","shift","process","REACT_APP_PEER_HOST","Peer","host","port","Number","parseInt","REACT_APP_PEER_PORT","path","REACT_APP_PEER_PATH","ConnectionManager","closed","onPeerOpenHandler","PEER_OPEN","onPeerConnectionHandler","connection","PEER_CONNECT","initPeer","prefixId","startAs","PEER_ERROR","existing","id1","id2","connect","openHandler","all","map","a","pkgType","sendPkg","c","PEER_CLOSE","PEER_DISCONNECT","rest","then","toLog","destroy","disconnectAll","cylinderGeometry","CylinderBufferGeometry","cylinderMaterial","MeshBasicMaterial","visible","name","cylinderMesh","Mesh","CYLINDER_OBJ","Object3D","add","color","disposeObj3D","obj3d","traverse","obj","geometry","material","dispose","disposeMaterial","prop","Texture","Array","isArray","TreeComponent","growthStage","topObj","trunkObj","plant","seed","tree","shade","groundShade","remove","Component","schema","Types","Ref","default","Color","GrowthStage","MODELS","BLUE_TOP","ORANGE_TOP","YELLOW_TOP","GREEN_TOP","TRUNK","SHADE","GROUND_SHADE","ACORN","PINE_CONE","MAPLE_SEED","BASSWOOD_SEED","RING","LANDSCAPE","TREE_MODELS","BLUE","ORANGE","YELLOW","GREEN","SEED_MODELS","COLOR_VALUES","SHADE_Y","INITIAL_SUN_ORIENTATION","Math","PI","TREE_GROWTH_PROPS","SEED","scale","Vector3","SHORT","MID","TALL","ACTION_COST_GROW","ACTION_COST_PURCHASE","objects","objectWaitOrders","loadedCount","totalCount","getObject","modelName","queue","modelNotFoundMessage","SunOrientationTagComponent","TagComponent","GameWorldSystem","world","attributes","gameWorld","ECSYThreeSystem","AxialCoordsComponent","axial","TileComponent","treeEntity","applyEasing","mapper","func","from","to","applyVector3","clone","multiply","sub","subScalar","bezier","hEase","compose","inverseElastic","easeOut","vEase","elastic","i","xz","TweenComponent","tweens","entity","tween","getMutableComponent","addScalar","SelectableTagComponent","TreeSystem","delta","time","queries","trees","removed","treeComp","getComponent","axialComp","linkedTileComp","tileEntities","get","changed","updateGrowthStage","bind","added","getObject3D","objectsToFetch","objs","o","seedObj","shadeObj","groundShadeObj","shadeContainer","position","y","groundShadeContainer","treeObj","plantContainerObj","rotation","random","createEntity","addObject3DComponent","addComponent","groundShadeContainerEntity","x","fromArray","toArray","catch","console","queueTween","duration","loop","jelly","TREE_GROWTH_DURATION","Euler","linear","setFromVector3","toVector3","components","Object3DComponent","listen","TweenSystem","object3DTweens","results","tweenComp","newTweens","tweenProp","tweenObj3dProp","oldValue","min","result","AxialCoordsSystem","axialPositions","prevQ","userData","q","prevR","toCartesian","z","set","TileSystem","tiles","tileComp","newColor","getHex","setHex","SunOrientationSystem","sunFacingObjs","sunOrientationRad","createTree","gameEntity","HexCube","join","Axial","hexCube","n","t","abs","max","s","neighbors","Cartesian2D","coords","sqrt","coord","euclideanDistance","origin","norm","normalize","size","toHexCube","range","toAxial","TouchSystem","hm","panDistances","onMouseMove","MouseEvent","clientX","clientY","changedTouches","pageX","pageY","mouseScreenPosition","innerWidth","innerHeight","hasMouseMoved","canvas","renderer","domElement","Hammer","Pan","direction","DIRECTION_ALL","velocityX","velocityY","activeObject","hoverObject","camera","addEventListener","length","pop","hDistance","vDistance","cameraRotationObj","newTilt","cameraTiltObj","RendererComposerComponent","composer","outlinePass","effectFXAA","WebGLRendererComponent","scene","RendererComposerSystem","needsResize","intersectionCounter","onResize","removeEventListener","renderers","component","width","clientWidth","height","clientHeight","EffectComposer","renderTarget1","texture","encoding","sRGBEncoding","renderTarget2","renderPass","RenderPass","addPass","OutlinePass","Vector2","edgeStrength","edgeThickness","hiddenEdgeColor","ShaderPass","FXAAShader","uniforms","removeComponent","rendererComposers","getPixelRatio","devicePixelRatio","setPixelRatio","aspect","updateProjectionMatrix","setSize","resolution","selectedObjects","render","isECSYObject3D","SelectionSystem","secondsElapsed","raycaster","Raycaster","CHECK_PERIOD","selectableObjs","selectables","setFromCamera","intersections","intersectObjects","intersectedObject","object","parent","currentRef","willContinueSearch","StarMeshNetworkEvents","GameWorld","gui","stats","sceneEntity","messages","hasStarted","Map","Stats","dat","GUI","WebGLRenderer","antialias","ECSYThreeWorld","entityPoolSize","document","body","appendChild","dom","init","destroyGUI","stop","clear","initGUI","clock","Clock","initialize","animationLoop","begin","execute","getDelta","elapsedTime","end","initRenderer","initECS","initScene","play","sunControl","step","registerComponent","TweenBaseComponent","unregisterSystem","WebGLRendererSystem","registerSystem","priority","shadowMap","enabled","VSMShadowMap","setClearColor","outputEncoding","fov","cameraFolder","addFolder","ambientLight","AmbientLight","sun","DirectionalLight","sin","castShadow","shadow","bias","radius","near","far","top","bottom","left","right","mapSize","sunContainer","Group","sky","commonLights","floorObj","game","generateGrid","boardObj","boardEntity","tileContainer","tileEntity","ring","ringContainerObj","ringClone","mesh","children","originalMaterial","MeshStandardMaterial","target","message","directionType","pause","GameEvent","GameActions","isMemberChangePayload","d","members","p","StarMeshNetwork","myConnectionManager","initialState","reducer","hostConnectionManager","meToHostConnection","state","networkName","hostId","networkErrorHandler","NETWORK_ERROR","sendToHost","initMyConnectionManagerListeners","onPkg","MEMBER_CHANGE","handleMemberChange","SET_STATE","STATE_CHANGE","DISPATCH","dispatchHandler","startPrefix","hostConnection","oldHost","broadcastPkg","connectPrefix","isClosed","member","HOST_CHANGE","includes","oldList","newList","memberJoining","memberLeaving","disconnect","MEMBERS_CHANGE","MEMBERS_JOIN","MEMBERS_LEFT","setReducer","dispatch","action","dispatchLocal","newState","setState","stateStaging","leave","getInitialPlayerInfo","lightPoint","score","availableArea","playerBoard","getInitialBoard","tileDistance","leaves","isTreeGrowthStage","stage","RoomActionTypes","RoomEvents","Game","room","mi","turn","network","GAME_EVENT","errorHandler","prevState","connId","playerId","pi","gameState","END_TURN","endTurnHandler","GROW_TREE","fromString","growTreeHandler","PLANT_SEED","source","plantSeedHandler","PURCHASE","purchaseHandler","UPDATE_GAME_STATE","started","myId","me","playerIds","players","preparingRound","dirtyTiles","rayDirection","revolutionLeft","board","scoreTokens","1","2","3","4","playerInfo","photosynthesisHints","getInitialState","axialString","tileInfo","setTile","setRayDirection","GAME_OVER","CLICK","_playerId","nPlayers","endGameCalculation","photosynthesis","shadows","tile","distance","winningsPlayerIds","winningScore","info","floor","gameOver","whoami","existingStage","resetTile","returnTree","obtainToken","purchaseIndex","amount","CH","freeze","maxPlayers","minPlayers","Room","create","myName","roomCode","joinOrHost","JOIN","leaveRoom","joinOrCreate","ERROR","rename","RENAME","SET_HOST","startGame","idDict","nameDict","k","START_GAME","endGame","END_GAME","networkReducer","setName","SET_PLAYERS","rejoin","LEAVE","typed","start","trace","idDictElement","roomState","globalRoom","RoomContext","createContext","useRoom","useContext","makeFade","transparentize","vibrantColors","blue","red","green","yellow","gray","dullColors","paleColors","baseColors","vibrantHighlights","mapObjIndexed","dark","light","white","colors","primary","accent","inputFocus","fgHighlights","bgHighlights","text","muted","background","bgs","fgs","fgPales","border","highlight","backgroundColor","prolog","comment","keyword","number","constant","variable","string","selector","tag","operator","punctuation","function","className","char","transition","props","ease","shortTransition","inputPadding","px","py","baseInput","borderRadius","borderColor","boxShadow","theme","lineHeight","fontFamily","fontWeight","fontSize","baseButton","display","alignItems","textAlign","outline","pillButton","smButton","mdButton","buttonStyles","buttonColors","normal","fg","bg","hoverBg","success","warning","danger","active","transparent","buttons","styleName","colorName","fill","fakePlaceholder","pt","pointerEvents","ml","fakePlaceholderPull","baseMagic","inputMagic","overflow","zIndex","pageHeadingSizes","pageHeadingIconSizes","fontSizes","heading","mb","subheading","textTransform","letterSpacing","pageHeading","svg","largeHeading","columnHeading","columnCardHeading","helperText","baseWell","my","borderWidth","borderStyle","dashed","baseMessage","messageStyle","fillColor","useColorSchemeMediaQuery","modes","breakpoints","space","fonts","monospace","fontWeights","bold","lineHeights","input","radii","layout","container","maxWidth","sidebar","inputs","badges","tabSize","MozTabSize","content","borderTopWidth","borderTopStyle","borderTopColor","menuItem","links","plain","dropdown","wells","styles","root","boxSizing","margin","h1","h2","h3","h4","h5","h6","textDecoration","pre","overflowX","table","borderCollapse","borderSpacing","th","borderBottomStyle","td","img","hr","borderTop","borderBottom","isDefined","buttonProps","block","PropTypes","bool","Button","forwardRef","ref","variant","sx","justifyContent","propTypes","defaultProps","displayName","Icon","sizes","NavBar","isRequired","useColorMode","colorMode","setColorMode","mr","flex","onClick","title","mdiCircleSlice4","BasicInput","as","__themeKey","IconButton","visibility","hidden","iconSx","Input","onClearClick","mt","fullwidth","placeholder","disabled","transform","mdiClose","Well","Card","Home","useState","exec","location","pathname","replace","setRoomCode","setError","setMessage","loading","setLoading","flexDirection","onChange","toUpperCase","AppState","ROOM","finally","GAME","IconText","node","any","reverse","otherProps","reverse_","fillOpacity","Dialog","useThemeUI","ariaHideApp","isOpen","onRequestClose","isStatic","onClose","contentLabel","style","overlay","padding","overflowY","minWidth","opacity","ConfirmDialog","onAction","run","setIsOpen","pb","hideNoChoice","noText","yesText","AlertDialog","useAlert","AlertContext","alert","setPlayers","setHost","useEffect","mdiCrown","mdiAccount","HOME","GameContext","useGame","GameContextProvider","setGameState","setGameOver","Provider","Dropdown","onSelect","onToggle","setOpen","useRef","current","contains","userSelect","mdiChevronUp","mdiChevronDown","Children","child","Divider","BasicSelect","choices","optionToValue","option","valueKey","optionToString","formatKey","selected","choice","stopPropagation","handleSelect","Select","preventDefault","Collapsible","hideOnly","noInitialTransition","boxProps","scrollHeight","setScrollHeight","isVisible","setVisible","transitionState","setTransitionState","isMounted","setMounted","setInit","SLOW","BEFORE","CollapsibleWell","defaultOpen","header","noPad","setController","reverseHeader","headerSx","onOpen","show","hide","toggle","Panel","purchase","plantSeed","growTree","endTurn","nextRound","setAxialString","axialString2","setAxialString2","setStage","useMemo","axial2","_alert","m","getName","GamePlayer","GameRenderer","divElem","childNodes","removeChild","getSystem","WrappedComponent","withAlertQueue","_setState","history","pushState","pageTitle","setQueue","popAlert","slice","alertNodes","concat","Boolean","hostname","MyGlobal","ReactDOM","StrictMode","getElementById","loader","GLTFLoader","modelNames","load","MODELS_LOCATION","gltf","receiveShadow","waitOrders","order","orders","startLoad","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.256f0767.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 87;","import { v4 as uuidv4 } from 'uuid'\nimport { equals } from 'ramda'\n\nconst TIMEOUT_DURATION = 5000\n\ninterface PayloadEssential {\n  toString: () => string\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\ntype Payload = Exclude<PayloadEssential, Function>\n\ntype Listener<P extends Payload> = (payload: P, preventClear?: () => void) => void\ntype Matcher<P extends Payload> = (payload: P) => boolean\n\nfunction isMatcher<P extends Payload> (match: P | Matcher<P> | { _: Partial<P> }): match is Matcher<P> {\n  return typeof match === 'function'\n}\n\n/**\n * @template E `typeof MyEnum` or a general `Record` with event names as keys paired with unique values\n * @template P type of payload\n */\nexport class Observable<E extends Record<string, string | number> = never, P extends Payload = never> {\n  private _onEventListeners: { [k in E[keyof E]]?: Record<string, Listener<P>> } = {}\n  private _onceEventListeners: { [k in E[keyof E]]?: Record<string, Listener<P>> } = {}\n\n  public on (event: E[keyof E], listener: Listener<P>): string {\n    let events = this._onEventListeners[event]\n    if (events === undefined) {\n      events = this._onEventListeners[event] = {}\n    }\n    const uuid = uuidv4()\n    events[uuid] = listener\n    return uuid\n  }\n\n  /**\n   * Given event, if the value going to feed to listener is equal to the params, call the listener\n   * @param event A value of E\n   * @param listener\n   * @param match\n   */\n  public onMatch (event: E[keyof E], listener: Listener<P>, match: P | Matcher<P> | { _: Partial<P> }): string {\n    return this.on(event, (value: P) => {\n      if (isMatcher(match)) {\n        if (match(value)) {\n          listener(value)\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      } else if (equals(match, value) as unknown as boolean) {\n        listener(value)\n      } else if (\n        typeof match === 'object' &&\n        match !== null &&\n        '_' in match &&\n        Object.keys(match._)\n          .reduce(\n            (flag: boolean, key) => (\n              flag && equals(\n                (match._ as Record<string, unknown>)[key],\n                (value as Record<string, unknown>)[key])\n            ),\n            true\n          )\n      ) {\n        listener(value)\n      }\n    })\n  }\n\n  public once (event: E[keyof E], listener: Listener<P>): string {\n    let events = this._onceEventListeners[event]\n    if (events === undefined) {\n      events = this._onceEventListeners[event] = {}\n    }\n    const uuid = uuidv4()\n    events[uuid] = listener\n    return uuid\n  }\n\n  /**\n   *\n   * @param event\n   * @param listener\n   * @param match\n   */\n  public onceMatch (event: E[keyof E], listener: Listener<P>, match: P | Matcher<P> | { _: Partial<P> }): string {\n    return this.once(event, (value: P, preventClear?: () => void) => {\n      if (isMatcher(match)) {\n        if (match(value)) {\n          listener(value, preventClear)\n        } else {\n          preventClear?.()\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      } else if (equals(match, value) as unknown as boolean) {\n        listener(value, preventClear)\n      } else if (\n        typeof match === 'object' &&\n        match !== null &&\n        '_' in match &&\n        Object.keys(match._)\n          .reduce(\n            (flag: boolean, key) => (\n              flag && equals(\n                (match._ as Record<string, unknown>)[key],\n                (value as Record<string, unknown>)[key])\n            ),\n            true\n          )\n      ) {\n        listener(value, preventClear)\n      } else {\n        preventClear?.()\n      }\n    })\n  }\n\n  public async until (event: E[keyof E], timeout = TIMEOUT_DURATION, _message?: unknown): Promise<P> {\n    return await new Promise((resolve, reject) => {\n      const cb = window.setTimeout(() => {\n        reject(new Error(event.toString() + ' timeout'))\n      }, timeout)\n      this.once(event, (value) => {\n        window.clearTimeout(cb)\n        resolve(value)\n      })\n    })\n  }\n\n  public async untilMatch (event: E[keyof E], value: P | Matcher<P> | { _: Partial<P> }, timeout = TIMEOUT_DURATION, _message?: unknown): Promise<P> {\n    if (value === undefined) throw new Error('expect undefined')\n    return await new Promise((resolve, reject) => {\n      const cb = window.setTimeout(() => {\n        reject(new Error(`${event} ${JSON.stringify(value)} timeout`))\n      }, timeout)\n      this.onceMatch(event, (value) => {\n        window.clearTimeout(cb)\n        resolve(value)\n      }, value)\n    })\n  }\n\n  public off (event: E[keyof E], uuid: string): void {\n    delete this._onEventListeners?.[event]?.[uuid]\n    delete this._onceEventListeners?.[event]?.[uuid]\n  }\n\n  public emit (event: E[keyof E], value: P): void {\n    Object.values(this._onEventListeners?.[event] ?? {})?.forEach((listener) => {\n      listener(value)\n    })\n    const clearUuid: string[] = []\n    Object.entries(this._onceEventListeners?.[event] ?? {})?.forEach(([uuid, listener]) => {\n      let preventClear = false\n      listener(value, () => {\n        preventClear = true\n      })\n      if (!preventClear) {\n        clearUuid.push(uuid)\n      }\n    })\n    clearUuid.forEach((uuid) => {\n      this.off(event, uuid)\n    })\n    // if (event !== '*') {\n    //   this.emit('*', event, ...params)\n    // }\n  }\n}\n","import { Connection } from './Connection'\nimport { PkgType } from './PkgType'\n\nexport enum ConnEvent {\n  ANY = '*',\n  PEER_OPEN = '_open',\n  PEER_CLOSE = '_close',\n  PEER_CONNECT = '_connect',\n  PEER_DISCONNECT = '_disconnect',\n  PEER_ERROR = '_error',\n  CONN_OPEN = 'open',\n  CONN_CLOSE = 'close',\n  CONN_DATA = 'data',\n  CONN_ERROR = 'error',\n  CONN_ACK = 'ack',\n  CONN_PKG = 'pkg'\n}\n\nexport interface ConnectionError {\n  name: string\n  message: string\n  stack?: string\n  type?: string\n}\n\nexport interface Package { _t: PkgType, data: unknown }\nexport type PayloadData = [string, Package]\n\nexport interface ConnectionListenerPayload {\n  conn?: Connection\n  data?: unknown\n  error?: ConnectionError\n  pid?: string\n  type?: PkgType\n  ack?: (ackVal: unknown) => void\n}\nexport type ConnectionListener = (payload: ConnectionListenerPayload) => void\n","export enum PkgType {\n  ALERT = 'alert',\n  XD = 'xd',\n  JOIN = 0,\n  MEMBER_CHANGE,\n  NEW_JOIN,\n  ACK,\n  PLAYER_LEFT,\n  CHANGE_HOST,\n  RENAME,\n  START_GAME,\n  GAME_EVENT,\n  UPDATE_GAME_STATE,\n  DISPATCH,\n  SET_STATE,\n}\n","import { DataConnection } from 'peerjs'\nimport { v4 } from 'uuid'\nimport { ConnectionListenerPayload, ConnEvent, Package, PayloadData } from './ConnectionTypes'\nimport { ConnectionManager } from './ConnectionManager'\nimport { Observable } from './Observable'\nimport { PkgType } from './PkgType'\n\nexport class Connection extends Observable<typeof ConnEvent, ConnectionListenerPayload> {\n  protected conn?: DataConnection // undefined if it is connecting to itself\n  protected manager: ConnectionManager\n\n  protected log (...params: unknown[]): void {\n    this.manager.log(...params)\n  }\n\n  public get id (): string {\n    if (this.conn !== undefined) {\n      return this.conn.peer\n    } else {\n      return this.manager.id\n    }\n  }\n\n  constructor (conn: DataConnection | 'self', connectionManager: ConnectionManager) {\n    super()\n    if (conn !== 'self') {\n      this.conn = conn\n      this.enrichConn(conn)\n    }\n    this.manager = connectionManager\n  }\n\n  public async send (data: Package): Promise<ConnectionListenerPayload> {\n    const pid = v4().split('-')[0]\n    const promise = this.manager.untilMatch(\n      ConnEvent.CONN_ACK,\n      ({ pid: p }: ConnectionListenerPayload) => p === pid)\n    if (this.conn !== undefined) {\n      if (this.conn.open) {\n        this.conn.send([pid, data])\n      } else {\n        this.conn.on('open', () => {\n          this.conn?.send([pid, data])\n        })\n      }\n    } else {\n      this.dataHandler()([pid, data])\n    }\n    return await promise\n  }\n\n  public async sendPkg (type: PkgType, data: unknown): Promise<ConnectionListenerPayload> {\n    return await this.send({\n      data,\n      _t: type\n    })\n  }\n\n  public close (): void {\n    this.conn?.close()\n    this.emit(ConnEvent.CONN_CLOSE, { conn: this })\n  }\n\n  private readonly dataHandler = (conn?: DataConnection) => ([pid, data]: PayloadData) => {\n    if (data !== undefined && data._t !== PkgType.ACK) {\n      let response: unknown\n      const ack = (v: unknown): void => {\n        response = v\n      }\n      this.emit(ConnEvent.CONN_DATA, { conn: this, data, ack })\n      if (typeof data === 'object' && data._t !== undefined) {\n        this.emit(ConnEvent.CONN_PKG, { conn: this, data: data.data, type: data._t, ack })\n      }\n      if (conn !== undefined) {\n        if (response === undefined) {\n          conn.send([pid, { _t: PkgType.ACK, data: response }])\n        } else {\n          conn.send([pid, { _t: PkgType.ACK, data: response }])\n        }\n      } else {\n        if (response === undefined) {\n          this.dataHandler()([pid, { _t: PkgType.ACK, data: undefined }])\n        } else {\n          this.dataHandler()([pid, { _t: PkgType.ACK, data: response }])\n        }\n      }\n    } else {\n      if (typeof data === 'object' && data !== null && data._t !== undefined) {\n        this.emit(ConnEvent.CONN_ACK, { conn: this, data: data.data, type: data._t, pid })\n      } else {\n        this.emit(ConnEvent.CONN_ACK, { conn: this, data, pid })\n      }\n    }\n  }\n\n  private enrichConn (conn: DataConnection): DataConnection {\n    conn.on('open', () => {\n      this.emit(ConnEvent.CONN_OPEN, { conn: this })\n    })\n    conn.on('data', this.dataHandler(conn))\n    conn.on('error', (error: Error) => {\n      this.emit(ConnEvent.CONN_ERROR, { conn: this, error })\n    })\n    conn.on('close', () => {\n      this.emit(ConnEvent.CONN_CLOSE, { conn: this })\n    })\n    return conn\n  }\n\n  public emit (event: ConnEvent, payload: ConnectionListenerPayload): void {\n    super.emit(event, payload)\n    this.manager.emit(event, payload)\n  }\n}\n","import { DataConnection } from 'peerjs'\nimport { FakePeer } from './FakePeer'\n\nexport class FakeConn implements DataConnection {\n  bufferSize!: number\n  dataChannel!: RTCDataChannel\n  label = 'my label'\n  metadata: unknown\n  open = false\n  peer = 'peer'\n  peerConnection!: RTCPeerConnection\n  reliable = true\n  serialization = 'binary'\n  type = 'data'\n  otherEnd?: FakeConn\n  hostPeer?: FakePeer\n\n  constructor () {\n    window.setTimeout(() => {\n      this.open = true\n      this.trigger('open')\n    }, 1)\n  }\n\n  parse (): void {\n    throw new Error('not implemented')\n  }\n\n  stringify (_data: Record<string, unknown> | number | string | unknown[]): string {\n    throw new Error('not implemented')\n  }\n\n  close (): void {\n    if (this.open) {\n      this.open = false\n      if (this.hostPeer !== undefined) {\n        this.hostPeer.connections = this.hostPeer?.connections.filter(conn => conn !== this)\n      }\n      if (this.otherEnd !== undefined) {\n        this.otherEnd.open = false\n        if (this.otherEnd.hostPeer !== undefined) {\n          this.otherEnd.hostPeer.connections = this.otherEnd.hostPeer?.connections.filter(conn => conn !== this.otherEnd)\n        }\n      }\n      window.setTimeout(() => {\n        this.otherEnd?.trigger('close')\n        this.trigger('close')\n      }, 1)\n    }\n  }\n\n  off (event: string, fn: () => void, once?: boolean): void {\n    throw new Error('not implemented')\n  }\n\n  public callbacks: Record<string | 'data' | 'open' | 'close' | 'error', Array<(d?: unknown) => void>> = {}\n\n  public on (event: string, cb: () => void): void\n  public on (event: 'data', cb: (data: unknown) => void): void\n  public on (event: 'open', cb: () => void): void\n  public on (event: 'close', cb: () => void): void\n  public on (event: 'error', cb: (err: unknown) => void): void\n  public on (event: string | 'data' | 'open' | 'close' | 'error', cb: (() => void) | ((data: unknown) => void)): void {\n    if (!(event in this.callbacks)) {\n      this.callbacks[event] = []\n    }\n    this.callbacks[event].push(cb)\n  }\n\n  public trigger (event: string | 'data' | 'open' | 'close' | 'error', data?: unknown): void {\n    this.callbacks[event]?.forEach(cb => {\n      cb(data)\n    })\n  }\n\n  public sent: unknown[] = []\n\n  send (data: unknown): void {\n    if (!this.open) {\n      throw new Error('Send data before opening')\n    }\n    this.sent.push(data)\n    // eslint-disable-next-line no-void\n    void Promise.resolve(\n      this.otherEnd?.trigger('data', data)\n    )\n  }\n}\n","import Peer, { MediaConnection } from 'peerjs'\n\nexport class FakeMediaConnection implements MediaConnection {\n  bufferSize: unknown\n  dataChannel: unknown\n  label = 'my label'\n  metadata: unknown\n  open = true\n  peer = 'peer'\n  peerConnection!: RTCPeerConnection\n  reliable = true\n  serialization = 'binary'\n  type = 'data'\n\n  parse (): void {\n    throw new Error('not implemented')\n  }\n\n  stringify (data: Record<string, unknown> | string | number | unknown[]): string {\n    return ''\n  }\n\n  close (): void {\n    this.open = false\n  }\n\n  off (event: string, fn: () => void, once?: boolean): void {\n    this.callbacks[event] = this.callbacks[event].filter(f => f !== fn)\n  }\n\n  public callbacks: Record<string | 'data' | 'open' | 'close' | 'error', Array<(d?: unknown) => void>> = {}\n\n  // on (event: string, cb: () => void): void\n  // on (event: 'data', cb: (data: any) => void): void\n  // on (event: 'open', cb: () => void): void\n  // on (event: 'close', cb: () => void): void\n  // on (event: 'error', cb: (err: any) => void): void\n  // on (event: string | 'data' | 'open' | 'close' | 'error', cb: (() => void) | ((data: any) => void)): void {\n  //   if (!(event in this.callbacks)) {\n  //     this.callbacks[event] = []\n  //   }\n  //   this.callbacks[event].push(cb)\n  // }\n\n  public trigger (event: string | 'data' | 'open' | 'close' | 'error', data: unknown | undefined): void {\n    this.callbacks[event]?.forEach(cb => cb(data))\n  }\n\n  public sent: unknown[] = []\n\n  send (data: unknown): void {\n    this.sent.push(data)\n  }\n\n  answer (stream?: MediaStream, options?: Peer.AnswerOption): void {\n    throw new Error('not implemented')\n  }\n\n  on (event: string, cb: () => void): void\n  on (event: 'stream', cb: (stream: MediaStream) => void): void\n  on (event: 'close', cb: () => void): void\n  on (event: 'error', cb: (err: unknown) => void): void\n  on (event: string | 'stream' | 'close' | 'error', cb: (() => void) | ((stream: MediaStream) => void) | ((err: unknown) => void)): void {\n    if (!(event in this.callbacks)) {\n      this.callbacks[event] = []\n    }\n    this.callbacks[event].push(cb as (d: unknown) => void)\n  }\n}\n","import Peer from 'peerjs'\nimport { FakeConn } from './FakeConn'\nimport { FakeMediaConnection } from './FakeMediaConnection'\nimport { v4 as uuidv4 } from 'uuid'\n\nexport class FakePeer implements Peer {\n  static allPeers: Record<string, FakePeer> = {}\n  connections: FakeConn[] = []\n  destroyed = false\n  disconnected = false\n  id = 'some id'\n  prototype!: RTCIceServer\n\n  constructor (id?: string, options?: unknown) {\n    this.id = id ?? uuidv4()\n    if (this.id in FakePeer.allPeers) {\n      throw new Error(`Peer '${this.id}' already exist`)\n    }\n    FakePeer.allPeers[this.id] = this\n    window.setTimeout(() => {\n      this.trigger('open', this.id)\n    }, 1)\n  }\n\n  call (id: string, stream: MediaStream, options?: Peer.CallOption): Peer.MediaConnection {\n    return new FakeMediaConnection()\n  }\n\n  connect (id: string, options?: Peer.PeerConnectOption): Peer.DataConnection {\n    if (FakePeer.allPeers[id] === undefined) {\n      throw new Error()\n    }\n    const peer: FakePeer = FakePeer.allPeers[id]\n    const fakeConn = new FakeConn()\n    const fakeConn2 = new FakeConn()\n    this.connections.push(fakeConn)\n    peer.connections.push(fakeConn2)\n    fakeConn.peer = id\n    fakeConn2.peer = this.id\n    fakeConn.otherEnd = fakeConn2\n    fakeConn2.otherEnd = fakeConn\n    fakeConn.hostPeer = this\n    fakeConn2.hostPeer = peer\n    peer.trigger('connection', fakeConn2)\n    return fakeConn\n  }\n\n  destroy (): void {\n    this.destroyed = true\n    this.connections.forEach(conn => {\n      conn.close()\n    })\n    const { [this.id]: t, ...ap } = FakePeer.allPeers\n    FakePeer.allPeers = ap\n  }\n\n  disconnect (): void {\n    this.disconnected = true\n    const { [this.id]: t, ...ap } = FakePeer.allPeers\n    FakePeer.allPeers = ap\n  }\n\n  getConnection (peerId: string, connectionId: string): Peer.MediaConnection | Peer.DataConnection | null {\n    return this.connections.find(({ peer }) => peer === peerId) ?? null\n  }\n\n  listAllPeers (callback: (peerIds: string[]) => void): void {\n    throw new Error('not implemented')\n  }\n\n  off (event: string, fn: () => void, once?: boolean): void {\n    throw new Error('not implemented')\n  }\n\n  public callbacks: Record<string | 'data' | 'open' | 'close' | 'error', Array<(d?: unknown) => void>> = {}\n\n  on (event: string, cb: () => void): void\n  on (event: 'open', cb: (id: string) => void): void\n  on (event: 'connection', cb: (dataConnection: Peer.DataConnection) => void): void\n  on (event: 'call', cb: (mediaConnection: Peer.MediaConnection) => void): void\n  on (event: 'close', cb: () => void): void\n  on (event: 'disconnected', cb: () => void): void\n  on (event: 'error', cb: (err: unknown) => void): void\n  on (event: string | 'open' | 'connection' | 'call' | 'close' | 'disconnected' | 'error', cb: (() => void) | ((id: string) => void) | ((dataConnection: Peer.DataConnection) => void) | ((mediaConnection: Peer.MediaConnection) => void) | ((err: unknown) => void)): void {\n    if (!(event in this.callbacks)) {\n      this.callbacks[event] = []\n    }\n    this.callbacks[event].push(cb as (d?: unknown) => void)\n  }\n\n  public trigger (event: string | 'data' | 'open' | 'close' | 'error', data: unknown): void {\n    this.callbacks[event]?.forEach(cb => {\n      cb(data)\n    })\n  }\n\n  reconnect (): void {\n    throw new Error('not implemented')\n  }\n}\n","import Peer from 'peerjs'\nimport { FakePeer } from './fake/FakePeer'\n\nexport const PeerFactory: { peers: Peer[], useFake: boolean, make: (id?: string) => Peer | FakePeer } = {\n  peers: [],\n  useFake: false,\n  make (id?: string): Peer {\n    const r = PeerFactory.peers.shift()\n    if (r !== undefined) {\n      return r\n    } else if (!PeerFactory.useFake) {\n      if (process.env.REACT_APP_PEER_HOST === undefined) {\n        return new Peer(id)\n      } else {\n        return new Peer(id, {\n          host: process.env.REACT_APP_PEER_HOST ?? 'localhost',\n          port: Number.parseInt(process.env.REACT_APP_PEER_PORT ?? '9000'),\n          path: process.env.REACT_APP_PEER_PATH ?? '/peer'\n        })\n      }\n    } else {\n      return new FakePeer(id)\n    }\n  }\n}\n","import Peer, { DataConnection } from 'peerjs'\nimport { Observable } from './Observable'\nimport { ConnectionListener, ConnectionListenerPayload, ConnEvent, Package } from './ConnectionTypes'\nimport { Connection } from './Connection'\nimport { PkgType } from './PkgType'\nimport { PeerFactory } from './PeerFactory'\n\nexport class ConnectionManager extends Observable<typeof ConnEvent, ConnectionListenerPayload> {\n  public id: string\n  protected peer: Peer\n  public connections: Connection[] = []\n  protected closed = false\n\n  public isClosed (): boolean {\n    return this.closed || this.peer.disconnected\n  }\n\n  public log = (..._params: unknown[]): void => {\n    // console.log(this.id, ..._params)\n  }\n\n  public static prefixId (id = ''): string {\n    return 'creamy9tale000000' + id\n  }\n\n  public static withPrefix (id = ''): ConnectionManager {\n    return new ConnectionManager(ConnectionManager.prefixId(id))\n  }\n\n  public static async startPrefix (id = ''): Promise<ConnectionManager> {\n    return await ConnectionManager.startAs(ConnectionManager.prefixId(id))\n  }\n\n  public static async startAs (id?: string): Promise<ConnectionManager> {\n    return await new Promise<ConnectionManager>((resolve, reject) => {\n      const manager = new ConnectionManager(id)\n      manager.once(ConnEvent.PEER_OPEN, () => {\n        resolve(manager)\n      })\n      manager.once(ConnEvent.PEER_ERROR, (payload) => {\n        reject(payload.error)\n      })\n    })\n  }\n\n  constructor (id?: string) {\n    super()\n    this.peer = this.initPeer(id)\n    this.id = this.peer.id\n    this.on(ConnEvent.CONN_CLOSE, ({ conn }) => {\n      if (conn !== undefined) {\n        this.connections = this.connections.filter(({ id }) => id !== conn.id)\n      }\n    })\n  }\n\n  public async connect (id: string, timeout = 5000): Promise<Connection> {\n    const existing = this.connections.find(({ id: _id }) => _id === id)\n    if (existing !== undefined) return Promise.resolve(existing)\n    if (id === this.id) {\n      return this.enrichConn(new Connection('self', this))\n    }\n    return await new Promise((resolve, reject) => {\n      const id1 = setTimeout(() => {\n        // reject(new ConnectionTimeoutError(id))\n      }, timeout)\n      const id2 = this.once(ConnEvent.PEER_ERROR, ({ error }: ConnectionListenerPayload) => {\n        reject(error)\n      })\n      const conn = this.peer.connect(id)\n      const openHandler = (): void => {\n        const connection: Connection = this.enrichConn(new Connection(conn, this))\n        this.off(ConnEvent.CONN_ERROR, id2)\n        resolve(connection)\n        clearTimeout(id1)\n      }\n      conn.on('open', () => {\n        openHandler()\n      })\n      if (conn.open) {\n        openHandler()\n      }\n    })\n  }\n\n  public async connectPrefix (id: string): Promise<Connection> {\n    return await this.connect(ConnectionManager.prefixId(id))\n  }\n\n  public async broadcast (data: Package): Promise<unknown> {\n    return await Promise.all(this.connections.map(async conn => {\n      return await conn.send(data)\n    }))\n  }\n\n  public async broadcastPkg (pkgType: PkgType, data: unknown): Promise<ConnectionListenerPayload[]> {\n    return await Promise.all(this.connections.map(async conn => {\n      return await conn.sendPkg(pkgType, data)\n    }))\n  }\n\n  public conn (id: string): Connection {\n    const find = this.connections.find(c => c.id === id)\n    if (find === undefined) {\n      throw new Error(`connection lost with ${id}`)\n    }\n    return find\n  }\n\n  public async send (id: string, data: Package): Promise<ConnectionListenerPayload> {\n    return await this.conn(id).send(data)\n  }\n\n  public async sendPkg (id: string, pkgType: PkgType, data: unknown): Promise<ConnectionListenerPayload> {\n    return await this.conn(id).sendPkg(pkgType, data)\n  }\n\n  private initPeer (id?: string): Peer {\n    const peer = PeerFactory.make(id)\n    peer.on('open', this.onPeerOpenHandler(peer))\n    peer.on('error', (error: Error) => {\n      this.emit(ConnEvent.PEER_ERROR, { error })\n    })\n    peer.on('close', () => {\n      this.emit(ConnEvent.PEER_CLOSE, {})\n    })\n    peer.on('disconnected', () => {\n      this.emit(ConnEvent.PEER_DISCONNECT, {})\n    })\n\n    return peer\n  }\n\n  private readonly onPeerOpenHandler = (peer: Peer) => (id: string): void => {\n    this.id = id\n    this.emit(ConnEvent.PEER_OPEN, {})\n    peer.on('connection', this.onPeerConnectionHandler)\n  }\n\n  private readonly onPeerConnectionHandler = (conn: DataConnection): void => {\n    this.log('connect', conn.peer)\n    const connection = this.enrichConn(new Connection(conn, this))\n    connection.once(ConnEvent.CONN_OPEN, () => {\n      this.emit(ConnEvent.PEER_CONNECT, { conn: connection })\n    })\n  }\n\n  public onPkg (pkgType: PkgType, listener: ConnectionListener): string {\n    return super.onMatch(ConnEvent.CONN_PKG, ({ data, ...rest }: ConnectionListenerPayload) => {\n      listener({ ...rest, data: data, type: pkgType })\n    }, { _: { type: pkgType } })\n  }\n\n  public oncePkg (pkgType: PkgType, listener: ConnectionListener): string {\n    return super.onceMatch(ConnEvent.CONN_PKG, ({ data, ...rest }: ConnectionListenerPayload) => {\n      listener({ ...rest, data: data, type: pkgType })\n    }, { _: { type: pkgType } })\n  }\n\n  public async untilPkg (pkgType: PkgType, timeout?: number): Promise<ConnectionListenerPayload> {\n    if (pkgType === undefined) throw new Error('trying to subscribe undefined pkgType')\n    return await super.untilMatch(ConnEvent.CONN_PKG, { _: { type: pkgType } }, timeout, pkgType)\n      .then(({ data, ...rest }: ConnectionListenerPayload) => {\n        return { ...rest, data: data, type: pkgType }\n      })\n  }\n\n  public on (event: ConnEvent, listener: ConnectionListener): string {\n    return super.on(event, listener)\n  }\n\n  public once (event: ConnEvent, listener: ConnectionListener): string {\n    return super.once(event, listener)\n  }\n\n  public emit (event: ConnEvent, payload: ConnectionListenerPayload): void {\n    const { conn, ...toLog } = payload\n    this.log('emit', event, { ...toLog, ...(conn !== undefined ? { conn: { id: conn?.id } } : {}) })\n    super.emit(event, payload)\n  }\n\n  private enrichConn (connection: Connection): Connection {\n    this.connections.push(connection)\n    return connection\n  }\n\n  public disconnect (id: string): void {\n    this.connections.find(c => c.id === id)?.close()\n  }\n\n  public disconnectAll (): void {\n    this.connections.map(conn => conn.close())\n  }\n\n  public destroy (): void {\n    this.closed = true\n    this.peer.destroy()\n    this.disconnectAll()\n  }\n\n  public close (): void {\n    this.closed = true\n    this.peer.destroy()\n    this.disconnectAll()\n  }\n}\n","import { CylinderBufferGeometry, Mesh, MeshBasicMaterial, Object3D } from 'three'\n\nconst cylinderGeometry = new CylinderBufferGeometry(4, 4, 1, 12)\nconst cylinderMaterial = new MeshBasicMaterial()\ncylinderMaterial.visible = false\ncylinderMaterial.name = 'invisible'\nconst cylinderMesh = new Mesh(cylinderGeometry, cylinderMaterial)\nexport const CYLINDER_OBJ = new Object3D()\nCYLINDER_OBJ.name = 'cylinder'\nCYLINDER_OBJ.add(cylinderMesh)\n\nexport const basicGray = new MeshBasicMaterial({\n  color: 0xcccccc\n})\n","import { Geometry, Material, Mesh, Object3D, Texture } from 'three'\nimport { BufferGeometry } from 'three/src/core/BufferGeometry'\nimport { basicGray } from './extraObjects'\n\nexport const disposeObj3D = (obj3d?: Object3D | null): void => {\n  obj3d?.traverse((obj) => {\n    if (obj instanceof Mesh) {\n      const geometry = obj.geometry as Geometry | BufferGeometry | undefined\n      const material = obj.material as Material | Material[] | undefined\n\n      if (geometry !== undefined) {\n        geometry.dispose()\n      }\n\n      const disposeMaterial = (material: Material): void => {\n        Object.keys(material).forEach((key) => {\n          const prop = material[key as keyof Material] as unknown\n          if (prop instanceof Texture) {\n            prop.dispose()\n          }\n        })\n        material.dispose()\n      }\n\n      if (material !== undefined) {\n        // Assuming no texture is used\n        if (Array.isArray(material)) {\n          material.forEach(disposeMaterial)\n        } else {\n          disposeMaterial(material)\n        }\n      }\n    }\n  })\n}\n\nexport const swapMaterial = (child: Object3D): void => {\n  if (child instanceof Mesh) {\n    child.material = basicGray\n  }\n}\n","import { Component, Types } from 'ecsy'\nimport { Color, GrowthStage } from '../../3d/constants'\nimport { Object3D } from 'three'\nimport { disposeObj3D } from '../../3d/helpers'\nimport { ECSYThreeEntity } from 'ecsy-three'\n\nexport default class TreeComponent extends Component<TreeComponent> {\n  readonly color!: Color\n  growthStage!: GrowthStage\n  topObj?: Object3D\n  trunkObj?: Object3D\n  plant?: ECSYThreeEntity\n  seed?: ECSYThreeEntity\n  tree?: ECSYThreeEntity\n  shade?: ECSYThreeEntity\n  groundShade?: ECSYThreeEntity\n\n  reset (): void {\n    this.plant?.remove()\n    this.seed?.remove()\n    this.tree?.remove()\n    this.shade?.remove()\n    this.groundShade?.remove()\n    this.plant = undefined\n    this.seed = undefined\n    this.tree = undefined\n    this.shade = undefined\n    disposeObj3D(this.topObj)\n    disposeObj3D(this.trunkObj)\n    this.topObj = undefined\n    this.trunkObj = undefined\n  }\n}\n\nTreeComponent.schema = {\n  color: { type: Types.Number },\n  growthStage: { type: Types.Number },\n  tree: { type: Types.Ref, default: undefined },\n  topObj: { type: Types.Ref, default: undefined },\n  trunkObj: { type: Types.Ref, default: undefined },\n  shade: { type: Types.Ref, default: undefined },\n  seed: { type: Types.Ref, default: undefined }\n}\n","import { Vector3 } from 'three'\n\nexport const MODELS_LOCATION = process.env.PUBLIC_URL + '/models'\n\nexport const MODELS = {\n  BLUE_TOP: 'blueTop',\n  ORANGE_TOP: 'orangeTop',\n  YELLOW_TOP: 'yellowTop',\n  GREEN_TOP: 'greenTop',\n  TRUNK: 'trunk',\n  SHADE: 'shade',\n  GROUND_SHADE: 'groundShade',\n  ACORN: 'acorn',\n  PINE_CONE: 'pineCone',\n  MAPLE_SEED: 'mapleSeed',\n  BASSWOOD_SEED: 'basswoodSeed',\n  RING: 'ring',\n  LANDSCAPE: 'landscape'\n} as const\n\nexport enum Color {\n  BLUE,\n  ORANGE,\n  YELLOW,\n  GREEN\n}\n\nexport enum GrowthStage {\n  SEED,\n  SHORT,\n  MID,\n  TALL\n}\n\nexport type ModelName = typeof MODELS[keyof typeof MODELS]\n\nexport const TREE_MODELS: Record<Color, ModelName> = {\n  [Color.BLUE]: MODELS.BLUE_TOP,\n  [Color.ORANGE]: MODELS.ORANGE_TOP,\n  [Color.YELLOW]: MODELS.YELLOW_TOP,\n  [Color.GREEN]: MODELS.GREEN_TOP\n} as const\n\nexport const SEED_MODELS: Record<Color, ModelName> = {\n  [Color.BLUE]: MODELS.PINE_CONE,\n  [Color.ORANGE]: MODELS.BASSWOOD_SEED,\n  [Color.YELLOW]: MODELS.ACORN,\n  [Color.GREEN]: MODELS.MAPLE_SEED\n} as const\n\n// Rendering specifics\nexport const AMBIENT_COLOR = 0x191F48\nexport const SUN_COLOR = 0xF8FFB2\nexport const SKY_COLOR = 0xcaf1fc\nexport const INACTIVE_COLOR = 0x333333\nexport const COLOR_VALUES: { [k in Color]: number } = {\n  [Color.BLUE]: 0x1C77E9,\n  [Color.ORANGE]: 0xD9311A,\n  [Color.YELLOW]: 0xE9D51C,\n  [Color.GREEN]: 0x53E91C\n}\n\nexport const SHADE_Y: { [k in GrowthStage]: number } = [-18, -10.7, -5.63, 0]\n\nexport const SUN_ANGLE = 52.725\n\nexport const TREE_TOP_Y = 10\n\nexport const TILE_SIZE = 5\n\nexport const INITIAL_SUN_ORIENTATION = 1.50 * Math.PI\n\nexport const GROUND_SHADE_HIDDEN_ROTATION = -0.8\n\nexport interface TreeGrowthProp {\n  tree: { scale: Vector3 }\n  seed: { scale: Vector3 }\n}\n\nexport const TREE_GROWTH_PROPS: { [k in GrowthStage]: TreeGrowthProp } = {\n  [GrowthStage.SEED]: {\n    tree: {\n      scale: new Vector3(0, 0, 0)\n    },\n    seed: {\n      scale: new Vector3(1, 1, 1)\n    }\n  },\n  [GrowthStage.SHORT]: {\n    tree: {\n      scale: new Vector3(0.333, 0.333, 0.333)\n    },\n    seed: {\n      scale: new Vector3(0, 0, 0)\n    }\n  },\n  [GrowthStage.MID]: {\n    tree: {\n      scale: new Vector3(0.666, 0.666, 0.666)\n    },\n    seed: {\n      scale: new Vector3(0, 0, 0)\n    }\n  },\n  [GrowthStage.TALL]: {\n    tree: {\n      scale: new Vector3(1, 1, 1)\n    },\n    seed: {\n      scale: new Vector3(0, 0, 0)\n    }\n  }\n}\n\n// Animations\nexport const TREE_GROWTH_DURATION = 1.5\nexport const GROUND_SHADE_DURATION = TREE_GROWTH_DURATION / 3 * 2\n\n// Gameplay\nexport const ACTION_COST_SEED = 1\n\nexport const ACTION_COST_GROW: { [k in GrowthStage]: number } = {\n  [GrowthStage.SEED]: 1,\n  [GrowthStage.SHORT]: 2,\n  [GrowthStage.MID]: 3,\n  [GrowthStage.TALL]: 4\n} as const\n\nexport const ACTION_COST_PURCHASE: { [k in GrowthStage]: readonly number[] } = {\n  [GrowthStage.SEED]: [1, 1, 2, 2],\n  [GrowthStage.SHORT]: [2, 2, 3, 3],\n  [GrowthStage.MID]: [3, 3, 4],\n  [GrowthStage.TALL]: [4, 5]\n} as const\n","import { Mesh, Object3D } from 'three'\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { MODELS, MODELS_LOCATION } from './constants'\n\nexport const objects: Record<string, Object3D | undefined> = {}\n\nconst objectWaitOrders: Record<string, Array<{\n  resolve: (value?: Object3D | PromiseLike<Object3D>) => void\n  reject: (reason?: unknown) => void\n  modelName: string\n}> | undefined> = {}\n\nlet loadedCount = 0\nlet totalCount = 0\n\nexport const resetAssets = (): void => {\n  Object.keys(objects).forEach(key => {\n    objects[key] = undefined\n  })\n  loadedCount = 0\n  totalCount = 0\n}\n\nconst modelNotFoundMessage = 'Model not found'\n\nconst doneLoading = (): void => {\n  // Clean up unhandled promises\n  Object.values(objectWaitOrders)\n    .filter(orders => Array.isArray(orders))\n    .forEach(orders => orders?.forEach(({ reject, modelName }) => reject(new Error(modelNotFoundMessage + ': ' + modelName))))\n  Object.keys(objectWaitOrders).forEach(key => {\n    objectWaitOrders[key] = undefined\n  })\n}\n\nexport const startLoad = (): void => {\n  const loader = new GLTFLoader()\n  const modelNames = Object.values(MODELS)\n  totalCount = modelNames.length\n  modelNames.forEach(name => {\n    loader.load(\n      MODELS_LOCATION + '/' + name + '.glb',\n      (gltf) => {\n        // Process objects\n        const object = new Object3D()\n        object.name = name\n        object.add(...gltf.scene.children)\n        object.traverse(child => {\n          if (child instanceof Mesh) {\n            child.castShadow = true\n            child.receiveShadow = true\n          }\n        })\n        objects[name] = object\n\n        // Resolve promises\n        const waitOrders = objectWaitOrders[name]\n        if (waitOrders !== undefined) {\n          waitOrders.forEach(order => {\n            order.resolve(object)\n          })\n          objectWaitOrders[name] = undefined\n        }\n\n        // Loaded\n        loadedCount++\n        if (loadedCount === totalCount) {\n          doneLoading()\n        }\n      },\n      undefined,\n      (e) => console.error(e)\n    )\n  })\n}\n\nexport const getObject = async (modelName: string): Promise<Object3D> => {\n  const obj3d = objects[modelName]\n  if (obj3d === undefined) {\n    if (loadedCount !== totalCount) {\n      // Not all models are loaded, this model may be loading\n      const queue = objectWaitOrders[modelName] ?? []\n      if (objectWaitOrders[modelName] === undefined) {\n        objectWaitOrders[modelName] = queue\n      }\n      return await new Promise<Object3D>((resolve, reject) => {\n        queue.push({ resolve, reject, modelName })\n      })\n    } else {\n      // Model name is definitely not loaded\n      return Promise.reject(new Error(modelNotFoundMessage + ': ' + modelName))\n    }\n  } else {\n    return Promise.resolve(obj3d)\n  }\n}\n","import { TagComponent } from 'ecsy'\n\nexport default class SunOrientationTagComponent extends TagComponent {}\n","import { ECSYThreeSystem, ECSYThreeWorld } from 'ecsy-three'\nimport GameWorld from '../GameWorld'\nimport { GameWorldAttributes } from '../types/GameWorldAttributes'\n\nexport default abstract class GameWorldSystem extends ECSYThreeSystem {\n  protected readonly gameWorld: GameWorld\n\n  public constructor (world: ECSYThreeWorld, attributes?: GameWorldAttributes) {\n    super(world, attributes)\n    if (attributes?.gameWorld === undefined) {\n      throw new Error('Game world must be provided')\n    }\n    this.gameWorld = attributes?.gameWorld\n  }\n}\n","import { Component, Types } from 'ecsy'\nimport Axial from '../../3d/Coordinates/Axial'\n\nexport default class AxialCoordsComponent extends Component<AxialCoordsComponent> {\n  axial!: Axial\n}\n\nAxialCoordsComponent.schema = {\n  axial: { type: Types.Ref }\n}\n","import { Component, Types } from 'ecsy'\nimport { MeshStandardMaterial } from 'three'\nimport { ECSYThreeEntity } from 'ecsy-three'\n\nexport default class TileComponent extends Component<TileComponent> {\n  material?: MeshStandardMaterial\n  treeEntity?: ECSYThreeEntity\n}\n\nTileComponent.schema = {\n  material: { type: Types.Ref, default: undefined },\n  treeEntity: { type: Types.Ref, default: undefined }\n}\n","import { TweenFunction } from '../types/TweenObjectProperties'\nimport { EasingFunction, TweenValueMapper } from '../types/Easing'\nimport { Euler, Vector2, Vector3 } from 'three'\n\nconst applyEasing = <T> (mapper: TweenValueMapper<T>) =>\n  (func: EasingFunction<T>): TweenFunction<T> =>\n    (from: T, to: T, value: number) =>\n      mapper(from, to, func(value))\n\nexport const applyNumber = applyEasing<number>(\n  (from, to, value) => to * value + from * (1 - value)\n)\n\nexport const applyVector3 = applyEasing<Vector3>(\n  (from, to, value) =>\n    to.clone().multiply(value).sub(from.clone().multiply(value.clone().subScalar(1)))\n)\n\nexport const applyVector2 = applyEasing<Vector2>(\n  (from, to, value) =>\n    to.clone().multiply(value).sub(from.clone().multiply(value.clone().subScalar(1)))\n)\n\nexport const toEulerTween = (func: TweenFunction<Vector3>): TweenFunction<Euler> =>\n  (from, to, value) => new Euler().setFromVector3(func(from.toVector3(), to.toVector3(), value))\n","import bezier from 'bezier-easing'\n\nexport default bezier(0.2, 1.61, 0.7, -0.1)\n// export default bezier(0.13, 1.85, 0.57, -0.08)\n","import bezier from 'bezier-easing'\n\nexport default bezier(0.32, -0.16, 0, 1.51)\n// export default bezier(0.49, -0.16, 0, 1.09)\n","import bezier from 'bezier-easing'\n\nexport default bezier(0, 0, 0.58, 1)\n","import { Vector3 } from 'three'\nimport { compose } from 'ramda'\nimport inverseElastic from '../1d/inverseElastic'\nimport elastic from '../1d/elastic'\nimport easeOut from '../1d/easeOut'\n\nconst hEase = compose(inverseElastic, easeOut)\nconst vEase = compose(elastic, easeOut)\n\nexport default (i: number): Vector3 => {\n  const xz = hEase(i)\n  return new Vector3(xz, vEase(i), xz)\n}\n","import { Component, Entity, Types } from 'ecsy'\nimport TweenProperties from '../types/TweenProperties'\n\n// TODO deep clone when getObject\n// TODO tween material\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default class TweenComponent<T extends TweenProperties<any>> extends Component<TweenComponent<T>> {\n  tweens: T[] = []\n\n  reset (): void {\n    super.reset()\n    this.tweens = []\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  static queueTween<T extends TweenProperties<any>> (entity: Entity, tween: T): void {\n    entity.getMutableComponent<TweenComponent<T>>(TweenComponent)?.tweens.push(tween)\n    // console.log(entity.id, tween)\n  }\n}\n\nTweenComponent.schema = {\n  tweens: { type: Types.Array, default: [] }\n}\n","import { Vector3 } from 'three'\n\nexport default (i: number): Vector3 => new Vector3().addScalar(i)\n","import { TagComponent } from 'ecsy'\n\nexport default class SelectableTagComponent extends TagComponent {}\n","import TreeComponent from '../components/TreeComponent'\nimport { getObject } from '../../3d/assets'\nimport {\n  Color, GROUND_SHADE_DURATION,\n  GROUND_SHADE_HIDDEN_ROTATION,\n  GrowthStage,\n  MODELS,\n  SEED_MODELS,\n  SHADE_Y, TREE_GROWTH_DURATION,\n  TREE_GROWTH_PROPS,\n  TREE_MODELS,\n  TREE_TOP_Y\n} from '../../3d/constants'\nimport { ECSYThreeEntity, Object3DComponent } from 'ecsy-three'\nimport { Euler, Object3D, Vector3 } from 'three'\nimport SunOrientationTagComponent from '../components/SunOrientationTagComponent'\nimport GameWorldSystem from './GameWorldSystem'\nimport AxialCoordsComponent from '../components/AxialCoordsComponent'\nimport TileComponent from '../components/TileComponent'\nimport { applyVector3, toEulerTween } from '../easing/applyEasing'\nimport jelly from '../easing/3d/jelly'\nimport TweenComponent from '../components/TweenComponent'\nimport TweenObjectProperties from '../types/TweenObjectProperties'\nimport linear from '../easing/3d/linear'\nimport SelectableTagComponent from '../components/SelectableTagComponent'\n\nexport default class TreeSystem extends GameWorldSystem {\n  execute (delta: number, time: number): void {\n    this.queries.trees.removed?.forEach(entity => {\n      // Removed\n      const treeComp = entity.getComponent(TreeComponent)\n      const axialComp = entity.getComponent(AxialCoordsComponent)\n      if (treeComp === undefined || axialComp === undefined) {\n        return\n      }\n\n      const linkedTileComp = this.gameWorld.tileEntities.get(axialComp.axial.toString())?.getMutableComponent(TileComponent)\n      if (linkedTileComp !== undefined) {\n        linkedTileComp.treeEntity = undefined\n      }\n    })\n\n    this.queries.trees.changed?.forEach(TreeSystem.updateGrowthStage.bind(this))\n\n    this.queries.trees.added?.forEach((entity) => {\n      // Added\n      const treeComp = entity.getMutableComponent(TreeComponent)\n      const axialComp = entity.getComponent<AxialCoordsComponent>(AxialCoordsComponent)\n      const obj3d = entity.getObject3D()\n      if (treeComp === undefined || obj3d === undefined || axialComp === undefined) {\n        return\n      }\n\n      const linkedTileComp = this.gameWorld.tileEntities.get(axialComp.axial.toString())?.getMutableComponent(TileComponent)\n      if (linkedTileComp !== undefined) {\n        linkedTileComp.treeEntity = entity\n      }\n\n      const { color } = treeComp\n      obj3d.name = 'tree-' + entity.id.toString() + '-' + Color[color]\n\n      // setup components\n      const objectsToFetch = [\n        getObject(TREE_MODELS[color]),\n        getObject(MODELS.TRUNK),\n        getObject(SEED_MODELS[color]),\n        getObject(MODELS.SHADE),\n        getObject(MODELS.GROUND_SHADE)\n      ]\n\n      Promise.all(objectsToFetch).then((objs) => {\n        const [\n          topObj,\n          trunkObj,\n          seedObj,\n          shadeObj,\n          groundShadeObj\n        ] = objs.map(o => o.clone())\n\n        const shadeContainer = new Object3D()\n        shadeContainer.name = 'shadeContainer'\n        shadeContainer.add(shadeObj)\n        shadeContainer.position.y = SHADE_Y[treeComp.growthStage]\n\n        const groundShadeContainer = new Object3D()\n        groundShadeContainer.name = 'groundShadeContainer'\n\n        const treeObj = new Object3D()\n        treeObj.name = 'tree'\n        topObj.position.y = TREE_TOP_Y\n        treeComp.topObj = topObj\n        treeComp.trunkObj = trunkObj\n        treeObj.add(topObj, trunkObj)\n\n        const plantContainerObj = new Object3D()\n        plantContainerObj.name = 'plantContainer'\n        plantContainerObj.rotation.y = Math.random() * Math.PI * 2\n        plantContainerObj.add(treeObj, seedObj)\n\n        treeComp.plant = this.world\n          .createEntity()\n          .addObject3DComponent(plantContainerObj, entity)\n          .addComponent(SelectableTagComponent)\n        treeComp.tree = this.world\n          .createEntity()\n          .addObject3DComponent(treeObj, treeComp.plant)\n          .addComponent(TweenComponent)\n        treeComp.seed = this.world\n          .createEntity()\n          .addObject3DComponent(seedObj, treeComp.plant)\n          .addComponent(TweenComponent)\n        treeComp.shade = this.world\n          .createEntity()\n          .addObject3DComponent(shadeContainer, entity)\n          .addComponent(SunOrientationTagComponent)\n          .addComponent(TweenComponent)\n        const groundShadeContainerEntity = this.world\n          .createEntity()\n          .addObject3DComponent(groundShadeContainer, entity)\n          .addComponent(SunOrientationTagComponent)\n        treeComp.groundShade = this.world\n          .createEntity()\n          .addObject3DComponent(groundShadeObj, groundShadeContainerEntity)\n          .addComponent(TweenComponent)\n\n        // Initialize scales and positions\n        groundShadeObj.rotation.x = treeComp.growthStage === GrowthStage.SEED ? GROUND_SHADE_HIDDEN_ROTATION : 0\n        shadeContainer.position.y = SHADE_Y[treeComp.growthStage]\n        treeObj.scale.fromArray(TREE_GROWTH_PROPS[treeComp.growthStage].tree.scale.toArray())\n        seedObj.scale.fromArray(TREE_GROWTH_PROPS[treeComp.growthStage].seed.scale.toArray())\n      }).catch(console.error)\n    })\n  }\n\n  private static updateGrowthStage (entity: ECSYThreeEntity): void {\n    // Changed\n    const treeComp = entity.getComponent(TreeComponent)\n    if (treeComp === undefined) {\n      return\n    }\n\n    const {\n      tree,\n      seed,\n      shade,\n      groundShade\n    } = treeComp\n\n    const treeObj = tree?.getObject3D()\n    const seedObj = seed?.getObject3D()\n    const shadeObj = shade?.getObject3D()\n    const groundShadeObj = groundShade?.getObject3D()\n\n    // Flexibility for animations\n    if (shade !== undefined && shadeObj !== undefined) {\n      TweenComponent.queueTween<TweenObjectProperties<Object3D, 'position'>>(shade, {\n        duration: TREE_GROWTH_DURATION,\n        loop: 1,\n        value: 0,\n        prop: 'position',\n        from: shadeObj.position,\n        to: new Vector3(0, SHADE_Y[treeComp.growthStage], 0),\n        func: applyVector3(jelly)\n      })\n    }\n    if (groundShade !== undefined && groundShadeObj !== undefined) {\n      TweenComponent.queueTween<TweenObjectProperties<Object3D, 'rotation'>>(groundShade, {\n        duration: GROUND_SHADE_DURATION,\n        loop: 1,\n        value: 0,\n        prop: 'rotation',\n        from: groundShadeObj.rotation,\n        to: new Euler(treeComp.growthStage === GrowthStage.SEED ? GROUND_SHADE_HIDDEN_ROTATION : 0, 0, 0),\n        func: toEulerTween(applyVector3(linear))\n      })\n    }\n    if (tree !== undefined && treeObj !== undefined) {\n      TweenComponent.queueTween<TweenObjectProperties<Object3D, 'scale'>>(tree, {\n        duration: TREE_GROWTH_DURATION,\n        loop: 1,\n        value: 0,\n        prop: 'scale',\n        from: treeObj.scale.clone(),\n        to: TREE_GROWTH_PROPS[treeComp.growthStage].tree.scale.clone(),\n        func: applyVector3(jelly)\n      })\n    }\n    if (seed !== undefined && seedObj !== undefined) {\n      TweenComponent.queueTween<TweenObjectProperties<Object3D, 'scale'>>(seed, {\n        duration: TREE_GROWTH_DURATION,\n        loop: 1,\n        value: 0,\n        prop: 'scale',\n        from: seedObj.scale.clone(),\n        to: TREE_GROWTH_PROPS[treeComp.growthStage].seed.scale.clone(),\n        func: applyVector3(jelly)\n      })\n    }\n  }\n}\n\n/*\nGrowth stages:\n0: seed model, scale = 1 easeInOutBack => tree model scale 0 grow out, seed shrink\n1: tree model, scale = 0.33 easeInOutBack\n2: tree model, scale = 0.66 easeInOutBack\n3: tree model, scale = 1 easeInOutBack\n */\n\nTreeSystem.queries = {\n  trees: {\n    components: [\n      TreeComponent, Object3DComponent\n    ],\n    listen: {\n      added: true,\n      removed: true,\n      changed: [TreeComponent, AxialCoordsComponent]\n    }\n  }\n}\n","import { ECSYThreeSystem, Object3DComponent } from 'ecsy-three'\nimport TweenComponent from '../components/TweenComponent'\nimport { Object3D } from 'three'\nimport TweenObjectProperties from '../types/TweenObjectProperties'\n\nexport default class TweenSystem extends ECSYThreeSystem {\n  execute (delta: number, time: number): void {\n    (this.queries.object3DTweens?.results ?? []).forEach(entity => {\n      const obj3d = entity?.getObject3D()\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const tweenComp = entity.getMutableComponent<TweenComponent<TweenObjectProperties<Object3D, any>>>(TweenComponent)\n\n      if (obj3d === undefined ||\n        tweenComp === undefined) {\n        return\n      }\n\n      const newTweens: typeof tweenComp.tweens = []\n\n      tweenComp.tweens.forEach((tweenProp) => {\n        if (tweenProp === undefined) {\n          return\n        }\n\n        // only accepts 'scale' | 'rotation' | 'position'\n        if (tweenProp.prop in ['scale', 'rotation', 'position']) {\n          return\n        }\n\n        const tweenObj3dProp = tweenProp as unknown as TweenObjectProperties<Object3D, 'scale' | 'position' | 'rotation' | 'quaternion'>\n\n        const {\n          duration,\n          value: oldValue,\n          prop,\n          from,\n          to,\n          func\n        } = tweenObj3dProp\n\n        const value = Math.min(1, delta / duration + oldValue)\n        tweenObj3dProp.value = value\n\n        const result = func(from, to, value)\n\n        obj3d[prop].fromArray(result.toArray())\n\n        if (value === 1) {\n          // Tweening is complete\n          if (tweenObj3dProp.loop > 0) {\n            // Next loop\n            tweenObj3dProp.loop--\n            tweenObj3dProp.value = 0\n          }\n          if (tweenObj3dProp.loop === 0) {\n            // Keep prop\n            return\n          }\n        }\n\n        newTweens.push(tweenProp)\n      })\n\n      tweenComp.tweens = newTweens\n    })\n  }\n}\n\nTweenSystem.queries = {\n  object3DTweens: {\n    components: [TweenComponent, Object3DComponent]\n  }\n}\n","import AxialCoordsComponent from '../components/AxialCoordsComponent'\nimport { ECSYThreeSystem, Object3DComponent } from 'ecsy-three'\nimport { TILE_SIZE } from '../../3d/constants'\n\nexport default class AxialCoordsSystem extends ECSYThreeSystem {\n  execute (delta: number, time: number): void {\n    this.queries.axialPositions.results.forEach(entity => {\n      const axial = entity.getComponent(AxialCoordsComponent)?.axial\n      const obj3d = entity.getObject3D()\n\n      if (axial === undefined || obj3d === undefined) {\n        return\n      }\n\n      const prevQ = (obj3d.userData.q) as number | undefined\n      const prevR = (obj3d.userData.r) as number | undefined\n\n      if (prevQ !== axial.q && prevR !== axial.r) {\n        const [x, z] = axial.toCartesian(TILE_SIZE).toArray()\n        obj3d.userData.q = axial.q\n        obj3d.userData.r = axial.r\n        obj3d.position.set(x, 0, z)\n      }\n    })\n  }\n}\n\nAxialCoordsSystem.queries = {\n  axialPositions: {\n    components: [AxialCoordsComponent, Object3DComponent]\n  }\n}\n","import TileComponent from '../components/TileComponent'\nimport { ECSYThreeSystem } from 'ecsy-three'\nimport { COLOR_VALUES, INACTIVE_COLOR } from '../../3d/constants'\nimport TreeComponent from '../components/TreeComponent'\n\nexport default class TileSystem extends ECSYThreeSystem {\n  execute (delta: number, time: number): void {\n    this.queries.tiles.results.forEach(entity => {\n      const tileComp = entity.getComponent<TileComponent>(TileComponent)\n\n      if (tileComp === undefined || tileComp.material === undefined) {\n        return\n      }\n\n      let newColor: number\n\n      if (tileComp.treeEntity !== undefined) {\n        const treeComp = tileComp.treeEntity.getComponent(TreeComponent)\n\n        if (treeComp === undefined) {\n          return\n        }\n\n        newColor = COLOR_VALUES[treeComp.color]\n      } else {\n        newColor = INACTIVE_COLOR\n      }\n\n      if (newColor !== tileComp.material.color.getHex()) {\n        tileComp.material.color.setHex(newColor)\n      }\n    })\n  }\n}\n\nTileSystem.queries = {\n  tiles: {\n    components: [TileComponent]\n  }\n}\n","import { Object3DComponent } from 'ecsy-three'\nimport SunOrientationTagComponent from '../components/SunOrientationTagComponent'\nimport GameWorldSystem from './GameWorldSystem'\n\nexport default class SunOrientationSystem extends GameWorldSystem {\n  execute (delta: number, time: number): void {\n    this.queries.sunFacingObjs.results.forEach(entity => {\n      const obj3d = entity.getObject3D()\n      if (obj3d === undefined) {\n        return\n      }\n      obj3d.rotation.y = this.gameWorld.sunOrientationRad\n    })\n  }\n}\n\nSunOrientationSystem.queries = {\n  sunFacingObjs: {\n    components: [SunOrientationTagComponent, Object3DComponent]\n  }\n}\n","import GameWorld from '../GameWorld'\nimport { Object3D } from 'three'\nimport TreeComponent from '../components/TreeComponent'\nimport { Color, GrowthStage } from '../../3d/constants'\nimport { Axial } from '../../3d/Coordinates/Axial'\nimport AxialCoordsComponent from '../components/AxialCoordsComponent'\nimport { ECSYThreeEntity } from 'ecsy-three'\n\nexport interface TreeOptions {\n  color: Color\n  growthStage: GrowthStage\n  axial: Axial\n}\n\nexport const createTree = (gameWorld: GameWorld, { color, growthStage, axial }: TreeOptions): ECSYThreeEntity | undefined => {\n  const tree = new Object3D()\n\n  const tileEntity = gameWorld.tileEntities.get(axial.toString())\n\n  if (tileEntity === undefined) {\n    console.error('Tile not found: ' + axial.toString())\n    return\n  }\n\n  return gameWorld.world\n    .createEntity()\n    .addObject3DComponent(tree, gameWorld.gameEntity)\n    .addComponent(TreeComponent, {\n      color,\n      growthStage\n    })\n    .addComponent(AxialCoordsComponent, {\n      axial\n    })\n}\n","import Axial from './Axial'\nimport Coordinates from './Coordinates'\n\nexport default class HexCube implements Coordinates<HexCube> {\n  public x: number\n  public y: number\n  public z: number\n\n  constructor (x: number, y: number, z: number) {\n    this.x = x\n    this.y = y\n    this.z = z\n  }\n\n  public static neighbors: HexCube[] = [\n    new HexCube(+1, -1, 0), new HexCube(+1, 0, -1), new HexCube(0, +1, -1),\n    new HexCube(-1, +1, 0), new HexCube(-1, 0, +1), new HexCube(0, -1, +1)\n  ]\n\n  public static fromArray (a: [number, number, number]): HexCube {\n    return new HexCube(...a)\n  }\n\n  public static fromString (s: string): HexCube {\n    const a = s.split(',').map((i: string) => parseInt(i, 10))\n    return HexCube.fromArray([a[0], a[1], a[2]])\n  }\n\n  public static get origin (): HexCube {\n    return new HexCube(0, 0, 0)\n  }\n\n  public toArray (): [number, number, number] {\n    return [this.x, this.y, this.z]\n  }\n\n  public toString (): string {\n    return this.toArray().join(',')\n  }\n\n  public toAxial (): Axial {\n    return new Axial(this.x, this.z)\n  }\n\n  public add (hexCube: HexCube): HexCube {\n    this.x += hexCube.x\n    this.y += hexCube.y\n    this.z += hexCube.z\n    return this\n  }\n\n  public scale (n: number): HexCube {\n    this.x *= n\n    this.y *= n\n    this.z *= n\n    return this\n  }\n\n  public tileDistance (t: HexCube): number {\n    return (Math.abs(this.x - t.x) + Math.abs(this.y - t.y) + Math.abs(this.z - t.z)) / 2\n  }\n\n  public range (r: number): HexCube[] {\n    const results: HexCube[] = []\n    for (let x = -r; x <= r; x++) {\n      for (let y = Math.max(-r, -x - r); y <= Math.min(r, -x + r); y++) {\n        const z = -x - y\n        results.push(\n          new HexCube(this.x + x, this.y + y, this.z + z)\n        )\n      }\n    }\n    return results\n  }\n}\n","import Coordinates from './Coordinates'\n\nexport default class Cartesian2D implements Coordinates<Cartesian2D> {\n  public x: number\n  public y: number\n\n  constructor (x: number, y: number) {\n    this.x = x\n    this.y = y\n  }\n\n  public static fromArray (a: [number, number]): Cartesian2D {\n    return new Cartesian2D(...a)\n  }\n\n  public static fromString (s: string): Cartesian2D {\n    const a = s.split(',').map((i: string) => parseInt(i, 10))\n    return Cartesian2D.fromArray([a[0], a[1]])\n  }\n\n  public static neighbors: Cartesian2D[] = [\n    new Cartesian2D(-1, -1),\n    new Cartesian2D(0, -1),\n    new Cartesian2D(1, -1),\n    new Cartesian2D(-1, 0),\n    new Cartesian2D(1, 0),\n    new Cartesian2D(-1, 1),\n    new Cartesian2D(0, 1),\n    new Cartesian2D(1, 1)\n  ]\n\n  public static get origin (): Cartesian2D {\n    return new Cartesian2D(0, 0)\n  }\n\n  public toArray (): [number, number] {\n    return [this.x, this.y]\n  }\n\n  public toString (): string {\n    return this.toArray().join(',')\n  }\n\n  public add (coords: Cartesian2D): Cartesian2D {\n    this.x += coords.x\n    this.y += coords.y\n    return this\n  }\n\n  public scale (n: number): Cartesian2D {\n    this.x *= n\n    this.y *= n\n    return this\n  }\n\n  public euclideanDistance (t: Cartesian2D): number {\n    return Math.sqrt((this.x - t.x) ** 2 + (this.y - t.y) ** 2)\n  }\n\n  public manhattanDistance (t: Cartesian2D): number {\n    return this.x - t.x + (this.y - t.y)\n  }\n\n  public added (coord: Cartesian2D): Cartesian2D {\n    const ret = new Cartesian2D(this.x, this.y)\n    return ret.add(coord)\n  }\n\n  public scaled (n: number): Cartesian2D {\n    const ret = new Cartesian2D(this.x, this.y)\n    return ret.scale(n)\n  }\n\n  public norm (): number {\n    return this.euclideanDistance(Cartesian2D.origin)\n  }\n\n  public normalize (): Cartesian2D {\n    return this.scale(1 / this.norm())\n  }\n\n  public normalized (): Cartesian2D {\n    const ret = new Cartesian2D(this.x, this.y)\n    return ret.normalize()\n  }\n\n  public clone (): Cartesian2D {\n    return new Cartesian2D(this.x, this.y)\n  }\n}\n","import HexCube from './HexCube'\nimport Coordinates from './Coordinates'\nimport Cartesian2D from './Cartesian2D'\n\nexport default class Axial implements Coordinates<Axial> {\n  public q: number\n  public r: number\n\n  constructor (q: number, r: number) {\n    this.q = q\n    this.r = r\n  }\n\n  public static neighbors = [\n    new Axial(+1, 0),\n    new Axial(+1, -1),\n    new Axial(0, -1),\n    new Axial(-1, 0),\n    new Axial(-1, +1),\n    new Axial(0, +1)\n  ]\n\n  public static fromArray (a: [number, number]): Axial {\n    return new Axial(...a)\n  }\n\n  public static fromString (s: string): Axial {\n    const a = s.split(',').map((i: string) => parseInt(i, 10))\n    return Axial.fromArray([a[0], a[1]])\n  }\n\n  static get origin (): Axial {\n    return new Axial(0, 0)\n  }\n\n  public toArray (): [number, number] {\n    return [this.q, this.r]\n  }\n\n  public toString (): string {\n    return this.toArray().join(',')\n  }\n\n  public toHexCube (): HexCube {\n    return new HexCube(this.q, -this.q - this.r, this.r)\n  }\n\n  public toCartesian (size: number): Cartesian2D {\n    const x = size * (Math.sqrt(3) * this.q + (Math.sqrt(3) / 2) * this.r)\n    const y = size * ((3 / 2) * this.r)\n    return new Cartesian2D(x, y)\n  }\n\n  public add (axial: Axial): Axial {\n    this.q += axial.q\n    this.r += axial.r\n    return this\n  }\n\n  public scale (n: number): Axial {\n    this.q *= n\n    this.r *= n\n    return this\n  }\n\n  public tileDistance (t: Axial): number {\n    return (\n      (Math.abs(this.q - t.q) +\n        Math.abs(this.q + this.r - t.q - t.r) +\n        Math.abs(this.r - t.r)) /\n      2\n    )\n  }\n\n  public range (r: number): Axial[] {\n    return this.toHexCube().range(r).map((c) => c.toAxial())\n  }\n}\n\nexport { Axial }\n","import GameWorldSystem from './GameWorldSystem'\nimport Hammer from 'hammerjs'\n\nexport default class TouchSystem extends GameWorldSystem {\n  hm!: HammerManager\n  panDistances: Array<[number, number]> = []\n\n  private readonly onMouseMove = (event: TouchEvent | MouseEvent): void => {\n    let x, y\n\n    if (event instanceof MouseEvent) {\n      x = event.clientX\n      y = event.clientY\n    } else {\n      x = event.changedTouches[0].pageX\n      y = event.changedTouches[0].pageY\n    }\n\n    this.gameWorld.mouseScreenPosition.x = (x / window.innerWidth) * 2 - 1\n    this.gameWorld.mouseScreenPosition.y = -(y / window.innerHeight) * 2 + 1\n\n    this.gameWorld.hasMouseMoved = true\n  }\n\n  init (): void {\n    const canvas = this.gameWorld.renderer.domElement\n\n    this.hm = new Hammer(canvas)\n    this.hm.add(new Hammer.Pan({ direction: Hammer.DIRECTION_ALL }))\n    this.hm.on('pan', ({ velocityX, velocityY }) => {\n      this.panDistances.push([velocityX, velocityY])\n    })\n    this.hm.on('tap', () => {\n      console.log('ran')\n      this.gameWorld.activeObject = this.gameWorld.hoverObject\n    })\n    this.hm.on('pinch', ({ scale }) => {\n      this.gameWorld.camera.position.z = Math.max(0.999, Math.min(this.gameWorld.camera.position.z * (scale), 4))\n    })\n\n    canvas.addEventListener('touchmove', this.onMouseMove)\n    canvas.addEventListener('mousemove', this.onMouseMove)\n  }\n\n  dispose (): void {\n    this.hm.destroy()\n  }\n\n  execute (delta: number, time: number): void {\n    while (this.panDistances.length > 0) {\n      const [hDistance, vDistance] = this.panDistances.pop()\n      this.gameWorld.cameraRotationObj.rotation.y -= hDistance * 0.05\n\n      const newTilt = this.gameWorld.cameraTiltObj.rotation.x - vDistance * 0.05\n      this.gameWorld.cameraTiltObj.rotation.x = Math.max(-Math.PI / 2, Math.min(-0.1, newTilt))\n    }\n  }\n}\n","import { RefPropType, Types } from 'ecsy'\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer'\nimport { WebGLRendererComponent } from 'ecsy-three'\nimport { Camera, Object3D, WebGLRenderer } from 'three'\nimport { OutlinePass } from 'three/examples/jsm/postprocessing/OutlinePass'\nimport { ShaderPass } from 'three/examples/jsm/postprocessing/ShaderPass'\n\nexport default class RendererComposerComponent extends WebGLRendererComponent {\n  composer!: EffectComposer\n  outlinePass!: OutlinePass\n  effectFXAA!: ShaderPass\n\n  static schema: {\n    composer: { type: RefPropType<EffectComposer> }\n    renderer: { type: RefPropType<WebGLRenderer> }\n    scene: { type: RefPropType<Object3D> } // this is wrong, but lib also wrong\n    camera: { type: RefPropType<Camera> } // this is wrong, but lib also wrong\n    outlinePass: { type: RefPropType<OutlinePass> }\n    effectFXAA: { type: RefPropType<ShaderPass>}\n  }\n}\n\nRendererComposerComponent.schema = {\n  composer: { type: Types.Ref as RefPropType<EffectComposer> },\n  renderer: { type: Types.Ref as RefPropType<WebGLRenderer> },\n  scene: { type: Types.Ref as RefPropType<Object3D> }, // this is wrong, but lib also wrong\n  camera: { type: Types.Ref as RefPropType<Camera> }, // this is wrong, but lib also wrong\n  outlinePass: { type: Types.Ref as RefPropType<OutlinePass> },\n  effectFXAA: { type: Types.Ref as RefPropType<ShaderPass> }\n}\n","import { ECSYThreeObject3D, WebGLRendererComponent } from 'ecsy-three'\nimport { Object3D, PerspectiveCamera, Scene, sRGBEncoding, Vector2 } from 'three'\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer'\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass'\nimport { OutlinePass } from 'three/examples/jsm/postprocessing/OutlinePass'\nimport RendererComposerComponent from '../components/RendererComposerComponent'\nimport GameWorldSystem from './GameWorldSystem'\nimport { ShaderPass } from 'three/examples/jsm/postprocessing/ShaderPass'\nimport { FXAAShader } from 'three/examples/jsm/shaders/FXAAShader'\n\nexport class RendererComposerSystem extends GameWorldSystem {\n  private needsResize = true\n  private intersectionCounter = 0\n\n  onResize (): void {\n    this.needsResize = true\n  }\n\n  init (): void {\n    this.needsResize = true\n    this.onResize = this.onResize.bind(this)\n    window.addEventListener('resize', this.onResize.bind(this), false)\n  }\n\n  dispose (): void {\n    window.removeEventListener('resize', this.onResize.bind(this))\n  }\n\n  execute (delta: number, time: number): void {\n    this.intersectionCounter += delta\n\n    // Change renderers into composerRenderers\n    this.queries.renderers.results.forEach(entity => {\n      const component = entity.getComponent(WebGLRendererComponent)\n      if (component === undefined) {\n        return\n      }\n\n      const camera = component.camera.getObject3D() as PerspectiveCamera | undefined\n      const scene = component.scene.getObject3D() as Scene | undefined\n      const renderer = component.renderer\n\n      if (scene === undefined || camera === undefined) {\n        return\n      }\n\n      const canvas = renderer.domElement\n      const width = canvas.clientWidth\n      const height = canvas.clientHeight\n\n      const composer = new EffectComposer(renderer)\n      composer.renderTarget1.texture.encoding = sRGBEncoding\n      composer.renderTarget2.texture.encoding = sRGBEncoding\n      const renderPass = new RenderPass(scene, camera)\n      composer.addPass(renderPass)\n      const outlinePass = new OutlinePass(new Vector2(width, height), scene, camera)\n      outlinePass.edgeStrength = 10\n      outlinePass.edgeThickness = 2\n      outlinePass.hiddenEdgeColor.set(0xFFFFFF)\n      composer.addPass(outlinePass)\n      const effectFXAA = new ShaderPass(FXAAShader)\n      // eslint-disable-next-line\n      effectFXAA.uniforms['resolution'].value.set(1 / width, 1 / height)\n      composer.addPass(effectFXAA)\n\n      entity.addComponent(RendererComposerComponent, {\n        renderer,\n        scene: component.scene,\n        camera: component.camera,\n        composer,\n        outlinePass,\n        effectFXAA\n      })\n\n      entity.removeComponent(WebGLRendererComponent)\n    })\n\n    this.queries.rendererComposers.results.forEach(entity => {\n      const component = entity.getComponent(RendererComposerComponent)\n      if (component === undefined) {\n        return\n      }\n      const camera = component.camera.getObject3D() as PerspectiveCamera | undefined\n      const scene = component.scene.getObject3D() as Scene | undefined\n      const renderer = component.renderer\n      const composer = component.composer\n      const effectFXAA = component.effectFXAA\n      const outlinePass = component.outlinePass\n\n      if (scene === undefined || camera === undefined) {\n        return\n      }\n\n      if (this.needsResize) {\n        const canvas = renderer.domElement\n\n        const curPixelRatio = renderer.getPixelRatio()\n\n        if (curPixelRatio !== window.devicePixelRatio) {\n          renderer.setPixelRatio(window.devicePixelRatio)\n          composer.setPixelRatio(window.devicePixelRatio)\n        }\n\n        const width = canvas.clientWidth\n        const height = canvas.clientHeight\n\n        camera.aspect = width / height\n        camera.updateProjectionMatrix()\n        renderer.setSize(width, height, false)\n        composer.setSize(width, height)\n        outlinePass.resolution.set(width, height)\n        // eslint-disable-next-line\n        effectFXAA.uniforms['resolution'].value.set(1 / width, 1 / height)\n\n        this.needsResize = false\n      }\n\n      const hoverObject = this.gameWorld.hoverObject\n      const activeObject = this.gameWorld.activeObject\n\n      outlinePass.selectedObjects = [hoverObject, activeObject !== hoverObject ? activeObject : undefined]\n        .filter((x): x is (Object3D & ECSYThreeObject3D) => x !== undefined)\n\n      composer.render()\n    })\n  }\n}\n\nRendererComposerSystem.queries = {\n  renderers: {\n    components: [WebGLRendererComponent],\n    listen: {\n      added: true\n    }\n  },\n  rendererComposers: { components: [RendererComposerComponent] }\n}\n","import GameWorldSystem from './GameWorldSystem'\nimport SelectableTagComponent from '../components/SelectableTagComponent'\nimport { ECSYThreeObject3D, Object3DComponent } from 'ecsy-three'\nimport { Object3D, Raycaster } from 'three'\n\nconst isECSYObject3D = (o: Object3D): o is (Object3D & ECSYThreeObject3D) => 'entity' in o\n\nexport default class SelectionSystem extends GameWorldSystem {\n  private static readonly CHECK_PERIOD = 0.05\n  private secondsElapsed = 0\n  private readonly raycaster = new Raycaster()\n\n  execute (delta: number, time: number): void {\n    if (!this.gameWorld.hasMouseMoved) {\n      return\n    }\n    this.gameWorld.hasMouseMoved = false\n\n    this.secondsElapsed += delta\n    if (this.secondsElapsed >= SelectionSystem.CHECK_PERIOD) {\n      this.secondsElapsed -= SelectionSystem.CHECK_PERIOD\n    } else {\n      return\n    }\n\n    const selectableEntities = this.queries.selectables.results\n    const selectableObjs = selectableEntities\n      .map(entity => entity.getObject3D<Object3D>())\n      .filter((o?: Object3D & ECSYThreeObject3D): o is (Object3D & ECSYThreeObject3D) => o !== undefined)\n\n    this.raycaster.setFromCamera(this.gameWorld.mouseScreenPosition, this.gameWorld.camera)\n    const intersections = this.raycaster.intersectObjects(selectableObjs, true)\n\n    if (intersections.length > 0) {\n      const intersectedObject = intersections[0].object\n      let parent: Object3D | null = intersectedObject\n      let currentRef: Object3D | null = intersectedObject\n      let willContinueSearch = true\n      do {\n        currentRef = parent\n        parent = currentRef?.parent ?? null\n        if (parent !== null) {\n          if (isECSYObject3D(parent)) {\n            willContinueSearch = parent.entity.getComponent(SelectableTagComponent) === undefined\n          } else if (currentRef !== parent) {\n            willContinueSearch = true\n          }\n        }\n      } while (willContinueSearch)\n\n      if (currentRef === parent) {\n        console.error('currentRef cannot be parent')\n      } else if (parent === null) {\n        console.error('parent cannot be null')\n      } else if (isECSYObject3D(parent)) {\n        this.gameWorld.hoverObject = parent\n      }\n    } else {\n      this.gameWorld.hoverObject = undefined\n    }\n  }\n}\n\nSelectionSystem.queries = {\n  selectables: {\n    components: [SelectableTagComponent, Object3DComponent]\n  }\n}\n","import { ConnectionManager } from './ConnectionManager'\nimport { ConnectionListenerPayload, ConnEvent } from './ConnectionTypes'\nimport { PkgType } from './PkgType'\nimport { Connection } from './Connection'\nimport { Observable } from './Observable'\nimport { clone } from 'ramda'\nimport { pause } from './pause'\n\nexport enum StarMeshNetworkEvents {\n  STATE_CHANGE,\n  MEMBERS_CHANGE,\n  MEMBERS_JOIN,\n  MEMBERS_LEFT,\n  NETWORK_ERROR,\n  HOST_CHANGE\n}\n\nexport interface StarMeshEventPayload<T> {\n  state?: T\n  members?: string[]\n  error?: Error\n  host?: string\n}\n\nexport type StarMeshAction = Record<string, unknown>\n\nexport type StarMeshReducer<T, U = never> = (prevState: T, action: U | StarMeshAction, connId: string) => T\n\ninterface MemberChangePayload {\n  members: string[]\n  host?: string\n}\n\nconst isMemberChangePayload = (data: unknown): data is MemberChangePayload => {\n  if (typeof data === 'object' && data !== null) {\n    if ('members' in data && 'host' in data) {\n      const d = data as { members: unknown, host: unknown }\n      return Array.isArray(d.members) && d.members.reduce((p: boolean, c) => p && typeof c === 'string', true)\n    }\n  }\n  return false\n}\n\nexport class StarMeshNetwork<T = Record<string, unknown>> extends Observable<typeof StarMeshNetworkEvents, StarMeshEventPayload<T>> {\n  hostConnectionManager?: ConnectionManager\n  myConnectionManager: ConnectionManager\n  meToHostConnection?: Connection\n  members: string[] = []\n\n  state: T\n  networkName?: string\n\n  reducer?: StarMeshReducer<T>\n  hostId?: string\n  initialState: T\n\n  public get id (): string {\n    return this.myConnectionManager.id\n  }\n\n  constructor (myConnectionManager: ConnectionManager, initialState: T, reducer?: StarMeshReducer<T>) {\n    super()\n    this.reducer = reducer\n    this.initialState = clone(initialState)\n    this.myConnectionManager = myConnectionManager\n    this.initMyConnectionManagerListeners()\n    this.state = clone(initialState)\n  }\n\n  private readonly networkErrorHandler = (error: Error): void => {\n    // console.log(this.id, error)\n    this.emit(StarMeshNetworkEvents.NETWORK_ERROR, { error })\n  }\n\n  public isHost (): boolean | undefined {\n    if (this.hostConnectionManager !== undefined) {\n      return true\n    } else if (this.meToHostConnection !== undefined) {\n      return false\n    } else {\n      return undefined\n    }\n  }\n\n  public sendToHost = async (pkgType: PkgType, data: unknown): Promise<ConnectionListenerPayload> => {\n    if (this.meToHostConnection === undefined) {\n      throw new Error('not connected to host')\n    }\n    return await this.myConnectionManager.sendPkg(this.meToHostConnection.id, pkgType, data)\n  }\n\n  public get myId (): string {\n    return this.myConnectionManager.id\n  }\n\n  private readonly initMyConnectionManagerListeners = (): void => {\n    this.myConnectionManager.onPkg(PkgType.MEMBER_CHANGE, ({ data }) => {\n      this.handleMemberChange(data).catch(this.networkErrorHandler)\n    })\n    this.myConnectionManager.onPkg(PkgType.SET_STATE, ({ data }) => {\n      this.emit(StarMeshNetworkEvents.STATE_CHANGE, { state: data as T })\n      this.state = data as T\n    })\n    this.myConnectionManager.onPkg(PkgType.DISPATCH, this.dispatchHandler)\n  }\n\n  public async joinOrHost (networkName: string): Promise<void> {\n    this.networkName = networkName\n    try {\n      await this.host(networkName)\n      await this.join(networkName)\n    } catch (e) {\n      await this.join(networkName)\n    }\n  }\n\n  private readonly host = async (networkName: string): Promise<void> => {\n    const hostConnection = await ConnectionManager.startPrefix(networkName)\n    const oldHost = this.hostId\n    this.hostId = this.id\n    this.hostConnectionManager = hostConnection\n    this.hostConnectionManager.on(ConnEvent.CONN_OPEN, ({ conn }) => {\n      if (conn !== undefined) {\n        this.hostConnectionManager?.broadcastPkg(PkgType.MEMBER_CHANGE, {\n          host: this.hostId,\n          members: [...this.members, conn.id]\n        })\n          .catch(this.networkErrorHandler)\n        conn.sendPkg(PkgType.SET_STATE, clone(this.state)).catch(this.networkErrorHandler)\n      }\n    })\n    this.hostConnectionManager.on(ConnEvent.CONN_CLOSE, ({ conn }) => {\n      this.hostConnectionManager?.broadcastPkg(PkgType.MEMBER_CHANGE, {\n        host: this.id,\n        members: this.members.filter(id => id !== conn?.id)\n      })\n        .catch(this.networkErrorHandler)\n    })\n    // if there are existing members, probably the members were connected to a disconnected host\n    // so update them to use the new host\n    if (this.members.length > 0) {\n      const members = this.members.filter(n => n !== oldHost)\n      await Promise.all(members.map(async (id: string): Promise<Connection> => await hostConnection?.connect(id))).catch(console.log)\n      await hostConnection.broadcastPkg(PkgType.MEMBER_CHANGE, {\n        host: this.id,\n        members\n      })\n    }\n  }\n\n  private readonly join = async (networkName: string): Promise<void> => {\n    this.meToHostConnection = await this.myConnectionManager.connectPrefix(networkName)\n    this.meToHostConnection.on(ConnEvent.CONN_CLOSE, () => {\n      if (this.members.length > 1) {\n        if (this.networkName !== undefined && !this.myConnectionManager.isClosed() && this.members.filter(n => n !== this.hostId)[0] === this.id) {\n          this.host(this.networkName).catch(this.networkErrorHandler)\n        }\n      }\n    })\n    while (this.members.length === 0) {\n      await pause(100)\n    }\n    while (!this.members.reduce((flag: boolean, member) => flag && undefined !== this.myConnectionManager.connections.find(({ id }) => id === member), true)) {\n      await pause(100)\n    }\n  }\n\n  private readonly handleMemberChange = async (data: unknown): Promise<void> => {\n    if (isMemberChangePayload(data)) {\n      this.emit(StarMeshNetworkEvents.HOST_CHANGE, { host: data.host })\n      if (data.members.length === this.members.length && this.members.reduce((f: boolean, c) => f && data.members.includes(c), true)) {\n        return\n      }\n      this.hostId = data.host\n      const oldList = [...this.members]\n      const newList = data.members\n      this.members = [...newList]\n      // connect to new member\n      const memberJoining = newList.filter(n => !oldList.includes(n))\n      const memberLeaving = oldList.filter(n => !newList.includes(n))\n      try {\n        await Promise.all(memberJoining.map(async n => {\n          return await this.myConnectionManager.connect(n)\n        }))\n        // disconnect leave member\n        memberLeaving.forEach(n => {\n          this.myConnectionManager.disconnect(n)\n        })\n      } catch (e) {\n        this.emit(StarMeshNetworkEvents.NETWORK_ERROR, e)\n        console.log(e)\n      }\n      if (memberJoining.length > 0 || memberLeaving.length > 0) {\n        this.emit(StarMeshNetworkEvents.MEMBERS_CHANGE, { members: this.members })\n      }\n      if (memberJoining.length > 0) {\n        this.emit(StarMeshNetworkEvents.MEMBERS_JOIN, { members: memberJoining })\n      }\n      if (memberLeaving.length > 0) {\n        this.emit(StarMeshNetworkEvents.MEMBERS_LEFT, { members: memberLeaving })\n      }\n    } else {\n      throw new Error('wrong member change payload')\n    }\n  }\n\n  public setReducer = (reducer: StarMeshReducer<T>): void => {\n    this.reducer = reducer\n  }\n\n  public dispatch = async (action: StarMeshAction): Promise<void> => {\n    const responses = await Promise.all(this.members.map(async (id) => await this.myConnectionManager.conn(id).sendPkg(PkgType.DISPATCH, action)))\n    responses.forEach(({ data }) => {\n      if (data !== undefined && data !== true) {\n        if (typeof data === 'string') {\n          throw new Error(data)\n        }\n      }\n    })\n  }\n\n  public dispatchLocal = async (action: StarMeshAction): Promise<void> => {\n    if (this.reducer === undefined) {\n      this.emit(StarMeshNetworkEvents.NETWORK_ERROR, { error: new Error('no reducer defined') })\n      throw new Error('no reducer defined')\n    }\n    const newState = this.reducer(this.state, action, this.id)\n    this.setState(newState)\n    return await Promise.resolve()\n  }\n\n  private readonly dispatchHandler = ({ conn, data, ack }: ConnectionListenerPayload): void => {\n    if (this.reducer === undefined) {\n      this.emit(StarMeshNetworkEvents.NETWORK_ERROR, { error: new Error('no reducer defined') })\n      ack?.('no reducer defined')\n    } else if (conn === undefined) {\n      this.emit(StarMeshNetworkEvents.NETWORK_ERROR, { error: new Error('no conn') })\n      ack?.('no conn')\n    } else {\n      try {\n        const stateStaging = this.reducer(this.state, data as StarMeshAction, conn.id)\n        this.setState(stateStaging)\n        ack?.(true)\n      } catch (e: unknown) {\n        ack?.((e as Error).message)\n      }\n    }\n  }\n\n  private readonly setState = (newState: T): void => {\n    this.state = newState\n    this.emit(StarMeshNetworkEvents.STATE_CHANGE, { state: newState })\n  }\n\n  public leave = (): void => {\n    this.networkName = undefined\n    this.hostConnectionManager?.destroy()\n    this.meToHostConnection?.close()\n    this.emit(StarMeshNetworkEvents.MEMBERS_LEFT, { members: this.members })\n    this.emit(StarMeshNetworkEvents.MEMBERS_CHANGE, { members: [] })\n    this.meToHostConnection = undefined\n    this.hostConnectionManager = undefined\n    this.state = clone(this.initialState)\n    this.members = []\n    this.hostId = undefined\n  }\n}\n","import { ECSYThreeEntity, ECSYThreeObject3D, ECSYThreeWorld, initialize, WebGLRendererSystem } from 'ecsy-three'\nimport {\n  AmbientLight,\n  Clock,\n  DirectionalLight,\n  Group,\n  Mesh,\n  MeshStandardMaterial,\n  Object3D,\n  PerspectiveCamera,\n  sRGBEncoding,\n  Vector2,\n  VSMShadowMap,\n  WebGLRenderer\n} from 'three'\nimport TreeSystem from './systems/TreeSystem'\nimport TweenSystem from './systems/TweenSystem'\nimport { disposeObj3D } from '../3d/helpers'\nimport TreeComponent from './components/TreeComponent'\nimport TweenBaseComponent from './components/TweenComponent'\nimport AxialCoordsComponent from './components/AxialCoordsComponent'\nimport { AMBIENT_COLOR, INITIAL_SUN_ORIENTATION, MODELS, SKY_COLOR, SUN_ANGLE, SUN_COLOR } from '../3d/constants'\nimport { getObject } from '../3d/assets'\nimport TileComponent from './components/TileComponent'\nimport AxialCoordsSystem from './systems/AxialCoordsSystem'\nimport TileSystem from './systems/TileSystem'\nimport SunOrientationTagComponent from './components/SunOrientationTagComponent'\nimport SunOrientationSystem from './systems/SunOrientationSystem'\nimport { createTree } from './entities/tree'\nimport dat from 'dat.gui'\nimport { Axial } from '../3d/Coordinates/Axial'\nimport { CYLINDER_OBJ } from '../3d/extraObjects'\nimport Stats from 'stats.js'\nimport { GameWorldMessages } from './GameWorldMessages'\nimport { TileInfo } from './types/TileInfo'\nimport TouchSystem from './systems/TouchSystem'\nimport { RendererComposerSystem } from './systems/RendererComposerSystem'\nimport RendererComposerComponent from './components/RendererComposerComponent'\nimport SelectableTagComponent from './components/SelectableTagComponent'\nimport SelectionSystem from './systems/SelectionSystem'\n\nexport default class GameWorld {\n  gui: dat.GUI\n  stats: Stats\n\n  renderer: WebGLRenderer\n  world: ECSYThreeWorld\n  sceneEntity!: ECSYThreeEntity\n  camera!: PerspectiveCamera\n  messages: Record<string, unknown[]> = {}\n  cameraTiltObj!: Object3D\n  cameraRotationObj!: Object3D\n\n  sunOrientationRad = 0\n  hasStarted = false\n\n  gameEntity!: ECSYThreeEntity\n  tileEntities: Map<string, ECSYThreeEntity> = new Map<string, ECSYThreeEntity>()\n\n  // ray casting selections\n  mouseScreenPosition = new Vector2()\n  hasMouseMoved = false\n  activeObject?: Object3D & ECSYThreeObject3D\n  hoverObject?: Object3D & ECSYThreeObject3D\n\n  constructor () {\n    this.stats = new Stats()\n    this.gui = new dat.GUI()\n    this.renderer = new WebGLRenderer({ antialias: true })\n    this.world = new ECSYThreeWorld({ entityPoolSize: 1000 })\n    document.body.appendChild(this.stats.dom)\n    window.addEventListener('load', () => {\n      this.init()\n    })\n  }\n\n  public dispose (): void {\n    this.destroyGUI()\n    this.world.stop()\n    this.tileEntities.clear()\n    disposeObj3D(this.sceneEntity?.getObject3D())\n    this.sunOrientationRad = 0\n    this.hasStarted = false\n    console.log('end')\n  }\n\n  public init (): void {\n    if (this.hasStarted) return\n    console.log('start')\n    this.hasStarted = true\n\n    this.initGUI()\n\n    const clock = new Clock()\n    const {\n      camera,\n      sceneEntity\n    } = initialize(this.world, {\n      renderer: this.renderer,\n      animationLoop: () => {\n        this.stats.begin()\n        this.world.execute(clock.getDelta(), clock.elapsedTime)\n        this.stats.end()\n      }\n    })\n    this.camera = camera\n    this.sceneEntity = sceneEntity\n\n    this.initRenderer()\n    this.initECS()\n    this.initScene()\n    this.world.play()\n  }\n\n  private destroyGUI (): void {\n    this.gui.destroy()\n    this.gui = new dat.GUI()\n  }\n\n  private initGUI (): void {\n    const sunControl = this.gui.add(this, 'sunOrientationRad', 0, 2 * Math.PI)\n    sunControl.name('Sun orientation')\n    sunControl.step(0.01)\n  }\n\n  private initECS (): void {\n    this.world.registerComponent(TreeComponent)\n    this.world.registerComponent(TweenBaseComponent)\n    this.world.registerComponent(AxialCoordsComponent)\n    this.world.registerComponent(TileComponent)\n    this.world.registerComponent(SunOrientationTagComponent)\n    this.world.registerComponent(RendererComposerComponent)\n    this.world.registerComponent(SelectableTagComponent)\n\n    this.world.unregisterSystem(WebGLRendererSystem)\n    this.world.registerSystem(RendererComposerSystem, { priority: 999, gameWorld: this })\n\n    this.world.registerSystem(AxialCoordsSystem)\n    this.world.registerSystem(TileSystem)\n    this.world.registerSystem(TreeSystem, { gameWorld: this })\n    this.world.registerSystem(TweenSystem)\n    this.world.registerSystem(SunOrientationSystem, { gameWorld: this })\n    this.world.registerSystem(SelectionSystem, { gameWorld: this })\n    this.world.registerSystem(TouchSystem, { gameWorld: this })\n  }\n\n  private initRenderer (): void {\n    this.renderer.shadowMap.enabled = true\n    this.renderer.shadowMap.type = VSMShadowMap\n    this.renderer.setClearColor(SKY_COLOR)\n    this.renderer.outputEncoding = sRGBEncoding\n  }\n\n  private initScene (): void {\n    this.camera.position.set(0, 0, 95)\n    this.camera.fov = 40\n\n    this.sceneEntity.getObject3D()?.remove(this.camera)\n\n    const cameraTiltObj = new Object3D()\n    cameraTiltObj.name = 'cameraTilt'\n    cameraTiltObj.rotation.x = -0.4\n    cameraTiltObj.add(this.camera)\n    this.cameraTiltObj = cameraTiltObj\n\n    const cameraRotationObj = new Object3D()\n    cameraRotationObj.name = 'cameraRotation'\n    cameraRotationObj.add(cameraTiltObj)\n    this.cameraRotationObj = cameraRotationObj\n\n    const cameraFolder = this.gui.addFolder('Camera')\n\n    cameraFolder.add(this.camera.position, 'z', 20, 300, 1).name('zoom')\n    cameraFolder.add(cameraTiltObj.rotation, 'x', -Math.PI / 2, 0, 0.01).name('tilt')\n    cameraFolder.add(cameraRotationObj.rotation, 'y', 0, Math.PI * 2, 0.01).name('rotation')\n    cameraFolder.open()\n\n    this.world.createEntity()\n      .addObject3DComponent(cameraRotationObj, this.sceneEntity)\n\n    const ambientLight = new AmbientLight(AMBIENT_COLOR, 0.5)\n    const sun = new DirectionalLight(SUN_COLOR, 1.2)\n    sun.position.set(0, Math.sin(SUN_ANGLE) * 150, 150)\n    sun.castShadow = true\n    sun.shadow.camera.visible = true\n    sun.shadow.bias = -0.001\n    sun.shadow.radius = 2\n    sun.shadow.camera.near = 50\n    sun.shadow.camera.far = 300\n    sun.shadow.camera.top = -100\n    sun.shadow.camera.bottom = 50\n    sun.shadow.camera.left = -100\n    sun.shadow.camera.right = 100\n    sun.shadow.mapSize.set(2 ** 9, 2 ** 9)\n    const sunContainer = new Group()\n    sunContainer.name = 'sun'\n    sunContainer.add(sun)\n\n    const sky = new DirectionalLight(0xFFFFFF, 0.2)\n    sky.name = 'sky'\n    sky.position.y = 100\n    // sky.castShadow = true\n    // sky.shadow.bias = -0.001\n    // sky.shadow.radius = 128\n    // sky.shadow.camera.near = 10\n    // sky.shadow.camera.far = 150\n    // sky.shadow.camera.top = -30\n    // sky.shadow.camera.bottom = 30\n    // sky.shadow.camera.left = -30\n    // sky.shadow.camera.right = 30\n    // sky.shadow.mapSize.set(2 ** 13, 2 ** 13)\n\n    const commonLights = new Group()\n    commonLights.name = 'commonLights'\n    commonLights.add(ambientLight, sky)\n\n    const floorObj = new Object3D()\n    getObject(MODELS.LANDSCAPE).then(obj => floorObj.add(obj.clone())).catch(console.error)\n    floorObj.name = 'floor'\n\n    this.world\n      .createEntity()\n      .addObject3DComponent(floorObj, this.sceneEntity)\n\n    this.world\n      .createEntity()\n      .addObject3DComponent(commonLights, this.sceneEntity)\n\n    this.world\n      .createEntity()\n      .addObject3DComponent(sunContainer, this.sceneEntity)\n      .addComponent(SunOrientationTagComponent)\n\n    const game = new Group()\n    game.name = 'Game'\n\n    this.gameEntity = this.world\n      .createEntity()\n      .addObject3DComponent(game, this.sceneEntity)\n\n    this.generateGrid()\n  }\n\n  private generateGrid (): void {\n    const boardObj = new Object3D()\n    boardObj.name = 'gameBoard'\n\n    const boardEntity = this.world\n      .createEntity()\n      .addObject3DComponent(boardObj, this.gameEntity)\n\n    Axial.origin.range(3).forEach(axial => {\n      const tileContainer = new Group()\n      tileContainer.name = 'tileContainer-' + axial.toString()\n      const tileEntity = this.world\n        .createEntity()\n        .addObject3DComponent(tileContainer, boardEntity)\n        .addComponent(AxialCoordsComponent, { axial })\n        .addComponent(TileComponent)\n        .addComponent(SelectableTagComponent)\n      this.tileEntities.set(axial.toString(), tileEntity)\n    })\n\n    getObject(MODELS.RING)\n      .then(ring => {\n        this.tileEntities.forEach(entity => {\n          const ringContainerObj = new Object3D()\n          ringContainerObj.name = 'ringContainer'\n          const ringClone = ring.clone()\n          ringClone.position.y -= 0.3\n          const mesh = ringClone.children.find((o): o is Mesh => o instanceof Mesh)\n          // Assuming material exists and is a MeshStandardMaterial\n          const originalMaterial = mesh?.material\n          const axialComp = entity.getComponent(AxialCoordsComponent)\n          if (mesh !== undefined && originalMaterial instanceof MeshStandardMaterial && axialComp !== undefined) {\n            const material = originalMaterial.clone()\n            mesh.material = material\n            mesh.material.name = 'tileRing-' + axialComp.axial.toString()\n            const tileComp = entity.getMutableComponent(TileComponent)\n            if (tileComp !== undefined) {\n              tileComp.material = material\n            }\n          } else {\n            console.error('Cannot find standard material inside ring object')\n          }\n          ringContainerObj.add(ringClone, CYLINDER_OBJ.clone())\n          entity.getObject3D()?.add(ringContainerObj)\n        })\n      })\n      .catch(console.error)\n  }\n\n  /**\n   * Send and receive messages between main game logic and ECS\n   * @param target Recipient\n   * @param message Message to recipient\n   */\n  public send (target: GameWorldMessages, message: unknown): void {\n    const queue = this.messages[target] ?? []\n\n    if (this.messages[target] === undefined) {\n      this.messages[target] = queue\n    }\n\n    queue.push(message)\n  }\n\n  /**\n   * Set the display at the tile, may\n   * remove it if color or growStage is undefined\n   * create a new tree if that location dont have tree\n   * grow the tree if that location have tree\n   * @param axial\n   * @param color\n   * @param growthStage\n   */\n  public setTile (axial: Axial, { color, growthStage }: Partial<TileInfo> = {}): void {\n    // TODO: implement the description\n    if (color !== undefined && growthStage !== undefined) {\n      createTree(this, { color, growthStage, axial })\n    }\n  }\n\n  public setRayDirection (directionType: number): void {\n    this.sunOrientationRad = INITIAL_SUN_ORIENTATION + directionType * Math.PI / 3\n  }\n}\n","export const pause = async (timeout: number): Promise<void> => await new Promise(resolve => {\n  setTimeout(() => {\n    resolve()\n  }, timeout)\n})\n","import { Room, RoomActionTypes } from '../lib/Room'\nimport { Observable } from '../lib/Observable'\nimport GameWorld from './GameWorld'\nimport { StarMeshAction, StarMeshNetworkEvents, StarMeshReducer } from '../lib/StarMeshNetwork'\nimport { GameState } from './types/GameState'\nimport { getInitialState } from './getInitialState'\nimport { Axial } from '../3d/Coordinates/Axial'\nimport { ACTION_COST_GROW, ACTION_COST_PURCHASE, GrowthStage } from '../3d/constants'\nimport { TileInfo } from './types/TileInfo'\nimport { clone } from 'ramda'\nimport { isTreeGrowthStage } from './isTreeGrowthStage'\n\nexport enum GameEvent {\n  UPDATE_GAME_STATE,\n  REQUEST_GAME_STATE,\n  GAME_OVER,\n  CLICK,\n  GAME_INIT\n}\n\nexport enum GameActions {\n  CLICK,\n  GROW_TREE,\n  END_TURN,\n  PLANT_SEED,\n  PURCHASE,\n}\n\nexport type Coords = [number, number]\n\nexport interface GameEventPayload {\n  data: unknown\n}\n\nexport class Game extends Observable<typeof GameEvent, GameEventPayload> {\n  room: Room\n  gameWorld = new GameWorld()\n\n  public get started (): boolean {\n    return this.room.started\n  }\n\n  public get state (): GameState | undefined {\n    return this.room.network.state.game\n  }\n\n  public static initialState (players: number): GameState {\n    return getInitialState(players)\n  }\n\n  public get me (): string {\n    return this.room.p(this.room.myId)\n  }\n\n  public get mi (): number {\n    return Number.parseInt(this.me)\n  }\n\n  public get nPlayers (): number {\n    return this.room.playerIds.length\n  }\n\n  constructor (room: Room) {\n    super()\n    this.room = room\n    this.room.network.on(StarMeshNetworkEvents.STATE_CHANGE, ({ state }) => {\n      this.emit(GameEvent.UPDATE_GAME_STATE, { data: state?.game })\n    })\n  }\n\n  public start (gameState: GameState): void {\n    //\n  }\n\n  public rejoin (gameState: GameState): void {\n    Object.entries(gameState.board).forEach(([axialString, tileInfo]) => {\n      if (tileInfo.color !== undefined && tileInfo.growthStage !== undefined) {\n        this.setTile(gameState, Axial.fromString(axialString), tileInfo)\n      }\n    })\n    this.setRayDirection(gameState, gameState.rayDirection)\n  }\n\n  public stop (payload: unknown): void {\n    this.emit(GameEvent.GAME_OVER, { data: payload })\n    // this.gameWorld.dispose()\n  }\n\n  public async click (x: number, y: number): Promise<void> {\n    return await this.dispatch({\n      action: GameActions.CLICK,\n      payload: [x, y]\n    }).catch(this.errorHandler)\n  }\n\n  public async endTurn (): Promise<void> {\n    return await this.dispatch({\n      action: GameActions.END_TURN,\n      payload: []\n    })\n  }\n\n  public endTurnHandler (gameState: GameState, _playerId: number): GameState {\n    gameState.turn++\n    gameState.dirtyTiles = []\n    if (gameState.turn === this.nPlayers) {\n      if (gameState.preparingRound > 0) {\n        gameState.preparingRound--\n      }\n      if (gameState.preparingRound === 0) {\n        gameState.rayDirection++\n        if (gameState.rayDirection === 6) {\n          gameState.rayDirection = 0\n          gameState.revolutionLeft--\n        }\n        gameState = this.setRayDirection(gameState, gameState.rayDirection)\n      }\n      gameState.turn = 0\n      if (gameState.revolutionLeft <= -1) {\n        return this.endGameCalculation(gameState)\n      }\n      if (gameState.preparingRound === 0) {\n        gameState = this.photosynthesis(gameState)\n      }\n    }\n    return gameState\n  }\n\n  public photosynthesis (gameState: GameState): GameState {\n    const shadows: { [axial: string]: GrowthStage } = {}\n    const direction: number = gameState.rayDirection\n    Object.entries(gameState.board).forEach(([axialString, tile]) => {\n      if (isTreeGrowthStage(tile.growthStage)) {\n        let axial = Axial.fromString(axialString)\n        for (let distance = 0; distance < tile.growthStage; distance++) {\n          axial = axial.add(Axial.neighbors[direction])\n          shadows[axial.toString()] = Math.max(shadows[axial.toString()] ?? 0, tile.growthStage)\n        }\n      }\n    })\n    Object.entries(gameState.board).forEach(([axialString, tile]) => {\n      if (isTreeGrowthStage(tile.growthStage)) {\n        if (tile.color !== undefined && tile.growthStage > (shadows[axialString] ?? 0)) {\n          gameState.playerInfo[tile.color].lightPoint += tile.growthStage as number\n          gameState.playerInfo[tile.color].lightPoint = Math.min(gameState.playerInfo[tile.color].lightPoint, 20)\n        }\n      }\n    })\n    return gameState\n  }\n\n  public endGameCalculation (gameState: GameState): GameState {\n    let winningsPlayerIds: string[] = []\n    let winningScore = 0\n    gameState.playerInfo.forEach((info, id) => {\n      info.score += Math.floor(info.lightPoint / 3)\n      info.lightPoint = 0\n      if (info.score > winningScore) {\n        winningScore = info.score\n        winningsPlayerIds = [id.toString()]\n      } else if (info.score === winningScore) {\n        winningsPlayerIds.push(id.toString())\n      }\n    })\n    gameState.gameOver = `Player '${winningsPlayerIds.map(i => this.room.whoami(i)).join(', ')}' win`\n    return { ...gameState }\n  }\n\n  public async growTree (axial: Axial): Promise<void> {\n    return await this.dispatch({\n      action: GameActions.GROW_TREE,\n      payload: axial.toString()\n    })\n  }\n\n  public growTreeHandler (gameState: GameState, playerId: number, axial: Axial): GameState {\n    if (!(axial.toString() in gameState.board)) {\n      throw new Error(`${axial.toString()} is not in game board`)\n    }\n    if (gameState.dirtyTiles.includes(axial.toString())) {\n      throw new Error('Cannot act on same tile twice')\n    }\n    if (gameState.preparingRound > 0) {\n      if (gameState.board[axial.toString()].growthStage !== undefined) {\n        throw new Error('Already occupied')\n      }\n      if (gameState.board[axial.toString()].leaves !== 1) {\n        throw new Error('First round can only grow tree on tile with 1 leaf')\n      }\n      --gameState.playerInfo[playerId].availableArea[GrowthStage.SHORT]\n      gameState = this.setTile(gameState, axial, { color: playerId, growthStage: GrowthStage.SHORT })\n      gameState = this.endTurnHandler(gameState, playerId)\n    } else {\n      if (gameState.board[axial.toString()].color !== playerId) {\n        throw new Error('You can only grow trees that belong to you')\n      }\n\n      const existingStage = gameState.board[axial.toString()].growthStage\n      if (existingStage === undefined) {\n        throw new Error('Please use growSeed method to plant a seed')\n      }\n\n      if (gameState.playerInfo[playerId].lightPoint < ACTION_COST_GROW[existingStage]) {\n        throw new Error(`Not enough light point, needed ${ACTION_COST_GROW[existingStage]}, but only have ${gameState.playerInfo[playerId].lightPoint}`)\n      }\n      if (existingStage !== GrowthStage.TALL && gameState.playerInfo[playerId].availableArea[existingStage + 1 as GrowthStage] <= 0) {\n        throw new Error(`Not enough ${GrowthStage[existingStage + 1]}, you need to buy it with light points before growing`)\n      }\n      gameState.playerInfo[playerId].lightPoint -= ACTION_COST_GROW[existingStage]\n      if (existingStage === GrowthStage.TALL) {\n        gameState = this.resetTile(gameState, axial)\n        gameState = this.returnTree(gameState, playerId, GrowthStage.TALL)\n        gameState = this.obtainToken(gameState, playerId, axial)\n      } else {\n        gameState.playerInfo[playerId].availableArea[existingStage + 1 as GrowthStage]--\n        gameState = this.setTile(gameState, axial, { color: playerId, growthStage: existingStage + 1 })\n        gameState = this.returnTree(gameState, playerId, existingStage)\n      }\n      gameState.dirtyTiles.push(axial.toString())\n    }\n    return gameState\n  }\n\n  public async plantSeed (source: Axial, target: Axial): Promise<void> {\n    return await this.dispatch({\n      action: GameActions.PLANT_SEED,\n      payload: [source.toString(), target.toString()]\n    })\n  }\n\n  public plantSeedHandler (gameState: GameState, playerId: number, source: Axial, target: Axial): GameState {\n    if (!(source.toString() in gameState.board)) {\n      throw new Error(`${source.toString()} is not in game board`)\n    }\n    if (!(target.toString() in gameState.board)) {\n      throw new Error(`${target.toString()} is not in game board`)\n    }\n    if (gameState.preparingRound > 0) {\n      throw new Error('Cannot plant seed at preparing round')\n    }\n    if (gameState.playerInfo[playerId].availableArea[GrowthStage.SEED] <= 0) {\n      throw new Error('Not enough available seed, you need to use light point to purchase more')\n    }\n    if (gameState.dirtyTiles.includes(source.toString()) || gameState.dirtyTiles.includes(target.toString())) {\n      throw new Error('Cannot act on same tile twice')\n    }\n    const tileInfo: TileInfo = gameState.board[source.toString()]\n    if (!isTreeGrowthStage(tileInfo.growthStage)) {\n      throw new Error('Source tile needed to be a tree')\n    }\n    if (tileInfo.color !== playerId) {\n      throw new Error('Cannot use other\\'s tree as source')\n    }\n    if (source.tileDistance(target) > tileInfo.growthStage) {\n      throw new Error('Seed is too far from tree')\n    }\n    gameState.dirtyTiles.push(source.toString(), target.toString())\n    gameState.playerInfo[playerId].availableArea[GrowthStage.SEED]--\n    gameState = this.setTile(gameState, target, { color: playerId, growthStage: GrowthStage.SEED })\n    return gameState\n  }\n\n  public async purchase (stage: GrowthStage): Promise<void> {\n    return await this.dispatch({\n      action: GameActions.PURCHASE,\n      payload: stage\n    })\n  }\n\n  public purchaseHandler (gameState: GameState, playerId: number, stage: GrowthStage): GameState {\n    if (gameState.preparingRound > 0) {\n      throw new Error('Cannot purchase at preparing round')\n    }\n    let purchaseIndex: number\n    for (purchaseIndex = 0; purchaseIndex < gameState.playerInfo[playerId].playerBoard[stage].length; purchaseIndex++) {\n      if (gameState.playerInfo[playerId].playerBoard[stage][purchaseIndex]) {\n        break\n      }\n    }\n    if (gameState.playerInfo[playerId].lightPoint < ACTION_COST_PURCHASE[stage][purchaseIndex]) {\n      throw new Error(`Not enough light point to purchase ${GrowthStage[stage]}, ${ACTION_COST_PURCHASE[stage][purchaseIndex].toString()} needed but only have ${gameState.playerInfo[playerId].lightPoint}`)\n    }\n    gameState.playerInfo[playerId].lightPoint -= ACTION_COST_PURCHASE[stage][purchaseIndex]\n    gameState.playerInfo[playerId].playerBoard[stage][purchaseIndex] = false\n    gameState.playerInfo[playerId].availableArea[stage]++\n    return gameState\n  }\n\n  public dispatch = async (action: StarMeshAction): Promise<void> => {\n    if (this.mi !== this.state?.turn) {\n      throw new Error('not your turn')\n    }\n    await this.room.network.dispatch({\n      action: RoomActionTypes.GAME_EVENT,\n      payload: action\n    })\n  }\n\n  public errorHandler = (e: Error): void => {\n    console.log(e)\n  }\n\n  public reducer: StarMeshReducer<GameState> = (prevState, { action, payload }, connId) => {\n    const playerId = this.room.pi(connId)\n    if (prevState.turn !== playerId) {\n      throw new Error('not your turn')\n    }\n    const gameState = clone(prevState)\n    switch (action) {\n      case GameActions.END_TURN: {\n        return this.endTurnHandler(gameState, playerId)\n      }\n      case GameActions.GROW_TREE: {\n        if (typeof payload !== 'string') {\n          throw new Error('invalid payload')\n        }\n        const axial = Axial.fromString(payload)\n        return this.growTreeHandler(gameState, playerId, axial)\n      }\n      case GameActions.PLANT_SEED: {\n        if (!(Array.isArray(payload) && payload.length === 2 && typeof payload[0] === 'string' && typeof payload[1] === 'string')) {\n          throw new Error('invalid payload')\n        }\n        const source = Axial.fromString(payload[0])\n        const target = Axial.fromString(payload[1])\n        return this.plantSeedHandler(gameState, playerId, source, target)\n      }\n      case GameActions.PURCHASE: {\n        if (typeof payload !== 'number') {\n          throw new Error('invalid payload')\n        }\n        const stage = payload as GrowthStage\n        return this.purchaseHandler(gameState, playerId, stage)\n      }\n    }\n    return prevState\n  }\n\n  private setTile (gameState: GameState, axial: Axial, tileInfo: Partial<TileInfo>): GameState {\n    gameState.board[axial.toString()].growthStage = tileInfo.growthStage\n    gameState.board[axial.toString()].color = tileInfo.color\n    this.gameWorld.setTile(axial, tileInfo)\n    return gameState\n  }\n\n  private resetTile (gameState: GameState, axial: Axial): GameState {\n    gameState.board[axial.toString()].color = undefined\n    gameState.board[axial.toString()].growthStage = undefined\n    this.gameWorld.setTile(axial)\n    return gameState\n  }\n\n  private returnTree (gameState: GameState, playerId: number, stage: GrowthStage): GameState {\n    for (let i = 0; i < gameState.playerInfo[playerId].playerBoard[stage].length; i++) {\n      if (!gameState.playerInfo[playerId].playerBoard[stage][i]) {\n        gameState.playerInfo[playerId].playerBoard[stage][i] = true\n        break\n      }\n    }\n    return gameState\n  }\n\n  private obtainToken (gameState: GameState, playerId: number, axial: Axial): GameState {\n    for (let leaves = gameState.board[axial.toString()].leaves; leaves >= 1; leaves--) {\n      const scoreToken = gameState.scoreTokens[leaves]\n      const amount = scoreToken.shift()\n      if (amount !== undefined) {\n        gameState.playerInfo[playerId].score += amount\n        break\n      }\n    }\n    return gameState\n  }\n\n  private setRayDirection (gameState: GameState, rayDirection: number): GameState {\n    gameState.rayDirection = rayDirection\n    this.gameWorld.setRayDirection(rayDirection)\n    return gameState\n  }\n}\n","import { clone } from 'ramda'\nimport { Color, GrowthStage } from '../3d/constants'\nimport { PlayerInfo } from './types/PlayerInfo'\nimport { GameState } from './types/GameState'\nimport { TileMap } from './types/TileMap'\nimport HexCube from '../3d/Coordinates/HexCube'\n\nconst getInitialPlayerInfo = (color: Color): PlayerInfo => clone({\n  lightPoint: 0,\n  score: 0,\n  color,\n  availableArea: {\n    [GrowthStage.SEED]: 2,\n    [GrowthStage.SHORT]: 4,\n    [GrowthStage.MID]: 1,\n    [GrowthStage.TALL]: 0\n  },\n  playerBoard: {\n    [GrowthStage.SEED]: [true, true, true, true],\n    [GrowthStage.SHORT]: [true, true, true, true],\n    [GrowthStage.MID]: [true, true, true],\n    [GrowthStage.TALL]: [true, true]\n  }\n})\n\nconst getInitialBoard = (): TileMap => {\n  const map: TileMap = {}\n  new HexCube(0, 0, 0).range(3).forEach(hexCube => {\n    const i = hexCube.tileDistance(HexCube.origin)\n    map[hexCube.toAxial().toString()] = {\n      leaves: 4 - i as 1 | 2 | 3 | 4\n    }\n  })\n  return map\n}\n\nexport const getInitialState = (players: number): GameState => {\n  const state: GameState = {\n    preparingRound: 2,\n    dirtyTiles: [],\n    turn: 0,\n    rayDirection: -1,\n    revolutionLeft: 3,\n    board: getInitialBoard(),\n    scoreTokens: {\n      1: [14, 14, 13, 13, 13, 12, 12, 12, 12],\n      2: [17, 16, 16, 14, 14, 13, 13, 13],\n      3: [19, 18, 18, 17, 17],\n      4: [22, 21, 20]\n    },\n    playerInfo: [],\n    photosynthesisHints: []\n  }\n  for (let id = 0; id < players; id++) {\n    state.playerInfo[id] = getInitialPlayerInfo(id)\n  }\n  if (players === 2) {\n    state.scoreTokens[3] = []\n  }\n  return state\n}\n","import { GrowthStage } from '../3d/constants'\n\nexport const isTreeGrowthStage = (stage: GrowthStage | undefined): stage is (GrowthStage.SHORT | GrowthStage.MID | GrowthStage.TALL) => {\n  return stage !== undefined && [GrowthStage.SHORT, GrowthStage.MID, GrowthStage.TALL].includes(stage)\n}\n","import { ConnectionManager } from './ConnectionManager'\nimport { Observable } from './Observable'\nimport { Game } from '../Game/Game'\nimport { StarMeshEventPayload, StarMeshNetwork, StarMeshNetworkEvents, StarMeshReducer } from './StarMeshNetwork'\nimport { clone } from 'ramda'\nimport { GameState } from '../Game/types/GameState'\n\nconst CH = 'ABCDEFGHJKLMNOPQRSTUVWXYZ'\n\nconst generateRoomCode = (): string => {\n  return [0, 0, 0, 0].map(() => CH[Math.floor(Math.random() * CH.length)]).join('')\n}\n\nexport enum RoomActionTypes {\n  JOIN,\n  LEAVE,\n  RENAME,\n  START_GAME,\n  END_GAME,\n  GAME_EVENT,\n}\n\nexport enum RoomEvents {\n  SET_PLAYERS,\n  SET_HOST,\n  START_GAME,\n  ERROR,\n  END_GAME,\n}\n\nexport interface RoomEventPayload {\n  data: unknown\n}\n\nexport interface PlayersDict {\n  [id: string]: string\n}\n\nexport interface RoomState {\n  players: PlayersDict\n  minPlayers: number\n  maxPlayers: number\n  game?: GameState\n  idDict?: PlayersDict\n  nameDict?: PlayersDict\n}\n\nconst initialState = Object.freeze({\n  maxPlayers: 4,\n  minPlayers: 2,\n  players: {}\n})\n\nexport class Room extends Observable<typeof RoomEvents, RoomEventPayload> {\n  network: StarMeshNetwork<RoomState>\n  manager: ConnectionManager\n  game: Game\n\n  public get state (): RoomState {\n    return this.network.state\n  }\n\n  public get hostPlayerId (): string | undefined {\n    return this.network.hostId\n  }\n\n  public get roomCode (): string | undefined {\n    return this.network.networkName\n  }\n\n  public get myId (): string {\n    return this.network.id\n  }\n\n  public get players (): PlayersDict {\n    return this.state.players\n  }\n\n  public get playerIds (): string[] {\n    return Object.keys(this.players)\n  }\n\n  /**\n   * given peerjs id return in game player id or\n   * given in game player id return peerjs id\n   * @param id\n   */\n  public p (id: string | number): string {\n    if (this.state.idDict === undefined) {\n      console.trace('Game not started yet')\n      throw new Error('Game not started yet')\n    }\n    return this.state.idDict[id]\n  }\n\n  /**\n   * given conn id return in game player id in integer\n   * @param id\n   */\n  public pi (id: string): number {\n    if (this.state.idDict === undefined) {\n      console.trace('Game not started yet')\n      throw new Error('Game not started yet')\n    }\n    return Number.parseInt(this.state.idDict[id])\n  }\n\n  /**\n   *  given name, return in game player id\n   * @param name\n   */\n  public n (name: string): string {\n    if (this.state.nameDict === undefined) {\n      console.trace('Game not started yet')\n      throw new Error('Game not started yet')\n    }\n    return this.state.nameDict[name]\n  }\n\n  /**\n   * Given game player id, return name\n   * @param id\n   */\n  public whoami (id: string): string {\n    if (this.state.idDict === undefined) {\n      console.trace('Game not started yet')\n      throw new Error('Game not started yet')\n    }\n    const idDictElement = this.state.idDict[id]\n    if (idDictElement === undefined) {\n      throw new Error(`Id ${id} not in game`)\n    }\n    return this.state.players[idDictElement]\n  }\n\n  public get started (): boolean {\n    return this.state.game !== undefined && this.state.game.gameOver === undefined\n  }\n\n  public static getName (roomState: RoomState, id: number): string {\n    if (roomState.idDict !== undefined && roomState.players !== undefined) {\n      return roomState.players[roomState.idDict[id]]\n    } else {\n      return ''\n    }\n  }\n\n  constructor (manager?: ConnectionManager) {\n    super()\n    this.manager = manager ?? new ConnectionManager()\n    this.network = new StarMeshNetwork<RoomState>(this.manager, clone(initialState), this.networkReducer)\n    this.network.on(StarMeshNetworkEvents.MEMBERS_LEFT, ({ members }) => {\n      if (members !== undefined) {\n        members.forEach(id => {\n          this.network.dispatchLocal({\n            action: RoomActionTypes.LEAVE,\n            payload: id\n          }).catch(this.errorHandler)\n        })\n      }\n    })\n    this.network.on(StarMeshNetworkEvents.HOST_CHANGE, ({ host }) => {\n      if (host !== undefined) {\n        this.emit(RoomEvents.SET_HOST, { data: host })\n      }\n    })\n    this.game = new Game(this)\n  }\n\n  public create = async (myName: string, roomCode?: string): Promise<string> => {\n    const code = roomCode === undefined || roomCode === '' ? generateRoomCode() : roomCode\n    await this.join(myName, code)\n    return code\n  }\n\n  public join = async (myName: string, roomCode: string): Promise<void> => {\n    if (roomCode === '') {\n      throw new Error('Room name is required')\n    }\n    console.log(`joining ${roomCode}`)\n    await this.network.joinOrHost(roomCode)\n    await this.network.dispatch({\n      action: RoomActionTypes.JOIN,\n      payload: myName\n    }).catch(e => {\n      this.leaveRoom()\n      throw e\n    })\n  }\n\n  public joinOrCreate = this.join\n\n  private readonly errorHandler = ({ error }: StarMeshEventPayload<RoomState>): void => {\n    console.log(error)\n    this.emit(RoomEvents.ERROR, { data: error })\n  }\n\n  public rename = async (name: string): Promise<void> => {\n    return await this.network.dispatch({\n      action: RoomActionTypes.RENAME,\n      payload: name\n    })\n  }\n\n  public leaveRoom = (): void => {\n    this.network.leave()\n    this.emit(RoomEvents.SET_HOST, { data: undefined })\n  }\n\n  public startGame = async (): Promise<void> => {\n    const idDict: PlayersDict = {}\n    const nameDict: PlayersDict = {}\n    Object.entries(this.players).forEach(([id, name], k) => {\n      idDict[id] = k.toString()\n      idDict[k] = id\n      nameDict[name] = k.toString()\n    })\n    return await this.network.dispatch({\n      action: RoomActionTypes.START_GAME,\n      payload: {\n        idDict,\n        nameDict\n      }\n    })\n  }\n\n  public endGame = async (message: string): Promise<void> => {\n    return await this.network.dispatch({\n      action: RoomActionTypes.END_GAME,\n      payload: message\n    })\n  }\n\n  private readonly networkReducer: StarMeshReducer<RoomState> = (prevState, { action, payload }, connId) => {\n    const setName = (): void => {\n      if (typeof payload !== 'string') throw new Error('Invalid payload')\n      if (this.started) {\n        if (this.n(payload) === undefined) {\n          throw new Error(`Room '${this.roomCode ?? ''}' has started game`)\n        } else if (prevState.idDict !== undefined && prevState.nameDict !== undefined) {\n          const pid = this.n(payload)\n          prevState.idDict[connId] = pid\n          prevState.idDict[pid] = connId\n          prevState.nameDict[payload] = pid\n        }\n      }\n      if (Object.values(prevState.players).includes(payload)) {\n        throw new Error(`Name '${payload}' already taken`)\n      }\n      prevState.players = { ...prevState.players, [connId]: payload }\n      this.emit(RoomEvents.SET_PLAYERS, {\n        data: {\n          ...prevState.players\n        }\n      })\n      if (prevState.game !== undefined) {\n        this.game.rejoin(prevState.game)\n      }\n    }\n    switch (action) {\n      case RoomActionTypes.JOIN:\n        if (Object.keys(prevState.players).length + 1 > prevState.maxPlayers) {\n          throw new Error(`Room '${this.roomCode ?? ''}' is already full`)\n        }\n        setName()\n        return { ...prevState }\n      case RoomActionTypes.RENAME:\n        setName()\n        return { ...prevState }\n      case RoomActionTypes.LEAVE: {\n        const { [payload as string]: u, ...players } = this.players\n        prevState.players = players\n        this.emit(RoomEvents.SET_PLAYERS, {\n          data: {\n            ...prevState.players\n          }\n        })\n        return { ...prevState }\n      }\n      case RoomActionTypes.START_GAME: {\n        if (this.playerIds.length < this.state.minPlayers) {\n          throw new Error('Not enough players, required 2')\n        }\n        const typed = payload as { idDict: PlayersDict, nameDict: PlayersDict }\n        prevState.game = Game.initialState(this.playerIds.length)\n        prevState.idDict = clone(typed.idDict)\n        prevState.nameDict = clone(typed.nameDict)\n        this.game?.start(prevState.game)\n        this.emit(RoomEvents.START_GAME, { data: this.game })\n        return { ...prevState }\n      }\n      case RoomActionTypes.END_GAME: {\n        prevState.idDict = undefined\n        prevState.nameDict = undefined\n        if (prevState.game !== undefined) {\n          prevState.game.gameOver = payload as string\n        }\n        this.game.stop(payload)\n        this.emit(RoomEvents.END_GAME, { data: payload })\n        return { ...prevState }\n      }\n      case RoomActionTypes.GAME_EVENT: {\n        if (this.started && prevState.game !== undefined) {\n          if (prevState.game.gameOver !== undefined) {\n            throw new Error('Game over')\n          }\n          try {\n            prevState.game = this.game?.reducer(prevState.game, payload as Record<string, unknown>, connId)\n          } catch (e) {\n            console.trace(e)\n            throw e\n          }\n          return { ...prevState }\n        } else {\n          throw new Error('Game not started')\n        }\n      }\n    }\n    return prevState\n  }\n}\n","import { createContext, useContext } from 'react'\nimport { Room } from './Room'\n\nexport const globalRoom = new Room()\nexport const RoomContext = createContext(globalRoom)\nexport const useRoom = (): Room => useContext(RoomContext)\n","import { transparentize } from 'polished'\nimport { mapObjIndexed } from 'ramda'\n\nexport const makeFade = transparentize(0.6)\n\nexport const vibrantColors = {\n  blue: '#3976E9',\n  red: '#E4456F',\n  green: '#2AC87D',\n  yellow: '#E99608',\n  gray: '#9CC6E9'\n}\n\nexport const dullColors = {\n  blue: '#4168AE',\n  red: '#925666',\n  green: '#569276',\n  yellow: '#D49E41',\n  gray: '#8E959B'\n}\n\nexport const paleColors = {\n  blue: '#7ea6f1',\n  red: '#ed86a1',\n  green: '#74dbaa',\n  yellow: '#f1bb5e',\n  gray: '#bfdaf1'\n}\n\nexport const baseColors = {\n  ...vibrantColors,\n  vibrantHighlights: mapObjIndexed(makeFade, vibrantColors),\n  dark: ['#282c30', '#383e43', '#484f56'],\n  light: ['#E0E3E5', '#c0c2c4', '#a0a1a3'],\n  white: ['#f9fbfc', '#f0f2f3', '#e8ebec']\n}\n\nexport const colors = {\n  ...baseColors,\n  primary: baseColors.blue,\n  accent: baseColors.yellow,\n  inputFocus: transparentize(0.2, baseColors.blue)\n}\n\nexport const light = {\n  ...colors,\n  blue: [colors.blue, dullColors.blue],\n  red: [colors.red, dullColors.red],\n  green: [colors.green, dullColors.green],\n  yellow: [colors.yellow, dullColors.yellow],\n  fgHighlights: mapObjIndexed(makeFade, dullColors),\n  bgHighlights: mapObjIndexed(makeFade, paleColors),\n  gray: [colors.gray, dullColors.gray],\n  text: colors.dark[0],\n  muted: makeFade(colors.dark[0]),\n  background: colors.white[0],\n  bgs: colors.white,\n  fgs: colors.dark,\n  fgPales: colors.dark.map(makeFade),\n  border: transparentize(0.8, baseColors.dark[0]),\n  highlight: transparentize(0.9, baseColors.dark[0]),\n  code: {\n    color: '#0451a5',\n    backgroundColor: '#ffffff',\n    prolog: '#001080',\n    comment: '#008000',\n    keyword: '#0000FF',\n    number: '#09885a',\n    constant: '#0000ff',\n    variable: '#001080',\n    string: '#a31515',\n    selector: '#800000',\n    tag: '#800000',\n    operator: '#000000',\n    punctuation: '#000000',\n    function: '#795e26',\n    className: '#267f99',\n    char: '#a31515'\n  }\n}\n\nexport const dark = {\n  ...colors,\n  blue: [colors.blue, paleColors.blue],\n  red: [colors.red, paleColors.red],\n  green: [colors.green, paleColors.green],\n  yellow: [colors.yellow, paleColors.yellow],\n  gray: [colors.gray, paleColors.gray],\n  fgHighlights: mapObjIndexed(makeFade, paleColors),\n  bgHighlights: mapObjIndexed(makeFade, dullColors),\n  text: colors.light[0],\n  muted: makeFade(colors.light[0]),\n  background: colors.dark[0],\n  bgs: colors.dark,\n  fgs: colors.light,\n  fgPales: colors.light.map(makeFade),\n  border: transparentize(0.8, baseColors.light[0]),\n  highlight: transparentize(0.9, baseColors.light[0]),\n  code: {\n    color: '#9CDCFE',\n    backgroundColor: '#1E1E1E',\n    prolog: '#9cdcfe',\n    comment: 'rgb(106, 153, 85)',\n    keyword: 'rgb(86, 156, 214)',\n    number: 'rgb(181, 206, 168)',\n    constant: 'rgb(100, 102, 149)',\n    variable: 'rgb(156, 220, 254)',\n    string: 'rgb(206, 145, 120)',\n    selector: 'rgb(215, 186, 125)',\n    tag: 'rgb(86, 156, 214)',\n    operator: '#808080',\n    punctuation: 'rgb(212, 212, 212)',\n    function: 'rgb(220, 220, 170)',\n    className: 'rgb(78, 201, 176)',\n    char: 'rgb(209, 105, 105)'\n  }\n}\n","export const SLOW = 0.3\nexport const FAST = 0.1\n\nexport const transition = (time, props, ease = 'ease') => ({\n  transition: props.map(p => `${time}s ${p} ${ease}`).join(',')\n})\n\nexport const shortTransition = (props) => transition(FAST, props)\n","export const inputPadding = {\n  px: 3,\n  py: 2\n}\n\nexport const mdInputPadding = {\n  px: 2,\n  py: 2\n}\n\nexport const smInputPadding = {\n  px: 1,\n  py: 1\n}\n","import { shortTransition } from '../transitions'\n\nexport const baseInput = {\n  borderRadius: 1,\n  border: '1px solid',\n  borderColor: 'border',\n  ...shortTransition(['box-shadow']),\n  boxShadow: '0 0 0 0 transparent',\n  ':focus, &.focus': {\n    boxShadow: theme => `0 0 0 3px ${theme.colors.inputFocus}`,\n    borderColor: 'unset'\n  },\n  lineHeight: 'input',\n  backgroundColor: 'transparent',\n  color: 'text',\n  fontFamily: 'body',\n  fontWeight: 'body',\n  fontSize: 1\n}\n","import { shortTransition } from './transitions'\nimport { inputPadding, mdInputPadding, smInputPadding } from './inputs/inputPadding'\nimport { baseInput } from './inputs/baseInput'\n\nexport const baseButton = {\n  ...baseInput,\n  ...inputPadding,\n  ...shortTransition(['background-color']),\n  display: 'inline-flex',\n  alignItems: 'center',\n  textAlign: 'unset',\n  outline: 'none',\n  '::-moz-focus-inner': {\n    border: 'none'\n  }\n}\n\nexport const pillButton = {\n  borderRadius: 4\n}\n\nexport const smButton = {\n  ...baseButton,\n  ...smInputPadding\n}\n\nexport const mdButton = {\n  ...baseButton,\n  ...mdInputPadding\n}\n\nexport const borderlessButton = {\n  ...baseButton,\n  border: 0\n}\n\nexport const borderlessSmButton = {\n  ...smButton,\n  border: 0\n}\n\nexport const borderlessMdButton = {\n  ...mdButton,\n  border: 0\n}\n\nconst buttonStyles = {\n  '': baseButton,\n  '-sm': smButton,\n  '-md': mdButton,\n  '-borderless': borderlessButton,\n  '-borderless-sm': borderlessSmButton,\n  '-borderless-md': borderlessMdButton,\n  '-pill': { ...baseButton, ...pillButton, px: 5 },\n  '-pill-sm': { ...smButton, ...pillButton, px: 3 },\n  '-pill-md': { ...mdButton, ...pillButton, px: 4 }\n}\n\nconst buttonColors = {\n  normal: {\n    fg: 'text',\n    bg: 'background',\n    hoverBg: 'highlight'\n  },\n  primary: {\n    fg: 'white.0',\n    bg: 'blue.0',\n    hoverBg: 'blue.1'\n  },\n  success: {\n    fg: 'white.0',\n    bg: 'blue.0',\n    hoverBg: 'blue.1'\n  },\n  warning: {\n    fg: 'dark.0',\n    bg: 'yellow.0',\n    hoverBg: 'yellow.1'\n  },\n  danger: {\n    fg: 'white.0',\n    bg: 'red.0',\n    hoverBg: 'red.1'\n  },\n  red: {\n    fg: 'white.0',\n    bg: 'red.0',\n    hoverBg: 'red.1'\n  },\n  active: {\n    fg: 'white.0',\n    bg: 'blue.0'\n  },\n  transparent: {\n    fg: 'fgs.0',\n    bg: 'transparent',\n    hoverBg: 'highlight',\n    border: 0\n  }\n}\n\nconst buttons = {}\n\nfor (const styleName in buttonStyles) {\n  for (const colorName in buttonColors) {\n    buttons[colorName + styleName] = {\n      ...buttonStyles[styleName],\n      backgroundColor: buttonColors[colorName].bg,\n      color: buttonColors[colorName].fg,\n      '*': {\n        fill: buttonColors[colorName].fg\n      },\n      ':hover': {\n        backgroundColor: buttonColors[colorName].hoverBg\n      },\n      '&:disabled': {\n        backgroundColor: 'light.0',\n        color: 'light.1'\n      }\n    }\n  }\n}\n\nexport default buttons\n","import { inputPadding } from './inputPadding'\nimport { baseInput } from './baseInput'\n\nexport default {\n  ...baseInput,\n  ...inputPadding\n}\n","import { shortTransition } from '../transitions'\nimport { inputPadding } from './inputPadding'\n\nexport const placeholder = {\n  '::placeholder': {\n    color: 'transparent'\n  }\n}\n\nexport const fakePlaceholder = {\n  position: 'absolute',\n  top: '12px',\n  pt: '1px',\n  left: inputPadding.px,\n  pointerEvents: 'none',\n  ml: -1,\n  px: 1,\n  fontSize: 1,\n  borderRadius: 1,\n  color: 'fgs.1',\n  ...shortTransition(['top', 'font-size', 'color', 'background-color'])\n}\n\nexport const fakePlaceholderPull = {\n  backgroundColor: 'background',\n  fontSize: 0,\n  top: '-10px'\n}\n\nexport const fakePlaceholderFocus = {\n  color: 'blue'\n}\n\nexport default {\n  ...placeholder,\n  '+ *': {\n    ...fakePlaceholder\n  },\n  ':not(:placeholder-shown) + *': {\n    ...fakePlaceholderPull\n  },\n  ':focus + *': {\n    ...fakePlaceholderPull,\n    ...fakePlaceholderFocus\n  }\n}\n","import inputMagic from './inputMagic'\nimport normal from './normal'\nimport baseMagic from './baseMagic'\n\nexport default {\n  normal,\n  baseMagic,\n  inputMagic\n}\n","import normal from './normal'\nimport baseMagic from './baseMagic'\n\nexport default {\n  ...normal,\n  ...baseMagic\n}\n","import { inputPadding } from './inputs/inputPadding'\n\nexport default {\n  ...inputPadding,\n  color: 'text',\n  display: 'block',\n  ':hover': {\n    backgroundColor: 'highlight'\n  }\n}\n","import { baseInput } from './inputs/baseInput'\n\nexport default {\n  ...baseInput,\n  boxShadow: 2,\n  backgroundColor: 'bgs.1',\n  lineHeight: 1.8,\n  overflow: 'hidden',\n  zIndex: 1\n}\n","const pageHeadingSizes = [4, 5, 6]\nconst pageHeadingIconSizes = pageHeadingSizes.map(x => theme => theme.fontSizes[x])\n\nexport default {\n  fontSize: 1,\n  success: {\n    color: 'green.1'\n  },\n  danger: {\n    color: 'red.1'\n  },\n  warning: {\n    color: 'yellow.1'\n  },\n  heading: {\n    fontSize: [3, 4],\n    mb: 3\n  },\n  subheading: {\n    textTransform: 'uppercase',\n    letterSpacing: '2px',\n    fontWeight: 'bold',\n    fontSize: 2,\n    color: 'fgPales.0',\n    mb: 3\n  },\n  pageHeading: {\n    fontSize: pageHeadingSizes,\n    mb: 3,\n    svg: {\n      color: '#ff0000',\n      width: pageHeadingIconSizes,\n      height: pageHeadingIconSizes\n    }\n  },\n  largeHeading: {\n    fontSize: [5, null, 7],\n    mb: 3\n  },\n  columnHeading: {\n    fontSize: 2,\n    fontWeight: 'bold'\n  },\n  columnCardHeading: {\n    fontSize: 2,\n    fontWeight: 'bold'\n  },\n  helperText: {\n    fontSize: 0,\n    color: 'muted'\n  }\n}\n","import { colors } from './colors'\nimport { transparentize } from 'polished'\n\nexport const baseWell = {\n  p: 3,\n  px: 3,\n  py: 3,\n  my: 3,\n  borderRadius: 1,\n  borderWidth: 1,\n  borderStyle: 'solid',\n  borderColor: 'border'\n}\n\nexport default {\n  normal: {\n    ...baseWell\n  },\n  dashed: {\n    ...baseWell,\n    borderStyle: 'dashed'\n  },\n  primary: {\n    ...baseWell,\n    borderColor: 'blue.1'\n  },\n  danger: {\n    ...baseWell,\n    borderColor: 'red.1',\n    backgroundColor: transparentize(0.7, colors.red)\n  },\n  warning: {\n    ...baseWell,\n    borderColor: 'yellow.1'\n  },\n  success: {\n    ...baseWell,\n    borderColor: 'green.1',\n    backgroundColor: transparentize(0.7, colors.green)\n  }\n}\n","const baseMessage = {\n  borderRadius: 1\n}\n\nconst messageStyle = (borderColor, fillColor) => ({\n  ...baseMessage,\n  borderColor: borderColor,\n  color: fillColor,\n  '*': {\n    fill: fillColor\n  }\n})\n\nexport default {\n  primary: messageStyle('blue.0', 'blue.1'),\n  info: messageStyle('gray.0', 'gray.1'),\n  danger: messageStyle('red.0', 'red.1'),\n  warning: messageStyle('yellow.0', 'yellow.1'),\n  success: messageStyle('green.0', 'green.1')\n}\n","import { colors, dark, light } from './colors'\nimport code from './code'\nimport buttons from './buttons'\nimport inputs from './inputs'\nimport menuItem from './menuItem'\nimport links from './links'\nimport dropdown from './dropdown'\nimport styles from './styles'\nimport text from './text'\nimport wells from './wells'\nimport messages from './messages'\nimport badges from './badges'\n\nexport default {\n  useColorSchemeMediaQuery: true,\n  colors: {\n    ...light,\n    modes: {\n      dark\n    }\n  },\n  bg: {\n    success: colors.green[0],\n    danger: colors.red[0],\n    warning: colors.yellow[0]\n  },\n  text,\n  breakpoints: ['40em', '52em', '64em', '110em'],\n  space: [\n    0,\n    4,\n    8,\n    16,\n    32,\n    64,\n    128,\n    256,\n    512\n  ],\n  fonts: {\n    body: 'Arial',\n    heading: 'inherit',\n    monospace: 'Inconsolata, monospace'\n  },\n  fontSizes: [\n    12,\n    14,\n    16,\n    20,\n    24,\n    32,\n    48,\n    64,\n    96\n  ],\n  fontWeights: {\n    body: 400,\n    heading: 300,\n    bold: 700\n  },\n  lineHeights: {\n    body: 1.5,\n    heading: 1.3,\n    input: 1.7\n  },\n  radii: [0, 4, 8, 16, 32],\n  shadows: [\n    null,\n    '0 2px 4px rgba(0, 0, 0, 0.2)',\n    '0 4px 8px rgba(0, 0, 0, 0.3)'\n  ],\n  layout: {\n    container: {\n      maxWidth: '100em',\n      p: [3, null, 4]\n    },\n    sidebar: {\n      width: '250px'\n    }\n  },\n  buttons,\n  inputs,\n  badges,\n  messages,\n  code,\n  menuItem,\n  links,\n  dropdown,\n  wells,\n  styles\n}\n","export default {\n  primary: {\n    backgroundColor: 'blue.0',\n    color: 'white.0',\n    '*': {\n      fill: 'white.0'\n    }\n  },\n  success: {\n    backgroundColor: 'green.0',\n    color: 'white.0',\n    '*': {\n      fill: 'white.0'\n    }\n  },\n  danger: {\n    backgroundColor: 'red.0',\n    color: 'white.0',\n    '*': {\n      fill: 'white.0'\n    }\n  },\n  warning: {\n    backgroundColor: 'yellow.0',\n    color: 'dark.0',\n    '*': {\n      fill: 'dark.0'\n    }\n  }\n}\n","export default {\n  fontFamily: 'monospace',\n  fontSize: 'inherit',\n  color: 'code.color',\n  backgroundColor: 'code.backgroundColor',\n  borderRadius: 1,\n  borderWidth: '1px',\n  borderStyle: 'solid',\n  borderColor: 'border',\n  p: 3,\n  tabSize: 4,\n  MozTabSize: '4',\n  '.token-line': {\n    display: 'flex'\n  },\n  '.token': {\n    display: 'inline-block',\n    lineHeight: 1.5\n  },\n  '.prolog': {\n    color: 'code.prolog'\n  },\n  '.comment': {\n    color: 'code.comment'\n  },\n  '.builtin,.changed,.keyword': {\n    color: 'code.keyword'\n  },\n  '.number': {\n    color: 'code.number'\n  },\n  '.constant': {\n    color: 'code.constant'\n  },\n  '.attr-name,.variable': {\n    color: 'code.variable'\n  },\n  '.string,.attr-value': {\n    color: 'code.string'\n  },\n  '.selector': {\n    color: 'code.selector'\n  },\n  '.tag': {\n    color: 'code.tag'\n  },\n  '.punctuation,.operator': {\n    color: 'code.operator'\n  },\n  '.punctuation, .plain': {\n    color: 'code.punctuation'\n  },\n  '.function': {\n    color: 'code.function'\n  },\n  '.class-name': {\n    color: 'code.className'\n  },\n  '.char': {\n    color: 'code.char'\n  },\n  '.inserted': {\n    backgroundColor: 'fgHighlights.green'\n  },\n  '.deleted': {\n    backgroundColor: 'fgHighlights.red'\n  },\n  '.special': {\n    color: 'red.0'\n  },\n  '.tab': {\n    position: 'relative',\n    '::before': {\n      position: 'absolute',\n      left: '1px',\n      top: 'calc(50% - 0.5px)',\n      content: '\"\"',\n      width: 'calc(100% - 3.5px)',\n      borderTopWidth: '1px',\n      borderTopStyle: 'solid',\n      borderTopColor: 'red.0'\n    },\n    '::after': {\n      position: 'absolute',\n      right: '1px',\n      top: 0,\n      content: '\">\"',\n      color: 'red.0'\n    }\n  }\n}\n","export default {\n  default: {\n    color: 'blue.1',\n    '*': {\n      fill: 'blue.1'\n    },\n    ':hover': {\n      color: 'blue.0',\n      '*': {\n        fill: 'blue.0'\n      }\n    }\n  },\n  plain: {\n    color: 'gray.1',\n    '*': {\n      fill: 'gray.1'\n    },\n    ':hover': {\n      color: 'gray.0',\n      '*': {\n        fill: 'gray.0'\n      }\n    }\n  },\n  active: {\n    color: 'yellow.1',\n    '*': {\n      fill: 'yellow.1'\n    },\n    ':hover': {\n      color: 'yellow.0',\n      '*': {\n        fill: 'yellow.0'\n      }\n    }\n  }\n}\n","export default {\n  root: {\n    fontFamily: 'body',\n    fontWeight: 'body',\n    lineHeight: 'body'\n  },\n  '*': {\n    boxSizing: 'border-box'\n  },\n  body: {\n    margin: 0\n  },\n  h1: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 5\n  },\n  h2: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 4\n  },\n  h3: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 3\n  },\n  h4: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 2\n  },\n  h5: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 1\n  },\n  h6: {\n    color: 'text',\n    fontFamily: 'heading',\n    lineHeight: 'heading',\n    fontWeight: 'heading',\n    fontSize: 0\n  },\n  p: {\n    color: 'text',\n    fontFamily: 'body',\n    fontWeight: 'body',\n    lineHeight: 'body'\n  },\n  a: {\n    textDecoration: 'none',\n    outline: 'none',\n    '::-moz-focus-inner': {\n      border: 'none'\n    }\n  },\n  pre: {\n    fontFamily: 'monospace',\n    overflowX: 'auto',\n    code: {\n      color: 'inherit'\n    }\n  },\n  table: {\n    width: '100%',\n    borderCollapse: 'separate',\n    borderSpacing: 0\n  },\n  th: {\n    textAlign: 'left',\n    borderBottomStyle: 'solid'\n  },\n  td: {\n    textAlign: 'left',\n    borderBottomStyle: 'solid'\n  },\n  img: {\n    maxWidth: '100%'\n  },\n  hr: {\n    borderTop: '1px solid',\n    borderBottom: 'none',\n    borderColor: 'border'\n  }\n}\n","/**\n * Guard against null and undefined\n * @param x\n */\nexport const isDefined = <T> (x: T | null | undefined): x is T => x !== undefined && x !== null\n\n/**\n * Use default value if null or undefined\n * @param x\n * @param defaultValue\n */\nexport const defaultValue = <T> (x: T | null | undefined, defaultValue: T): T => isDefined(x) ? x : defaultValue\n\nexport const useOrFallback = <T, U> (x: T | null | undefined, dependent: (x: T) => U, defaultValue: U): U =>\n  isDefined(x) ? dependent(x) : defaultValue\n\nexport const show = <T, U> (x: T | null | undefined, content: (x: T) => U): U | null => isDefined(x) ? content(x) : null\n","/** @jsx jsx */\nimport { ButtonProps, jsx } from 'theme-ui'\nimport { Button as ThemeUIButton } from '@theme-ui/components'\nimport PropTypes from 'prop-types'\nimport { forwardRef, FunctionComponent } from 'react'\nimport { isDefined } from '../../utils/componentHelpers'\n\nconst buttonProps = {\n  block: PropTypes.bool\n}\n\ntype MyButtonProps = PropTypes.InferProps<typeof buttonProps>\n\nconst Button: FunctionComponent<MyButtonProps & ButtonProps> = forwardRef<HTMLButtonElement, MyButtonProps & ButtonProps>((props, ref) => (\n  <ThemeUIButton\n    ref={ref}\n    variant='normal'\n    sx={{\n      display: isDefined(props.block) && props.block ? 'flex' : undefined,\n      width: isDefined(props.block) && props.block ? '100%' : undefined,\n      justifyContent: isDefined(props.block) && props.block ? 'center' : undefined,\n      position: 'relative'\n    }}\n    {...props}\n  />\n))\n\nButton.propTypes = buttonProps\n\nButton.defaultProps = {\n  block: false\n}\n\nButton.displayName = 'Button'\n\nexport default Button\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport MdiIcon from '@mdi/react'\nimport PropTypes from 'prop-types'\n\nconst Icon = (props) => {\n  const fontSizes = Array.isArray(props.size) ? props.size : [props.size]\n  const sizes = fontSizes.map(x => theme => theme.fontSizes[x] * theme.lineHeights.body)\n\n  return (\n    <MdiIcon\n      {...{ ...props, color: null, size: null }}\n      sx={{\n        fill: props.color,\n        height: sizes,\n        width: sizes,\n        ...props?.sx\n      }}\n    />\n  )\n}\n\nIcon.propTypes = {\n  path: PropTypes.string.isRequired,\n  color: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.func\n  ]),\n  size: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.arrayOf(PropTypes.number)\n  ]),\n  sx: PropTypes.object\n}\n\nIcon.defaultProps = {\n  color: 'text',\n  size: 1\n}\n\nexport default Icon\n","/** @jsx jsx */\nimport { mdiCircleSlice4 } from '@mdi/js'\nimport { Flex } from '@theme-ui/components'\nimport { jsx, useColorMode } from 'theme-ui'\nimport theme from '../theme'\nimport Button from './common/Button'\nimport Icon from './common/Icon'\nimport { FunctionComponent } from 'react'\nimport PropTypes from 'prop-types'\n\nconst propTypes = {\n  setState: PropTypes.func.isRequired,\n  state: PropTypes.number.isRequired\n}\n\nconst NavBar: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ state, setState }) => {\n  const [colorMode, setColorMode] = useColorMode()\n  const toggleDarkMode = (): void => setColorMode(colorMode === 'default' ? 'dark' : 'default')\n\n  return (\n    <Flex py={2} px={theme.layout.container.p} sx={{ alignItems: 'center', position: 'fixed', width: '100%' }}>\n      <Flex mr={2} sx={{ alignItems: 'center', flex: 1 }}>\n        {/* {state > 0 && <Button onClick={() => setState(state - 1)}><Icon path={mdiArrowLeft}/></Button>} */}\n      </Flex>\n      <Flex ml='auto' sx={{ alignItems: 'center' }}>\n        <Button onClick={toggleDarkMode} mr={2} title='Toggle Dark Mode'><Icon path={mdiCircleSlice4}/></Button>\n      </Flex>\n    </Flex>\n  )\n}\nexport default NavBar\n\nNavBar.propTypes = propTypes\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport { Box } from '@theme-ui/components'\n\nconst BasicInput = props => <Box as='input' __themeKey='inputs' variant='normal' {...props}/>\n\nexport default BasicInput\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Button from './Button'\nimport Icon from './Icon'\n\nconst IconButton = (props) => {\n  return <Button\n    variant={props.variant || 'normal-sm'}\n    type='button'\n    sx={{\n      ...props.sx,\n      visibility: props.hidden === undefined || props.hidden === null || !props.hidden ? 'unset' : 'hidden',\n      overflow: 'hidden'\n    }}\n    onClick={props.onClick}>\n    <Icon path={props.path} sx={props.iconSx} color={props.color} size={props.size}/>\n  </Button>\n}\n\nIconButton.propTypes = {\n  variant: PropTypes.string,\n  sx: PropTypes.object,\n  iconSx: PropTypes.object,\n  path: PropTypes.node,\n  onClick: PropTypes.func,\n  hidden: PropTypes.bool,\n  color: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.func\n  ]),\n  size: PropTypes.oneOfType([\n    PropTypes.number,\n    PropTypes.arrayOf(PropTypes.number)\n  ])\n}\n\nexport default IconButton\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport { Box, Label, Text } from '@theme-ui/components'\nimport PropTypes from 'prop-types'\nimport BasicInput from './BasicInput'\nimport { FunctionComponent } from 'react'\nimport IconButton from './IconButton'\nimport { mdiClose } from '@mdi/js'\n\nconst propTypes = {\n  fullwidth: PropTypes.bool,\n  label: PropTypes.string.isRequired,\n  sx: PropTypes.object,\n  helperText: PropTypes.string,\n  disabled: PropTypes.bool,\n  onClearClick: PropTypes.func,\n  onChange: PropTypes.func,\n  value: PropTypes.string\n}\n\nconst Input: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ onClearClick, ...props }) => (\n  <Box mt={3} sx={{ width: props.fullwidth ?? false ? '100%' : undefined, ...props.sx }}>\n    <Label\n      sx={{\n        position: 'relative'\n      }}>\n      <BasicInput\n        {...props}\n        placeholder={props.label}\n        variant='inputMagic'\n        sx={{ width: props.fullwidth ?? false ? '100%' : undefined, ...props.sx }}\n      />\n      <Text>{props.label}</Text>\n      {!(props.disabled ?? false) && onClearClick !== undefined\n        ? <Box sx={{ position: 'absolute', right: 1, top: '50%', transform: 'translateY(-50%)' }}>\n          <IconButton variant='transparent-borderless-sm' path={mdiClose} onClick={onClearClick}/>\n        </Box> : null}\n    </Label>\n    <Text variant='helperText'>\n      {props.helperText}\n    </Text>\n  </Box>\n)\n\nInput.propTypes = propTypes\n\nexport default Input\n","import React, { forwardRef, FunctionComponent } from 'react'\nimport { Box, BoxOwnProps } from '@theme-ui/components'\n\nconst Well: FunctionComponent<BoxOwnProps> = forwardRef<HTMLDivElement, BoxOwnProps>((props, ref) => (\n  <Box\n    ref={ref}\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    __themeKey='wells'\n    variant='normal'\n    {...props}\n  />\n))\n\nWell.displayName = 'Well'\n\nexport default Well\n","import React, { FunctionComponent } from 'react'\nimport { Box } from '@theme-ui/components'\n\nexport const Card: FunctionComponent = (props) => (\n  <Box\n    sx={{\n      py: 4, px: 5, backgroundColor: 'background', boxShadow: 2, borderRadius: 3\n    }}\n    {...props}\n  />\n)\n","import React, { FunctionComponent, useState } from 'react'\nimport { Flex, Heading, Text } from '@theme-ui/components'\nimport Input from './common/Input'\nimport PropTypes from 'prop-types'\nimport Button from './common/Button'\nimport Well from './common/Well'\nimport { useRoom } from '../lib/RoomContext'\nimport { AppState } from './App'\nimport { Card } from './common/Card'\n\nconst propTypes = {\n  setState: PropTypes.func.isRequired\n}\n\nexport const Home: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ setState }) => {\n  const room = useRoom()\n  const [name, setName] = useState('')\n  const [roomCode, setRoomCode] = useState(/^\\/(.*)$/.exec(window.location.pathname.replace(process.env.PUBLIC_URL, ''))?.[1] ?? '')\n  const [error, setError] = useState('')\n  const [message, setMessage] = useState('')\n  const [loading, setLoading] = useState(false)\n  const createRoom = (): void => {\n    setMessage('Creating Room...')\n    setLoading(true)\n    room.create(name, roomCode)\n      .then(() => {\n        setError('')\n        setState(AppState.ROOM)\n      })\n      .catch((e: { type: string }) => {\n        if (e.type === 'unavailable-id') {\n          setError(`Room ${roomCode} already exists`)\n        } else {\n          setError('Error when creating room')\n        }\n        console.error(e)\n      })\n      .finally(() => {\n        setMessage('')\n        setLoading(false)\n      })\n  }\n  const joinRoom = (): void => {\n    setMessage('Joining Room...')\n    setLoading(true)\n    room.join(name, roomCode)\n      .then(() => {\n        setError('')\n        if (room.started) {\n          setState(AppState.GAME)\n          // room.game.gameWorld.init()\n        } else {\n          setState(AppState.ROOM)\n        }\n      })\n      .catch((e: Error) => {\n        setError(e.message)\n        console.error(e)\n      })\n      .finally(() => {\n        setMessage('')\n        setLoading(false)\n      })\n  }\n  return (\n    <Card>\n      <Flex sx={{ flexDirection: 'column' }}>\n        <Heading>Welcome to Photosynthesis</Heading>\n        {\n          error !== '' && (\n            <Well variant='danger'>{error}</Well>\n          )\n        }\n        <Input\n          fullwidth={true}\n          disabled={loading}\n          label='Name'\n          onChange={({ target }) => setName?.((target as HTMLInputElement).value)}\n          value={name}\n        />\n        <Input\n          fullwidth={true}\n          disabled={loading}\n          label='Room'\n          onChange={({ target }) => setRoomCode?.((target as HTMLInputElement).value.toUpperCase())}\n          value={roomCode}\n        />\n        <Flex mt={3}>\n          <Button sx={{ flex: 1 }} disabled={loading || name === ''} variant='warning' onClick={createRoom}>New\n            Room</Button>\n          <Button sx={{ flex: 1 }} disabled={loading || name === '' || roomCode === ''} ml={3} variant='primary' onClick={joinRoom}>Join\n            Room</Button>\n        </Flex>\n        <Text>{message}</Text>\n      </Flex>\n    </Card>\n  )\n}\n\nHome.propTypes = propTypes\n","import React, { FunctionComponent } from 'react'\nimport { FlexProps } from 'theme-ui'\nimport { Flex, Text } from '@theme-ui/components'\nimport PropTypes, { InferProps } from 'prop-types'\nimport Icon from './Icon'\n\nconst iconTextProps = {\n  path: PropTypes.string.isRequired,\n  children: PropTypes.node.isRequired,\n  size: PropTypes.number,\n  color: PropTypes.any,\n  reverse: PropTypes.bool\n}\n\nexport interface IconTextProps extends InferProps<typeof iconTextProps> {\n  color?: string | ((x: unknown) => string) | null\n}\n\nconst IconText: FunctionComponent<IconTextProps & FlexProps> = ({ children, color, path, size, reverse = false, ...otherProps }) => {\n  const reverse_ = reverse ?? false\n  return (\n    <Flex sx={{ alignItems: 'center', flexDirection: reverse_ ? 'row-reverse' : 'row' }} {...otherProps}>\n      <Icon\n        size={size}\n        path={path}\n        color={color}\n        sx={{\n          fillOpacity: color === 'transparent' ? 0 : 1,\n          path: {\n            fill: color\n          }\n        }}\n      />\n      {' '}\n      <Text ml={!reverse_ ? 2 : 0} mr={reverse_ ? 2 : 0} sx={{ flex: 1, color }}>{children}</Text>\n    </Flex>\n  )\n}\n\nIconText.propTypes = iconTextProps\n\nIconText.defaultProps = {\n  reverse: false\n}\n\nexport default IconText\n","/** @jsx jsx */\nimport { jsx, useThemeUI } from 'theme-ui'\nimport Modal from 'react-modal'\nimport PropTypes from 'prop-types'\nimport { Box } from '@theme-ui/components'\nimport { shortTransition } from '../../theme/transitions'\n\nconst Dialog = props => {\n  const { theme } = useThemeUI()\n\n  return (\n    <Modal\n      ariaHideApp={false}\n      isOpen={props.isOpen}\n      onRequestClose={() => !props.isStatic && props.onClose()}\n      contentLabel={props.contentLabel}\n      style={{\n        overlay: {\n          backgroundColor: theme.colors.fgPales[0],\n          zIndex: 200,\n          display: 'flex',\n          justifyContent: 'center',\n          alignItems: 'center',\n          padding: theme.space[2],\n          overflowY: 'auto'\n        }\n      }}\n      sx={{\n        minWidth: ['100%', '250px'],\n        maxWidth: typeof props.size === 'number' && theme.breakpoints[props.size],\n        outline: 'none',\n        opacity: 0,\n        margin: 'auto',\n        fontFamily: 'body',\n        lineHeight: 'body',\n        ...shortTransition(['opacity']),\n        '&.ReactModal__Content--after-open': {\n          opacity: 1\n        },\n        '&.ReactModal__Content--before-close': {\n          opacity: 0\n        }\n      }}>\n      <Box\n        {...props}\n        sx={{\n          backgroundColor: 'bgs.1',\n          boxShadow: 2,\n          borderRadius: 1\n        }}\n      />\n    </Modal>\n  )\n}\n\nDialog.propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  onClose: PropTypes.func,\n  contentLabel: PropTypes.string,\n  setIsOpen: PropTypes.func,\n  isStatic: PropTypes.bool,\n  size: PropTypes.number\n}\n\nDialog.defaultProps = {\n  size: 0\n}\n\nexport default Dialog\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport Dialog from './Dialog'\nimport { Box, Flex, Heading, Text } from '@theme-ui/components'\nimport Button from './Button'\nimport PropTypes from 'prop-types'\n\nconst ConfirmDialog = props => {\n  const close = typeof props.onClose === 'function' ? props.onClose : () => {\n  }\n  const action = typeof props.onAction === 'function' ? props.onAction : () => {\n  }\n  const run = x => () => {\n    close()\n    action(x)\n  }\n  return (\n    <Dialog\n      isStatic\n      {...{\n        isOpen: props.isOpen,\n        onClose: props.onClose,\n        contentLabel: props.contentLabel,\n        setIsOpen: props.setIsOpen,\n        size: props.size\n      }}>\n      <Box p={[4, 3]} pb={2}>\n        <Heading variant='subheading'>{props.title}</Heading>\n        <Text>{props.children}</Text>\n      </Box>\n      <Flex\n        p={[3, 2]}\n        sx={{\n          alignItems: 'center',\n          justifyContent: 'flex-end'\n        }}>\n        {!props.hideNoChoice && <Button onClick={run(false)}>{props.noText}</Button>}\n        <Button ml={2} onClick={run(true)}>{props.yesText}</Button>\n      </Flex>\n    </Dialog>\n  )\n}\n\nConfirmDialog.propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  onClose: PropTypes.func,\n  onAction: PropTypes.func,\n  contentLabel: PropTypes.string,\n  setIsOpen: PropTypes.func,\n  noText: PropTypes.string,\n  yesText: PropTypes.string,\n  children: PropTypes.node.isRequired,\n  title: PropTypes.string,\n  hideNoChoice: PropTypes.bool,\n  size: PropTypes.number\n}\n\nConfirmDialog.defaultProps = {\n  noText: 'No',\n  yesText: 'Yes',\n  title: 'Confirm',\n  hideNoChoice: false\n}\n\nexport default ConfirmDialog\n","import React, { FunctionComponent } from 'react'\nimport ConfirmDialog from './ConfirmDialog'\nimport PropTypes from 'prop-types'\n\nconst propTypes = {\n  isOpen: PropTypes.bool.isRequired,\n  onClose: PropTypes.func,\n  contentLabel: PropTypes.string,\n  setIsOpen: PropTypes.func,\n  yesText: PropTypes.string,\n  children: PropTypes.node.isRequired,\n  title: PropTypes.string,\n  size: PropTypes.number\n}\n\nconst AlertDialog: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = props => (\n  <ConfirmDialog {...props} hideNoChoice>{props.children}</ConfirmDialog>\n)\nAlertDialog.propTypes = propTypes\n\nAlertDialog.defaultProps = {\n  title: 'Alert',\n  yesText: 'OK'\n}\n\nexport default AlertDialog\n","import React, { Context, createContext, FunctionComponent, useContext, useState } from 'react'\nimport AlertDialog from './AlertDialog'\n\nexport interface AlertMessage {\n  title: string\n  message: string | Element\n}\n\nexport type AlertFunction = (s: string | AlertMessage) => void\n\nexport const withAlertQueue = (WrappedComponent: FunctionComponent): FunctionComponent => {\n  const AlertWrapper: FunctionComponent = props => {\n    const [queue, setQueue] = useState<AlertMessage[]>([])\n\n    const popAlert = (): void => {\n      setQueue(queue.slice(1))\n    }\n\n    const queueAlert: AlertFunction = (s: string | AlertMessage): void => {\n      const message: AlertMessage = typeof s === 'string' ? { title: 'Alert', message: s } : s\n      setQueue(queue.concat([message]))\n    }\n\n    const alertNodes = queue.map((message, i) => (\n      <AlertDialog key={i} isOpen={i === 0} title={message.title} onClose={popAlert}>\n        {message.message}\n      </AlertDialog>\n    ))\n\n    return (\n      <AlertContext.Provider value={queueAlert}>\n        <WrappedComponent {...props}/>\n        {alertNodes}\n      </AlertContext.Provider>\n    )\n  }\n\n  return AlertWrapper\n}\n\nexport const useAlert = (): AlertFunction => useContext(AlertContext)\nexport const AlertContext: Context<AlertFunction> = createContext<AlertFunction>(window.alert)\nAlertContext.displayName = 'AlertContext'\n","import React, { FunctionComponent, useEffect, useState } from 'react'\nimport { Divider, Flex, Heading } from '@theme-ui/components'\nimport Input from './common/Input'\nimport PropTypes from 'prop-types'\nimport Button from './common/Button'\nimport { useRoom } from '../lib/RoomContext'\nimport { PlayersDict, RoomEvents } from '../lib/Room'\nimport IconText from './common/IconText'\nimport { mdiAccount, mdiCrown } from '@mdi/js'\nimport { AppState } from './App'\nimport { Game } from '../Game/Game'\nimport { useAlert } from './common/AlertContext'\nimport { Card } from './common/Card'\n\nconst propTypes = {\n  setState: PropTypes.func.isRequired\n}\n\nexport const Room: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ setState }) => {\n  const room = useRoom()\n  const [players, setPlayers] = useState<PlayersDict>({})\n  const [host, setHost] = useState('')\n  const alert = useAlert()\n  const name = players[room.myId] ?? ''\n  const rename = room.rename\n  useEffect(() => {\n    room.on(RoomEvents.SET_PLAYERS, ({ data }) => setPlayers(data as PlayersDict))\n    room.on(RoomEvents.SET_HOST, ({ data }) => setHost(data as string))\n    room.on(RoomEvents.START_GAME, ({ data: game }) => {\n      setState(AppState.GAME, game as Game)\n    })\n  }, [room, setState])\n  const startGame = (): void => {\n    room?.startGame().catch((e: Error) => {\n      console.log(e)\n      alert(e.message)\n    })\n  }\n  return (\n    <Card>\n      <Flex sx={{ flexDirection: 'column' }}>\n        <Heading>{room.roomCode}</Heading>\n        <Input\n          label='My Name'\n          value={name}\n          onChange={async ({ target }: InputEvent) => {\n            await rename((target as HTMLInputElement)?.value ?? '')\n          }}\n        />\n        <Divider my={3}/>\n        <Flex sx={{ flexDirection: 'column' }}>\n          {\n            Object.entries(players).map(([id, name]) => (\n              id === host\n                ? <IconText key={id} path={mdiCrown}>{name}{id === room.myId && ' (me)'}</IconText>\n                : <IconText key={id} path={mdiAccount}>{name}{id === room.myId && ' (me)'}</IconText>\n            ))\n          }\n        </Flex>\n        <Divider my={3}/>\n        <Flex>\n          <Button\n            sx={{ flex: 1 }}\n            variant='warning'\n            onClick={(): void => {\n              setState(AppState.HOME)\n            }}>\n            Back\n          </Button>\n          <Button\n            sx={{ flex: 1, visibility: (host === room.myId ? null : 'hidden') }}\n            ml={3}\n            variant='primary'\n            onClick={host === room.myId ? startGame : undefined}>\n            Start\n          </Button>\n        </Flex>\n      </Flex>\n    </Card>\n  )\n}\n\nRoom.propTypes = propTypes\n","import React, { createContext, FunctionComponent, useContext, useEffect, useState } from 'react'\nimport { Game, GameEvent } from './Game'\nimport PropTypes from 'prop-types'\nimport { globalRoom, useRoom } from '../lib/RoomContext'\nimport { GameState } from './types/GameState'\n\nexport const GameContext = createContext<[Game, GameState | undefined, string | undefined]>([globalRoom.game, undefined, undefined])\nexport const useGame = (): [Game, GameState | undefined, string | undefined] => useContext(GameContext)\n\nexport const GameContextProvider: FunctionComponent = (props) => {\n  const game = useRoom().game\n  const [gameState, setGameState] = useState<GameState | undefined>(undefined)\n  const [gameOver, setGameOver] = useState<string | undefined>(undefined)\n  useEffect(() => {\n    setGameState(undefined)\n    game.on(GameEvent.UPDATE_GAME_STATE, ({ data }) => {\n      const state = data as GameState\n      setGameOver(state?.gameOver)\n      setGameState({ ...state })\n    })\n    game.on(GameEvent.GAME_OVER, ({ data }) => setGameOver(data as string))\n  }, [game])\n  return <GameContext.Provider value={[game, gameState, gameOver]} {...props} />\n}\n\nGameContextProvider.propTypes = {\n  value: PropTypes.any\n}\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport { mdiChevronDown, mdiChevronUp } from '@mdi/js'\nimport { Box, Divider, Flex } from '@theme-ui/components'\nimport PropTypes from 'prop-types'\nimport { Children, useEffect, useRef, useState } from 'react'\nimport Button from './Button'\nimport Icon from './Icon'\n\nconst Dropdown = props => {\n  const { children, title, onSelect, onToggle } = props\n  const [isOpen, setOpen] = useState(false)\n  /**\n   * @type {React.MutableRefObject<Node>}\n   */\n  const ref = useRef(null)\n\n  useEffect(() => {\n    const close = (e) => {\n      if (!ref.current.contains(e.target)) {\n        setOpen(false)\n      }\n    }\n\n    if (window) {\n      window.addEventListener('click', close)\n      return () => window.removeEventListener('click', close)\n    }\n\n    return () => {}\n  }, [])\n\n  useEffect(() => {\n    onToggle && onToggle(isOpen)\n  }, [isOpen, onToggle])\n\n  return (\n    <Flex\n      {...props}\n      ref={ref}\n      sx={{\n        position: 'relative',\n        userSelect: 'none',\n        width: props.fullwidth ? '100%' : undefined\n      }}>\n      <Button\n        className={isOpen ? 'focus ' : ''}\n        justifyContent='space-between'\n        onClick={() => setOpen(!isOpen)}\n        variant={isOpen ? 'active' : 'normal'}\n        type={'button'}\n        sx={{\n          position: 'relative',\n          justifyContent: 'space-between',\n          flex: 1\n        }}>\n        {title}\n        <Icon\n          path={isOpen ? mdiChevronUp : mdiChevronDown}\n          sx={{\n            ml: 2,\n            mr: -1\n          }}\n        />\n      </Button>\n      {isOpen && (\n        <Box\n          sx={{\n            variant: 'dropdown',\n            position: 'absolute',\n            top: '100%',\n            left: 0,\n            mt: 1,\n            minWidth: '100%',\n            p: 0,\n            zIndex: 50\n          }}\n          onClick={() => setOpen(false)}>\n          {\n            Children.toArray(children).filter(x => x !== null).map((child, i) =>\n              typeof child === 'string' || typeof child === 'number' || (typeof child === 'object' && child.type !== Divider)\n                ? <Box key={i} onClick={() => onSelect && onSelect(child)}>{child}</Box>\n                : child\n            )\n          }\n        </Box>\n      )}\n    </Flex>\n  )\n}\n\nDropdown.propTypes = {\n  fullwidth: PropTypes.bool,\n  children: PropTypes.node,\n  title: PropTypes.string.isRequired,\n  onSelect: PropTypes.func,\n  onToggle: PropTypes.func\n}\n\nexport default Dropdown\n","import React, { forwardRef } from 'react'\nimport { Box } from '@theme-ui/components'\n\nconst MenuItem = (props, ref) => (\n  <Box variant='menuItem' ref={ref} {...props}/>\n)\n\nexport default forwardRef(MenuItem)\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport Dropdown from './Dropdown'\nimport MenuItem from './MenuItem'\n\nconst BasicSelect = (props) => {\n  const { onSelect } = props\n  const choices = Array.isArray(props.choices)\n    ? props.choices\n    : Object.entries(props.choices).map(([value, label]) => ({\n      value,\n      label,\n      ...label\n    }))\n  const optionToValue = props.optionToValue ?? (option => props.valueKey ? option[props.valueKey] : option.value || option)\n  const optionToString = props.optionToString ?? (option => props.formatKey ? option[props.formatKey] : option.label || option)\n  const selected = props.value\n    ? choices.find(choice => props.value === optionToValue(choice)) ?? props.value\n    : choices[0]\n\n  const handleSelect = (choice, e) => {\n    e.stopPropagation()\n    const value = optionToValue(choice)\n    onSelect && onSelect(value)\n  }\n\n  return (\n    <Dropdown {...props} title={optionToString(selected)}>\n      {choices.map(choice => (\n        <MenuItem\n          key={optionToValue(choice)}\n          onClick={e => handleSelect(choice, e)}>\n          {optionToString(choice)}\n        </MenuItem>\n      ))\n      }\n    </Dropdown>\n  )\n}\n\nBasicSelect.propTypes = {\n  choices: PropTypes.oneOfType([\n    PropTypes.object,\n    PropTypes.array\n  ]).isRequired,\n  onSelect: PropTypes.func,\n  value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  fullwidth: PropTypes.bool,\n  valueKey: PropTypes.string,\n  formatKey: PropTypes.string,\n  optionToString: PropTypes.func,\n  optionToValue: PropTypes.func\n}\n\nexport default BasicSelect\n","/** @jsx jsx */\nimport { jsx } from 'theme-ui'\nimport { Box, Label, Text } from '@theme-ui/components'\nimport PropTypes from 'prop-types'\nimport { useState } from 'react'\nimport BasicSelect from './BasicSelect'\n\nconst Select = props => {\n  const [isOpen, setOpen] = useState(false)\n\n  return (\n    <Box mt={3} sx={{ width: props.fullwidth ? '100%' : undefined }}>\n      <Label\n        sx={{\n          position: 'relative',\n          display: 'inline-box',\n          width: props.fullwidth ? '100%' : undefined\n        }}\n        onClick={e => e.preventDefault()}>\n        <BasicSelect\n          onToggle={setOpen}\n          {...props}\n          __themeKey='inputs'\n          variant='baseMagic'\n          value={props.value}\n        />\n        <Text\n          sx={{\n            ml: -1,\n            color: isOpen ? 'blue' : null\n          }}>{props.label}</Text>\n      </Label>\n      <Text variant='helperText'>\n        {props.helperText}\n      </Text>\n    </Box>\n  )\n}\n\nSelect.propTypes = {\n  label: PropTypes.string.isRequired,\n  ...BasicSelect.propTypes\n}\n\nexport default Select\n","import React, { FunctionComponent, useEffect, useRef, useState } from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport { Box, BoxProps } from '@theme-ui/components'\nimport { SLOW, transition } from '../../theme/transitions'\n\nconst OPEN = 0b001\nconst DURING = 0b010\nconst BEFORE = 0b100\n\nconst collapsibleProps = {\n  isOpen: PropTypes.bool.isRequired,\n  children: PropTypes.node.isRequired,\n  hideOnly: PropTypes.bool,\n  noInitialTransition: PropTypes.bool\n}\n\nexport type CollapsibleProps = InferProps<typeof collapsibleProps>\n\nconst Collapsible: FunctionComponent<CollapsibleProps & BoxProps> = ({ isOpen, children, hideOnly, noInitialTransition, ...boxProps }) => {\n  const ref = useRef<HTMLDivElement>(null)\n  const [scrollHeight, setScrollHeight] = useState(0)\n  const [isVisible, setVisible] = useState(isOpen)\n  const [transitionState, setTransitionState] = useState<number>(isOpen ? OPEN : 0)\n  const [isMounted, setMounted] = useState(false)\n  const [init, setInit] = useState(!(noInitialTransition ?? false))\n\n  useEffect(() => {\n    setTimeout(() => setInit(true), SLOW * 1000)\n  }, [])\n\n  const updateScrollHeight = (): void => {\n    if (ref?.current !== null) {\n      setScrollHeight(ref.current.scrollHeight)\n    }\n  }\n\n  useEffect(() => {\n    if (isOpen) {\n      setVisible(true)\n    }\n    setTransitionState(isOpen ? BEFORE | OPEN : BEFORE & ~OPEN)\n  }, [isOpen])\n\n  useEffect(() => {\n    if (isMounted) {\n      updateScrollHeight()\n      if ((transitionState & BEFORE) > 0) {\n        setTransitionState(transitionState & ~BEFORE | DURING)\n      } else if ((transitionState & DURING) > 0) {\n        setTimeout(() => {\n          if (isMounted) {\n            if (transitionState === (DURING & ~OPEN)) {\n              setVisible(false)\n            }\n            setTransitionState(transitionState & ~DURING)\n          }\n        }, SLOW * 1000)\n      }\n    }\n  }, [isMounted, transitionState])\n\n  useEffect(() => {\n    setMounted(true)\n    return () => {\n      setMounted(false)\n    }\n  }, [])\n\n  const height = (transitionState === (DURING | OPEN)) || (transitionState === (BEFORE & ~OPEN))\n    ? scrollHeight.toString() + 'px'\n    : (transitionState === (BEFORE | OPEN)) || (transitionState === (DURING & ~OPEN))\n      ? '0px'\n      : undefined\n\n  return (\n    <Box\n      ref={ref}\n      sx={{\n        height,\n        overflowY: (transitionState & (DURING | BEFORE)) > 0 ? 'hidden' : undefined,\n        ...(init ? transition(SLOW, ['height']) : {})\n      }}\n      {...boxProps}>\n      {hideOnly ?? false\n        ? (\n          <Box sx={{ display: isVisible ? 'block' : 'none' }}>\n            {children}\n          </Box>\n        )\n        : (isVisible ? children : null)}\n    </Box>\n  )\n}\n\nCollapsible.propTypes = collapsibleProps\n\nCollapsible.defaultProps = {\n  noInitialTransition: false\n}\n\nexport default Collapsible\n","import React, { forwardRef, FunctionComponent, useEffect, useState } from 'react'\nimport PropTypes, { InferProps } from 'prop-types'\nimport Well from './Well'\nimport { Box, BoxOwnProps, BoxProps, Flex } from '@theme-ui/components'\nimport Icon from './Icon'\nimport { mdiChevronDown } from '@mdi/js'\nimport { transition } from '../../theme/transitions'\nimport Collapsible from './Collapsible'\nimport { baseWell } from '../../theme/wells'\nimport { isDefined } from '../../utils/componentHelpers'\n\nconst collapsibleWellProps = {\n  defaultOpen: PropTypes.bool,\n  children: PropTypes.node.isRequired,\n  header: PropTypes.node.isRequired,\n  setController: PropTypes.func,\n  noPad: PropTypes.bool,\n  reverseHeader: PropTypes.bool,\n  headerSx: PropTypes.object,\n  hideOnly: PropTypes.bool,\n  onOpen: PropTypes.func,\n  open: PropTypes.bool,\n  color: PropTypes.string\n}\n\nexport interface CollapsibleWellController {\n  show: () => void\n  hide: () => void\n  toggle: () => void\n}\n\nexport interface CollapsibleWellProps extends InferProps<typeof collapsibleWellProps> {\n  color?: string | undefined\n  setController?: ((controller: CollapsibleWellController) => void) | null\n}\n\nconst CollapsibleWell: FunctionComponent<CollapsibleWellProps & BoxOwnProps> = forwardRef<HTMLDivElement, CollapsibleWellProps & BoxProps>(\n  (\n    { defaultOpen, children, header, noPad, setController, hideOnly, reverseHeader, headerSx, onOpen, ...boxProps },\n    ref\n  ) => {\n    const [isOpen, setOpen] = useState(defaultOpen ?? false)\n\n    useEffect(() => {\n      if (isDefined(setController)) {\n        setController({\n          show: () => setOpen(true),\n          hide: () => setOpen(false),\n          toggle: () => setOpen(!isOpen)\n        })\n      }\n    }, [isOpen, setController])\n\n    useEffect(() => {\n      if (isOpen) {\n        onOpen?.()\n      }\n    }, [isOpen, onOpen])\n\n    return (\n      <Well\n        ref={ref}\n        {...boxProps}\n        sx={{ p: [0, 0, 0, 0], ...(boxProps.sx) }}>\n        <Flex\n          onClick={() => setOpen(!isOpen)}\n          sx={{\n            px: baseWell.px,\n            py: baseWell.py,\n            ':hover': {\n              backgroundColor: 'highlight'\n            },\n            alignItems: 'center',\n            justifyContent: 'space-between',\n            flexDirection: reverseHeader ?? false ? 'row-reverse' : 'row',\n            ...headerSx\n          }}>\n          {header}\n          <Icon\n            path={mdiChevronDown}\n            sx={{\n              ...transition(0.3, ['transform']),\n              transform: isOpen ? 'rotate(180deg)' : undefined\n            }}\n          />\n        </Flex>\n        <Collapsible isOpen={isOpen} hideOnly={hideOnly}>\n          <Box\n            className='collapsible-content'\n            px={noPad ?? false ? undefined : baseWell.px}\n            py={noPad ?? false ? undefined : baseWell.py}\n            sx={{\n              borderTopColor: 'border',\n              borderTopWidth: '1px',\n              borderTopStyle: 'solid'\n            }}>\n            {children}\n          </Box>\n        </Collapsible>\n      </Well>\n    )\n  }\n)\n\nCollapsibleWell.propTypes = collapsibleWellProps\n\nCollapsibleWell.displayName = 'CollapsibleWell'\n\nexport default CollapsibleWell\n","import React, { FunctionComponent, useState } from 'react'\nimport { useRoom } from '../lib/RoomContext'\nimport { Flex } from 'theme-ui'\nimport NavBar from './NavBar'\nimport { transition } from '../theme/transitions'\nimport { Home } from './Home'\nimport { Room } from './Room'\nimport { GameContextProvider } from '../Game/GameContext'\nimport { GamePlayer } from './GamePlayer'\nimport { withAlertQueue } from './common/AlertContext'\nimport GameRenderer from './GameRenderer'\nimport { Box } from '@theme-ui/components'\n\nexport enum AppState {\n  HOME,\n  ROOM,\n  GAME\n}\n\nconst App: FunctionComponent = () => {\n  const [state, _setState] = useState(AppState.HOME)\n  const room = useRoom()\n  const setState = (newState: AppState): void => {\n    if (newState !== state) {\n      if (newState === AppState.HOME) {\n        room.leaveRoom()\n        window.history.pushState({\n          pageTitle: 'Whatever Game'\n        }, '', process.env.PUBLIC_URL)\n      } else if (newState === AppState.ROOM) {\n        window.history.pushState({\n          pageTitle: (room.roomCode ?? '') + ' - Whatever Game'\n        }, '', `${process.env.PUBLIC_URL}/${room.roomCode ?? ''}`)\n      }\n      _setState(newState)\n    }\n  }\n  return (\n    <Box>\n      <NavBar setState={setState} state={state}/>\n      <Box sx={{ width: '100vw', height: '100vh', overflow: 'hidden', position: 'relative' }}>\n        <GameContextProvider>\n          <GameRenderer/>\n          <Flex sx={{ width: '100vw', bottom: 0, left: `${-(state - 2) * 100}%`, position: 'absolute', ...transition(0.3, ['left'], 'linear') }}>\n            <GamePlayer setState={setState}/>\n          </Flex>\n          <Flex sx={{ width: '100vw', height: '100vh', left: `${-(state - 1) * 100}%`, justifyContent: 'center', alignItems: 'center', position: 'absolute', ...transition(0.3, ['left'], 'linear') }}>\n            <Room setState={setState}/>\n          </Flex>\n          <Flex sx={{ width: '100vw', height: '100vh', left: `${-state * 100}%`, justifyContent: 'center', alignItems: 'center', position: 'absolute', ...transition(0.3, ['left'], 'linear') }}>\n            <Home setState={setState}/>\n          </Flex>\n        </GameContextProvider>\n      </Box>\n    </Box>\n  )\n}\n\nexport default withAlertQueue(App)\n","import { Box, Divider, Flex } from '@theme-ui/components'\nimport Button from './common/Button'\nimport Select from './common/Select'\nimport { Color, GrowthStage } from '../3d/constants'\nimport Input from './common/Input'\nimport CollapsibleWell from './common/CollapsibleWell'\nimport React, { FunctionComponent, useMemo, useState } from 'react'\nimport { GameState } from '../Game/types/GameState'\nimport { Room, RoomState } from '../lib/Room'\nimport { Axial } from '../3d/Coordinates/Axial'\nimport PropTypes from 'prop-types'\nimport { PlayerInfo } from '../Game/types/PlayerInfo'\nimport { useAlert } from './common/AlertContext'\n\ninterface props {\n  mi: number // my player id\n  roomState: RoomState\n  purchase: (growStage: GrowthStage) => Promise<void>\n  plantSeed: (source: Axial, target: Axial) => Promise<void>\n  growTree: (source: Axial) => Promise<void>\n  endTurn: () => Promise<void>\n  nextRound: () => void\n}\n\nconst propTypes = {\n  mi: PropTypes.number.isRequired,\n  roomState: PropTypes.any.isRequired,\n  purchase: PropTypes.func.isRequired,\n  plantSeed: PropTypes.func.isRequired,\n  growTree: PropTypes.func.isRequired,\n  endTurn: PropTypes.func.isRequired,\n  nextRound: PropTypes.func.isRequired\n}\n\nexport const Panel: FunctionComponent<props> = ({ mi, roomState, purchase, plantSeed, growTree, endTurn, nextRound }) => {\n  const [axialString, setAxialString] = useState('')\n  const [axialString2, setAxialString2] = useState('')\n  const [stage, setStage] = useState<GrowthStage>(GrowthStage.SEED)\n  const axial = useMemo(() => Axial.fromString(axialString), [axialString])\n  const axial2 = useMemo(() => Axial.fromString(axialString2), [axialString2])\n  const gameState: GameState | undefined = roomState.game\n  const playerInfo: PlayerInfo | undefined = gameState?.playerInfo[mi]\n  const gameOver = gameState?.gameOver\n  const _alert = useAlert()\n  const alert = (e: string): void => {\n    console.error(e)\n    _alert(e)\n  }\n  const clickToSeed = (): void => {\n    plantSeed(axial, axial2).catch(alert)\n  }\n  const clickToGrow = (): void => {\n    growTree(axial).catch(alert)\n  }\n  const clickToPurchase = (): void => {\n    purchase(stage).catch(alert)\n  }\n  const clickToEndTurn = (): void => {\n    endTurn().catch(alert)\n  }\n  return (\n    <CollapsibleWell header='Board' sx={{ m: 0, backgroundColor: 'rgba(255, 255, 255, 0.6)' }} color='background.0'>\n      <Flex>\n        <Box>\n          <Button onClick={() => console.log(gameState)}>Log Game State</Button>\n          <Button onClick={() => console.log(roomState)}>Log Room State</Button>\n          <Select\n            label='GrowthStage'\n            value={stage}\n            choices={[GrowthStage.SEED, GrowthStage.SHORT, GrowthStage.MID, GrowthStage.TALL].map(v => [v, GrowthStage[v]])}\n            formatKey='1'\n            valueKey='0'\n            onSelect={setStage}\n          />\n          <Input\n            label='Axial'\n            onChange={({ target: { value } }: { target: { value: string } }) => setAxialString(value)}\n          />\n          <Input\n            label='Axial2'\n            onChange={({ target: { value } }: { target: { value: string } }) => setAxialString2(value)}\n          />\n          <Button onClick={clickToSeed}>Seed</Button>\n          <Button onClick={clickToGrow}>Grow</Button>\n          <Button onClick={clickToPurchase}>Purchase</Button>\n          <Button onClick={clickToEndTurn}>End Turn</Button>\n        </Box>\n        {gameState !== undefined && (\n          <Box>\n            <Box>Public</Box>\n            <Box>{Room.getName(roomState, gameState.turn)} turn</Box>\n            <Box>Ray Direction {gameState.rayDirection}</Box>\n            <Box>Rotation left {gameState.revolutionLeft}</Box>\n            <Box>Tokens: {gameState.revolutionLeft}</Box>\n            <Box>Me: {mi} {Room.getName(roomState, mi)}</Box>\n            <Box>Color: {playerInfo?.color !== undefined ? Color[playerInfo?.color] : ''}</Box>\n            <Box>LightPoint: {playerInfo?.lightPoint}</Box>\n            <Box>Score: {playerInfo?.score}</Box>\n            <Box>Available: {JSON.stringify(playerInfo?.availableArea)}</Box>\n            <Box>Board: {JSON.stringify(playerInfo?.playerBoard)}</Box>\n          </Box>\n        )}\n      </Flex>\n      {\n        gameOver !== undefined && (\n          <Box>\n            <Divider/>\n            <Button variant='primary' onClick={() => nextRound}>Next Round</Button>\n            {gameOver}\n          </Box>\n        )\n      }\n    </CollapsibleWell>\n  )\n}\n\nPanel.propTypes = propTypes\n","import React, { FunctionComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport { useGame } from '../Game/GameContext'\nimport { Box, Flex } from '@theme-ui/components'\nimport { AppState } from './App'\nimport { useRoom } from '../lib/RoomContext'\nimport { Panel } from './Panel'\n\nconst propTypes = {\n  setState: PropTypes.func.isRequired\n}\n\nexport const GamePlayer: FunctionComponent<PropTypes.InferProps<typeof propTypes>> = ({ setState }) => {\n  const [game] = useGame()\n  const room = useRoom()\n  return (\n    <Box\n      sx={{\n        width: '100%',\n        height: '100%'\n      }}>\n      <Flex\n        sx={{\n          width: '100vw',\n          flexDirection: 'column',\n          justifyContent: 'flex-end',\n          position: 'absolute',\n          left: 0,\n          bottom: 0\n        }}>\n        {room.started &&\n        <Panel\n          mi={game.mi}\n          roomState={room.state}\n          purchase={game.purchase.bind(game)}\n          plantSeed={game.plantSeed.bind(game)}\n          growTree={game.growTree.bind(game)}\n          endTurn={game.endTurn.bind(game)}\n          nextRound={() => {\n            setState(AppState.ROOM)\n          }}\n        />}\n      </Flex>\n    </Box>\n  )\n}\n\nGamePlayer.propTypes = propTypes\n","import React, { FunctionComponent, useEffect, useRef } from 'react'\nimport { Box } from '@theme-ui/components'\nimport { WebGLRendererSystem } from 'ecsy-three'\nimport { useGame } from '../Game/GameContext'\n\nconst GameRenderer: FunctionComponent = () => {\n  const ref = useRef<HTMLDivElement | null>(null)\n  const [game] = useGame()\n  const gameWorld = game.gameWorld\n\n  useEffect(() => {\n    const divElem = ref.current\n    if (divElem !== null) {\n      divElem.childNodes.forEach(child => {\n        divElem.removeChild(child)\n      })\n      divElem.appendChild(gameWorld.renderer.domElement)\n      gameWorld.world.getSystem(WebGLRendererSystem)?.onResize()\n    }\n  }, [ref, gameWorld.renderer.domElement, gameWorld.world])\n\n  return (\n    <Box\n      ref={ref}\n      sx={{\n        width: '100vw',\n        height: '100vh',\n        position: 'absolute',\n        left: 0,\n        top: 0,\n        right: 0,\n        bottom: 0,\n        canvas: {\n          width: '100%',\n          height: '100%'\n        }\n      }}\n    />\n  )\n}\n\nexport default GameRenderer\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/.exec(window.location.hostname)\n)\n\ninterface Config {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\n}\n\nexport function register (config?: Config): void {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    )\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          )\n        }).catch(console.error)\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW (swUrl: string, config?: Config): void {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller !== null) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config?.onUpdate !== undefined) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              config?.onSuccess?.(registration)\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker (swUrl: string, config?: Config): void {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && !contentType.includes('javascript'))\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          }).catch(console.error)\n        }).catch(console.error)\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister (): void {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister().catch(console.error)\n      })\n      .catch((error: Error) => {\n        console.error(error.message)\n      })\n  }\n}\n","import React, { FunctionComponent } from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './components/App'\nimport * as serviceWorker from './serviceWorker'\nimport { Global } from '@emotion/core'\nimport theme from './theme'\nimport { ThemeProvider } from 'theme-ui'\nimport { startLoad } from './3d/assets'\n\nconst MyGlobal: FunctionComponent = () => (\n  <Global\n    styles={(theme) => ({\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment\n      body: theme.styles.body,\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment\n      '*': theme.styles['*'],\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access,@typescript-eslint/no-unsafe-assignment\n      a: theme.styles.a\n    })}\n  />\n)\n\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <MyGlobal/>\n      <App/>\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\nstartLoad()\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}